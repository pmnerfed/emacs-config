<?xml version="1.0" encoding="utf-8"?>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-02 Tue 13:05 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doom Emacs Configuration</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="tecosaur" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel='shortcut icon' type='image/png' href='https://www.gnu.org/software/emacs/favicon.png'>
<!––tec/custom-head-start--><style type="text/css">
   :root {
      --theme-bg: #242730;
      --theme-bg-alt: #2a2e38;
      --theme-base0: #1c1f24;
      --theme-base1: #1c1f24;
      --theme-base2: #21272d;
      --theme-base3: #23272e;
      --theme-base4: #484854;
      --theme-base5: #62686E;
      --theme-base6: #757B80;
      --theme-base7: #9ca0a4;
      --theme-base8: #DFDFDF;
      --theme-fg: #bbc2cf;
      --theme-fg-alt: #5D656B;
      --theme-grey: #484854;
      --theme-red: #ff665c;
      --theme-orange: #e69055;
      --theme-green: #7bc275;
      --theme-teal: #4db5bd;
      --theme-yellow: #FCCE7B;
      --theme-blue: #51afef;
      --theme-dark-blue: #1f5582;
      --theme-magenta: #C57BDB;
      --theme-violet: #a991f1;
      --theme-cyan: #5cEfFF;
      --theme-dark-cyan: #6A8FBF;
   }
</style>
<link rel='stylesheet' type='text/css' href='https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css'/>
<link rel='stylesheet' type='text/css' href='https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css'/>

<script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script type='text/javascript' src='https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js'></script>
<script type='text/javascript' src='https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js'></script>

<style>
 pre.src {
     background-color: var(--theme-bg);
     color: var(--theme-fg);
     scrollbar-color:#bbb6#9992;
     scrollbar-width: thin;
     margin: 0;
     border: none;
 }
 div.org-src-container {
     border-radius: 12px;
     overflow: hidden;
     margin-bottom: 24px;
     margin-top: 1px;
     border: 1px solid#e1e4e5;
 }
 pre.src::before {
     background-color:#6666;
     top: 8px;
     border: none;
     border-radius: 5px;
     line-height: 1;
     border: 2px solid var(--theme-bg);
     opacity: 0;
     transition: opacity 200ms;
 }
 pre.src:hover::before { opacity: 1; }
 pre.src:active::before { opacity: 0; }

 pre.example {
     border-radius: 12px;
     background: var(--theme-bg-alt);
     color: var(--theme-fg);
 }

 code {
     border-radius: 5px;
     background:#e8e8e8;
     font-size: 80%;
 }

 kbd {
     display: inline-block;
     padding: 3px 5px;
     font: 80% SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
     line-height: normal;
     line-height: 10px;
     color:#444d56;
     vertical-align: middle;
     background-color:#fafbfc;
     border: 1px solid#d1d5da;
     border-radius: 3px;
     box-shadow: inset 0 -1px 0#d1d5da;
 }

 table {
     max-width: 100%;
     overflow-x: auto;
     display: block;
     border-top: none;
 }

 a:not([aria-hidden='true']) {
     text-decoration: none;
     background-image: linear-gradient(#d8dce9, #d8dce9);
     background-position: 0% 100%;
     background-repeat: no-repeat;
     background-size: 0% 2px;
     transition: background-size .3s;
 }
 #table-of-contents a {
     background-image: none;
 }
 a:hover:not([aria-hidden='true']),
 a:focus:not([aria-hidden='true']) {
     background-size: 100% 2px;
 }
 a[href^='#'] { font-variant-numeric: oldstyle-nums; }
 a[href^='#']:visited { color:#3091d1; }

 li .checkbox {
     display: inline-block;
     width: 0.9em;
     height: 0.9em;
     border-radius: 3px;
     margin: 3px;
     top: 4px;
     position: relative;
 }
 li.on > .checkbox { background: var(--theme-green); box-shadow: 0 0 2px var(--theme-green); }
 li.trans > .checkbox { background: var(--theme-orange); box-shadow: 0 0 2px var(--theme-orange); }
 li.off > .checkbox { background: var(--theme-red); box-shadow: 0 0 2px var(--theme-red); }
 li.on > .checkbox::after {
     content: '';
     height: 0.45em;
     width: 0.225em;
     -webkit-transform-origin: left top;
     transform-origin: left top;
     transform: scaleX(-1) rotate(135deg);
     border-right: 2.8px solid#fff;
     border-top: 2.8px solid#fff;
     opacity: 0.9;
     left: 0.10em;
     top: 0.45em;
     position: absolute;
 }
 li.trans > .checkbox::after {
     content: '';
     font-weight: bold;
     font-size: 1.6em;
     position: absolute;
     top: 0.23em;
     left: 0.09em;
     width: 0.35em;
     height: 0.12em;
     background:#fff;
     opacity: 0.9;
     border-radius: 0.1em;
 }
 li.off > .checkbox::after {
     content: '✖';
     color:#fff;
     opacity: 0.9;
     position: relative;
     top: -0.40rem;
     left: 0.17em;
     font-size: 0.75em;
 }

 span.timestamp {
     color: #003280;
     background: #647CFF44;
     border-radius: 3px;
     line-height: 1.25;
 }

 #content img {
     border-radius: 3px;
 }

 #table-of-contents { overflow-y: auto; }
 blockquote p { margin: 8px 0px 16px 0px; }
 #postamble .date { color: var(--theme-green); }

 ::-webkit-scrollbar { width: 10px; height: 8px; }
 ::-webkit-scrollbar-track { background:#9992; }
 ::-webkit-scrollbar-thumb { background:#ccc; border-radius: 10px; }
 ::-webkit-scrollbar-thumb:hover { background:#888; }

 /* sometimes this all-important space seems to go missing
 /so let's protect against that. If it's exteranious it's
 /just gobbled anyway. */
 span.section-number-1:after,
 span.section-number-2:after,
 span.section-number-3:after,
 span.section-number-4:after,
 span.section-number-5:after,
 span.section-number-6:after {
     content: ' '
 }

 /* so the bounding box coveres the <a> */
 h1,h2,h3,h4,h5,h6 {
     padding-left: 30px;
     margin-left: -30px;
 }

 h1 > a[aria-hidden='true'],
 h2 > a[aria-hidden='true'],
 h3 > a[aria-hidden='true'],
 h4 > a[aria-hidden='true'],
 h5 > a[aria-hidden='true'],
 h6 > a[aria-hidden='true'] {
     color: #6a737d;
     float: left;
     padding-right: 4px;
     margin-left: -25px;
     position: relative;
     top: 7px;
     line-height: 1;
     font-size: 70%;
     visibility: hidden;
 }

 h1:hover > a[aria-hidden='true'],
 h2:hover > a[aria-hidden='true'],
 h3:hover > a[aria-hidden='true'],
 h4:hover > a[aria-hidden='true'],
 h5:hover > a[aria-hidden='true'],
 h6:hover > a[aria-hidden='true'] {
     visibility: visible;
 }
</style>
<!––tec/custom-head-end-->
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Doom Emacs Configuration</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#intro">1. Intro</a>
<ul>
<li><a href="#notes-unwary-adventurer">1.1. Notes for the unwary adventurer</a>
<ul>
<li><a href="#extra-requirements">1.1.1. Extra Requirements</a></li>
</ul>
</li>
<li><a href="#current-issues">1.2. Current Issues</a>
<ul>
<li><a href="#magit-push-daemon">1.2.1. Magit push in daemon</a></li>
<li><a href="#calctex-brings-up">1.2.2. CalcTeX brings up compilation buffer</a></li>
<li><a href="#unread-emails-doesnt">1.2.3. Unread emails doesn&rsquo;t work across Emacs instances</a></li>
</ul>
</li>
<li><a href="#editor-comparison">1.3. Editor comparison</a></li>
</ul>
</li>
<li><a href="#rudimentary-configuration">2. Rudimentary configuration</a>
<ul>
<li><a href="#personal-information">2.1. Personal Information</a></li>
<li><a href="#better-defaults">2.2. Better defaults</a>
<ul>
<li><a href="#simple-settings">2.2.1. Simple settings</a></li>
<li><a href="#fullscreen">2.2.2. Fullscreen</a></li>
<li><a href="#auto-customisations">2.2.3. Auto-customisations</a></li>
<li><a href="#windows">2.2.4. Windows</a></li>
<li><a href="#buffer-defaults">2.2.5. Buffer defaults</a></li>
</ul>
</li>
<li><a href="#doom-configuration">2.3. Doom configuration</a>
<ul>
<li><a href="#visual-settings">2.3.1. Visual Settings</a>
<ul>
<li><a href="#font-face">2.3.1.1. Font Face</a></li>
<li><a href="#theme-modeline">2.3.1.2. Theme and modeline</a></li>
<li><a href="#miscellaneous">2.3.1.3. Miscellaneous</a></li>
</ul>
</li>
<li><a href="#some-helper-macros">2.3.2. Some helper macros</a></li>
</ul>
</li>
<li><a href="#other-things">2.4. Other things</a>
<ul>
<li><a href="#editor-interaction">2.4.1. Editor interaction</a>
<ul>
<li><a href="#mouse-buttons">2.4.1.1. Mouse buttons</a></li>
</ul>
</li>
<li><a href="#window-title">2.4.2. Window title</a></li>
<li><a href="#splash-screen">2.4.3. Splash screen</a></li>
<li><a href="#systemd-daemon">2.4.4. Systemd daemon</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#package-loading">3. Package loading</a>
<ul>
<li><a href="#loading-instructions">3.1. Loading instructions</a>
<ul>
<li><a href="#packages-melpa-elpa">3.1.1. Packages in MELPA/ELPA/emacsmirror</a></li>
<li><a href="#packages-from-git">3.1.2. Packages from git repositories</a></li>
<li><a href="#disabling-built-packages">3.1.3. Disabling built-in packages</a></li>
</ul>
</li>
<li><a href="#general-packages">3.2. General packages</a>
<ul>
<li><a href="#prettification">3.2.1. Prettification</a></li>
<li><a href="#window-management">3.2.2. Window management</a></li>
<li><a href="#fun">3.2.3. Fun</a></li>
<li><a href="#improving-features">3.2.4. Improving features</a>
<ul>
<li><a href="#flyspell-lazy">3.2.4.1. Flyspell-lazy</a></li>
<li><a href="#calctex">3.2.4.2. CalcTeX</a></li>
<li><a href="#ess">3.2.4.3. ESS</a></li>
<li><a href="#magit-delta">3.2.4.4. Magit Delta</a></li>
<li><a href="#info-colours">3.2.4.5. Info colours</a></li>
</ul>
</li>
<li><a href="#email">3.2.5. Email</a></li>
</ul>
</li>
<li><a href="#language-packages">3.3. Language packages</a>
<ul>
<li><a href="#latex">3.3.1. LaTeX</a></li>
<li><a href="#org-mode">3.3.2. Org Mode</a>
<ul>
<li><a href="#improve-agenda-capture">3.3.2.1. Improve agenda/capture</a></li>
<li><a href="#visuals">3.3.2.2. Visuals</a></li>
<li><a href="#extra-functionality">3.3.2.3. Extra functionality</a></li>
</ul>
</li>
<li><a href="#systemd">3.3.3. Systemd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#package-configuration">4. Package configuration</a>
<ul>
<li><a href="#abbrev-mode">4.1. Abbrev mode</a></li>
<li><a href="#calc">4.2. Calc</a></li>
<li><a href="#centaur-tabs">4.3. Centaur Tabs</a></li>
<li><a href="#company">4.4. Company</a>
<ul>
<li><a href="#plain-text">4.4.1. Plain Text</a></li>
<li><a href="#company-ess">4.4.2. ESS</a></li>
</ul>
</li>
<li><a href="#elcord">4.5. Elcord</a></li>
<li><a href="#emacs-anywhere-configuration">4.6. Emacs Anywhere configuration</a></li>
<li><a href="#eros-eval">4.7. Eros-eval</a></li>
<li><a href="#evil">4.8. EVIL</a></li>
<li><a href="#flyspell">4.9. Flyspell</a></li>
<li><a href="#info-colors">4.10. Info colors</a></li>
<li><a href="#ispell">4.11. Ispell</a></li>
<li><a href="#ivy">4.12. Ivy</a></li>
<li><a href="#magit">4.13. Magit</a></li>
<li><a href="#mail">4.14. Mail</a>
<ul>
<li><a href="#fetching">4.14.1. Fetching</a>
<ul>
<li><a href="#rebuild-mail-index">4.14.1.1. Rebuild mail index while using mu4e</a></li>
<li><a href="#config-transcoding-">4.14.1.2. Config transcoding &amp; service management</a></li>
<li><a href="#fetching-systemd">4.14.1.3. Systemd</a></li>
</ul>
</li>
<li><a href="#indexing-searching">4.14.2. Indexing/Searching</a></li>
<li><a href="#sending">4.14.3. Sending</a>
<ul>
<li><a href="#system-hackery">4.14.3.1. System hackery</a></li>
</ul>
</li>
<li><a href="#mu4e">4.14.4. Mu4e</a>
<ul>
<li><a href="#viewing-mail">4.14.4.1. Viewing Mail</a></li>
<li><a href="#sending-mail">4.14.4.2. Sending Mail</a></li>
<li><a href="#getting-notified">4.14.4.3. Getting notified</a></li>
<li><a href="#process-control">4.14.4.4. Process control</a></li>
</ul>
</li>
<li><a href="#org-msg">4.14.5. Org Msg</a></li>
</ul>
</li>
<li><a href="#org-chef">4.15. Org Chef</a></li>
<li><a href="#projectile">4.16. Projectile</a></li>
<li><a href="#smart-parentheses">4.17. Smart Parentheses</a></li>
<li><a href="#spray">4.18. Spray</a></li>
<li><a href="#theme-magic">4.19. Theme magic</a></li>
<li><a href="#tramp">4.20. Tramp</a>
<ul>
<li>
<ul>
<li><a href="#troubleshooting">4.20.0.1. Troubleshooting</a>
<ul>
<li><a href="#zsh">4.20.0.1.1. Zsh</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#treemacs">4.21. Treemacs</a></li>
<li><a href="#vterm">4.22. VTerm</a></li>
<li><a href="#which-key">4.23. Which-key</a></li>
<li><a href="#xkcd">4.24. xkcd</a></li>
<li><a href="#yasnippet">4.25. YASnippet</a></li>
</ul>
</li>
<li><a href="#language-configuration">5. Language configuration</a>
<ul>
<li>
<ul>
<li><a href="#file-templates">5.0.1. File Templates</a></li>
</ul>
</li>
<li><a href="#plaintext">5.1. Plaintext</a></li>
<li><a href="#org">5.2. Org Mode</a>
<ul>
<li><a href="#system-config">5.2.1. System config</a></li>
<li><a href="#behaviour">5.2.2. Behaviour</a>
<ul>
<li><a href="#tweaking-defaults">5.2.2.1. Tweaking defaults</a></li>
<li><a href="#behaviour-extra-functionality">5.2.2.2. Extra functionality</a>
<ul>
<li><a href="#org-buffer-creation">5.2.2.2.1. Org buffer creation</a></li>
<li><a href="#list-bullet-sequence">5.2.2.2.2. List bullet sequence</a></li>
<li><a href="#citation">5.2.2.2.3. Citation</a></li>
<li><a href="#cdlatex">5.2.2.2.4. cdlatex</a></li>
<li><a href="#spellcheck">5.2.2.2.5. Spellcheck</a></li>
<li><a href="#lsp-support-src">5.2.2.2.6. LSP support in <code>src</code> blocks</a></li>
<li><a href="#view-exported-file">5.2.2.2.7. View exported file</a></li>
</ul>
</li>
<li><a href="#super-agenda">5.2.2.3. Super agenda</a></li>
<li><a href="#capture">5.2.2.4. Capture</a></li>
<li><a href="#roam">5.2.2.5. Roam</a>
<ul>
<li><a href="#basic-settings">5.2.2.5.1. Basic settings</a></li>
<li><a href="#registering-roam-protocol">5.2.2.5.2. Registering roam protocol</a></li>
<li><a href="#graph-behaviour">5.2.2.5.3. Graph Behaviour</a></li>
<li><a href="#modeline-file-name">5.2.2.5.4. Modeline file name</a></li>
</ul>
</li>
<li><a href="#nicer-generated-heading">5.2.2.6. Nicer generated heading IDs</a></li>
<li><a href="#nicer-org-return">5.2.2.7. Nicer <code>org-return</code></a></li>
<li><a href="#org-plot">5.2.2.8. Org Plot</a></li>
<li><a href="#extra-links">5.2.2.9. Extra links</a>
<ul>
<li><a href="#extra-links-xkcd">5.2.2.9.1. xkcd</a></li>
<li><a href="#youtube">5.2.2.9.2. YouTube</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org-mode-visuals">5.2.3. Visuals</a>
<ul>
<li><a href="#editor">5.2.3.1. In editor</a>
<ul>
<li><a href="#font-display">5.2.3.1.1. Font Display</a></li>
<li><a href="#symbols">5.2.3.1.2. Symbols</a></li>
<li><a href="#latex-fragments">5.2.3.1.3. LaTeX Fragments</a></li>
<li><a href="#stolen-from-scimax">5.2.3.1.4. Stolen from scimax (semi-working right now)</a></li>
</ul>
</li>
<li><a href="#exporting-general">5.2.3.2. Exporting (general)</a></li>
<li><a href="#exporting-html">5.2.3.3. Exporting to HTML</a>
<ul>
<li><a href="#custom-css-js">5.2.3.3.1. Custom CSS/JS</a></li>
<li><a href="#make-verbatim-different">5.2.3.3.2. Make verbatim different to code</a></li>
<li><a href="#change-checkbox-type">5.2.3.3.3. Change checkbox type</a></li>
<li><a href="#header-anchors">5.2.3.3.4. Header anchors</a></li>
<li><a href="#latex-rendering">5.2.3.3.5. LaTeX Rendering</a></li>
</ul>
</li>
<li><a href="#exporting-latex">5.2.3.4. Exporting to LaTeX</a>
<ul>
<li><a href="#chameleon-aka-match">5.2.3.4.1. Chameleon &#x2014; aka. match theme</a></li>
<li><a href="#exporting-latex-make">5.2.3.4.2. Make verbatim different to code</a></li>
</ul>
</li>
<li><a href="#exporting-beamer">5.2.3.5. Exporting to Beamer</a></li>
<li><a href="#exporting-gfm">5.2.3.6. Exporting to GFM</a></li>
</ul>
</li>
<li><a href="#babel">5.2.4. Babel</a></li>
<li><a href="#org-mode-ess">5.2.5. ESS</a></li>
</ul>
</li>
<li><a href="#language-configuration-latex">5.3. LaTeX</a>
<ul>
<li><a href="#be-implemented-ideas">5.3.1. To-be-implemented ideas</a></li>
<li><a href="#compilation">5.3.2. Compilation</a></li>
<li><a href="#snippet-helpers">5.3.3. Snippet helpers</a>
<ul>
<li><a href="#template">5.3.3.1. Template</a></li>
<li><a href="#deliminators">5.3.3.2. Deliminators</a></li>
</ul>
</li>
<li><a href="#editor-visuals">5.3.4. Editor visuals</a></li>
<li><a href="#latex-cdlatex">5.3.5. CDLaTeX</a></li>
<li><a href="#synctex">5.3.6. SyncTeX</a></li>
<li><a href="#evilification">5.3.7. Evilification</a></li>
</ul>
</li>
<li><a href="#python">5.4. Python</a></li>
<li><a href="#r">5.5. R</a>
<ul>
<li><a href="#r-editor-visuals">5.5.1. Editor Visuals</a></li>
</ul>
</li>
<li><a href="#hledger">5.6. hledger</a></li>
<li><a href="#markdown">5.7. Markdown</a></li>
<li><a href="#beancount">5.8. Beancount</a></li>
</ul>
</li>
</ul>
</div>
</div>
<blockquote>
<p>
Let us change our traditional attitude to the construction of programs:
Instead of imagining that our main task is to instruct a computer what to do,
let us concentrate rather on explaining to human beings what we want a
computer to do. &#x2014; Donald Knuth
</p>
</blockquote>

<div id="outline-container-intro" class="outline-2">
<h2 id="intro"> <a class="anchor" aria-hidden="true" href="#intro">🔗</a><span class="section-number-2">1</span> Intro</h2>
<div class="outline-text-2" id="text-1">
<p>
Customising an editor can be very rewarding &#x2026; until you have to leave it.
For years I have been looking for ways to avoid this pain.
Then I discovered <a href="https://github.com/cknadler/vim-anywhere">vim-anywhere</a>, and found that it had an Emacs companion,<a href="https://github.com/zachcurry/emacs-anywhere">
emacs-anywhere</a>. To me, this looked most attractive.
</p>

<p>
Separately, online I have seen the following statement enough times I think it&rsquo;s a catchphrase
</p>
<blockquote>
<p>
Redditor1: I just discovered this thing, isn&rsquo;t it cool. <br />
Redditor2: Oh, there&rsquo;s an Emacs mode for that.
</p>
</blockquote>

<p>
I tried out the <kbd>spacemacs</kbd> distribution a bit, but it wasn&rsquo;t quite to my liking.
Then I heard about <kbd>doom emacs</kbd> and thought I may as well give that a try.
TLDR; it&rsquo;s great.
</p>

<p>
Now I&rsquo;ve discovered the wonders of literate programming, and am becoming more
settled by the day. This is my config, and also a cautionary tale (just replace
&ldquo;Linux&rdquo; with &ldquo;Emacs&rdquo; in the comic below).
</p>

<p>
<img src='https://imgs.xkcd.com/comics/cautionary.png' title="This really is a true story, and she doesn't know I put it in my comic because her wifi hasn't worked for weeks." alt='Cautionary'>
</p>
</div>

<div id="outline-container-notes-unwary-adventurer" class="outline-3">
<h3 id="notes-unwary-adventurer"> <a class="anchor" aria-hidden="true" href="#notes-unwary-adventurer">🔗</a> <a class="anchor" aria-hidden="true" href="#notes-unwary-adventurer">🔗</a><span class="section-number-3">1.1</span> Notes for the unwary adventurer</h3>
<div class="outline-text-3" id="text-1-1">
<p>
If you like the look of this, that&rsquo;s marvellous, and I&rsquo;m really happy that I&rsquo;ve
made something which you may find interesting, however:
</p>
<div class="warning">
<p>
This config is <i>insidious</i>. Copying the whole thing blindly can easily lead to
undesired effects. I recommend copying chunks instead.
</p>

</div>

<p>
If you are so bold as to wish to steal bits of my config (or if I upgrade and
wonder why things aren&rsquo;t working), here&rsquo;s a list of sections which rely on
externally setup (i.e. outside of this config).
</p>

<dl class="org-dl">
<dt>libvterm</dt><dd>I rely on my distro-provided <kbd>libvterm.so</kbd>, <a href="#vterm">vterm</a> sets a compile flag.
If this causes issues, just delete the <code>(setq term-module-cmake-args ...)</code> bit.</dd>
<dt>dictionary</dt><dd>I&rsquo;ve downloaded a custom <a href="http://app.aspell.com/create">SCOWL</a> dictionary, which I use in <a href="#ispell">ispell</a>.
If this causes issues, just delete the <code>(setq ispell-dictionary ...)</code> bit.</dd>
<dt>uni-units file</dt><dd>I&rsquo;ve got a file in <kbd>~/.org/.uni-units</kbd> which I use in <code>org-capture</code>
If this causes issues, just remove the reference to that file in <a href="#capture">Capture</a> and
instances of <code>unit-prompt</code> used in  <code>(doct ...)</code></dd>
</dl>

<p>
Oh, did I mention that I started this config when I didn&rsquo;t know any <kbd>elisp</kbd>, and
this whole thing is a hack job? If you can suggest any improvements, please do
so, no matter how much critisism you include I&rsquo;ll appreciate it :)
</p>

<p>
<img src='https://imgs.xkcd.com/comics/code_quality.png' title="I honestly didn't think you could even USE emoji in variable names. Or that there were so many different crying ones." alt='Code Quality'>
</p>
</div>
<div id="outline-container-extra-requirements" class="outline-4">
<h4 id="extra-requirements"> <a class="anchor" aria-hidden="true" href="#extra-requirements">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-requirements">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-requirements">🔗</a><span class="section-number-4">1.1.1</span> Extra Requirements</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
The lovely <code>doom doctor</code> is good at diagnosing most missing things, but here are a
few extras.
</p>
<ul class="org-ul">
<li><p>
The <a href="https://github.com/dandavison/delta/">Delta</a> binary. It&rsquo;s packaged for some distributions but I installed it with
</p>
<div class="org-src-container">
<pre class="src src-shell">cargo install git-delta
</pre>
</div></li>
<li>A <a href="https://www.tug.org/texlive/">LaTeX Compiler</a> is required for the mathematics rendering performed in <a href="#org">Org</a>,
and by <a href="#calctex">CalcTeX</a>.</li>
<li>I use the <a href="https://overpassfont.org/">Overpass</a> font as a go-to sans serif.
It&rsquo;s used as my <code>doom-variable-pitch-font</code> and in the graph generated by <a href="#roam">Roam</a>.
I have chosen it because it possesses a few characteristics I consider
desirable, namely:
<ul class="org-ul">
<li>A clean, and legible style. Highway-style fonts tend to be designed to be
clear at a glance, and work well with a thicker weight, and this is inspired
by <i>Highway Gothic</i>.</li>
<li>It&rsquo;s slightly quirky. Look at the diagonal cut on stems for example.
Helvetica is a masterful design, but I like a bit more pizazz now and then.</li>
</ul></li>
<li>A few LSP servers. Take a look at <a href="init.el">init.el</a> to see which modules have the <code>+lsp</code> flag.</li>
<li><p>
The <kbd>cargo-script</kbd> rust crate is required for evaluation of rust blocks by babel.
As described in the README for <a href="https://github.com/micanzhang/ob-rust">ob-rust</a>. Like <code>delta</code>, this can just be installed
using cargo.
</p>
<div class="org-src-container">
<pre class="src src-shell">cargo install cargo-script
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-current-issues" class="outline-3">
<h3 id="current-issues"> <a class="anchor" aria-hidden="true" href="#current-issues">🔗</a> <a class="anchor" aria-hidden="true" href="#current-issues">🔗</a><span class="section-number-3">1.2</span> Current Issues</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-magit-push-daemon" class="outline-4">
<h4 id="magit-push-daemon"> <a class="anchor" aria-hidden="true" href="#magit-push-daemon">🔗</a> <a class="anchor" aria-hidden="true" href="#magit-push-daemon">🔗</a> <a class="anchor" aria-hidden="true" href="#magit-push-daemon">🔗</a><span class="section-number-4">1.2.1</span> Magit push in daemon</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Quite often trying to push to a remote in the emacs daemon produces as error like this:
</p>
<div class="org-src-container">
<pre class="src src-fundamental">128 git &#8230; push -v origin refs/heads/master\:refs/heads/master
Pushing to git@github.com:tecosaur/emacs-config.git

fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</pre>
</div>
</div>
</div>
<div id="outline-container-calctex-brings-up" class="outline-4">
<h4 id="calctex-brings-up"> <a class="anchor" aria-hidden="true" href="#calctex-brings-up">🔗</a> <a class="anchor" aria-hidden="true" href="#calctex-brings-up">🔗</a> <a class="anchor" aria-hidden="true" href="#calctex-brings-up">🔗</a><span class="section-number-4">1.2.2</span> CalcTeX brings up compilation buffer</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
With my <a href="#calc">Calc</a> hook, the first call of <kbd>M-x calc</kbd> brings up a compilation buffer
from CalcTeX. I&rsquo;m guessing this is from the compilation of the preamble / <code>.fmt</code> file.
</p>
</div>
</div>
<div id="outline-container-unread-emails-doesnt" class="outline-4">
<h4 id="unread-emails-doesnt"> <a class="anchor" aria-hidden="true" href="#unread-emails-doesnt">🔗</a> <a class="anchor" aria-hidden="true" href="#unread-emails-doesnt">🔗</a> <a class="anchor" aria-hidden="true" href="#unread-emails-doesnt">🔗</a><span class="section-number-4">1.2.3</span> Unread emails doesn&rsquo;t work across Emacs instances</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
It would be nice if it did, so that I could have the Emacs-daemon hold the
active mu4e session, but still get that information. In this case I&rsquo;d want to
change the action to open the Emacs daemon, but it should be possible.
</p>

<p>
This would probably involve hooking into the daemon&rsquo;s modeline update function
to write to a temporary file, and having a file watcher started in other Emacs
instances, in a similar manner to <a href="#rebuild-mail-index">Rebuild mail index while using mu4e</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-editor-comparison" class="outline-3">
<h3 id="editor-comparison"> <a class="anchor" aria-hidden="true" href="#editor-comparison">🔗</a> <a class="anchor" aria-hidden="true" href="#editor-comparison">🔗</a><span class="section-number-3">1.3</span> Editor comparison</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<img src='https://imgs.xkcd.com/comics/real_programmers.png' title="Real programmers set the universal constants at the start such that the universe evolves to contain the disk with the data they want." alt='Real Programmers'>
</p>

<p>
Over the years I have tried out (spent at least a year using as my primary
editor) the following applications
</p>
<ul class="org-ul">
<li>Python IDLE</li>
<li>Komodo Edit</li>
<li>Brackets</li>
<li>VSCode</li>
<li>and now, Emacs</li>
</ul>

<p>
I have attempted to quantify aspects of my impressions of them below.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Editor</th>
<th scope="col" class="org-right">Extensibility</th>
<th scope="col" class="org-right">Ecosystem</th>
<th scope="col" class="org-right">Ease of Use</th>
<th scope="col" class="org-right">Comfort</th>
<th scope="col" class="org-right">Completion</th>
<th scope="col" class="org-right">Performance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">IDLE</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">VSCode</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3.5</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Brackets</td>
<td class="org-right">2.5</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">2.5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">Emacs</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">3.5</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Komodo Edit</td>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>


<div class="figure">
<p><img src="https://media.githubusercontent.com/media/tecosaur/emacs-config/master/misc/editor-comparison.png" alt="editor-comparison.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-rudimentary-configuration" class="outline-2">
<h2 id="rudimentary-configuration"> <a class="anchor" aria-hidden="true" href="#rudimentary-configuration">🔗</a><span class="section-number-2">2</span> Rudimentary configuration</h2>
<div class="outline-text-2" id="text-2">
<p>
Make this file run (slightly) faster with lexical binding (see <a href="https://nullprogram.com/blog/2016/12/22/">this blog post</a>
for more info).
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;;; </span><span style="color: #62686E;">config.el -*- lexical-binding: t; -*-</span>
</pre>
</div>
</div>
<div id="outline-container-personal-information" class="outline-3">
<h3 id="personal-information"> <a class="anchor" aria-hidden="true" href="#personal-information">🔗</a> <a class="anchor" aria-hidden="true" href="#personal-information">🔗</a><span class="section-number-3">2.1</span> Personal Information</h3>
<div class="outline-text-3" id="text-2-1">
<p>
It&rsquo;s useful to have some basic personal information
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">user-full-name</span> <span style="color: #7bc275;">"TEC"</span>
      <span style="color: #DFDFDF;">user-mail-address</span> <span style="color: #7bc275;">"tec@tecosaur.com"</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Apparently this is used by <code>GPG</code>, and all sorts of other things.
</p>

<p>
Speaking of <code>GPG</code>, I want to use <kbd>~/.authsource.gpg</kbd> instead of the default in
<kbd>~/.emacs.d</kbd>. Why? Because my home directory is already cluttered, so this won&rsquo;t
make a difference, and I don&rsquo;t want to accidently purge this file (I have done
<code>rm -rf~/.emac.d</code> before). I also want to cache as much as possible, as my home
machine is pretty safe, and my laptop is shutdown a lot.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">auth-sources</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"~/.authinfo.gpg"</span><span style="color: #C57BDB;">)</span>
      <span style="color: #DFDFDF;">auth-source-cache-expiry</span> nil<span style="color: #51afef;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">default is 7200 (2h)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-better-defaults" class="outline-3">
<h3 id="better-defaults"> <a class="anchor" aria-hidden="true" href="#better-defaults">🔗</a> <a class="anchor" aria-hidden="true" href="#better-defaults">🔗</a><span class="section-number-3">2.2</span> Better defaults</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-simple-settings" class="outline-4">
<h4 id="simple-settings"> <a class="anchor" aria-hidden="true" href="#simple-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#simple-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#simple-settings">🔗</a><span class="section-number-4">2.2.1</span> Simple settings</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Browsing the web and seeing <a href="https://github.com/angrybacon/dotemacs/blob/master/dotemacs.org#use-better-defaults">angrybacon/dotemacs</a> and comparing with the values
shown by <kbd>SPC h v</kbd> and selecting what I thought looks good, I&rsquo;ve ended up adding the following:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span>
 <span style="color: #DFDFDF;">delete-by-moving-to-trash</span> t                      <span style="color: #62686E;">; </span><span style="color: #62686E;">Delete files to trash</span>
 <span style="color: #DFDFDF;">tab-width</span> <span style="color: #e69055; font-weight: bold;">4</span>                                      <span style="color: #62686E;">; </span><span style="color: #62686E;">Set width for tabs</span>
 <span style="color: #DFDFDF;">uniquify-buffer-name-style</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">forward</span>              <span style="color: #62686E;">; </span><span style="color: #62686E;">Uniquify buffer names</span>
 <span style="color: #DFDFDF;">window-combination-resize</span> t                      <span style="color: #62686E;">; </span><span style="color: #62686E;">take new window space from all other windows (not just current)</span>
 <span style="color: #DFDFDF;">x-stretch-cursor</span> t<span style="color: #51afef;">)</span>                              <span style="color: #62686E;">; </span><span style="color: #62686E;">Stretch cursor to the glyph width</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">undo-limit</span> <span style="color: #e69055; font-weight: bold;">80000000</span>                         <span style="color: #62686E;">; </span><span style="color: #62686E;">Raise undo-limit to 80Mb</span>
      <span style="color: #DFDFDF;">evil-want-fine-undo</span> t                       <span style="color: #62686E;">; </span><span style="color: #62686E;">By default while in insert all changes are one big blob. Be more granular</span>
      <span style="color: #DFDFDF;">auto-save-default</span> t                         <span style="color: #62686E;">; </span><span style="color: #62686E;">Nobody likes to loose work, I certainly don't</span>
      <span style="color: #DFDFDF;">inhibit-compacting-font-caches</span> t            <span style="color: #62686E;">; </span><span style="color: #62686E;">When there are lots of glyphs, keep them in memory</span>
      <span style="color: #DFDFDF;">truncate-string-ellipsis</span> <span style="color: #7bc275;">"&#8230;"</span><span style="color: #51afef;">)</span>               <span style="color: #62686E;">; </span><span style="color: #62686E;">Unicode ellispis are nicer than "...", and also save /precious/ space</span>

<span style="color: #51afef;">(</span><span style="color: #DFDFDF;">delete-selection-mode</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>                         <span style="color: #62686E;">; </span><span style="color: #62686E;">Replace selection when inserting text</span>
<span style="color: #51afef;">(</span><span style="color: #DFDFDF;">display-time-mode</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>                             <span style="color: #62686E;">; </span><span style="color: #62686E;">Enable time in the mode-line</span>
<span style="color: #51afef;">(</span><span style="color: #DFDFDF;">display-battery-mode</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>                          <span style="color: #62686E;">; </span><span style="color: #62686E;">On laptops it's nice to know how much power you have</span>
<span style="color: #51afef;">(</span><span style="color: #DFDFDF;">global-subword-mode</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>                           <span style="color: #62686E;">; </span><span style="color: #62686E;">Iterate through CamelCase words</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-fullscreen" class="outline-4">
<h4 id="fullscreen"> <a class="anchor" aria-hidden="true" href="#fullscreen">🔗</a> <a class="anchor" aria-hidden="true" href="#fullscreen">🔗</a> <a class="anchor" aria-hidden="true" href="#fullscreen">🔗</a><span class="section-number-4">2.2.2</span> Fullscreen</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
I also like the idea of fullscreen-ing when opened by <code>emacs</code> or the <code>.desktop</code> file.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #DFDFDF;">initial-window-system</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">x</span><span style="color: #C57BDB;">)</span>                 <span style="color: #62686E;">; </span><span style="color: #62686E;">if started by emacs command or desktop file</span>
    <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">toggle-frame-maximized</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">toggle-frame-fullscreen</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-auto-customisations" class="outline-4">
<h4 id="auto-customisations"> <a class="anchor" aria-hidden="true" href="#auto-customisations">🔗</a> <a class="anchor" aria-hidden="true" href="#auto-customisations">🔗</a> <a class="anchor" aria-hidden="true" href="#auto-customisations">🔗</a><span class="section-number-4">2.2.3</span> Auto-customisations</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
By default changes made via a customisation interface are added to <kbd>init.el</kbd>.
I prefer the idea of using a separate file for this. We just need to change a
setting, and load it if it exists.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #DFDFDF;">custom-file</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">".custom.el"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">file-exists-p</span> <span style="color: #DFDFDF;">custom-file</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">load</span> <span style="color: #DFDFDF;">custom-file</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-windows" class="outline-4">
<h4 id="windows"> <a class="anchor" aria-hidden="true" href="#windows">🔗</a> <a class="anchor" aria-hidden="true" href="#windows">🔗</a> <a class="anchor" aria-hidden="true" href="#windows">🔗</a><span class="section-number-4">2.2.4</span> Windows</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
I find it rather handy to be asked which buffer I want to see after splitting
the window. Let&rsquo;s make that happen.
First, we&rsquo;ll enter the new window
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">evil-vsplit-window-right</span> t
      <span style="color: #DFDFDF;">evil-split-window-below</span> t<span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Then, we&rsquo;ll pull up <code>ivy</code>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defadvice!</span> prompt-for-buffer <span style="color: #C57BDB;">(</span><span style="color: #FCCE7B;">&amp;rest</span> _<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>evil-window-split evil-window-vsplit<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+ivy/switch-buffer</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Oh, and previews are nice
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">+ivy-buffer-preview</span> t<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Window rotation is nice, and can be found under <kbd>SPC w r</kbd> and <kbd>SPC w R</kbd>.
<i>Layout</i> rotation is also nice though. Let&rsquo;s stash this under <kbd>SPC w SPC</kbd>, inspired
by Tmux&rsquo;s use of <kbd>C-b SPC</kbd> to rotate windows.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">evil-window-map</span>
      <span style="color: #7bc275;">"SPC"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">rotate-layout</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-buffer-defaults" class="outline-4">
<h4 id="buffer-defaults"> <a class="anchor" aria-hidden="true" href="#buffer-defaults">🔗</a> <a class="anchor" aria-hidden="true" href="#buffer-defaults">🔗</a> <a class="anchor" aria-hidden="true" href="#buffer-defaults">🔗</a><span class="section-number-4">2.2.5</span> Buffer defaults</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
I&rsquo;d much rather have my new buffers in <code>org-mode</code> than <code>fundamental-mode</code>, hence
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">(setq-default major-mode 'org-mode)</span>
</pre>
</div>
<p>
For some reason this + the mixed pitch hook causes issues with hydra and so I&rsquo;ll
just need to resort to <kbd>SPC b o</kbd> for now.
</p>
</div>
</div>
</div>
<div id="outline-container-doom-configuration" class="outline-3">
<h3 id="doom-configuration"> <a class="anchor" aria-hidden="true" href="#doom-configuration">🔗</a> <a class="anchor" aria-hidden="true" href="#doom-configuration">🔗</a><span class="section-number-3">2.3</span> Doom configuration</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-visual-settings" class="outline-4">
<h4 id="visual-settings"> <a class="anchor" aria-hidden="true" href="#visual-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#visual-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#visual-settings">🔗</a><span class="section-number-4">2.3.1</span> Visual Settings</h4>
<div class="outline-text-4" id="text-2-3-1">
</div>
<div id="outline-container-font-face" class="outline-5">
<h5 id="font-face"> <a class="anchor" aria-hidden="true" href="#font-face">🔗</a> <a class="anchor" aria-hidden="true" href="#font-face">🔗</a> <a class="anchor" aria-hidden="true" href="#font-face">🔗</a> <a class="anchor" aria-hidden="true" href="#font-face">🔗</a><span class="section-number-5">2.3.1.1</span> Font Face</h5>
<div class="outline-text-5" id="text-2-3-1-1">
<p>
&rsquo;Fira Code&rsquo; is nice, and &rsquo;Overpass&rsquo; makes for a nice sans companion. We just need to
fiddle with the font sizes a tad so that they visually match.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">doom-font</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">font-spec</span> <span style="color: #C57BDB;">:family</span> <span style="color: #7bc275;">"JetBrains Mono"</span> <span style="color: #C57BDB;">:size</span> <span style="color: #e69055; font-weight: bold;">24</span><span style="color: #C57BDB;">)</span>
      <span style="color: #DFDFDF;">doom-big-font</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">font-spec</span> <span style="color: #C57BDB;">:family</span> <span style="color: #7bc275;">"JetBrains Mono"</span> <span style="color: #C57BDB;">:size</span> <span style="color: #e69055; font-weight: bold;">36</span><span style="color: #C57BDB;">)</span>
      <span style="color: #DFDFDF;">doom-variable-pitch-font</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">font-spec</span> <span style="color: #C57BDB;">:family</span> <span style="color: #7bc275;">"Overpass"</span> <span style="color: #C57BDB;">:size</span> <span style="color: #e69055; font-weight: bold;">24</span><span style="color: #C57BDB;">)</span>
      <span style="color: #DFDFDF;">doom-serif-font</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">font-spec</span> <span style="color: #C57BDB;">:family</span> <span style="color: #7bc275;">"IBM Plex Mono"</span> <span style="color: #C57BDB;">:weight</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">light</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-theme-modeline" class="outline-5">
<h5 id="theme-modeline"> <a class="anchor" aria-hidden="true" href="#theme-modeline">🔗</a> <a class="anchor" aria-hidden="true" href="#theme-modeline">🔗</a> <a class="anchor" aria-hidden="true" href="#theme-modeline">🔗</a> <a class="anchor" aria-hidden="true" href="#theme-modeline">🔗</a><span class="section-number-5">2.3.1.2</span> Theme and modeline</h5>
<div class="outline-text-5" id="text-2-3-1-2">
<p>
<code>doom-one</code> is nice and all, but I find the <code>vibrant</code> variant nicer.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">doom-theme</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">doom-vibrant</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
However, by default <code>red</code> text is used in the <code>modeline</code>, so let&rsquo;s make that orange
so I don&rsquo;t feel like something&rsquo;s gone <i>wrong</i> when editing files.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">custom-set-faces!</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>doom-modeline-buffer-modified <span style="color: #C57BDB;">:foreground</span> <span style="color: #7bc275;">"orange"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
While we&rsquo;re modifying the modeline, <kbd>LF UTF-8</kbd> is the default file encoding, and
thus not worth noting in the modeline. So, let&rsquo;s conditionally hide it.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">doom-modeline-conditional-buffer-encoding</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #7e7e87;">"We expect the encoding to be LF UTF-8, so only show the modeline when this is not the case"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #DFDFDF;">doom-modeline-buffer-encoding</span>
              <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #DFDFDF;">buffer-file-coding-system</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">utf-8-unix</span><span style="color: #C57BDB;">)</span>
                          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #DFDFDF;">buffer-file-coding-system</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">utf-8</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">after-change-major-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">doom-modeline-conditional-buffer-encoding</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-miscellaneous" class="outline-5">
<h5 id="miscellaneous"> <a class="anchor" aria-hidden="true" href="#miscellaneous">🔗</a> <a class="anchor" aria-hidden="true" href="#miscellaneous">🔗</a> <a class="anchor" aria-hidden="true" href="#miscellaneous">🔗</a> <a class="anchor" aria-hidden="true" href="#miscellaneous">🔗</a><span class="section-number-5">2.3.1.3</span> Miscellaneous</h5>
<div class="outline-text-5" id="text-2-3-1-3">
<p>
Relative line numbers are fantastic for knowing how far away line numbers are,
then <kbd>ESC 12 &lt;UP&gt;</kbd> gets you exactly where you think.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">display-line-numbers-type</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">relative</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
I&rsquo;d like some slightly nicer default buffer names
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">doom-fallback-buffer-name</span> <span style="color: #7bc275;">"&#9658; Doom"</span>
      <span style="color: #DFDFDF;">+doom-dashboard-name</span> <span style="color: #7bc275;">"&#9658; Doom"</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
There&rsquo;s a bug with the modeline in insert mode for org documents (<a href="https://github.com/seagle0128/doom-modeline/issues/300">issue</a>), so
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">custom-set-faces!</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>doom-modeline-evil-insert-state <span style="color: #C57BDB;">:weight</span> bold <span style="color: #C57BDB;">:foreground</span> <span style="color: #7bc275;">"#339CDB"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-some-helper-macros" class="outline-4">
<h4 id="some-helper-macros"> <a class="anchor" aria-hidden="true" href="#some-helper-macros">🔗</a> <a class="anchor" aria-hidden="true" href="#some-helper-macros">🔗</a> <a class="anchor" aria-hidden="true" href="#some-helper-macros">🔗</a><span class="section-number-4">2.3.2</span> Some helper macros</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
There are a few handy macros added by doom, namely
</p>
<ul class="org-ul">
<li><code>load!</code> for loading external <code>.el</code> files relative to this one</li>
<li><code>use-package</code> for configuring packages</li>
<li><code>add-load-path!</code> for adding directories to the <code>load-path</code> where <code>emacs</code> looks when
you load packages with <code>require</code> or <code>use-package</code></li>
<li><code>map</code> for binding new keys</li>
</ul>
<p>
To find more,
</p>
</div>
</div>
</div>
<div id="outline-container-other-things" class="outline-3">
<h3 id="other-things"> <a class="anchor" aria-hidden="true" href="#other-things">🔗</a> <a class="anchor" aria-hidden="true" href="#other-things">🔗</a><span class="section-number-3">2.4</span> Other things</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-editor-interaction" class="outline-4">
<h4 id="editor-interaction"> <a class="anchor" aria-hidden="true" href="#editor-interaction">🔗</a> <a class="anchor" aria-hidden="true" href="#editor-interaction">🔗</a> <a class="anchor" aria-hidden="true" href="#editor-interaction">🔗</a><span class="section-number-4">2.4.1</span> Editor interaction</h4>
<div class="outline-text-4" id="text-2-4-1">
</div>
<div id="outline-container-mouse-buttons" class="outline-5">
<h5 id="mouse-buttons"> <a class="anchor" aria-hidden="true" href="#mouse-buttons">🔗</a> <a class="anchor" aria-hidden="true" href="#mouse-buttons">🔗</a> <a class="anchor" aria-hidden="true" href="#mouse-buttons">🔗</a> <a class="anchor" aria-hidden="true" href="#mouse-buttons">🔗</a><span class="section-number-5">2.4.1.1</span> Mouse buttons</h5>
<div class="outline-text-5" id="text-2-4-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:n</span> <span style="color: #C57BDB;">[</span>mouse-8<span style="color: #C57BDB;">]</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">better-jumper-jump-backward</span>
      <span style="color: #C57BDB;">:n</span> <span style="color: #C57BDB;">[</span>mouse-9<span style="color: #C57BDB;">]</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">better-jumper-jump-forward</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-window-title" class="outline-4">
<h4 id="window-title"> <a class="anchor" aria-hidden="true" href="#window-title">🔗</a> <a class="anchor" aria-hidden="true" href="#window-title">🔗</a> <a class="anchor" aria-hidden="true" href="#window-title">🔗</a><span class="section-number-4">2.4.2</span> Window title</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
I&rsquo;d like to have just the buffer name, then if applicable the project folder
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">frame-title-format</span>
    <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">""</span>
      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:eval</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">s-contains-p</span> <span style="color: #DFDFDF;">org-roam-directory</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #DFDFDF;">buffer-file-name</span> <span style="color: #7bc275;">""</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">".*/[0-9]*-?"</span> <span style="color: #7bc275;">"&#129172; "</span> <span style="color: #DFDFDF;">buffer-file-name</span><span style="color: #C57BDB;">)</span>
         <span style="color: #7bc275;">"%b"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:eval</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>project-name <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">projectile-project-name</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unless</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string=</span> <span style="color: #7bc275;">"-"</span> project-name<span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">buffer-modified-p</span><span style="color: #C57BDB;">)</span>  <span style="color: #7bc275;">" &#9673; %s"</span> <span style="color: #7bc275;">" &#8198;&#9679;&#8198; %s"</span><span style="color: #51afef;">)</span> project-name<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-splash-screen" class="outline-4">
<h4 id="splash-screen"> <a class="anchor" aria-hidden="true" href="#splash-screen">🔗</a> <a class="anchor" aria-hidden="true" href="#splash-screen">🔗</a> <a class="anchor" aria-hidden="true" href="#splash-screen">🔗</a><span class="section-number-4">2.4.3</span> Splash screen</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
Emacs can render an image as the splash screen, and <a href="https://github.com/MarioRicalde">@MarioRicalde</a> came up with a
cracker! He&rsquo;s also provided me with a nice emacs-style <i>E</i>, which is good for
smaller windows. <b>@MarioRicalde</b> you have my sincere thanks, you&rsquo;re great!
<object type="image/svg+xml" data="misc/splash-images/blackhole-lines.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>

<p>
By incrementally stripping away the outer layers of the logo one can obtain
quite a nice resizing effect.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">fancy-splash-image-template</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-template.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Default template svg used for the splash image, with substitutions from "</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">fancy-splash-image-nil</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/transparent-pixel.png"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"An image to use at minimum size, usually a transparent pixel"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">fancy-splash-sizes</span>
  <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">500</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">50</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">0</span> . <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-0.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">440</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">42</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-0.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">400</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">38</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-1.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">350</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">36</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-2.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">300</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">34</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-3.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">250</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">32</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-4.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">200</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">30</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/blackhole-lines-5.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">100</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">24</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:template</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"misc/splash-images/emacs-e-template.svg"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0</span>   <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">0</span>  <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">0</span> . <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:file</span> ,<span style="color: #DFDFDF;">fancy-splash-image-nil</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">fancy-splash-sizes</span>
  <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">500</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">50</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">0</span> . <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">440</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">42</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">330</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">35</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">200</span> <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">30</span> <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">1</span> . <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0</span>   <span style="color: #C57BDB;">:min-height</span> <span style="color: #e69055; font-weight: bold;">0</span>  <span style="color: #C57BDB;">:padding</span> <span style="color: #51afef;">(</span><span style="color: #e69055; font-weight: bold;">0</span> . <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:file</span> ,<span style="color: #DFDFDF;">fancy-splash-image-nil</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"list of plists with the following properties</span>
<span style="color: #7e7e87;">  :height the height of the image</span>
<span style="color: #7e7e87;">  :min-height minimum `</span><span style="color: #a991f1;">frame-height</span><span style="color: #7e7e87;">' for image</span>
<span style="color: #7e7e87;">  :padding `</span><span style="color: #a991f1;">+doom-dashboard-banner-padding</span><span style="color: #7e7e87;">' to apply</span>
<span style="color: #7e7e87;">  :template non-default template file</span>
<span style="color: #7e7e87;">  :file file to use instead of template"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">fancy-splash-template-colours</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"$colour1"</span> . keywords<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"$colour2"</span> . type<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"$colour3"</span> . base5<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"$colour4"</span> . base8<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"list of colour-replacement alists of the form (\"$placeholder\" . 'theme-colour) which applied the template"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">file-exists-p</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"theme-splashes"</span> <span style="color: #DFDFDF;">doom-cache-dir</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">make-directory</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"theme-splashes"</span> <span style="color: #DFDFDF;">doom-cache-dir</span><span style="color: #7bc275;">)</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">fancy-splash-filename</span> <span style="color: #C57BDB;">(</span>theme-name height<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">file-name-as-directory</span> <span style="color: #7bc275;">"theme-splashes"</span><span style="color: #51afef;">)</span>
                            <span style="color: #51afef;">(</span><span style="color: #a991f1;">symbol-name</span> <span style="color: #DFDFDF;">doom-theme</span><span style="color: #51afef;">)</span>
                            <span style="color: #7bc275;">"-"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">number-to-string</span> height<span style="color: #51afef;">)</span> <span style="color: #7bc275;">".svg"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #DFDFDF;">doom-cache-dir</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">fancy-splash-clear-cache</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #7e7e87;">"Delete all cached fancy splash images"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">interactive</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">delete-directory</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"theme-splashes"</span> <span style="color: #DFDFDF;">doom-cache-dir</span><span style="color: #7bc275;">)</span> t<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Cache cleared!"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">fancy-splash-generate-image</span> <span style="color: #C57BDB;">(</span>template height<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Read TEMPLATE and create an image if HEIGHT with colour substitutions as  ;described by `</span><span style="color: #a991f1;">fancy-splash-template-colours</span><span style="color: #7e7e87;">' for the current theme"</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">with-temp-buffer</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert-file-contents</span> template<span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">re-search-forward</span> <span style="color: #7bc275;">"$height"</span> nil t<span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">replace-match</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">number-to-string</span> height<span style="color: #51afef;">)</span> nil nil<span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #51afef;">(</span>substitution <span style="color: #DFDFDF;">fancy-splash-template-colours</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">beginning-of-buffer</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">while</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">re-search-forward</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> substitution<span style="color: #7bc275;">)</span> nil t<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">replace-match</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">cdr</span> substitution<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> nil nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">write-region</span> nil nil
                    <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">fancy-splash-filename</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">symbol-name</span> <span style="color: #DFDFDF;">doom-theme</span><span style="color: #C57BDB;">)</span> height<span style="color: #51afef;">)</span> nil nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">fancy-splash-generate-images</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #7e7e87;">"Perform `</span><span style="color: #a991f1;">fancy-splash-generate-image</span><span style="color: #7e7e87;">' in bulk"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #7bc275;">(</span>size <span style="color: #DFDFDF;">fancy-splash-sizes</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> size <span style="color: #C57BDB;">:file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">fancy-splash-generate-image</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> size <span style="color: #C57BDB;">:file</span><span style="color: #7bc275;">)</span>
                                       <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> size <span style="color: #C57BDB;">:template</span><span style="color: #7bc275;">)</span>
                                       <span style="color: #DFDFDF;">fancy-splash-image-template</span><span style="color: #C57BDB;">)</span>
                                   <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> size <span style="color: #C57BDB;">:height</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">ensure-theme-splash-images-exist</span> <span style="color: #C57BDB;">(</span><span style="color: #FCCE7B;">&amp;optional</span> height<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unless</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">file-exists-p</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">fancy-splash-filename</span>
                          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">symbol-name</span> <span style="color: #DFDFDF;">doom-theme</span><span style="color: #C57BDB;">)</span>
                          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> height
                              <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> <span style="color: #DFDFDF;">fancy-splash-sizes</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:height</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">fancy-splash-generate-images</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">get-appropriate-splash</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>height <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">frame-height</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">cl-some</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>size<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&gt;=</span> height <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> size <span style="color: #C57BDB;">:min-height</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> size<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #DFDFDF;">fancy-splash-sizes</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-size nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-theme nil<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">set-appropriate-splash</span> <span style="color: #C57BDB;">(</span><span style="color: #FCCE7B;">&amp;optional</span> frame<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>appropriate-image <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">get-appropriate-splash</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> appropriate-image fancy-splash-last-size<span style="color: #C57BDB;">)</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #DFDFDF;">doom-theme</span> fancy-splash-last-theme<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> appropriate-image <span style="color: #C57BDB;">:file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">ensure-theme-splash-images-exist</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> appropriate-image <span style="color: #C57BDB;">:height</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">fancy-splash-image</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> appropriate-image <span style="color: #C57BDB;">:file</span><span style="color: #C57BDB;">)</span>
              <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">fancy-splash-filename</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">symbol-name</span> <span style="color: #DFDFDF;">doom-theme</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> appropriate-image <span style="color: #C57BDB;">:height</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">+doom-dashboard-banner-padding</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> appropriate-image <span style="color: #C57BDB;">:padding</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-size appropriate-image<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> fancy-splash-last-theme <span style="color: #DFDFDF;">doom-theme</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+doom-dashboard-reload</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">window-size-change-functions</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">set-appropriate-splash</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">doom-load-theme-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">set-appropriate-splash</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-systemd-daemon" class="outline-4">
<h4 id="systemd-daemon"> <a class="anchor" aria-hidden="true" href="#systemd-daemon">🔗</a> <a class="anchor" aria-hidden="true" href="#systemd-daemon">🔗</a> <a class="anchor" aria-hidden="true" href="#systemd-daemon">🔗</a><span class="section-number-4">2.4.4</span> Systemd daemon</h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
For running a systemd service for a Emacs server I have the following
</p>
<div class="org-src-container">
<pre class="src src-systemd"><span style="color: #FCCE7B;">[Unit]</span>
<span style="color: #51afef;">Description</span>=Emacs server daemon
<span style="color: #51afef;">Documentation</span>=info:emacs man:emacs(<span style="color: #e69055; font-weight: bold;">1</span>) https://gnu.org/software/emacs/

<span style="color: #FCCE7B;">[Service]</span>
<span style="color: #51afef;">Type</span>=<span style="color: #C57BDB;">forking</span>
<span style="color: #51afef;">ExecStart</span>=/usr/bin/emacs --daemon
<span style="color: #51afef;">ExecStop</span>=/usr/bin/emacsclient --eval <span style="color: #7bc275;">"(progn (setq kill-emacs-hook nil) (kill emacs))"</span>
<span style="color: #51afef;">Environment</span>=SSH_AUTH_SOCK=<span style="color: #a991f1;">%t</span>/keyring/ssh
<span style="color: #51afef;">Restart</span>=<span style="color: #C57BDB;">on-failure</span>

<span style="color: #FCCE7B;">[Install]</span>
<span style="color: #51afef;">WantedBy</span>=default.target
</pre>
</div>
<p>
which is then enabled by
</p>
<div class="org-src-container">
<pre class="src src-shell">systemctl --user enable emacs.service
</pre>
</div>

<p>
When the daemon is running, I almost always want to do a few particular things
with it, so I may as well eat the load time at startup. We also want to keep <kbd>mu4e</kbd> running.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">greedily-do-daemon-setup</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">daemonp</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">org</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">mu4e</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-confirm-quit</span> t<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-lock-greedy</span> t<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-lock-relaxed</span> t<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">mu4e-lock-add-watcher</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-lock-avalible</span> t<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~start</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">emacs-startup-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">greedily-do-daemon-setup</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-package-loading" class="outline-2">
<h2 id="package-loading"> <a class="anchor" aria-hidden="true" href="#package-loading">🔗</a><span class="section-number-2">3</span> Package loading</h2>
<div class="outline-text-2" id="text-3">
<p>
This file shouldn&rsquo;t be byte compiled.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">-*- no-byte-compile: t; -*-</span>
</pre>
</div>
</div>
<div id="outline-container-loading-instructions" class="outline-3">
<h3 id="loading-instructions"> <a class="anchor" aria-hidden="true" href="#loading-instructions">🔗</a> <a class="anchor" aria-hidden="true" href="#loading-instructions">🔗</a><span class="section-number-3">3.1</span> Loading instructions</h3>
<div class="outline-text-3" id="text-3-1">
<p>
This is where you install packages, by declaring them with the <code>package!</code>
macro, then running <code>doom refresh</code> on the command line. You&rsquo;ll need to
restart Emacs for your changes to take effect! Or at least, run <kbd>M-x doom/reload</kbd>.
</p>

<p>
WARNING: Don&rsquo;t disable core packages listed in <code>~/.emacs.d/core/packages.el</code>.
Doom requires these, and disabling them may have terrible side effects.
</p>
</div>

<div id="outline-container-packages-melpa-elpa" class="outline-4">
<h4 id="packages-melpa-elpa"> <a class="anchor" aria-hidden="true" href="#packages-melpa-elpa">🔗</a> <a class="anchor" aria-hidden="true" href="#packages-melpa-elpa">🔗</a> <a class="anchor" aria-hidden="true" href="#packages-melpa-elpa">🔗</a><span class="section-number-4">3.1.1</span> Packages in MELPA/ELPA/emacsmirror</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
To install <code>some-package</code> from MELPA, ELPA or emacsmirror:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> some-package<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-packages-from-git" class="outline-4">
<h4 id="packages-from-git"> <a class="anchor" aria-hidden="true" href="#packages-from-git">🔗</a> <a class="anchor" aria-hidden="true" href="#packages-from-git">🔗</a> <a class="anchor" aria-hidden="true" href="#packages-from-git">🔗</a><span class="section-number-4">3.1.2</span> Packages from git repositories</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
To install a package directly from a particular repo, you&rsquo;ll need to specify
a <code>:recipe</code>. You&rsquo;ll find documentation on what <code>:recipe</code> accepts <a href="https://github.com/raxod502/straight.el#the-recipe-format">here</a>:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> another-package
  <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"username/repo"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
If the package you are trying to install does not contain a <code>PACKAGENAME.el</code>
file, or is located in a subdirectory of the repo, you&rsquo;ll need to specify
<code>:files</code> in the <code>:recipe</code>:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> this-package
  <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"username/repo"</span>
           <span style="color: #C57BDB;">:files</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"some-file.el"</span> <span style="color: #7bc275;">"src/lisp/*.el"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-disabling-built-packages" class="outline-4">
<h4 id="disabling-built-packages"> <a class="anchor" aria-hidden="true" href="#disabling-built-packages">🔗</a> <a class="anchor" aria-hidden="true" href="#disabling-built-packages">🔗</a> <a class="anchor" aria-hidden="true" href="#disabling-built-packages">🔗</a><span class="section-number-4">3.1.3</span> Disabling built-in packages</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
If you&rsquo;d like to disable a package included with Doom, for whatever reason,
you can do so here with the <code>:disable</code> property:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> builtin-package <span style="color: #C57BDB;">:disable</span> t<span style="color: #51afef;">)</span>
</pre>
</div>
<p>
You can override the recipe of a built in package without having to specify
all the properties for <code>:recipe</code>. These will inherit the rest of its recipe
from Doom or MELPA/ELPA/Emacsmirror:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> builtin-package <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:nonrecursive</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> builtin-package-2 <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"myfork/package"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Specify a <code>:branch</code> to install a package from a particular branch or tag.
This is required for some packages whose default branch isn&rsquo;t &rsquo;master&rsquo; (which
our package manager can&rsquo;t deal with; see <a href="https://github.com/raxod502/straight.el/issues/279">raxod502/straight.el#279</a>)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> builtin-package <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:branch</span> <span style="color: #7bc275;">"develop"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-general-packages" class="outline-3">
<h3 id="general-packages"> <a class="anchor" aria-hidden="true" href="#general-packages">🔗</a> <a class="anchor" aria-hidden="true" href="#general-packages">🔗</a><span class="section-number-3">3.2</span> General packages</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-prettification" class="outline-4">
<h4 id="prettification"> <a class="anchor" aria-hidden="true" href="#prettification">🔗</a> <a class="anchor" aria-hidden="true" href="#prettification">🔗</a> <a class="anchor" aria-hidden="true" href="#prettification">🔗</a><span class="section-number-4">3.2.1</span> Prettification</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
<code>prettify-mode</code> is nice and all, but adding substitutions is a little verbose.
This helps with that.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> prettify-utils <span style="color: #62686E;">; </span><span style="color: #62686E;">simplify messing with prettify-mode</span>
  <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"Ilazki/prettify-utils.el"</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"8b783d316c..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-window-management" class="outline-4">
<h4 id="window-management"> <a class="anchor" aria-hidden="true" href="#window-management">🔗</a> <a class="anchor" aria-hidden="true" href="#window-management">🔗</a> <a class="anchor" aria-hidden="true" href="#window-management">🔗</a><span class="section-number-4">3.2.2</span> Window management</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> rotate <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"091b5ac4fc..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-fun" class="outline-4">
<h4 id="fun"> <a class="anchor" aria-hidden="true" href="#fun">🔗</a> <a class="anchor" aria-hidden="true" href="#fun">🔗</a> <a class="anchor" aria-hidden="true" href="#fun">🔗</a><span class="section-number-4">3.2.3</span> Fun</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Sometimes one just wants a little fun.
XKCD comics are fun.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> xkcd <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"66e928706f..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Every so often, you want everyone else to <i>know</i> that you&rsquo;re typing, or just to
amuse oneself. Introducing: typewriter sounds!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> <span style="color: #DFDFDF;">selectric-mode</span> <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"bb9e66678f..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Hey, let&rsquo;s get the weather in here while we&rsquo;re at it.
Unfortunately this seems slightly unmaintained (<a href="https://github.com/bcbcarl/emacs-wttrin/pulls">few open bugfix PRs</a>) so let&rsquo;s
roll our <a href="lisp/wttrin.el">own version</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> wttrin <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:local-repo</span> <span style="color: #7bc275;">"lisp"</span> <span style="color: #C57BDB;">:no-byte-compile</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Why not flash words on the screen. Why not &#x2014; hey, it could be fun.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> spray <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"00638bc916..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
With all our fancy Emacs themes, my terminal is missing out!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> theme-magic <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"844c4311bd..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
What&rsquo;s even the point of using Emacs unless you&rsquo;re constantly telling everyone
about it?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> elcord <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"94b0afb9ba..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
For some reason, I find myself demoing Emacs every now and then. Showing what
keyboard stuff I&rsquo;m doing on-screen seems helpful. While <a href="https://gitlab.com/screenkey/screenkey">screenkey</a> does exist,
having something that doesn&rsquo;t cover up screen content is nice.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> keycast <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"a912c4db1b..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
let&rsquo;s just make sure this is lazy-loaded appropriately.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> keycast
  <span style="color: #C57BDB;">:commands</span> <span style="color: #DFDFDF;">keycast-mode</span>
  <span style="color: #C57BDB;">:config</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #DFDFDF;">keycast-mode</span>
    <span style="color: #7e7e87;">"Show current command and its key binding in the mode line."</span>
    <span style="color: #C57BDB;">:global</span> t
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">keycast-mode</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">pre-command-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">keycast-mode-line-update</span> t<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">global-mode-string</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">""</span> <span style="color: #DFDFDF;">mode-line-keycast</span> <span style="color: #7bc275;">" "</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">remove-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">pre-command-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">keycast-mode-line-update</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">global-mode-string</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">remove</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">""</span> <span style="color: #DFDFDF;">mode-line-keycast</span> <span style="color: #7bc275;">" "</span><span style="color: #7bc275;">)</span> <span style="color: #DFDFDF;">global-mode-string</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">custom-set-faces!</span>
    <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>keycast-command <span style="color: #C57BDB;">:inherit</span> doom-modeline-debug
                      <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0.9</span><span style="color: #7bc275;">)</span>
    <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>keycast-key <span style="color: #C57BDB;">:inherit</span> custom-modified
                  <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.1</span>
                  <span style="color: #C57BDB;">:weight</span> bold<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-improving-features" class="outline-4">
<h4 id="improving-features"> <a class="anchor" aria-hidden="true" href="#improving-features">🔗</a> <a class="anchor" aria-hidden="true" href="#improving-features">🔗</a> <a class="anchor" aria-hidden="true" href="#improving-features">🔗</a><span class="section-number-4">3.2.4</span> Improving features</h4>
<div class="outline-text-4" id="text-3-2-4">
</div>
<div id="outline-container-flyspell-lazy" class="outline-5">
<h5 id="flyspell-lazy"> <a class="anchor" aria-hidden="true" href="#flyspell-lazy">🔗</a> <a class="anchor" aria-hidden="true" href="#flyspell-lazy">🔗</a> <a class="anchor" aria-hidden="true" href="#flyspell-lazy">🔗</a> <a class="anchor" aria-hidden="true" href="#flyspell-lazy">🔗</a><span class="section-number-5">3.2.4.1</span> Flyspell-lazy</h5>
<div class="outline-text-5" id="text-3-2-4-1">
<p>
To alleviate some <a href="#flyspell">issues with flyspell</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> flyspell-lazy <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"3ebf68cc9e..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-calctex" class="outline-5">
<h5 id="calctex"> <a class="anchor" aria-hidden="true" href="#calctex">🔗</a> <a class="anchor" aria-hidden="true" href="#calctex">🔗</a> <a class="anchor" aria-hidden="true" href="#calctex">🔗</a> <a class="anchor" aria-hidden="true" href="#calctex">🔗</a><span class="section-number-5">3.2.4.2</span> CalcTeX</h5>
<div class="outline-text-5" id="text-3-2-4-2">
<p>
This is a nice extension to <code>calc</code>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> calctex <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"johnbcoughlin/calctex"</span>
                                 <span style="color: #C57BDB;">:files</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"*.el"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"08273d4216..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-ess" class="outline-5">
<h5 id="ess"> <a class="anchor" aria-hidden="true" href="#ess">🔗</a> <a class="anchor" aria-hidden="true" href="#ess">🔗</a> <a class="anchor" aria-hidden="true" href="#ess">🔗</a> <a class="anchor" aria-hidden="true" href="#ess">🔗</a><span class="section-number-5">3.2.4.3</span> ESS</h5>
<div class="outline-text-5" id="text-3-2-4-3">
<p>
View data frames better with
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> ess-view <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"d4e5a340b7..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-magit-delta" class="outline-5">
<h5 id="magit-delta"> <a class="anchor" aria-hidden="true" href="#magit-delta">🔗</a> <a class="anchor" aria-hidden="true" href="#magit-delta">🔗</a> <a class="anchor" aria-hidden="true" href="#magit-delta">🔗</a> <a class="anchor" aria-hidden="true" href="#magit-delta">🔗</a><span class="section-number-5">3.2.4.4</span> Magit Delta</h5>
<div class="outline-text-5" id="text-3-2-4-4">
<p>
<a href="https://github.com/dandavison/delta/">Delta</a> is a git diff syntax highlighter written in rust. The author also wrote a
package to hook this into the magit diff view. This requires the <code>delta</code> binary.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">(package! magit-delta :recipe (:host github :repo "dandavison/magit-delta") :pin "0c7d8b2359")</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-info-colours" class="outline-5">
<h5 id="info-colours"> <a class="anchor" aria-hidden="true" href="#info-colours">🔗</a> <a class="anchor" aria-hidden="true" href="#info-colours">🔗</a> <a class="anchor" aria-hidden="true" href="#info-colours">🔗</a> <a class="anchor" aria-hidden="true" href="#info-colours">🔗</a><span class="section-number-5">3.2.4.5</span> Info colours</h5>
<div class="outline-text-5" id="text-3-2-4-5">
<p>
This makes manual pages nicer to look at :)
Variable pitch fontification + colouring
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> info-colors <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"47ee73cc19..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-email" class="outline-4">
<h4 id="email"> <a class="anchor" aria-hidden="true" href="#email">🔗</a> <a class="anchor" aria-hidden="true" href="#email">🔗</a> <a class="anchor" aria-hidden="true" href="#email">🔗</a><span class="section-number-4">3.2.5</span> Email</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
It&rsquo;s nice to send out fancy HTML emails. The <kbd>org-msg</kbd> package allows to write
emails in org mode, and send as an HTML multipart email. We can setup some CSS
to be inlined, render LaTeX fragments, and all those goodies!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-msg<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
To actually get notifications, we can use <kbd>mu4e-alert</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> mu4e-alert<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-language-packages" class="outline-3">
<h3 id="language-packages"> <a class="anchor" aria-hidden="true" href="#language-packages">🔗</a> <a class="anchor" aria-hidden="true" href="#language-packages">🔗</a><span class="section-number-3">3.3</span> Language packages</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-latex" class="outline-4">
<h4 id="latex"> <a class="anchor" aria-hidden="true" href="#latex">🔗</a> <a class="anchor" aria-hidden="true" href="#latex">🔗</a> <a class="anchor" aria-hidden="true" href="#latex">🔗</a><span class="section-number-4">3.3.1</span> LaTeX</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> evil-tex <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"itai33/evil-tex"</span><span style="color: #C57BDB;">)</span>
                            <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"9365aa33a0..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org-mode" class="outline-4">
<h4 id="org-mode"> <a class="anchor" aria-hidden="true" href="#org-mode">🔗</a> <a class="anchor" aria-hidden="true" href="#org-mode">🔗</a> <a class="anchor" aria-hidden="true" href="#org-mode">🔗</a><span class="section-number-4">3.3.2</span> Org Mode</h4>
<div class="outline-text-4" id="text-3-3-2">
</div>
<div id="outline-container-improve-agenda-capture" class="outline-5">
<h5 id="improve-agenda-capture"> <a class="anchor" aria-hidden="true" href="#improve-agenda-capture">🔗</a> <a class="anchor" aria-hidden="true" href="#improve-agenda-capture">🔗</a> <a class="anchor" aria-hidden="true" href="#improve-agenda-capture">🔗</a> <a class="anchor" aria-hidden="true" href="#improve-agenda-capture">🔗</a><span class="section-number-5">3.3.2.1</span> Improve agenda/capture</h5>
<div class="outline-text-5" id="text-3-3-2-1">
<p>
The agenda is nice, but a souped up version is nicer.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-super-agenda <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"dd0d104c26..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Similarly <code>doct</code> (Declarative Org Capture Templates) seems to be a nicer way to
set up org-capture.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> doct
  <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"progfolio/doct"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"1bcec209e1..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-visuals" class="outline-5">
<h5 id="visuals"> <a class="anchor" aria-hidden="true" href="#visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#visuals">🔗</a><span class="section-number-5">3.3.2.2</span> Visuals</h5>
<div class="outline-text-5" id="text-3-3-2-2">
<p>
Org tables aren&rsquo;t the prettiest thing to look at. This package is supposed to
redraw them in the buffer with box-drawing characters. Sounds like an
improvement to me! Just need to get it working&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-pretty-table-mode
  <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"Fuco1/org-pretty-table"</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"88380f865a..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
For automatically toggling LaTeX fragment previews there&rsquo;s this nice package
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-fragtog <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"8eca8084cc..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code>org-superstar-mode</code> is great. While we&rsquo;re at it we may as well make tags prettier as well :)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-pretty-tags <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"40fd72f3e7..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-extra-functionality" class="outline-5">
<h5 id="extra-functionality"> <a class="anchor" aria-hidden="true" href="#extra-functionality">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-functionality">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-functionality">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-functionality">🔗</a><span class="section-number-5">3.3.2.3</span> Extra functionality</h5>
<div class="outline-text-5" id="text-3-3-2-3">
<p>
Because of the <i><a href="https://github.com/commonmark/commonmark-spec/wiki/markdown-flavors">lovely variety in markdown implementations</a></i> there isn&rsquo;t actually
such a thing a standard table spec &#x2026; or standard anything really. Because
<code>org-md</code> is a goody-two-shoes, it just uses HTML for all these non-standardised
elements (a lot of them). So <code>ox-gfm</code> is handy for exporting markdown with all the
features that GitHub has. Initialised in <a href="#exporting-gfm">5.2.3.6</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> ox-gfm <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"99f93011b0..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now and then citations need to happen
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-ref <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"4ce8064437..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Came across this and &#x2026; it&rsquo;s cool
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-graph-view <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:host</span> github <span style="color: #C57BDB;">:repo</span> <span style="color: #7bc275;">"alphapapa/org-graph-view"</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"13314338d7..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I <b>need</b> this in my life. It take a URL to a recipe from a common site, and
inserts an org-ified version at point. Isn&rsquo;t that just great.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-chef <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"1dd73fd3db..."</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I have my own <a href="lisp/org-plot.el">modified version</a> of <code>org-plot</code>, so let&rsquo;s use that
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> org-plot <span style="color: #C57BDB;">:recipe</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:local-repo</span> <span style="color: #7bc275;">"lisp"</span> <span style="color: #C57BDB;">:no-byte-compile</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-systemd" class="outline-4">
<h4 id="systemd"> <a class="anchor" aria-hidden="true" href="#systemd">🔗</a> <a class="anchor" aria-hidden="true" href="#systemd">🔗</a> <a class="anchor" aria-hidden="true" href="#systemd">🔗</a><span class="section-number-4">3.3.3</span> Systemd</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
For editing systemd unit files
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> systemd <span style="color: #C57BDB;">:pin</span> <span style="color: #7bc275;">"51c148e09a..."</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-package-configuration" class="outline-2">
<h2 id="package-configuration"> <a class="anchor" aria-hidden="true" href="#package-configuration">🔗</a><span class="section-number-2">4</span> Package configuration</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-abbrev-mode" class="outline-3">
<h3 id="abbrev-mode"> <a class="anchor" aria-hidden="true" href="#abbrev-mode">🔗</a> <a class="anchor" aria-hidden="true" href="#abbrev-mode">🔗</a><span class="section-number-3">4.1</span> Abbrev mode</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Thanks to <a href="https://emacs.stackexchange.com/questions/45462/use-a-single-abbrev-table-for-multiple-modes/45476#45476">use a single abbrev-table for multiple modes? - Emacs Stack Exchange</a> I
have the following.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package</span> abbrev
  <span style="color: #C57BDB;">:init</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #DFDFDF;">abbrev-mode</span> t<span style="color: #C57BDB;">)</span>
  <span style="color: #62686E;">;; </span><span style="color: #62686E;">a hook funtion that sets the abbrev-table to org-mode-abbrev-table</span>
  <span style="color: #62686E;">;; </span><span style="color: #62686E;">whenever the major mode is a text mode</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/set-text-mode-abbrev-table</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">derived-mode-p</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">text-mode</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">local-abbrev-table</span> <span style="color: #DFDFDF;">org-mode-abbrev-table</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:commands</span> <span style="color: #DFDFDF;">abbrev-mode</span>
  <span style="color: #C57BDB;">:hook</span>
  <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">abbrev-mode</span> . tec/set-text-mode-abbrev-table<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:config</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">abbrev-file-name</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"abbrev.el"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">save-abbrevs</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">silently</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-calc" class="outline-3">
<h3 id="calc"> <a class="anchor" aria-hidden="true" href="#calc">🔗</a> <a class="anchor" aria-hidden="true" href="#calc">🔗</a><span class="section-number-3">4.2</span> Calc</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Radians are just better
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> calc-angle-mode <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">rad</span>  <span style="color: #62686E;">;; </span><span style="color: #62686E;">radians are rad</span>
      calc-algebraic-mode t <span style="color: #62686E;">;; </span><span style="color: #62686E;">allows '2*x instead of 'x&lt;RET&gt;2*</span>
      calc-symbolic-mode t<span style="color: #51afef;">)</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">keeps stuff like &#8730;2 irrational for as long as possible</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> calctex
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> calctex-format-latex-header <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> calctex-format-latex-header
                                            <span style="color: #7bc275;">"\n\\usepackage{arevmath}"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">calc-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">calctex-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-centaur-tabs" class="outline-3">
<h3 id="centaur-tabs"> <a class="anchor" aria-hidden="true" href="#centaur-tabs">🔗</a> <a class="anchor" aria-hidden="true" href="#centaur-tabs">🔗</a><span class="section-number-3">4.3</span> Centaur Tabs</h3>
<div class="outline-text-3" id="text-4-3">
<p>
We want to make the tabs a nice, comfy size (<code>36</code>), with icons. The modifier
marker is nice, but the particular default Unicode one causes a lag spike, so
let&rsquo;s just switch to an <code>o</code>, which still looks decent but doesn&rsquo;t cause any
issues.
A &rsquo;active-bar&rsquo; is nice, so let&rsquo;s have one of those. If we have it <code>under</code> needs us to
turn on <code>x-underline-at-decent</code> though. For some reason this didn&rsquo;t seem to work
inside the <code>(after! ... )</code> block ¯\<sub>(ツ)</sub>_/¯.
Then let&rsquo;s change the font to a sans serif, but the default one doesn&rsquo;t fit too
well somehow, so let&rsquo;s switch to &rsquo;P22 Underground Book&rsquo;; it looks much nicer.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> centaur-tabs
  <span style="color: #C57BDB;">(</span>centaur-tabs-mode <span style="color: #e69055; font-weight: bold;">-1</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> centaur-tabs-height <span style="color: #e69055; font-weight: bold;">36</span>
        centaur-tabs-set-icons t
        centaur-tabs-modified-marker <span style="color: #7bc275;">"o"</span>
        centaur-tabs-close-button <span style="color: #7bc275;">"&#215;"</span>
        centaur-tabs-set-bar <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">above</span><span style="color: #C57BDB;">)</span>
        centaur-tabs-gray-out-icons <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">buffer</span>
  <span style="color: #C57BDB;">(</span>centaur-tabs-change-fonts <span style="color: #7bc275;">"P22 Underground Book"</span> <span style="color: #e69055; font-weight: bold;">160</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #62686E;">;; </span><span style="color: #62686E;">(setq x-underline-at-descent-line t)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-company" class="outline-3">
<h3 id="company"> <a class="anchor" aria-hidden="true" href="#company">🔗</a> <a class="anchor" aria-hidden="true" href="#company">🔗</a><span class="section-number-3">4.4</span> Company</h3>
<div class="outline-text-3" id="text-4-4">
<p>
It&rsquo;s nice to have completions almost all the time, in my opinion. Key strokes
are just waiting to be saved!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> company
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">company-idle-delay</span> <span style="color: #e69055; font-weight: bold;">0.5</span>
        <span style="color: #DFDFDF;">company-minimum-prefix-length</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">company-show-numbers</span> t<span style="color: #C57BDB;">)</span>
<span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">evil-normal-state-entry-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">company-abort</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">make aborting less annoying.</span>
</pre>
</div>
<p>
Now, the improvements from <code>precident</code> are mostly from remembering history, so
let&rsquo;s improve that memory.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #DFDFDF;">history-length</span> <span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-default</span> <span style="color: #DFDFDF;">prescient-history-length</span> <span style="color: #e69055; font-weight: bold;">1000</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-plain-text" class="outline-4">
<h4 id="plain-text"> <a class="anchor" aria-hidden="true" href="#plain-text">🔗</a> <a class="anchor" aria-hidden="true" href="#plain-text">🔗</a> <a class="anchor" aria-hidden="true" href="#plain-text">🔗</a><span class="section-number-4">4.4.1</span> Plain Text</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
<code>ispell</code> is nice, let&rsquo;s have it in <code>text</code>, <code>markdown</code>, and <code>GFM</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">set-company-backend!</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>text-mode
                        markdown-mode
                        gfm-mode<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:seperate</span> company-ispell
              company-files
              company-yasnippet<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
We then configure the dictionary we&rsquo;re using in <a href="#ispell">ispell</a>.
</p>
</div>
</div>
<div id="outline-container-company-ess" class="outline-4">
<h4 id="company-ess"> <a class="anchor" aria-hidden="true" href="#company-ess">🔗</a> <a class="anchor" aria-hidden="true" href="#company-ess">🔗</a> <a class="anchor" aria-hidden="true" href="#company-ess">🔗</a><span class="section-number-4">4.4.2</span> ESS</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
<code>company-dabbrev-code</code> is nice. Let&rsquo;s have it.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">set-company-backend!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">ess-r-mode</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>company-R-args company-R-objects company-dabbrev-code <span style="color: #C57BDB;">:separate</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-elcord" class="outline-3">
<h3 id="elcord"> <a class="anchor" aria-hidden="true" href="#elcord">🔗</a> <a class="anchor" aria-hidden="true" href="#elcord">🔗</a><span class="section-number-3">4.5</span> Elcord</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> elcord-use-major-mode-as-main-icon t<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-emacs-anywhere-configuration" class="outline-3">
<h3 id="emacs-anywhere-configuration"> <a class="anchor" aria-hidden="true" href="#emacs-anywhere-configuration">🔗</a> <a class="anchor" aria-hidden="true" href="#emacs-anywhere-configuration">🔗</a><span class="section-number-3">4.6</span> <a href="https://github.com/zachcurry/emacs-anywhere">Emacs Anywhere</a> configuration</h3>
<div class="outline-text-3" id="text-4-6">
<p>
It&rsquo;s nice to recognise GitHub (so we can use <code>GFM</code>), and other apps which we know
take markdown
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">markdown-window-p</span> <span style="color: #C57BDB;">(</span>window-title<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Judges from WINDOW-TITLE whether the current window likes markdown"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-match-p</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">rx</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">"Stack Exchange"</span> <span style="color: #7bc275;">"Stack Overflow"</span>
                          <span style="color: #7bc275;">"Pull Request"</span> <span style="color: #7bc275;">"Issue"</span> <span style="color: #7bc275;">"Discord"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                  window-title<span style="color: #7bc275;">)</span> <span style="color: #FCCE7B;">t nil</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
When the window opens, we generally want text so let&rsquo;s use a nice sans serif font,
a position the window below and to the left. Oh, and don&rsquo;t forget about checking
for <code>GFM</code>, otherwise let&rsquo;s just use <code>markdown</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">emacs-anywhere--active-markdown</span> nil
  <span style="color: #7e7e87;">"Whether the buffer started off as markdown.</span>
<span style="color: #7e7e87;">Affects behaviour of `</span><span style="color: #a991f1;">emacs-anywhere--finalise-content</span><span style="color: #7e7e87;">'"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">emacs-anywhere--finalise-content</span> <span style="color: #C57BDB;">(</span><span style="color: #FCCE7B;">&amp;optional</span> _frame<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #DFDFDF;">emacs-anywhere--active-markdown</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">fundamental-mode</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"#+OPTIONS: toc:nil\n"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">rename-buffer</span> <span style="color: #7bc275;">"*EA Pre Export*"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-export-to-buffer</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">gfm</span> ea--buffer-name<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">kill-buffer</span> <span style="color: #7bc275;">"*EA Pre Export*"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">gui-select-text</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">buffer-string</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #DFDFDF;">emacs-anywhere-mode</span>
  <span style="color: #7e7e87;">"To tweak the current buffer for some emacs-anywhere considerations"</span>
  <span style="color: #C57BDB;">:init-value</span> nil
  <span style="color: #C57BDB;">:keymap</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">list</span>
           <span style="color: #62686E;">;; </span><span style="color: #62686E;">Finish edit, but be smart in org mode</span>
           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">kbd</span> <span style="color: #7bc275;">"C-c C-c"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda!</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #DFDFDF;">major-mode</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-mode</span><span style="color: #51afef;">)</span>
                                                   <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-in-src-block-p</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                                              <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-ctrl-c-ctrl-c</span><span style="color: #7bc275;">)</span>
                                            <span style="color: #7bc275;">(</span><span style="color: #a991f1;">delete-frame</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
           <span style="color: #62686E;">;; </span><span style="color: #62686E;">Abort edit. emacs-anywhere saves the current edit for next time.</span>
           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">kbd</span> <span style="color: #7bc275;">"C-c C-k"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda!</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> ea-on nil<span style="color: #C57BDB;">)</span>
                                          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">delete-frame</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #DFDFDF;">emacs-anywhere-mode</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">line breaking</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">turn-off-auto-fill</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">visual-line-mode</span> t<span style="color: #7bc275;">)</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">DEL/C-SPC to clear (first keystroke only)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">set-transient-map</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>keymap <span style="color: #51afef;">(</span><span style="color: #a991f1;">make-sparse-keymap</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                         <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">define-key</span> keymap <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">kbd</span> <span style="color: #7bc275;">"DEL"</span><span style="color: #7bc275;">)</span>   <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda!</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-region</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                         <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">define-key</span> keymap <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">kbd</span> <span style="color: #7bc275;">"C-SPC"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda!</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-region</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                         keymap<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">disable tabs</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">bound-and-true-p</span> centaur-tabs-mode<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>centaur-tabs-local-mode t<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">ea-popup-handler</span> <span style="color: #C57BDB;">(</span>app-name window-title x y w h<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">interactive</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">set-frame-size</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">selected-frame</span><span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">80</span> <span style="color: #e69055; font-weight: bold;">12</span><span style="color: #C57BDB;">)</span>
  <span style="color: #62686E;">;; </span><span style="color: #62686E;">position the frame near the mouse</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let*</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>mousepos <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">split-string</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">shell-command-to-string</span> <span style="color: #7bc275;">"xdotool getmouselocation | sed -E \"s/ screen:0 window:[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;"> ]*|x:|y://g\""</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>mouse-x <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">-</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-to-number</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">0</span> mousepos<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">100</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>mouse-y <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">-</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-to-number</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> mousepos<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">50</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">set-frame-position</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">selected-frame</span><span style="color: #51afef;">)</span> mouse-x mouse-y<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">set-frame-name</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"Quick Edit &#8759; "</span> ea-app-name <span style="color: #7bc275;">" &#8212; "</span>
                          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">truncate-string-to-width</span>
                           <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-trim</span>
                            <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-trim-right</span> window-title
                                               <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"-[A-Za-z0-9 ]*%s"</span> ea-app-name<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                            <span style="color: #7bc275;">"[\s-]+"</span> <span style="color: #7bc275;">"[\s-]+"</span><span style="color: #C57BDB;">)</span>
                           <span style="color: #e69055; font-weight: bold;">45</span> nil nil <span style="color: #7bc275;">"&#8230;"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"window-title: %s"</span> window-title<span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when-let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>selection <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">gui-get-selection</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">PRIMARY</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert</span> selection<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">emacs-anywhere--active-markdown</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">markdown-window-p</span> window-title<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">convert buffer to org mode if markdown</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #DFDFDF;">emacs-anywhere--active-markdown</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">shell-command-on-region</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #51afef;">)</span>
                             <span style="color: #7bc275;">"pandoc -f markdown -t org"</span> nil t<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">deactivate-mark</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">set major mode</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-mode</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">ea--delete-frame-handler</span> <span style="color: #C57BDB;">:before</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">emacs-anywhere--finalise-content</span><span style="color: #C57BDB;">)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">I'll be honest with myself, I /need/ spellcheck</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">flyspell-buffer</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">evil-insert-state</span><span style="color: #C57BDB;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">start in insert</span>
  <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">emacs-anywhere-mode</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">ea-popup-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">ea-popup-handler</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-eros-eval" class="outline-3">
<h3 id="eros-eval"> <a class="anchor" aria-hidden="true" href="#eros-eval">🔗</a> <a class="anchor" aria-hidden="true" href="#eros-eval">🔗</a><span class="section-number-3">4.7</span> Eros-eval</h3>
<div class="outline-text-3" id="text-4-7">
<p>
This makes the result of evals with <kbd>gr</kbd> and <kbd>gR</kbd> just slightly prettier. Every bit
counts right?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">eros-eval-result-prefix</span> <span style="color: #7bc275;">"&#10233; "</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-evil" class="outline-3">
<h3 id="evil"> <a class="anchor" aria-hidden="true" href="#evil">🔗</a> <a class="anchor" aria-hidden="true" href="#evil">🔗</a><span class="section-number-3">4.8</span> EVIL</h3>
<div class="outline-text-3" id="text-4-8">
<p>
I don&rsquo;t use <code>evil-escape-mode</code>, so I may as well turn it off, I&rsquo;ve heard it
contributes a typing delay. I&rsquo;m not sure it&rsquo;s much, but it is an extra
<code>pre-command-hook</code> that I don&rsquo;t benefit from, so&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> evil <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">evil-escape-mode</span> nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-flyspell" class="outline-3">
<h3 id="flyspell"> <a class="anchor" aria-hidden="true" href="#flyspell">🔗</a> <a class="anchor" aria-hidden="true" href="#flyspell">🔗</a><span class="section-number-3">4.9</span> Flyspell</h3>
<div class="outline-text-3" id="text-4-9">
<p>
At one point, typing became noticeably laggy, Profiling revealed
<code>flyspell-post-command-hook</code> was responsible for 47% of CPU cycles by itself!
So I&rsquo;m going to make use of <code>flyspell-lazy</code>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> flyspell <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">flyspell-lazy</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">flyspell-lazy-mode</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-info-colors" class="outline-3">
<h3 id="info-colors"> <a class="anchor" aria-hidden="true" href="#info-colors">🔗</a> <a class="anchor" aria-hidden="true" href="#info-colors">🔗</a><span class="section-number-3">4.10</span> Info colors</h3>
<div class="outline-text-3" id="text-4-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> info-colors
  <span style="color: #C57BDB;">:commands</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">info-colors-fontify-node</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">Info-selection-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">info-colors-fontify-node</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">Info-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">mixed-pitch-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-ispell" class="outline-3">
<h3 id="ispell"> <a class="anchor" aria-hidden="true" href="#ispell">🔗</a> <a class="anchor" aria-hidden="true" href="#ispell">🔗</a><span class="section-number-3">4.11</span> Ispell</h3>
<div class="outline-text-3" id="text-4-11">
<p>
Let&rsquo;s get a nice big dictionary from <a href="http://app.aspell.net/create">SCOWL Custom List/Dictionary Creator</a> with
the following configuration
</p>
<dl class="org-dl">
<dt>size</dt><dd>80 (huge)</dd>
<dt>spellings</dt><dd>British(-ise) and Australian</dd>
<dt>spelling variants level</dt><dd>0</dd>
<dt>diacritics</dt><dd>keep</dd>
<dt>extra lists</dt><dd>hacker, roman numerals</dd>
</dl>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">ispell-dictionary</span> <span style="color: #7bc275;">"en_GBs_au_SCOWL_80_0_k_hr"</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Oh, and by the way, if <code>company-ispell-dictionary</code> is <code>nil</code>, then
<code>ispell-complete-word-dict</code> is used instead, which once again when <code>nil</code> is
<code>ispell-alternate-dictionary</code>, which at the moment maps to a plaintext version of
the above.
</p>

<p>
It seems reasonable to want to keep an eye on my personal dict, let&rsquo;s have it
nearby (also means that if I change the &rsquo;main&rsquo; dictionary I keep my addition).
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">ispell-personal-dictionary</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">".hunspell_personal"</span> <span style="color: #DFDFDF;">doom-private-dir</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-ivy" class="outline-3">
<h3 id="ivy"> <a class="anchor" aria-hidden="true" href="#ivy">🔗</a> <a class="anchor" aria-hidden="true" href="#ivy">🔗</a><span class="section-number-3">4.12</span> Ivy</h3>
<div class="outline-text-3" id="text-4-12">
<p>
While in an ivy mini-buffer <kbd>C-o</kbd> shows a list of all possible actions one may take.
By default this is <code>#'ivy-read-action-by-key</code> however a better interface to this
is using Hydra.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">ivy-read-action-function</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">ivy-hydra-read-action</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I currently have ~40k functions. This seems like sufficient motivation to
increase the maximum number of items ivy will sort to 40k + a bit, this way
<kbd>SPC h f</kbd> et al. will continue to function as expected.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">ivy-sort-max-size</span> <span style="color: #e69055; font-weight: bold;">50000</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-magit" class="outline-3">
<h3 id="magit"> <a class="anchor" aria-hidden="true" href="#magit">🔗</a> <a class="anchor" aria-hidden="true" href="#magit">🔗</a><span class="section-number-3">4.13</span> Magit</h3>
<div class="outline-text-3" id="text-4-13">
<p>
Magit is pretty nice by default. The diffs don&rsquo;t get any
syntax-highlighting-love though which is a bit sad. Thankfully
<a href="https://github.com/dandavison/magit-delta">dandavison/magit-delta</a> exists, which we can put to use.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">(after! magit</span>
<span style="color: #62686E;">;;   </span><span style="color: #62686E;">(magit-delta-mode +1))</span>
</pre>
</div>
<p>
Unfortunately this seems to mess things up, which is something I&rsquo;ll want to look
into later.
</p>
</div>
</div>
<div id="outline-container-mail" class="outline-3">
<h3 id="mail"> <a class="anchor" aria-hidden="true" href="#mail">🔗</a> <a class="anchor" aria-hidden="true" href="#mail">🔗</a><span class="section-number-3">4.14</span> Mail</h3>
<div class="outline-text-3" id="text-4-14">
<p>
<img src='https://imgs.xkcd.com/comics/email.png' title="My New Year's resolution for 2014-54-12/30/14 Dec:12:1420001642 is to learn these stupid time formatting strings." alt='Email'>
</p>
</div>

<div id="outline-container-fetching" class="outline-4">
<h4 id="fetching"> <a class="anchor" aria-hidden="true" href="#fetching">🔗</a> <a class="anchor" aria-hidden="true" href="#fetching">🔗</a> <a class="anchor" aria-hidden="true" href="#fetching">🔗</a><span class="section-number-4">4.14.1</span> Fetching</h4>
<div class="outline-text-4" id="text-4-14-1">
<p>
The contenders for this seem to be:
</p>
<ul class="org-ul">
<li><a href="https://www.offlineimap.org/">OfflineIMAP</a> (<a href="https://wiki.archlinux.org/index.php/OfflineIMAP">ArchWiki page</a>)</li>
<li><a href="http://isync.sourceforge.net/mbsync.html">isync/mbsync</a> (<a href="https://wiki.archlinux.org/index.php/isync">ArchWiki page</a>)</li>
</ul>

<p>
From perusing r/emacs the prevailing opinion seems to be that
</p>
<ul class="org-ul">
<li>isync is faster</li>
<li>isync works more reliably</li>
</ul>
<p>
So let&rsquo;s use that.
</p>

<p>
The config was straightforward, and is located at <a href="file:///home/tec/.mbsyncrc">~/.mbsyncrc</a>.
I&rsquo;m currently successfully connecting to: Gmail, office365mail, and dovecot.
I&rsquo;m also shoving passwords in my <a href="file:///home/tec/.authinfo.gpg">authinfo.gpg</a> and fetching them using <code>PassCmd</code>:
</p>
<div class="org-src-container">
<pre class="src src-shell">gpg2 -q --for-your-eyes-only --no-tty -d ~/.authinfo.gpg | awk <span style="color: #7bc275;">'/machine IMAP_SERCER login EMAIL_ADDR/ {print $NF}'</span>
</pre>
</div>

<p>
We can run <code>mbsync -a</code> in a systemd service file or something, but we can do
better than that. <a href="https://github.com/vsemyonoff/easymail#usage">vsemyonoff/easymail</a> seems like the sort of thing we want, but
is written for <kbd>notmuch</kbd> unfortunately. We can still use it for inspiration though.
Using <a href="https://gitlab.com/shackra/goimapnotify">goimapnotify</a> we should be able to sync just after new
mail. Unfortunately this means <i>yet another</i> config file :(
</p>

<p>
We install with
</p>
<div class="org-src-container">
<pre class="src src-shell">go get -u gitlab.com/shackra/goimapnotify
<span style="color: #FCCE7B;">ln</span> -s ~/go/bin/goimapnotify ~/.local/bin/
</pre>
</div>

<p>
Here&rsquo;s the general plan:
</p>
<ol class="org-ol">
<li>Use <code>goimapnotify</code> to monitor mailboxes
This needs it&rsquo;s own set of configs, and <kbd>systemd</kbd> services, which is a pain. We
remove this pain by writing a python script (found below) to setup these
config files, and systemd services by parsing the  <a href="file:///home/tec/.mbsyncrc">~/.mbsyncrc</a> file.</li>
<li>On new mail, call <code>mbsync --pull --new ACCOUNT:BOX</code>
We try to be as specific as possible, so <code>mbsync</code> returns as soon as possible,
and we can <i>get those emails as soon as possible</i>.</li>
<li>Try to call <code>mu index --lazy-fetch</code>.
This fails if mu4e is already open (due to a write lock on the database), so
in that case we just <code>touch</code> a tmp file (<kbd>/tmp/mu_reindex_now</kbd>).</li>
<li>Separately, we set up Emacs to check for the existance of
<kbd>/tmp/mu_reindex_now</kbd> once a second while mu4e is
running, and (after deleting the file) call <code>mu4e-update-index</code>.</li>
</ol>

<p>
Let&rsquo;s start off by handling the elisp side of things
</p>
</div>

<div id="outline-container-rebuild-mail-index" class="outline-5">
<h5 id="rebuild-mail-index"> <a class="anchor" aria-hidden="true" href="#rebuild-mail-index">🔗</a> <a class="anchor" aria-hidden="true" href="#rebuild-mail-index">🔗</a> <a class="anchor" aria-hidden="true" href="#rebuild-mail-index">🔗</a> <a class="anchor" aria-hidden="true" href="#rebuild-mail-index">🔗</a><span class="section-number-5">4.14.1.1</span> Rebuild mail index while using mu4e</h5>
<div class="outline-text-5" id="text-4-14-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-reindex-request-file</span> <span style="color: #7bc275;">"/tmp/mu_reindex_now"</span>
    <span style="color: #7e7e87;">"Location of the reindex request, signaled by existance"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-reindex-request-min-seperation</span> <span style="color: #e69055; font-weight: bold;">5.0</span>
    <span style="color: #7e7e87;">"Don't refresh again until this many second have elapsed.</span>
<span style="color: #7e7e87;">Prevents a series of redisplays from being called (when set to an appropriate value)"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-watcher</span> nil<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-just-deleted</span> nil<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-reindex-request--last-time</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-reindex-request--add-watcher</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-just-deleted</span> nil<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-watcher</span>
          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">file-notify-add-watch</span> <span style="color: #DFDFDF;">mu4e-reindex-request-file</span>
                                 <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>change<span style="color: #C57BDB;">)</span>
                                 <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-file-reindex-request</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> mu4e-stop-watching-for-reindex-request <span style="color: #7bc275;">()</span>
    <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e~proc-kill</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-watcher</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">file-notify-rm-watch</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-watcher</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> mu4e-watch-for-reindex-request <span style="color: #7bc275;">()</span>
    <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e~proc-start</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">mu4e-stop-watching-for-reindex-request</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">file-exists-p</span> <span style="color: #DFDFDF;">mu4e-reindex-request-file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-reindex-request-file</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">mu4e-reindex-request--add-watcher</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-file-reindex-request</span> <span style="color: #7bc275;">(</span>event<span style="color: #7bc275;">)</span>
      <span style="color: #7e7e87;">"Act based on the existance of `</span><span style="color: #a991f1;">mu4e-reindex-request-file</span><span style="color: #7e7e87;">'"</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-just-deleted</span>
          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-reindex-request--add-watcher</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> event<span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">created</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-reindex-request-file</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-reindex-request--file-just-deleted</span> t<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-reindex-maybe</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-reindex-maybe</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> new-request<span style="color: #7bc275;">)</span>
      <span style="color: #7e7e87;">"Run `</span><span style="color: #a991f1;">mu4e~proc-index</span><span style="color: #7e7e87;">' if it's been more than `</span><span style="color: #a991f1;">mu4e-reindex-request-min-seperation</span><span style="color: #7e7e87;">' seconds since the last request,"</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>time-since-last-request <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">float-time</span><span style="color: #51afef;">)</span> <span style="color: #DFDFDF;">mu4e-reindex-request--last-time</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> new-request
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-reindex-request--last-time</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">float-time</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">&gt;</span> time-since-last-request <span style="color: #DFDFDF;">mu4e-reindex-request-min-seperation</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e~proc-index</span> nil t<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> new-request
            <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">run-at-time</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">*</span> <span style="color: #e69055; font-weight: bold;">1.1</span> <span style="color: #DFDFDF;">mu4e-reindex-request-min-seperation</span><span style="color: #51afef;">)</span> nil
                         <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-reindex-maybe</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-config-transcoding-" class="outline-5">
<h5 id="config-transcoding-"> <a class="anchor" aria-hidden="true" href="#config-transcoding-">🔗</a> <a class="anchor" aria-hidden="true" href="#config-transcoding-">🔗</a> <a class="anchor" aria-hidden="true" href="#config-transcoding-">🔗</a> <a class="anchor" aria-hidden="true" href="#config-transcoding-">🔗</a><span class="section-number-5">4.14.1.2</span> Config transcoding &amp; service management</h5>
<div class="outline-text-5" id="text-4-14-1-2">
<p>
As long as the <kbd>mbsyncrc</kbd> file exists, this is as easy as running
</p>
<div class="org-src-container">
<pre class="src src-shell">~/.config/doom/misc/mbsync-imapnotify.py
</pre>
</div>

<p>
When run without flags this will perform the following actions
</p>
<ul class="org-ul">
<li>Read, and parse <a href="file:///home/tec/.mbsyncrc">~/.mbsyncrc</a>, specifically recognising the following properties
<ul class="org-ul">
<li><code>IMAPAccount</code></li>
<li><code>Host</code></li>
<li><code>Port</code></li>
<li><code>User</code></li>
<li><code>Password</code></li>
<li><code>PassCmd</code></li>
<li><code>Patterns</code></li>
</ul></li>
<li>Call <code>mbsync --list ACCOUNT</code>, and filter results according to <code>Patterns</code></li>
<li>Construct a imapnotify config for each account, with the following hooks
<dl class="org-dl">
<dt>onNewMail</dt><dd><code>mbsync --pull ACCOUNT:MAILBOX</code></dd>
<dt>onNewMailPost</dt><dd><code>if mu index --lazy-check; then test -f /tmp/mu_reindex_now &amp;&amp; rm /tmp/mu_reindex_now; else touch /tmp/mu_reindex_now; fi</code></dd>
</dl></li>
<li>Compare accounts list to previous accounts, enable/disable the relevant
systemd services, called with the <code>--now</code> flag (start/stop services as well)</li>
</ul>

<p>
This script also supports the following flags
</p>
<ul class="org-ul">
<li><code>--status</code> to get the status of the relevant systemd services supports <kbd>active</kbd>,
<kbd>failing</kbd>, and <kbd>disabled</kbd></li>
<li><code>--enable</code> to enable all relevant systemd services</li>
<li><code>--disable</code> to disable all relevant systemd services</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">from</span> pathlib <span style="color: #51afef;">import</span> Path
<span style="color: #51afef;">import</span> json
<span style="color: #51afef;">import</span> re
<span style="color: #51afef;">import</span> shutil
<span style="color: #51afef;">import</span> subprocess
<span style="color: #51afef;">import</span> sys
<span style="color: #51afef;">import</span> fnmatch

<span style="color: #DFDFDF;">mbsyncFile</span> = Path(<span style="color: #7bc275;">"~/.mbsyncrc"</span>).expanduser()

<span style="color: #DFDFDF;">imapnotifyConfigFolder</span> = Path(<span style="color: #7bc275;">"~/.imapnotify/"</span>).expanduser()
imapnotifyConfigFolder.mkdir(exist_ok=<span style="color: #a991f1;">True</span>)
<span style="color: #DFDFDF;">imapnotifyConfigFilename</span> = <span style="color: #7bc275;">"notify.conf"</span>

<span style="color: #DFDFDF;">imapnotifyDefault</span> = {
    <span style="color: #7bc275;">"host"</span>: <span style="color: #7bc275;">""</span>,
    <span style="color: #7bc275;">"port"</span>: <span style="color: #e69055; font-weight: bold;">993</span>,
    <span style="color: #7bc275;">"tls"</span>: <span style="color: #a991f1;">True</span>,
    <span style="color: #7bc275;">"tlsOptions"</span>: {<span style="color: #7bc275;">"rejectUnauthorized"</span>: <span style="color: #a991f1;">True</span>},
    <span style="color: #7bc275;">"onNewMail"</span>: <span style="color: #7bc275;">""</span>,
    <span style="color: #7bc275;">"onNewMailPost"</span>: <span style="color: #7bc275;">"if mu index --lazy-check; then test -f /tmp/mu_reindex_now &amp;&amp; rm /tmp/mu_reindex_now; else touch /tmp/mu_reindex_now; fi"</span>,
}


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">stripQuotes</span>(string):
    <span style="color: #51afef;">if</span> string[<span style="color: #e69055; font-weight: bold;">0</span>] == <span style="color: #7bc275;">'"'</span> <span style="color: #51afef;">and</span> string[-<span style="color: #e69055; font-weight: bold;">1</span>] == <span style="color: #7bc275;">'"'</span>:
        <span style="color: #51afef;">return</span> string[<span style="color: #e69055; font-weight: bold;">1</span>:-<span style="color: #e69055; font-weight: bold;">1</span>].replace(<span style="color: #7bc275;">'\\"'</span>, <span style="color: #7bc275;">'"'</span>)


<span style="color: #DFDFDF;">mbsyncInotifyMapping</span> = {
    <span style="color: #7bc275;">"Host"</span>: (<span style="color: #C57BDB;">str</span>, <span style="color: #7bc275;">"host"</span>),
    <span style="color: #7bc275;">"Port"</span>: (<span style="color: #C57BDB;">int</span>, <span style="color: #7bc275;">"port"</span>),
    <span style="color: #7bc275;">"User"</span>: (<span style="color: #C57BDB;">str</span>, <span style="color: #7bc275;">"username"</span>),
    <span style="color: #7bc275;">"Password"</span>: (<span style="color: #C57BDB;">str</span>, <span style="color: #7bc275;">"password"</span>),
    <span style="color: #7bc275;">"PassCmd"</span>: (stripQuotes, <span style="color: #7bc275;">"passwordCmd"</span>),
    <span style="color: #7bc275;">"Patterns"</span>: (<span style="color: #C57BDB;">str</span>, <span style="color: #7bc275;">"_patterns"</span>),
}

<span style="color: #DFDFDF;">oldAccounts</span> = [d.name <span style="color: #51afef;">for</span> d <span style="color: #51afef;">in</span> imapnotifyConfigFolder.iterdir() <span style="color: #51afef;">if</span> d.is_dir()]

<span style="color: #DFDFDF;">currentAccount</span> = <span style="color: #7bc275;">""</span>
<span style="color: #DFDFDF;">currentAccountData</span> = {}

<span style="color: #DFDFDF;">successfulAdditions</span> = []


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">processLine</span>(line):
    <span style="color: #DFDFDF;">newAcc</span> = re.match(r<span style="color: #7bc275;">"^IMAPAccount ([^#]+)"</span>, line)

    <span style="color: #DFDFDF;">linecontent</span> = re.sub(r<span style="color: #7bc275;">"(^|[^\\])#.*"</span>, <span style="color: #7bc275;">""</span>, line).split(<span style="color: #7bc275;">" "</span>, <span style="color: #e69055; font-weight: bold;">1</span>)
    <span style="color: #51afef;">if</span> <span style="color: #C57BDB;">len</span>(linecontent) != <span style="color: #e69055; font-weight: bold;">2</span>:
        <span style="color: #51afef;">return</span>

    <span style="color: #DFDFDF;">parameter</span>, <span style="color: #DFDFDF;">value</span> = linecontent

    <span style="color: #51afef;">if</span> parameter == <span style="color: #7bc275;">"IMAPAccount"</span>:
        <span style="color: #51afef;">if</span> currentAccountNumber &gt; <span style="color: #e69055; font-weight: bold;">0</span>:
            finaliseAccount()
        newAccount(value)
    <span style="color: #51afef;">elif</span> parameter <span style="color: #51afef;">in</span> mbsyncInotifyMapping.keys():
        <span style="color: #DFDFDF;">parser</span>, <span style="color: #DFDFDF;">key</span> = mbsyncInotifyMapping[parameter]
        <span style="color: #DFDFDF;">currentAccountData</span>[key] = parser(value)
    <span style="color: #51afef;">elif</span> parameter == <span style="color: #7bc275;">"Channel"</span>:
        <span style="color: #DFDFDF;">currentAccountData</span>[<span style="color: #7bc275;">"onNewMail"</span>] = f<span style="color: #7bc275;">"mbsync --pull --new {value}:'%s'"</span>


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">newAccount</span>(name):
    <span style="color: #51afef;">global</span> currentAccountNumber
    <span style="color: #51afef;">global</span> currentAccount
    <span style="color: #51afef;">global</span> currentAccountData
    <span style="color: #DFDFDF;">currentAccountNumber</span> += <span style="color: #e69055; font-weight: bold;">1</span>
    <span style="color: #DFDFDF;">currentAccount</span> = name
    <span style="color: #DFDFDF;">currentAccountData</span> = {}
    <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\n\033[1;32m{currentAccountNumber}\033[0;32m - {name}\033[0;37m"</span>)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">accountToFoldername</span>(name):
    <span style="color: #51afef;">return</span> re.sub(r<span style="color: #7bc275;">"[^A-Za-z0-9]"</span>, <span style="color: #7bc275;">""</span>, name)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">finaliseAccount</span>():
    <span style="color: #51afef;">if</span> currentAccountNumber == <span style="color: #e69055; font-weight: bold;">0</span>:
        <span style="color: #51afef;">return</span>

    <span style="color: #51afef;">global</span> currentAccountData
    <span style="color: #51afef;">try</span>:
        <span style="color: #DFDFDF;">currentAccountData</span>[<span style="color: #7bc275;">"boxes"</span>] = getMailBoxes(currentAccount)
    <span style="color: #51afef;">except</span> subprocess.CalledProcessError <span style="color: #51afef;">as</span> e:
        <span style="color: #51afef;">print</span>(
            f<span style="color: #7bc275;">"\033[1;31mError:\033[0;31m failed to fetch mailboxes (skipping): "</span>
            + f<span style="color: #7bc275;">"`{' '.join(e.cmd)}' returned code {e.returncode}\033[0;37m"</span>
        )
        <span style="color: #51afef;">return</span>
    <span style="color: #51afef;">except</span> subprocess.TimeoutExpired <span style="color: #51afef;">as</span> e:
        <span style="color: #51afef;">print</span>(
            f<span style="color: #7bc275;">"\033[1;31mError:\033[0;31m failed to fetch mailboxes (skipping): "</span>
            + f<span style="color: #7bc275;">"`{' '.join(e.cmd)}' timed out after {e.timeout} seconds\033[0;37m"</span>
        )
        <span style="color: #51afef;">return</span>

    <span style="color: #51afef;">if</span> <span style="color: #7bc275;">"_patterns"</span> <span style="color: #51afef;">in</span> currentAccountData:
        currentAccountData[<span style="color: #7bc275;">"boxes"</span>] = applyPatternFilter(
            currentAccountData[<span style="color: #7bc275;">"_patterns"</span>], currentAccountData[<span style="color: #7bc275;">"boxes"</span>]
        )

    <span style="color: #62686E;"># </span><span style="color: #62686E;">strip not-to-be-exported data</span>
    <span style="color: #DFDFDF;">currentAccountData</span> = {
        k: currentAccountData[k] <span style="color: #51afef;">for</span> k <span style="color: #51afef;">in</span> currentAccountData <span style="color: #51afef;">if</span> k[<span style="color: #e69055; font-weight: bold;">0</span>] != <span style="color: #7bc275;">"_"</span>
    }

    <span style="color: #DFDFDF;">parametersSet</span> = currentAccountData.keys()
    <span style="color: #DFDFDF;">currentAccountData</span> = {**imapnotifyDefault, **currentAccountData}
    <span style="color: #51afef;">for</span> key, val <span style="color: #51afef;">in</span> currentAccountData.items():
        <span style="color: #DFDFDF;">valColor</span> = <span style="color: #7bc275;">"\033[0;33m"</span> <span style="color: #51afef;">if</span> key <span style="color: #51afef;">in</span> parametersSet <span style="color: #51afef;">else</span> <span style="color: #7bc275;">"\033[0;37m"</span>
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"  \033[1;37m{key:&lt;13} {valColor}{val}\033[0;37m"</span>)

    <span style="color: #51afef;">if</span> (
        <span style="color: #C57BDB;">len</span>(currentAccountData[<span style="color: #7bc275;">"boxes"</span>]) &gt; <span style="color: #e69055; font-weight: bold;">15</span>
        <span style="color: #51afef;">and</span> <span style="color: #7bc275;">"@gmail.com"</span> <span style="color: #51afef;">in</span> currentAccountData[<span style="color: #7bc275;">"username"</span>]
    ):
        <span style="color: #51afef;">print</span>(
            <span style="color: #7bc275;">"  \033[1;31mWarning:\033[0;31m Gmail raises an error when more than"</span>
            + <span style="color: #7bc275;">"\033[1;31m15\033[0;31m simultanious connections are attempted."</span>
            + <span style="color: #7bc275;">"\n           You are attempting to monitor "</span>
            + f<span style="color: #7bc275;">"\033[1;31m{len(currentAccountData['boxes'])}\033[0;31m mailboxes.\033[0;37m"</span>
        )

    <span style="color: #DFDFDF;">configFile</span> = (
        imapnotifyConfigFolder
        / accountToFoldername(currentAccount)
        / imapnotifyConfigFilename
    )
    configFile.parent.mkdir(exist_ok=<span style="color: #a991f1;">True</span>)

    json.dump(currentAccountData, <span style="color: #C57BDB;">open</span>(configFile, <span style="color: #7bc275;">"w"</span>), indent=<span style="color: #e69055; font-weight: bold;">2</span>)
    <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">" \033[0;35mConfig generated and saved to {configFile}\033[0;37m"</span>)

    <span style="color: #51afef;">global</span> successfulAdditions
    successfulAdditions.append(accountToFoldername(currentAccount))


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">getMailBoxes</span>(account):
    <span style="color: #DFDFDF;">boxes</span> = subprocess.run(
        [<span style="color: #7bc275;">"mbsync"</span>, <span style="color: #7bc275;">"--list"</span>, account], check=<span style="color: #a991f1;">True</span>, stdout=subprocess.PIPE, timeout=<span style="color: #e69055; font-weight: bold;">10.0</span>
    )
    <span style="color: #51afef;">return</span> boxes.stdout.decode(<span style="color: #7bc275;">"utf-8"</span>).strip().split(<span style="color: #7bc275;">"\n"</span>)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">applyPatternFilter</span>(pattern, mailboxes):
    <span style="color: #DFDFDF;">patternRegexs</span> = getPatternRegexes(pattern)
    <span style="color: #51afef;">return</span> [m <span style="color: #51afef;">for</span> m <span style="color: #51afef;">in</span> mailboxes <span style="color: #51afef;">if</span> testPatternRegexs(patternRegexs, m)]


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">getPatternRegexes</span>(pattern):
    <span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">addGlob</span>(b):
        blobs.append(b.replace(<span style="color: #7bc275;">'\\"'</span>, <span style="color: #7bc275;">'"'</span>))
        <span style="color: #51afef;">return</span> <span style="color: #7bc275;">""</span>

    <span style="color: #DFDFDF;">blobs</span> = []
    <span style="color: #DFDFDF;">pattern</span> = re.sub(r<span style="color: #7bc275;">' ?"([^"]+)"'</span>, <span style="color: #51afef;">lambda</span> m: addGlob(m.groups()[<span style="color: #e69055; font-weight: bold;">0</span>]), pattern)
    blobs.extend(pattern.split(<span style="color: #7bc275;">" "</span>))
    <span style="color: #DFDFDF;">blobs</span> = [
        (-<span style="color: #e69055; font-weight: bold;">1</span>, fnmatch.translate(b[<span style="color: #e69055; font-weight: bold;">1</span>::])) <span style="color: #51afef;">if</span> b[<span style="color: #e69055; font-weight: bold;">0</span>] == <span style="color: #7bc275;">"!"</span> <span style="color: #51afef;">else</span> (<span style="color: #e69055; font-weight: bold;">1</span>, fnmatch.translate(b))
        <span style="color: #51afef;">for</span> b <span style="color: #51afef;">in</span> blobs
    ]
    <span style="color: #51afef;">return</span> blobs


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">testPatternRegexs</span>(regexCond, case):
    <span style="color: #51afef;">for</span> factor, regex <span style="color: #51afef;">in</span> regexCond:
        <span style="color: #51afef;">if</span> factor * <span style="color: #C57BDB;">bool</span>(re.match(regex, case)) &lt; <span style="color: #e69055; font-weight: bold;">0</span>:
            <span style="color: #51afef;">return</span> <span style="color: #a991f1;">False</span>
    <span style="color: #51afef;">return</span> <span style="color: #a991f1;">True</span>


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">processSystemdServices</span>():
    <span style="color: #DFDFDF;">keptAccounts</span> = [acc <span style="color: #51afef;">for</span> acc <span style="color: #51afef;">in</span> successfulAdditions <span style="color: #51afef;">if</span> acc <span style="color: #51afef;">in</span> oldAccounts]
    <span style="color: #DFDFDF;">freshAccounts</span> = [acc <span style="color: #51afef;">for</span> acc <span style="color: #51afef;">in</span> successfulAdditions <span style="color: #51afef;">if</span> acc <span style="color: #51afef;">not</span> <span style="color: #51afef;">in</span> oldAccounts]
    <span style="color: #DFDFDF;">staleAccounts</span> = [acc <span style="color: #51afef;">for</span> acc <span style="color: #51afef;">in</span> oldAccounts <span style="color: #51afef;">if</span> acc <span style="color: #51afef;">not</span> <span style="color: #51afef;">in</span> successfulAdditions]

    <span style="color: #51afef;">if</span> keptAccounts:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\033[1;34m{len(keptAccounts)}\033[0;34m kept accounts:\033[0;37m"</span>)
        restartAccountSystemdServices(keptAccounts)

    <span style="color: #51afef;">if</span> freshAccounts:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\033[1;32m{len(freshAccounts)}\033[0;32m new accounts:\033[0;37m"</span>)
        enableAccountSystemdServices(freshAccounts)
    <span style="color: #51afef;">else</span>:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\033[0;32mNo new accounts.\033[0;37m"</span>)

    <span style="color: #DFDFDF;">notActuallyEnabledAccounts</span> = [
        acc <span style="color: #51afef;">for</span> acc <span style="color: #51afef;">in</span> successfulAdditions <span style="color: #51afef;">if</span> <span style="color: #51afef;">not</span> getAccountServiceState(acc)[<span style="color: #7bc275;">"enabled"</span>]
    ]
    <span style="color: #51afef;">if</span> notActuallyEnabledAccounts:
        <span style="color: #51afef;">print</span>(
            f<span style="color: #7bc275;">"\033[1;32m{len(notActuallyEnabledAccounts)}\033[0;32m accounts need re-enabling:\033[0;37m"</span>
        )
        enableAccountSystemdServices(notActuallyEnabledAccounts)

    <span style="color: #51afef;">if</span> staleAccounts:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\033[1;33m{len(staleAccounts)}\033[0;33m removed accounts:\033[0;37m"</span>)
        disableAccountSystemdServices(staleAccounts)
    <span style="color: #51afef;">else</span>:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\033[0;33mNo removed accounts.\033[0;37m"</span>)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">enableAccountSystemdServices</span>(accounts):
    <span style="color: #51afef;">for</span> account <span style="color: #51afef;">in</span> accounts:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">" \033[0;32m - \033[1;37m{account:&lt;18}"</span>, end=<span style="color: #7bc275;">"\033[0;37m"</span>, flush=<span style="color: #a991f1;">True</span>)
        <span style="color: #51afef;">if</span> setSystemdServiceState(
            <span style="color: #7bc275;">"enable"</span>, f<span style="color: #7bc275;">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;32m enabled"</span>)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">disableAccountSystemdServices</span>(accounts):
    <span style="color: #51afef;">for</span> account <span style="color: #51afef;">in</span> accounts:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">" \033[0;33m - \033[1;37m{account:&lt;18}"</span>, end=<span style="color: #7bc275;">"\033[0;37m"</span>, flush=<span style="color: #a991f1;">True</span>)
        <span style="color: #51afef;">if</span> setSystemdServiceState(
            <span style="color: #7bc275;">"disable"</span>, f<span style="color: #7bc275;">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;33m disabled"</span>)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">restartAccountSystemdServices</span>(accounts):
    <span style="color: #51afef;">for</span> account <span style="color: #51afef;">in</span> accounts:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">" \033[0;34m - \033[1;37m{account:&lt;18}"</span>, end=<span style="color: #7bc275;">"\033[0;37m"</span>, flush=<span style="color: #a991f1;">True</span>)
        <span style="color: #51afef;">if</span> setSystemdServiceState(
            <span style="color: #7bc275;">"restart"</span>, f<span style="color: #7bc275;">"goimapnotify@{accountToFoldername(account)}.service"</span>
        ):
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;34m restarted"</span>)


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">setSystemdServiceState</span>(state, service):
    <span style="color: #51afef;">try</span>:
        <span style="color: #DFDFDF;">enabler</span> = subprocess.run(
            [<span style="color: #7bc275;">"systemctl"</span>, <span style="color: #7bc275;">"--user"</span>, state, service, <span style="color: #7bc275;">"--now"</span>],
            check=<span style="color: #a991f1;">True</span>,
            stderr=subprocess.DEVNULL,
            timeout=<span style="color: #e69055; font-weight: bold;">2.0</span>,
        )
        <span style="color: #51afef;">return</span> <span style="color: #a991f1;">True</span>
    <span style="color: #51afef;">except</span> subprocess.CalledProcessError <span style="color: #51afef;">as</span> e:
        <span style="color: #51afef;">print</span>(
            f<span style="color: #7bc275;">" \033[1;31mfailed\033[0;31m to {state}, `{' '.join(e.cmd)}'"</span>
            + f<span style="color: #7bc275;">"returned code {e.returncode}\033[0;37m"</span>
        )
    <span style="color: #51afef;">except</span> subprocess.TimeoutExpired <span style="color: #51afef;">as</span> e:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">" \033[1;31mtimed out after {e.timeout} seconds\033[0;37m"</span>)
        <span style="color: #51afef;">return</span> <span style="color: #a991f1;">False</span>


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">getAccountServiceState</span>(account):
    <span style="color: #51afef;">return</span> {
        state: <span style="color: #C57BDB;">bool</span>(
            <span style="color: #e69055; font-weight: bold;">1</span>
            - subprocess.run(
                [
                    <span style="color: #7bc275;">"systemctl"</span>,
                    <span style="color: #7bc275;">"--user"</span>,
                    f<span style="color: #7bc275;">"is-{state}"</span>,
                    <span style="color: #7bc275;">"--quiet"</span>,
                    f<span style="color: #7bc275;">"goimapnotify@{accountToFoldername(account)}.service"</span>,
                ],
                stderr=subprocess.DEVNULL,
            ).returncode
        )
        <span style="color: #51afef;">for</span> state <span style="color: #51afef;">in</span> (<span style="color: #7bc275;">"enabled"</span>, <span style="color: #7bc275;">"active"</span>, <span style="color: #7bc275;">"failing"</span>)
    }


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">getAccountServiceStates</span>(accounts):
    <span style="color: #51afef;">for</span> account <span style="color: #51afef;">in</span> accounts:
        <span style="color: #DFDFDF;">enabled</span>, <span style="color: #DFDFDF;">active</span>, <span style="color: #DFDFDF;">failing</span> = getAccountServiceState(account).values()
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"  - \033[1;37m{account:&lt;18}\033[0;37m "</span>, end=<span style="color: #7bc275;">""</span>, flush=<span style="color: #a991f1;">True</span>)
        <span style="color: #51afef;">if</span> <span style="color: #51afef;">not</span> enabled:
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;33mdisabled\033[0;37m"</span>)
        <span style="color: #51afef;">elif</span> active:
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;32mactive\033[0;37m"</span>)
        <span style="color: #51afef;">elif</span> failing:
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;31mfailing\033[0;37m"</span>)
        <span style="color: #51afef;">else</span>:
            <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;35min an unrecognised state\033[0;37m"</span>)


<span style="color: #51afef;">if</span> <span style="color: #C57BDB;">len</span>(sys.argv) &gt; <span style="color: #e69055; font-weight: bold;">1</span>:
    <span style="color: #51afef;">if</span> sys.argv[<span style="color: #e69055; font-weight: bold;">1</span>] == <span style="color: #7bc275;">"--enable"</span>:
        enableAccountSystemdServices(oldAccounts)
        <span style="color: #a991f1;">exit</span>()
    <span style="color: #51afef;">elif</span> sys.argv[<span style="color: #e69055; font-weight: bold;">1</span>] == <span style="color: #7bc275;">"--disable"</span>:
        disableAccountSystemdServices(oldAccounts)
        <span style="color: #a991f1;">exit</span>()
    <span style="color: #51afef;">elif</span> sys.argv[<span style="color: #e69055; font-weight: bold;">1</span>] == <span style="color: #7bc275;">"--status"</span>:
        getAccountServiceStates(oldAccounts)
        <span style="color: #a991f1;">exit</span>()
    <span style="color: #51afef;">else</span>:
        <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"\033[0;31mFlag {sys.argv[1]} not recognised\033[0;37m"</span>)
        <span style="color: #a991f1;">exit</span>()


<span style="color: #DFDFDF;">mbsyncData</span> = <span style="color: #C57BDB;">open</span>(mbsyncFile, <span style="color: #7bc275;">"r"</span>).read()

<span style="color: #DFDFDF;">currentAccountNumber</span> = <span style="color: #e69055; font-weight: bold;">0</span>

<span style="color: #DFDFDF;">totalAccounts</span> = <span style="color: #C57BDB;">len</span>(re.findall(r<span style="color: #7bc275;">"^IMAPAccount"</span>, mbsyncData, re.M))


<span style="color: #51afef;">def</span> <span style="color: #5cEfFF;">main</span>():
    <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;34m:: MbSync to Go IMAP notify config file creator ::\033[0;37m"</span>)

    shutil.rmtree(imapnotifyConfigFolder)
    imapnotifyConfigFolder.mkdir(exist_ok=<span style="color: #a991f1;">False</span>)
    <span style="color: #51afef;">print</span>(<span style="color: #7bc275;">"\033[1;30mImap Notify config dir purged\033[0;37m"</span>)

    <span style="color: #51afef;">print</span>(f<span style="color: #7bc275;">"Identified \033[1;32m{totalAccounts}\033[0;32m accounts.\033[0;37m"</span>)

    <span style="color: #51afef;">for</span> line <span style="color: #51afef;">in</span> mbsyncData.split(<span style="color: #7bc275;">"\n"</span>):
        processLine(line)

    finaliseAccount()

    <span style="color: #51afef;">print</span>(
        f<span style="color: #7bc275;">"\nConfig files generated for \033[1;36m{len(successfulAdditions)}\033[0;36m"</span>
        + f<span style="color: #7bc275;">" out of \033[1;36m{totalAccounts}\033[0;37m accounts.\n"</span>
    )

    processSystemdServices()


<span style="color: #51afef;">if</span> <span style="color: #C57BDB;">__name__</span> == <span style="color: #7bc275;">"__main__"</span>:
    main()
</pre>
</div>
</div>
</div>

<div id="outline-container-fetching-systemd" class="outline-5">
<h5 id="fetching-systemd"> <a class="anchor" aria-hidden="true" href="#fetching-systemd">🔗</a> <a class="anchor" aria-hidden="true" href="#fetching-systemd">🔗</a> <a class="anchor" aria-hidden="true" href="#fetching-systemd">🔗</a> <a class="anchor" aria-hidden="true" href="#fetching-systemd">🔗</a><span class="section-number-5">4.14.1.3</span> Systemd</h5>
<div class="outline-text-5" id="text-4-14-1-3">
<p>
We then have a service file to run <code>goimapnotify</code> on all of these generated config files.
We&rsquo;ll use a template service file so we can enable a unit per-account.
</p>
<div class="org-src-container">
<pre class="src src-systemd"><span style="color: #FCCE7B;">[Unit]</span>
<span style="color: #51afef;">Description</span>=IMAP notifier using IDLE, golang version.
<span style="color: #51afef;">ConditionPathExists</span>=<span style="color: #a991f1;">%h</span>/.imapnotify/<span style="color: #a991f1;">%I</span>/notify.conf
<span style="color: #51afef;">After</span>=network.target

<span style="color: #FCCE7B;">[Service]</span>
<span style="color: #51afef;">ExecStart</span>=<span style="color: #a991f1;">%h</span>/go/bin/goimapnotify -conf <span style="color: #a991f1;">%h</span>/.imapnotify/<span style="color: #a991f1;">%I</span>/notify.conf
<span style="color: #51afef;">Restart</span>=<span style="color: #C57BDB;">always</span>
<span style="color: #51afef;">RestartSec</span>=<span style="color: #e69055; font-weight: bold;">30</span>

<span style="color: #FCCE7B;">[Install]</span>
<span style="color: #51afef;">WantedBy</span>=default.target
</pre>
</div>

<p>
Enabling the service is actually taken care of by that python script.
</p>

<p>
From one or two small tests, this can bring the delay down to as low as five
seconds, which I&rsquo;m quite happy with.
</p>

<p>
This works well for fetching new mail, but we also want to propagate other
changes (e.g. marking mail as read), and make sure we&rsquo;re up to date at the
start, so for that I&rsquo;ll do the &rsquo;normal&rsquo; thing and run <code>mbsync -all</code> every so often
&#x2014; let&rsquo;s say five minutes.
</p>

<p>
We can accomplish this via a systemd timer, and service file.
</p>
<div class="org-src-container">
<pre class="src src-systemd"><span style="color: #FCCE7B;">[Unit]</span>
<span style="color: #51afef;">Description</span>=call mbsync on all accounts every <span style="color: #e69055; font-weight: bold;">5</span> minutes
<span style="color: #51afef;">ConditionPathExists</span>=<span style="color: #a991f1;">%h</span>/.mbsyncrc

<span style="color: #FCCE7B;">[Timer]</span>
<span style="color: #51afef;">OnBootSec</span>=5m
<span style="color: #51afef;">OnUnitInactiveSec</span>=5m

<span style="color: #FCCE7B;">[Install]</span>
<span style="color: #51afef;">WantedBy</span>=default.target
</pre>
</div>

<div class="org-src-container">
<pre class="src src-systemd"><span style="color: #FCCE7B;">[Unit]</span>
<span style="color: #51afef;">Description</span>=mbsync service, sync all mail
<span style="color: #51afef;">Documentation</span>=man:mbsync(<span style="color: #e69055; font-weight: bold;">1</span>)
<span style="color: #51afef;">ConditionPathExists</span>=<span style="color: #a991f1;">%h</span>/.mbsyncrc

<span style="color: #FCCE7B;">[Service]</span>
<span style="color: #51afef;">Type</span>=<span style="color: #C57BDB;">oneshot</span>
<span style="color: #51afef;">ExecStart</span>=/usr/bin/mbsync -c <span style="color: #a991f1;">%h</span>/.mbsyncrc --all

<span style="color: #FCCE7B;">[Install]</span>
<span style="color: #51afef;">WantedBy</span>=mail.target
</pre>
</div>

<p>
Enabling (and starting) this is as simple as
</p>
<div class="org-src-container">
<pre class="src src-shell">systemctl --user enable mbsync.timer --now
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-indexing-searching" class="outline-4">
<h4 id="indexing-searching"> <a class="anchor" aria-hidden="true" href="#indexing-searching">🔗</a> <a class="anchor" aria-hidden="true" href="#indexing-searching">🔗</a> <a class="anchor" aria-hidden="true" href="#indexing-searching">🔗</a><span class="section-number-4">4.14.2</span> Indexing/Searching</h4>
<div class="outline-text-4" id="text-4-14-2">
<p>
This is performed by <a href="https://www.djcbsoftware.nl/code/mu/">Mu</a>. This is a tool for finding emails stored in the <a href="http://en.wikipedia.org/wiki/Maildir">Maildir</a> format.
According to the homepage, it&rsquo;s main features are
</p>
<ul class="org-ul">
<li>Fast indexing</li>
<li>Good searching</li>
<li>Support for encrypted and signed messages</li>
<li>Rich CLI tooling</li>
<li>accent/case normalisation</li>
<li>strong integration with email clients</li>
</ul>

<p>
Unfortunately <code>mu</code> is not currently packaged from me. Oh well, I guess I&rsquo;m
building it from source then. I needed to install these packages
</p>
<ul class="org-ul">
<li><kbd>gmime-devel</kbd></li>
<li><kbd>xapian-core-devel</kbd></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell" id="org77985f5"><span style="color: #FCCE7B;">cd</span> ~/.local/lib/
<span style="color: #FCCE7B;">git</span> clone https://github.com/djcb/mu.git
<span style="color: #FCCE7B;">cd</span> ./mu
./autogen.sh
<span style="color: #FCCE7B;">make</span>
<span style="color: #FCCE7B;">sudo</span> <span style="color: #FCCE7B;">make</span> install
</pre>
</div>

<p>
To check how my version compares to the latest published:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #FCCE7B;">curl</span> --silent <span style="color: #7bc275;">"https://api.github.com/repos/djcb/mu/releases/latest"</span> | <span style="color: #FCCE7B;">grep</span> <span style="color: #7bc275;">'"tag_name":'</span> | sed -E <span style="color: #7bc275;">'s/.*"([^"]+)".*/\1/'</span>
mu --version | head -n <span style="color: #e69055; font-weight: bold;">1</span> | sed <span style="color: #7bc275;">'s/.* version //'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sending" class="outline-4">
<h4 id="sending"> <a class="anchor" aria-hidden="true" href="#sending">🔗</a> <a class="anchor" aria-hidden="true" href="#sending">🔗</a> <a class="anchor" aria-hidden="true" href="#sending">🔗</a><span class="section-number-4">4.14.3</span> Sending</h4>
<div class="outline-text-4" id="text-4-14-3">
<p>
<a href="https://www.nongnu.org/smtpmail/">SmtpMail</a> seems to be the &rsquo;default&rsquo; starting point, but that&rsquo;s not packaged for
me. <a href="https://marlam.de/msmtp/">msmtp</a> is however, so I&rsquo;ll give that a shot. Reading around a bit (googling
&ldquo;msmtp vs sendmail&rdquo; for example) almost every comparison mentioned seems to
suggest msmtp to be a better choice. I have seen the following points raised
</p>
<ul class="org-ul">
<li><code>sendmail</code> has several vulnerabilities</li>
<li><code>sendmail</code> is tedious to configure</li>
<li><code>ssmtp</code> is no longer maintained</li>
<li><code>msmtp</code> is a maintained alternative to <code>ssmtp</code></li>
<li><code>msmtp</code> is easier to configure</li>
</ul>

<p>
The config file is <a href="file:///home/tec/.msmtprc">~/.msmtprc</a>
</p>
</div>

<div id="outline-container-system-hackery" class="outline-5">
<h5 id="system-hackery"> <a class="anchor" aria-hidden="true" href="#system-hackery">🔗</a> <a class="anchor" aria-hidden="true" href="#system-hackery">🔗</a> <a class="anchor" aria-hidden="true" href="#system-hackery">🔗</a> <a class="anchor" aria-hidden="true" href="#system-hackery">🔗</a><span class="section-number-5">4.14.3.1</span> System hackery</h5>
<div class="outline-text-5" id="text-4-14-3-1">
<p>
Unfortunately, I seem to have run into a <a href="https://bugs.archlinux.org/task/44994">bug</a> present in my packaged version, so
we&rsquo;ll just install the latest from source.
</p>

<p>
For full use of the <code>auth</code> options, I need <kbd>GNU SASL</kbd>, which isn&rsquo;t packaged for me.
I don&rsquo;t think I want it, but in case I do, I&rsquo;ll need to do this.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #C57BDB;">export</span> <span style="color: #DFDFDF;">GSASL_VERSION</span>=1.8.1
<span style="color: #FCCE7B;">cd</span> ~/.local/lib/
<span style="color: #FCCE7B;">curl</span> <span style="color: #7bc275;">"ftp://ftp.gnu.org/gnu/gsasl/libgsasl-</span><span style="color: #a991f1;">$</span><span style="color: #DFDFDF;">GSASL_VERSION</span><span style="color: #7bc275;">.tar.gz"</span> | tar xz
<span style="color: #FCCE7B;">curl</span> <span style="color: #7bc275;">"ftp://ftp.gnu.org/gnu/gsasl/gsasl-</span><span style="color: #a991f1;">$</span><span style="color: #DFDFDF;">GSASL_VERSION</span><span style="color: #7bc275;">.tar.gz"</span> | tar xz
<span style="color: #FCCE7B;">cd</span> <span style="color: #7bc275;">"./libgsasl-</span><span style="color: #a991f1;">$</span><span style="color: #DFDFDF;">GSASL_VERSION</span><span style="color: #7bc275;">"</span>
./configure
<span style="color: #FCCE7B;">make</span>
<span style="color: #FCCE7B;">sudo</span> <span style="color: #FCCE7B;">make</span> install
<span style="color: #FCCE7B;">cd</span> ..
<span style="color: #FCCE7B;">cd</span> <span style="color: #7bc275;">"./gsasl-</span><span style="color: #a991f1;">$</span><span style="color: #DFDFDF;">VERSION</span><span style="color: #7bc275;">"</span>
./configure
<span style="color: #FCCE7B;">make</span>
<span style="color: #FCCE7B;">sudo</span> <span style="color: #FCCE7B;">make</span> install
<span style="color: #FCCE7B;">cd</span> ..
</pre>
</div>

<p>
Now actually compile <code>msmtp</code>.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #FCCE7B;">cd</span> ~/.local/lib/
<span style="color: #FCCE7B;">git</span> clone https://github.com/marlam/msmtp-mirror.git ./msmtp
<span style="color: #FCCE7B;">cd</span> ./msmtp
libtoolize --force
aclocal
autoheader
automake --force-missing --add-missing
autoconf
<span style="color: #62686E;"># </span><span style="color: #62686E;">if using GSASL</span>
<span style="color: #62686E;"># </span><span style="color: #62686E;">PKG_CONFIG_PATH=/usr/local/lib/pkgconfig ./configure --with-libgsasl</span>
./configure
<span style="color: #FCCE7B;">make</span>
<span style="color: #FCCE7B;">sudo</span> <span style="color: #FCCE7B;">make</span> install
</pre>
</div>

<p>
If using <kbd>GSASL</kbd> (from earlier) we need to make ensure that the dynamic library in
in the library path. We can do by adding an executable with the same name
earlier on in my <code>$PATH</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #DFDFDF;">LD_LIBRARY_PATH</span>=/usr/local/lib exec /usr/local/bin/msmtp <span style="color: #7bc275;">"</span><span style="color: #a991f1;">$</span><span style="color: #DFDFDF;">@</span><span style="color: #7bc275;">"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-mu4e" class="outline-4">
<h4 id="mu4e"> <a class="anchor" aria-hidden="true" href="#mu4e">🔗</a> <a class="anchor" aria-hidden="true" href="#mu4e">🔗</a> <a class="anchor" aria-hidden="true" href="#mu4e">🔗</a><span class="section-number-4">4.14.4</span> Mu4e</h4>
<div class="outline-text-4" id="text-4-14-4">
<p>
Webmail clients are nice and all, but I still don&rsquo;t believe that SPAs in my
browser can replaced desktop apps &#x2026; sorry Gmail. I&rsquo;m also liking google less
and less.
</p>

<p>
Mailspring is a decent desktop client, quite lightweight for electron
(apparently the backend is in <kbd>C</kbd>, which probably helps), however I miss Emacs
stuff.
</p>

<p>
While <kbd>Notmuch</kbd> seems very promising, and I&rsquo;ve heard good things about it, it
doesn&rsquo;t seem to make any changes to the emails themselves. All data is stored in
Notmuch&rsquo;s database. While this is a very interesting model, occasionally I need
to pull up an email on say my phone, and so not I want the tagging/folders etc.
to be applied to the mail itself &#x2014; not stored in a database.
</p>

<p>
On the other hand <kbd>Mu4e</kbd> is also talked about a lot in positive terms, and seems
to possess a similarly strong feature set &#x2014; and modifies the mail itself (I.e.
information is accessible without the database). <kbd>Mu4e</kbd> also seems to have a large
user base, which tends to correlate with better support and attention.
</p>

<p>
As I installed mu4e from source, I need to add the <kbd>/usr/local/</kbd> loadpath so Mu4e has a chance of loading
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">load-path</span> <span style="color: #7bc275;">"/usr/local/share/emacs/site-lisp/mu4e"</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>

<div id="outline-container-viewing-mail" class="outline-5">
<h5 id="viewing-mail"> <a class="anchor" aria-hidden="true" href="#viewing-mail">🔗</a> <a class="anchor" aria-hidden="true" href="#viewing-mail">🔗</a> <a class="anchor" aria-hidden="true" href="#viewing-mail">🔗</a> <a class="anchor" aria-hidden="true" href="#viewing-mail">🔗</a><span class="section-number-5">4.14.4.1</span> Viewing Mail</h5>
<div class="outline-text-5" id="text-4-14-4-1">
<p>
There seem to be some advantages with using Gnus&rsquo; article view (such as inline
images), and judging from <a href="https://github.com/djcb/mu/pull/1442#issuecomment-591695814">djcb/mu!1442 (comment)</a> this seems to be the &rsquo;way of
the future&rsquo; for mu4e.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-view-use-gnus</span> t<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
There are some all-the-icons font related issues, so we need to redefine the
fancy chars, and make sure they get the correct width.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">my-string-width</span> <span style="color: #7bc275;">(</span>str<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Return the width in pixels of a string in the current</span>
<span style="color: #7e7e87;">window's default font. If the font is mono-spaced, this</span>
<span style="color: #7e7e87;">will also be the width of all other printable characters."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>window <span style="color: #7bc275;">(</span><span style="color: #a991f1;">selected-window</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>remapping <span style="color: #DFDFDF;">face-remapping-alist</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">with-temp-buffer</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">make-local-variable</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">face-remapping-alist</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">face-remapping-alist</span> remapping<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">set-window-buffer</span> window <span style="color: #7bc275;">(</span><span style="color: #a991f1;">current-buffer</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> str<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">car</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">window-text-pixel-size</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>


  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">cl-defun</span> <span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">(</span>name <span style="color: #FCCE7B;">&amp;key</span> set colour height v-adjust<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Convert :icon declaration to icon"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>icon-set <span style="color: #7bc275;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"all-the-icons-"</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> set <span style="color: #7bc275;">"faicon"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>v-adjust <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> v-adjust <span style="color: #e69055; font-weight: bold;">0.02</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>height <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> height <span style="color: #e69055; font-weight: bold;">0.8</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>icon <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> colour
                     <span style="color: #51afef;">(</span><span style="color: #a991f1;">apply</span> icon-set <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>,name <span style="color: #C57BDB;">:face</span> ,<span style="color: #7bc275;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"all-the-icons-"</span> colour<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">:height</span> ,height <span style="color: #C57BDB;">:v-adjust</span> ,v-adjust<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">apply</span> icon-set <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>,name  <span style="color: #C57BDB;">:height</span> ,height <span style="color: #C57BDB;">:v-adjust</span> ,v-adjust<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>icon-width <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">my-string-width</span> icon<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>space-width <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">my-string-width</span> <span style="color: #7bc275;">" "</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>space-factor <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">/</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">float</span> icon-width<span style="color: #C57BDB;">)</span> space-width<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">" "</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">display</span> <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>space . <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:width</span> ,space-factor<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> icon<span style="color: #51afef;">)</span>
      <span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-use-fancy-chars</span> t
        <span style="color: #DFDFDF;">mu4e-headers-draft-mark</span>      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"D"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"pencil"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-flagged-mark</span>    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"F"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"flag"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-new-mark</span>        <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"N"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"sync"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"material"</span> <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0.8</span> <span style="color: #C57BDB;">:v-adjust</span> <span style="color: #e69055; font-weight: bold;">-0.10</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-passed-mark</span>     <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"P"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"arrow-right"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-replied-mark</span>    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"R"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"arrow-right"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-seen-mark</span>       <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"S"</span> <span style="color: #7bc275;">""</span><span style="color: #7bc275;">)</span> <span style="color: #62686E;">;</span><span style="color: #62686E;">(mu4e~normalised-icon "eye" :height 0.6 :v-adjust 0.07 :colour "dsilver"))</span>
        <span style="color: #DFDFDF;">mu4e-headers-trashed-mark</span>    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"T"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"trash"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-attach-mark</span>     <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"a"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"file-text-o"</span> <span style="color: #C57BDB;">:colour</span> <span style="color: #7bc275;">"silver"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-encrypted-mark</span>  <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"x"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"lock"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-signed-mark</span>     <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"s"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"certificate"</span> <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0.7</span> <span style="color: #C57BDB;">:colour</span> <span style="color: #7bc275;">"dpurple"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #DFDFDF;">mu4e-headers-unread-mark</span>     <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> <span style="color: #7bc275;">"u"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e~normalised-icon</span> <span style="color: #7bc275;">"eye-slash"</span> <span style="color: #C57BDB;">:v-adjust</span> <span style="color: #e69055; font-weight: bold;">0.05</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
To account for the increase width of each flag charachter, and make perform a
few more visual tweaks, we&rsquo;ll tweak the headers a bit.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-header-colourise</span> <span style="color: #7bc275;">(</span>str<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>str-sum <span style="color: #7bc275;">(</span><span style="color: #a991f1;">apply</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #7bc275;">(</span>c<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">%</span> c <span style="color: #e69055; font-weight: bold;">3</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> str<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>colour <span style="color: #7bc275;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">%</span> str-sum <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">length</span> <span style="color: #DFDFDF;">mu4e-header-colourised-faces</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                        <span style="color: #DFDFDF;">mu4e-header-colourised-faces</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">put-text-property</span> <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">length</span> str<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> colour str<span style="color: #51afef;">)</span>
      str<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-header-colourised-faces</span>
    <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>all-the-icons-lblue
      all-the-icons-purple
      all-the-icons-blue-alt
      all-the-icons-green
      all-the-icons-maroon
      all-the-icons-yellow
      all-the-icons-orange<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-headers-fields</span>
        <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #C57BDB;">:account</span> . <span style="color: #e69055; font-weight: bold;">12</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:human-date</span> . <span style="color: #e69055; font-weight: bold;">8</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:flags</span> . <span style="color: #e69055; font-weight: bold;">6</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:from</span> . <span style="color: #e69055; font-weight: bold;">25</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:folder</span> . <span style="color: #e69055; font-weight: bold;">10</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:recipnum</span> . <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:subject</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-put</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">:flags</span> <span style="color: #DFDFDF;">mu4e-header-info</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">:shortname</span> <span style="color: #7bc275;">" Flags"</span><span style="color: #C57BDB;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">default=Flgs</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-header-info-custom</span>
        <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #C57BDB;">:account</span> .
           <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Account"</span> <span style="color: #C57BDB;">:shortname</span> <span style="color: #7bc275;">"Account"</span> <span style="color: #C57BDB;">:help</span> <span style="color: #7bc275;">"Which account this email belongs to"</span> <span style="color: #C57BDB;">:function</span>
            <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>msg<span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>maildir
                     <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-message-field</span> msg <span style="color: #C57BDB;">:maildir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-header-colourise</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"^gmail"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"g"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bold-italic</span><span style="color: #51afef;">)</span>
                                                                 <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s"</span>
                                                                         <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">substring</span> maildir <span style="color: #e69055; font-weight: bold;">1</span>
                                                                                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-match-p</span> <span style="color: #7bc275;">"/"</span> maildir <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:folder</span> .
           <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Folder"</span> <span style="color: #C57BDB;">:shortname</span> <span style="color: #7bc275;">"Folder"</span> <span style="color: #C57BDB;">:help</span> <span style="color: #7bc275;">"Lowest level folder"</span> <span style="color: #C57BDB;">:function</span>
            <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>msg<span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>maildir
                     <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-message-field</span> msg <span style="color: #C57BDB;">:maildir</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-header-colourise</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"\\`.*/"</span> <span style="color: #7bc275;">""</span> maildir<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:recipnum</span> .
           <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Number of recipients"</span>
            <span style="color: #C57BDB;">:shortname</span> <span style="color: #7bc275;">" &#11127;"</span>
            <span style="color: #C57BDB;">:help</span> <span style="color: #7bc275;">"Number of recipients for this message"</span>
            <span style="color: #C57BDB;">:function</span>
            <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>msg<span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%2d"</span>
                                  <span style="color: #7bc275;">(</span><span style="color: #a991f1;">+</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-message-field</span> msg <span style="color: #C57BDB;">:to</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                     <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-message-field</span> msg <span style="color: #C57BDB;">:cc</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                          <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mu4e-footer-face</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Due to evil, none of the marking commands work when making a visual selection in
the headers view of mu4e. Without overriding any evil commands we may actually
want to use in and evil selection, this can be easily fixed.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">mu4e-headers-mode-map</span>
    <span style="color: #C57BDB;">:after</span> mu4e
    <span style="color: #C57BDB;">:v</span> <span style="color: #7bc275;">"*"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-headers-mark-for-something</span>
    <span style="color: #C57BDB;">:v</span> <span style="color: #7bc275;">"!"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-headers-mark-for-read</span>
    <span style="color: #C57BDB;">:v</span> <span style="color: #7bc275;">"?"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-headers-mark-for-unread</span>
    <span style="color: #C57BDB;">:v</span> <span style="color: #7bc275;">"u"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-headers-mark-for-unmark</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
The main mu4e window is &#x2026; alright. I&rsquo;m not afraid of unicode though, so I&rsquo;ll
define a fancier version. Look, it&rsquo;s the asterisks. We can do better than
asterisks. The keybindings can also be made nicer, why have <code>[x]</code> when we can just
have a bold, coloured <code>x</code>. Does the same job, while looking much less garish.
We don&rsquo;t put this in an <code>(after! ...)</code> block as <kbd>evil-collection-mu4e</kbd> calls
<code>mu4e~main-action-str</code> in Doom&rsquo;s mu4e <code>(usepackage! ...)</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defadvice!</span> mu4e~main-action-prettier-str <span style="color: #C57BDB;">(</span>str <span style="color: #FCCE7B;">&amp;optional</span> func-or-shortcut<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Highlight the first occurrence of [.] in STR.</span>
<span style="color: #7e7e87;">If FUNC-OR-SHORTCUT is non-nil and if it is a function, call it</span>
<span style="color: #7e7e87;">when STR is clicked (using RET or mouse-2); if FUNC-OR-SHORTCUT is</span>
<span style="color: #7e7e87;">a string, execute the corresponding keyboard action when it is</span>
<span style="color: #7e7e87;">clicked."</span>
  <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e~main-action-str</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>newstr
         <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span>
          <span style="color: #7bc275;">"\\[</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">..?</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">\\]"</span>
          <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span><span style="color: #51afef;">(</span>m<span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s"</span>
                    <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> m<span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>mode-line-emphasis bold<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"\t\\*"</span> <span style="color: #7bc275;">"\t&#9899;"</span> str<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">map</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">make-sparse-keymap</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span>func <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">functionp</span> func-or-shortcut<span style="color: #7bc275;">)</span>
                  func-or-shortcut
                <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">stringp</span> func-or-shortcut<span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span><span style="color: #C57BDB;">()(</span><span style="color: #51afef;">interactive</span><span style="color: #C57BDB;">)</span>
                      <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">execute-kbd-macro</span> func-or-shortcut<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">define-key</span> map <span style="color: #51afef;">[</span>mouse-2<span style="color: #51afef;">]</span> func<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">define-key</span> map <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">kbd</span> <span style="color: #7bc275;">"RET"</span><span style="color: #51afef;">)</span> func<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">put-text-property</span> <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> newstr<span style="color: #51afef;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">keymap</span> map newstr<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">put-text-property</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #7bc275;">"[A-Za-z].+$"</span> newstr<span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #a991f1;">-</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">length</span> newstr<span style="color: #C57BDB;">)</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mouse-face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">highlight</span> newstr<span style="color: #7bc275;">)</span>
    newstr<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">evil-collection-mu4e-end-region-misc</span> <span style="color: #7bc275;">"quit"</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I&rsquo;d also quite like an easy way to be able to move away from the created mu4e
workspace without closing the process (which rules &ldquo;quit&rdquo; out). The obvious
analogous idea is &ldquo;hide&rdquo;, and it turns out that the <kbd>h</kbd> key is conveniently
unbound in the main mu4e view.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">mu4e-main-mode-map</span>
      <span style="color: #C57BDB;">:after</span> mu4e
      <span style="color: #C57BDB;">:nive</span> <span style="color: #7bc275;">"h"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+workspace/other</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I often find myself viewing new mails using the Emacs client. When opening a new
window and switching to view the mu4e workspace, and empty workspace is left. We
can try to avoid this workspace polution by deleting the current workspace
before switching if it is empty.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defadvice!</span> delete-current-worspace-if-empty <span style="color: #C57BDB;">()</span>
  <span style="color: #7e7e87;">"Close the current workspace if it is empty."</span>
  <span style="color: #C57BDB;">:before</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">=mu4e</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unless</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+workspace-buffer-list</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+workspace-delete</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+workspace-current-name</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sending-mail" class="outline-5">
<h5 id="sending-mail"> <a class="anchor" aria-hidden="true" href="#sending-mail">🔗</a> <a class="anchor" aria-hidden="true" href="#sending-mail">🔗</a> <a class="anchor" aria-hidden="true" href="#sending-mail">🔗</a> <a class="anchor" aria-hidden="true" href="#sending-mail">🔗</a><span class="section-number-5">4.14.4.2</span> Sending Mail</h5>
<div class="outline-text-5" id="text-4-14-4-2">
<p>
Let&rsquo;s send emails too.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">sendmail-program</span> <span style="color: #7bc275;">"/usr/local/bin/msmtp"</span>
        <span style="color: #DFDFDF;">send-mail-function</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">smtpmail-send-it</span>
        <span style="color: #DFDFDF;">message-sendmail-f-is-evil</span> t
        <span style="color: #DFDFDF;">message-sendmail-extra-arguments</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"--read-envelope-from"</span><span style="color: #7bc275;">)</span><span style="color: #62686E;">; </span><span style="color: #62686E;">, "--read-recipients")</span>
        <span style="color: #DFDFDF;">message-send-mail-function</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">message-send-mail-with-sendmail</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
It&rsquo;s also nice to avoid accidently sending emails with the wrong account.
If we can send from the address in the <code>To</code> field, let&rsquo;s do that. Opening an <code>ivy</code>
prompt otherwise also seems sensible.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">my-mu4e-set-account</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Set the account for composing a message."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #DFDFDF;">mu4e-compose-parent-message</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>to <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-message-field</span> <span style="color: #DFDFDF;">mu4e-compose-parent-message</span> <span style="color: #C57BDB;">:to</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span>from <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-message-field</span> <span style="color: #DFDFDF;">mu4e-compose-parent-message</span> <span style="color: #C57BDB;">:from</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                 <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">member</span> to <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #DFDFDF;">mu4e~server-props</span> <span style="color: #C57BDB;">:personal-addresses</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">user-mail-address</span> to<span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">member</span> from <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #DFDFDF;">mu4e~server-props</span> <span style="color: #C57BDB;">:personal-addresses</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                       <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">user-mail-address</span> from<span style="color: #C57BDB;">)</span>
                       nil<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">ivy-read</span> <span style="color: #7bc275;">"Account: "</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #DFDFDF;">mu4e~server-props</span> <span style="color: #C57BDB;">:personal-addresses</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">:action</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #7bc275;">(</span>candidate<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">user-mail-address</span> candidate<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">mu4e-compose-pre-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">my-mu4e-set-account</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
We can register Emacs as a potential email client with the following desktop
file, thanks to Etienne Deparis&rsquo;s <a href="https://etienne.depar.is/emacs.d/mu4e.html">Mu4e customization</a>.
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #FCCE7B;">Desktop Entry</span>]
<span style="color: #DFDFDF;">Name</span>=Compose message in Emacs
<span style="color: #DFDFDF;">GenericName</span>=Compose a new message with Mu4e in Emacs
<span style="color: #DFDFDF;">Comment</span>=Open mu4e compose window
<span style="color: #DFDFDF;">MimeType</span>=x-scheme-handler/mailto;
<span style="color: #DFDFDF;">Exec</span>=emacsclient -create-frame --alternate-editor=<span style="color: #7bc275;">""</span> --no-wait --eval <span style="color: #7bc275;">'(progn (x-focus-frame nil) (mu4e-compose-from-mailto "%u"))'</span>
<span style="color: #DFDFDF;">Icon</span>=emacs
<span style="color: #DFDFDF;">Type</span>=Application
<span style="color: #DFDFDF;">Terminal</span>=false
<span style="color: #DFDFDF;">Categories</span>=Network;Email;
<span style="color: #DFDFDF;">StartupWMClass</span>=Emacs
</pre>
</div>

<p>
To register this, just call
</p>
<div class="org-src-container">
<pre class="src src-shell">update-desktop-database ~/.local/share/applications
</pre>
</div>

<p>
We also want to define <code>mu4e-compose-from-mailto</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-compose-from-mailto</span> <span style="color: #C57BDB;">(</span>mailto-string<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">mu4e</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unless</span> <span style="color: #DFDFDF;">mu4e~server-props</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">mu4e</span> t<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">sleep-for</span> <span style="color: #e69055; font-weight: bold;">0.1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let*</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>mailto <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">rfc2368-parse-mailto-url</span> mailto-string<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>to <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #7bc275;">"To"</span> mailto<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>subject <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #7bc275;">"Subject"</span> mailto<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">""</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>body <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #7bc275;">"Body"</span> mailto<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">org-msg-greeting-fmt</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #7bc275;">"Body"</span> mailto<span style="color: #7bc275;">)</span>
                                   <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"%"</span> <span style="color: #7bc275;">"%%"</span>
                                                             <span style="color: #51afef;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #7bc275;">"Body"</span> mailto<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                                 <span style="color: #DFDFDF;">org-msg-greeting-fmt</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>headers <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">-filter</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>spec<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">-contains-p</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"To"</span> <span style="color: #7bc275;">"Subject"</span> <span style="color: #7bc275;">"Body"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> spec<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> mailto<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">mu4e~compose-mail</span> to subject headers<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
This may not quite function as intended for now due to <a href="https://github.com/jeremy-compostella/org-msg/issues/52">jeremy-compostella/org-msg#52</a>.
</p>
</div>
</div>
<div id="outline-container-getting-notified" class="outline-5">
<h5 id="getting-notified"> <a class="anchor" aria-hidden="true" href="#getting-notified">🔗</a> <a class="anchor" aria-hidden="true" href="#getting-notified">🔗</a> <a class="anchor" aria-hidden="true" href="#getting-notified">🔗</a> <a class="anchor" aria-hidden="true" href="#getting-notified">🔗</a><span class="section-number-5">4.14.4.3</span> Getting notified</h5>
<div class="outline-text-5" id="text-4-14-4-3">
<p>
For this we can use <kbd>mu4e-alert</kbd>. We can also perform a few tweaks to make it a
bit more visually appealing.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> mu4e-alert
  <span style="color: #C57BDB;">:after</span> mu4e
  <span style="color: #C57BDB;">:config</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-alert-enable-mode-line-display</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-alert-enable-notifications</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-alert-set-default-style</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">libnotify</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-alert-icon</span> <span style="color: #7bc275;">"/usr/share/icons/Papirus/64x64/apps/evolution.svg"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-alert-iconised-modeline-formatter</span> <span style="color: #7bc275;">(</span>mail-count<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Formatter used to get the string to be displayed in the mode-line, using all-the-icons.</span>
<span style="color: #7e7e87;">MAIL-COUNT is the count of mails for which the string is to displayed"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">zerop</span> mail-count<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">" "</span>
              <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span>
               <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span>
                <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">all-the-icons-material</span> <span style="color: #7bc275;">"mail_outline"</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">zerop</span> mail-count<span style="color: #C57BDB;">)</span>
                    <span style="color: #7bc275;">""</span>
                  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">" %d"</span> mail-count<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">help-echo</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">=</span> mail-count <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span>
                                      <span style="color: #7bc275;">"You have an unread email"</span>
                                    <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"You have %s unread emails"</span> mail-count<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                  <span style="color: #7bc275;">"\nClick here to view "</span>
                                  <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">=</span> mail-count <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span> <span style="color: #7bc275;">"it"</span> <span style="color: #7bc275;">"them"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mouse-face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mode-line-highlight</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">keymap</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>mode-line keymap
                                   <span style="color: #51afef;">(</span>mouse-1 . mu4e-alert-view-unread-mails<span style="color: #51afef;">)</span>
                                   <span style="color: #51afef;">(</span>mouse-2 . mu4e-alert-view-unread-mails<span style="color: #51afef;">)</span>
                                   <span style="color: #51afef;">(</span>mouse-3 . mu4e-alert-view-unread-mails<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-alert-modeline-formatter</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-alert-iconised-modeline-formatter</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-alert-email-notification-types</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>subjects<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-alert-grouped-mail-notification-formatter-with-bell</span> <span style="color: #7bc275;">(</span>mail-group all-mails<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Default function to format MAIL-GROUP for notification.</span>
<span style="color: #7e7e87;">ALL-MAILS are the all the unread emails"</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">shell-command</span> <span style="color: #7bc275;">"paplay /usr/share/sounds/freedesktop/stereo/message.oga"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">&gt;</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">length</span> mail-group<span style="color: #C57BDB;">)</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>mail-count <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> mail-group<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>total-mails <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> all-mails<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>first-mail <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> mail-group<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>title-prefix <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"You have %d unread emails"</span>
                                      mail-count<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>field-value <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-alert--get-group</span> first-mail<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>title-suffix <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">pcase</span> <span style="color: #DFDFDF;">mu4e-alert-group-by</span>
                                        <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">:from</span> <span style="color: #7bc275;">"from %s:"</span><span style="color: #7bc275;">)</span>
                                        <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">:to</span> <span style="color: #7bc275;">"to %s:"</span><span style="color: #7bc275;">)</span>
                                        <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">:maildir</span> <span style="color: #7bc275;">"in %s:"</span><span style="color: #7bc275;">)</span>
                                        <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">:priority</span> <span style="color: #7bc275;">"with %s priority:"</span><span style="color: #7bc275;">)</span>
                                        <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">:flags</span> <span style="color: #7bc275;">"with %s flags:"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                      field-value<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>title <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s %s"</span> title-prefix title-suffix<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">list</span> <span style="color: #C57BDB;">:title</span> title
                 <span style="color: #C57BDB;">:body</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">s-join</span> <span style="color: #7bc275;">"\n"</span>
                               <span style="color: #51afef;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">mail</span><span style="color: #7bc275;">)</span>
                                         <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s&lt;b&gt;%s&lt;/b&gt; &#8226; %s"</span>
                                                 <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
                                                  <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> mail <span style="color: #C57BDB;">:in-reply-to</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"&#11177; "</span><span style="color: #C57BDB;">)</span>
                                                  <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-match-p</span> <span style="color: #7bc275;">"\\`Fwd:"</span>
                                                                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> mail <span style="color: #C57BDB;">:subject</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">" &#11183; "</span><span style="color: #C57BDB;">)</span>
                                                  <span style="color: #C57BDB;">(</span>t <span style="color: #7bc275;">"&#8192;&#8192;"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                                 <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">truncate-string-to-width</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">caar</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> mail <span style="color: #C57BDB;">:from</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                                                           <span style="color: #e69055; font-weight: bold;">20</span> nil nil t<span style="color: #51afef;">)</span>
                                                 <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">truncate-string-to-width</span>
                                                  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"\\`Re: </span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">|</span><span style="color: #7bc275;">\\`Fwd: "</span> <span style="color: #7bc275;">""</span>
                                                                            <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> mail <span style="color: #C57BDB;">:subject</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                                  <span style="color: #e69055; font-weight: bold;">40</span> nil nil t<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                       mail-group<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>new-mail <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> mail-group<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>subject <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> new-mail <span style="color: #C57BDB;">:subject</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>sender <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">caar</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> new-mail <span style="color: #C57BDB;">:from</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">list</span> <span style="color: #C57BDB;">:title</span> sender <span style="color: #C57BDB;">:body</span> subject<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-alert-grouped-mail-notification-formatter</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-alert-grouped-mail-notification-formatter-with-bell</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-process-control" class="outline-5">
<h5 id="process-control"> <a class="anchor" aria-hidden="true" href="#process-control">🔗</a> <a class="anchor" aria-hidden="true" href="#process-control">🔗</a> <a class="anchor" aria-hidden="true" href="#process-control">🔗</a> <a class="anchor" aria-hidden="true" href="#process-control">🔗</a><span class="section-number-5">4.14.4.4</span> Process control</h5>
<div class="outline-text-5" id="text-4-14-4-4">
<p>
Here&rsquo;s what I want
</p>
<ul class="org-ul">
<li>An instance of Mu4e to be active all the time, for notifications</li>
<li>No crufty timers on loops et. al</li>
</ul>
<p>
I think a file watch etc. setup similar to that in <a href="#rebuild-mail-index">Rebuild mail index while
using mu4e</a> is probably the cleanest way to operate. We can put the current PID
in the file and check for existance too.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> mu4e
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock-file</span> <span style="color: #7bc275;">"/tmp/mu4e_lock"</span>
    <span style="color: #7e7e87;">"Location of the lock file which stores the PID of the process currenty running mu4e"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock-request-file</span> <span style="color: #7bc275;">"/tmp/mu4e_lock_request"</span>
    <span style="color: #7e7e87;">"Location of the lock file for which creating indicated that another process wants the lock to be released"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock-greedy</span> nil
    <span style="color: #7e7e87;">"Whether to 'grab' the `</span><span style="color: #a991f1;">mu4e-lock-file</span><span style="color: #7e7e87;">' if nobody else has it, i.e. start Mu4e"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock-relaxed</span> nil
    <span style="color: #7e7e87;">"Whether if someone else wants the lock (signaled via `</span><span style="color: #a991f1;">mu4e-lock-request-file</span><span style="color: #7e7e87;">'), we should stop Mu4e and let go of it"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-lock-pid-info</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Get info on the PID refered to in `</span><span style="color: #a991f1;">mu4e-lock-file</span><span style="color: #7e7e87;">' in the form (pid . process-attributes)</span>
<span style="color: #7e7e87;"> If the file or process do not exist, the lock file is deleted an nil returned."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">file-exists-p</span> <span style="color: #DFDFDF;">mu4e-lock-file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>pid <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-to-number</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">f-read-text</span> <span style="color: #DFDFDF;">mu4e-lock-file</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">utf-8</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>process <span style="color: #51afef;">(</span><span style="color: #a991f1;">process-attributes</span> pid<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> process <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> pid process<span style="color: #7bc275;">)</span>
            <span style="color: #7bc275;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-lock-file</span><span style="color: #7bc275;">)</span> nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-lock-avalible</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> strict<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"If the `</span><span style="color: #a991f1;">mu4e-lock-file</span><span style="color: #7e7e87;">' is avalible (unset or owned by this emacs) return t.</span>
<span style="color: #7e7e87;">If STRICT only accept an unset lock file."</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">not</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">when-let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>lock-info <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-lock-pid-info</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span>pid <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> lock-info<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> strict <span style="color: #51afef;">(</span><span style="color: #a991f1;">/=</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">emacs-pid</span><span style="color: #C57BDB;">)</span> pid<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> mu4e-lock-file-delete-maybe <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Check `</span><span style="color: #a991f1;">mu4e-lock-file</span><span style="color: #7e7e87;">', and delete it if this process is responsible for it."</span>
    <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-quit</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-lock-avalible</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-lock-file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">file-notify-rm-watch</span> <span style="color: #DFDFDF;">mu4e-lock--request-watcher</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">kill-emacs-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-lock-file-delete-maybe</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> mu4e-lock-start <span style="color: #7bc275;">(</span>orig-fun <span style="color: #FCCE7B;">&amp;optional</span> callback<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Check `</span><span style="color: #a991f1;">mu4e-lock-file</span><span style="color: #7e7e87;">', and if another process is responsible for it, abort starting.</span>
<span style="color: #7e7e87;">Else, write to this process' PID to the lock file"</span>
    <span style="color: #C57BDB;">:around</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e~start</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-lock-avalible</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">shell-command</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"touch %s"</span> <span style="color: #DFDFDF;">mu4e-lock-request-file</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Lock file exists, requesting that it be given up"</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">sleep-for</span> <span style="color: #e69055; font-weight: bold;">0.1</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-lock-request-file</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e-lock-avalible</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">user-error</span> <span style="color: #7bc275;">"Unfortunately another Emacs is already doing stuff with Mu4e, and you can only have one at a time"</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">f-write-text</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">number-to-string</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">emacs-pid</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">utf-8</span> <span style="color: #DFDFDF;">mu4e-lock-file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-lock-request-file</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">funcall</span> orig-fun callback<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-lock--request-watcher</span>
            <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">file-notify-add-watch</span> <span style="color: #DFDFDF;">mu4e-lock-request-file</span>
                                   <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>change<span style="color: #7bc275;">)</span>
                                   <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-lock-request</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock--file-watcher</span> nil<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock--file-just-deleted</span> nil<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">mu4e-lock--request-watcher</span> nil<span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-lock-add-watcher</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-lock--file-just-deleted</span> nil<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">file-notify-rm-watch</span> <span style="color: #DFDFDF;">mu4e-lock--file-watcher</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-lock--file-watcher</span>
          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">file-notify-add-watch</span> <span style="color: #DFDFDF;">mu4e-lock-file</span>
                                 <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>change<span style="color: #C57BDB;">)</span>
                                 <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-lock-file-updated</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-lock-request</span> <span style="color: #7bc275;">(</span>event<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Handle another process requesting the Mu4e lock."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> event<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">created</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #DFDFDF;">mu4e-lock-relaxed</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">mu4e~stop</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">file-notify-rm-watch</span> <span style="color: #DFDFDF;">mu4e-lock--file-watcher</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Someone else wants to use Mu4e, releasing lock"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-lock-file</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">run-at-time</span> <span style="color: #e69055; font-weight: bold;">0.2</span> nil <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e-lock-add-watcher</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">delete-file</span> <span style="color: #DFDFDF;">mu4e-lock-request-file</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">mu4e-lock-file-updated</span> <span style="color: #7bc275;">(</span>event<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">mu4e-lock--file-just-deleted</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-lock-add-watcher</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> event<span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">deleted</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">mu4e-lock--file-just-deleted</span> t<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #DFDFDF;">mu4e-lock-greedy</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">mu4e-lock-avalible</span> t<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Noticed Mu4e lock was avalible, grabbed it"</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">run-at-time</span> <span style="color: #e69055; font-weight: bold;">0.2</span> nil <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">mu4e~start</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org-msg" class="outline-4">
<h4 id="org-msg"> <a class="anchor" aria-hidden="true" href="#org-msg">🔗</a> <a class="anchor" aria-hidden="true" href="#org-msg">🔗</a> <a class="anchor" aria-hidden="true" href="#org-msg">🔗</a><span class="section-number-4">4.14.5</span> Org Msg</h4>
<div class="outline-text-4" id="text-4-14-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">org-msg-currently-exporting</span> nil
  <span style="color: #7e7e87;">"Helper variable to indicate whether org-msg is currently exporting the org buffer to HTML.</span>
<span style="color: #7e7e87;">Usefull for affecting some of my HTML export config."</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> org-msg
  <span style="color: #C57BDB;">:after</span> mu4e
  <span style="color: #C57BDB;">:config</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-msg-options</span> <span style="color: #7bc275;">"html-postamble:nil H:5 num:nil ^:{} toc:nil author:nil email:nil \\n:t tex:dvipng"</span>
        <span style="color: #DFDFDF;">org-msg-startup</span> <span style="color: #7bc275;">"hidestars indent inlineimages"</span>
        <span style="color: #DFDFDF;">org-msg-greeting-fmt</span> <span style="color: #7bc275;">"\nHi %s,\n\n"</span>
        <span style="color: #DFDFDF;">org-msg-greeting-name-limit</span> <span style="color: #e69055; font-weight: bold;">3</span>
        <span style="color: #DFDFDF;">org-msg-text-plain-alternative</span> t<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">org-msg-edit-mode-map</span>
        <span style="color: #C57BDB;">:n</span> <span style="color: #7bc275;">"G"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-msg-goto-body</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> org-msg--now-exporting <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;rest</span> _<span style="color: #7bc275;">)</span>
    <span style="color: #C57BDB;">:before</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-msg-org-to-xml</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-msg-currently-exporting</span> t<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> org-msg--not-exporting <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;rest</span> _<span style="color: #7bc275;">)</span>
    <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-msg-org-to-xml</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-msg-currently-exporting</span> nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-msg-enforce-css</span>
        <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>font-family <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>font-family . <span style="color: #7bc275;">"-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen, Ubuntu, Cantarell,\</span>
<span style="color: #7bc275;">          \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>monospace-font <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>font-family . <span style="color: #7bc275;">"SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>font-size <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>font-size . <span style="color: #7bc275;">"11pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>font <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>,font-family ,font-size<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>line-height <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>line-height . <span style="color: #7bc275;">"1.2"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>theme-color <span style="color: #7bc275;">"#2654BF"</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">bold</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>font-weight . <span style="color: #7bc275;">"bold"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>color <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>color . ,theme-color<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>table <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"6px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"6px"</span><span style="color: #51afef;">)</span>
                        <span style="color: #51afef;">(</span>border-left . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>border-right . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span>
                        <span style="color: #51afef;">(</span>border-top . <span style="color: #7bc275;">"2px solid #222222"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>border-bottom . <span style="color: #7bc275;">"2px solid #222222"</span><span style="color: #51afef;">)</span>
                        <span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>ftl-number <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>,color ,bold <span style="color: #51afef;">(</span>text-align . <span style="color: #7bc275;">"left"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>inline-modes <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>asl c c++ conf cpp csv diff ditaa emacs-lisp
                                   fundamental ini json makefile man org plantuml
                                   python sh xml<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>inline-src <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>background-color . <span style="color: #7bc275;">"rgba(27,31,35,.05)"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>border-radius . <span style="color: #7bc275;">"3px"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">".2em .4em"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>font-size . <span style="color: #7bc275;">"90%"</span><span style="color: #51afef;">)</span> ,monospace-font
                             <span style="color: #51afef;">(</span>margin . <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span>code-src
                <span style="color: #7bc275;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>mode<span style="color: #C57BDB;">)</span>
                          <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>code ,<span style="color: #7bc275;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"src src-"</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">symbol-name</span> mode<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                                 ,inline-src<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                        inline-modes<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #C57BDB;">`</span><span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>del nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>color . <span style="color: #7bc275;">"grey"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>border-left . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>text-decoration . <span style="color: #7bc275;">"line-through"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"10px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>line-height . <span style="color: #7bc275;">"11pt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>a nil <span style="color: #7bc275;">(</span>,color<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>a reply-header <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>color . <span style="color: #7bc275;">"black"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>text-decoration . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>div reply-header <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">"3.0pt 0in 0in 0in"</span><span style="color: #51afef;">)</span>
                               <span style="color: #51afef;">(</span>border-top . <span style="color: #7bc275;">"solid #e1e1e1 1.0pt"</span><span style="color: #51afef;">)</span>
                               <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"20px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>span underline <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>text-decoration . <span style="color: #7bc275;">"underline"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>li nil <span style="color: #7bc275;">(</span>,line-height <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span>
                                  <span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"2px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil org-ul <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>list-style-type . <span style="color: #7bc275;">"square"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil org-ol <span style="color: #7bc275;">(</span>,@font ,line-height <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span>
                                <span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-left . <span style="color: #7bc275;">"30px"</span><span style="color: #51afef;">)</span>
                                <span style="color: #51afef;">(</span>padding-top . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>padding-left . <span style="color: #7bc275;">"5px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil signature <span style="color: #7bc275;">(</span>,@font <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"20px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>blockquote nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">"0px 10px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-left . <span style="color: #7bc275;">"10px"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"20px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>border-left . <span style="color: #7bc275;">"3px solid #ccc"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>font-style . <span style="color: #7bc275;">"italic"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>background . <span style="color: #7bc275;">"#f9f9f9"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>code nil <span style="color: #7bc275;">(</span>,font-size ,monospace-font <span style="color: #51afef;">(</span>background . <span style="color: #7bc275;">"#f9f9f9"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            ,@code-src
            <span style="color: #C57BDB;">(</span>nil linenr <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>padding-right . <span style="color: #7bc275;">"1em"</span><span style="color: #51afef;">)</span>
                         <span style="color: #51afef;">(</span>color . <span style="color: #7bc275;">"black"</span><span style="color: #51afef;">)</span>
                         <span style="color: #51afef;">(</span>background-color . <span style="color: #7bc275;">"#aaaaaa"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>pre nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>line-height . <span style="color: #7bc275;">"1.2"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>color . ,<span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">fg</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>background-color . ,<span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bg</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>margin . <span style="color: #7bc275;">"4px 0px 8px 0px"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">"8px 12px"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>width . <span style="color: #7bc275;">"95%"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>border-radius . <span style="color: #7bc275;">"5px"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>font-weight . <span style="color: #7bc275;">"500"</span><span style="color: #51afef;">)</span>
                      ,monospace-font<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>div org-src-container <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"10px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil figure-number ,ftl-number<span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil table-number<span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>caption nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>text-align . <span style="color: #7bc275;">"left"</span><span style="color: #51afef;">)</span>
                          <span style="color: #51afef;">(</span>background . ,theme-color<span style="color: #51afef;">)</span>
                          <span style="color: #51afef;">(</span>color . <span style="color: #7bc275;">"white"</span><span style="color: #51afef;">)</span>
                          ,bold<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil t-above <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>caption-side . <span style="color: #7bc275;">"top"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil t-bottom <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>caption-side . <span style="color: #7bc275;">"bottom"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil listing-number ,ftl-number<span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil figure ,ftl-number<span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>nil org-src-name ,ftl-number<span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>img nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>vertical-align . <span style="color: #7bc275;">"middle"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>max-width . <span style="color: #7bc275;">"100%"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>img latex-fragment <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>transform . ,<span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"translateY(-1px) scale(%.3f)"</span>
                                                       <span style="color: #7bc275;">(</span><span style="color: #a991f1;">/</span> <span style="color: #e69055; font-weight: bold;">1.0</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">boundp</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">preview-scale</span><span style="color: #C57BDB;">)</span>
                                                                  <span style="color: #DFDFDF;">preview-scale</span> <span style="color: #e69055; font-weight: bold;">1.4</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">(</span>margin . <span style="color: #7bc275;">"0 -0.35em"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>table nil <span style="color: #7bc275;">(</span>,@table ,line-height <span style="color: #51afef;">(</span>border-collapse . <span style="color: #7bc275;">"collapse"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>th nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>border . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>border-bottom . <span style="color: #7bc275;">"1px solid #222222"</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span>background-color . <span style="color: #7bc275;">"#EDEDED"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>font-weight . <span style="color: #7bc275;">"500"</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">"3px 10px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>td nil <span style="color: #7bc275;">(</span>,@table <span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">"1px 10px"</span><span style="color: #51afef;">)</span>
                             <span style="color: #51afef;">(</span>background-color . <span style="color: #7bc275;">"#f9f9f9"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>border . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>td org-left <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>text-align . <span style="color: #7bc275;">"left"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>td org-right <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>text-align . <span style="color: #7bc275;">"right"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>td org-center <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>text-align . <span style="color: #7bc275;">"center"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">kbd</span> nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>border . <span style="color: #7bc275;">"1px solid #d1d5da"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>border-radius . <span style="color: #7bc275;">"3px"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>box-shadow . <span style="color: #7bc275;">"inset 0 -1px 0 #d1d5da"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>background-color . <span style="color: #7bc275;">"#fafbfc"</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span>color . <span style="color: #7bc275;">"#444d56"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>padding . <span style="color: #7bc275;">"3px 5px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>display . <span style="color: #7bc275;">"inline-block"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>div outline-text-4 <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-left . <span style="color: #7bc275;">"15px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>div outline-4 <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-left . <span style="color: #7bc275;">"10px"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>h4 nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>font-size . <span style="color: #7bc275;">"11pt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>h3 nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span>
                     ,color <span style="color: #51afef;">(</span>font-size . <span style="color: #7bc275;">"14pt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>h2 nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"20px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"20px"</span><span style="color: #51afef;">)</span>
                     ,color <span style="color: #51afef;">(</span>font-size . <span style="color: #7bc275;">"18pt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>h1 nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"20px"</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span> ,color <span style="color: #51afef;">(</span>font-size . <span style="color: #7bc275;">"24pt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>p nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>text-decoration . <span style="color: #7bc275;">"none"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span>margin-top . <span style="color: #7bc275;">"10px"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>line-height . <span style="color: #7bc275;">"11pt"</span><span style="color: #51afef;">)</span> ,font-size
                    <span style="color: #51afef;">(</span>max-width . <span style="color: #7bc275;">"100ch"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>b nil <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>font-weight . <span style="color: #7bc275;">"500"</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>color . ,theme-color<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>div nil <span style="color: #7bc275;">(</span>,@font <span style="color: #51afef;">(</span>line-height . <span style="color: #7bc275;">"12pt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  
  <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">org-msg-mode</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
To make this look a little nicer, we will overwrite the default style.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2670fab"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-msg-enforce-css</span>
      <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let*</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>font-family <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>font-family . <span style="color: #7bc275;">"-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen, Ubuntu, Cantarell,\</span>
<span style="color: #7bc275;">        \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>monospace-font <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>font-family . <span style="color: #7bc275;">"SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>font-size <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>font-size . <span style="color: #7bc275;">"11pt"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>font <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>,font-family ,font-size<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>line-height <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>line-height . <span style="color: #7bc275;">"1.2"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>theme-color <span style="color: #7bc275;">"#2654BF"</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">bold</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>font-weight . <span style="color: #7bc275;">"bold"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>color <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>color . ,theme-color<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>table <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"6px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"6px"</span><span style="color: #7bc275;">)</span>
                      <span style="color: #7bc275;">(</span>border-left . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>border-right . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span>
                      <span style="color: #7bc275;">(</span>border-top . <span style="color: #7bc275;">"2px solid #222222"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>border-bottom . <span style="color: #7bc275;">"2px solid #222222"</span><span style="color: #7bc275;">)</span>
                      <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>ftl-number <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>,color ,bold <span style="color: #7bc275;">(</span>text-align . <span style="color: #7bc275;">"left"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>inline-modes <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>asl c c++ conf cpp csv diff ditaa emacs-lisp
                                 fundamental ini json makefile man org plantuml
                                 python sh xml<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>inline-src <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>background-color . <span style="color: #7bc275;">"rgba(27,31,35,.05)"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>border-radius . <span style="color: #7bc275;">"3px"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">".2em .4em"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>font-size . <span style="color: #7bc275;">"90%"</span><span style="color: #7bc275;">)</span> ,monospace-font
                           <span style="color: #7bc275;">(</span>margin . <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>code-src
              <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>mode<span style="color: #51afef;">)</span>
                        <span style="color: #C57BDB;">`</span><span style="color: #51afef;">(</span>code ,<span style="color: #C57BDB;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"src src-"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">symbol-name</span> mode<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                               ,inline-src<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                      inline-modes<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>del nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>color . <span style="color: #7bc275;">"grey"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>border-left . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>text-decoration . <span style="color: #7bc275;">"line-through"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"10px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>line-height . <span style="color: #7bc275;">"11pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>a nil <span style="color: #C57BDB;">(</span>,color<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>a reply-header <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>color . <span style="color: #7bc275;">"black"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>text-decoration . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>div reply-header <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">"3.0pt 0in 0in 0in"</span><span style="color: #7bc275;">)</span>
                             <span style="color: #7bc275;">(</span>border-top . <span style="color: #7bc275;">"solid #e1e1e1 1.0pt"</span><span style="color: #7bc275;">)</span>
                             <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"20px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>span underline <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>text-decoration . <span style="color: #7bc275;">"underline"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>li nil <span style="color: #C57BDB;">(</span>,line-height <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span>
                                <span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"2px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil org-ul <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>list-style-type . <span style="color: #7bc275;">"square"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil org-ol <span style="color: #C57BDB;">(</span>,@font ,line-height <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span>
                              <span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-left . <span style="color: #7bc275;">"30px"</span><span style="color: #7bc275;">)</span>
                              <span style="color: #7bc275;">(</span>padding-top . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>padding-left . <span style="color: #7bc275;">"5px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil signature <span style="color: #C57BDB;">(</span>,@font <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"20px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>blockquote nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">"0px 10px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-left . <span style="color: #7bc275;">"10px"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"20px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>border-left . <span style="color: #7bc275;">"3px solid #ccc"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>font-style . <span style="color: #7bc275;">"italic"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>background . <span style="color: #7bc275;">"#f9f9f9"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>code nil <span style="color: #C57BDB;">(</span>,font-size ,monospace-font <span style="color: #7bc275;">(</span>background . <span style="color: #7bc275;">"#f9f9f9"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          ,@code-src
          <span style="color: #51afef;">(</span>nil linenr <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>padding-right . <span style="color: #7bc275;">"1em"</span><span style="color: #7bc275;">)</span>
                       <span style="color: #7bc275;">(</span>color . <span style="color: #7bc275;">"black"</span><span style="color: #7bc275;">)</span>
                       <span style="color: #7bc275;">(</span>background-color . <span style="color: #7bc275;">"#aaaaaa"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>pre nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>line-height . <span style="color: #7bc275;">"1.2"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>color . ,<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">fg</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>background-color . ,<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bg</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>margin . <span style="color: #7bc275;">"4px 0px 8px 0px"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">"8px 12px"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>width . <span style="color: #7bc275;">"95%"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>border-radius . <span style="color: #7bc275;">"5px"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>font-weight . <span style="color: #7bc275;">"500"</span><span style="color: #7bc275;">)</span>
                    ,monospace-font<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>div org-src-container <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"10px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil figure-number ,ftl-number<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil table-number<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>caption nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>text-align . <span style="color: #7bc275;">"left"</span><span style="color: #7bc275;">)</span>
                        <span style="color: #7bc275;">(</span>background . ,theme-color<span style="color: #7bc275;">)</span>
                        <span style="color: #7bc275;">(</span>color . <span style="color: #7bc275;">"white"</span><span style="color: #7bc275;">)</span>
                        ,bold<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil t-above <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>caption-side . <span style="color: #7bc275;">"top"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil t-bottom <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>caption-side . <span style="color: #7bc275;">"bottom"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil listing-number ,ftl-number<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil figure ,ftl-number<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>nil org-src-name ,ftl-number<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>img nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>vertical-align . <span style="color: #7bc275;">"middle"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>max-width . <span style="color: #7bc275;">"100%"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>img latex-fragment <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>transform . ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"translateY(-1px) scale(%.3f)"</span>
                                                     <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">/</span> <span style="color: #e69055; font-weight: bold;">1.0</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">boundp</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">preview-scale</span><span style="color: #51afef;">)</span>
                                                                <span style="color: #DFDFDF;">preview-scale</span> <span style="color: #e69055; font-weight: bold;">1.4</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                               <span style="color: #7bc275;">(</span>margin . <span style="color: #7bc275;">"0 -0.35em"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>table nil <span style="color: #C57BDB;">(</span>,@table ,line-height <span style="color: #7bc275;">(</span>border-collapse . <span style="color: #7bc275;">"collapse"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>th nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>border . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>border-bottom . <span style="color: #7bc275;">"1px solid #222222"</span><span style="color: #7bc275;">)</span>
                   <span style="color: #7bc275;">(</span>background-color . <span style="color: #7bc275;">"#EDEDED"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>font-weight . <span style="color: #7bc275;">"500"</span><span style="color: #7bc275;">)</span>
                   <span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">"3px 10px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>td nil <span style="color: #C57BDB;">(</span>,@table <span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">"1px 10px"</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span>background-color . <span style="color: #7bc275;">"#f9f9f9"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>border . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>td org-left <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>text-align . <span style="color: #7bc275;">"left"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>td org-right <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>text-align . <span style="color: #7bc275;">"right"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>td org-center <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>text-align . <span style="color: #7bc275;">"center"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">kbd</span> nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>border . <span style="color: #7bc275;">"1px solid #d1d5da"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>border-radius . <span style="color: #7bc275;">"3px"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>box-shadow . <span style="color: #7bc275;">"inset 0 -1px 0 #d1d5da"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>background-color . <span style="color: #7bc275;">"#fafbfc"</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span>color . <span style="color: #7bc275;">"#444d56"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>padding . <span style="color: #7bc275;">"3px 5px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>display . <span style="color: #7bc275;">"inline-block"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>div outline-text-4 <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-left . <span style="color: #7bc275;">"15px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>div outline-4 <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-left . <span style="color: #7bc275;">"10px"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>h4 nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>font-size . <span style="color: #7bc275;">"11pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>h3 nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span>
                   ,color <span style="color: #7bc275;">(</span>font-size . <span style="color: #7bc275;">"14pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>h2 nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"20px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"20px"</span><span style="color: #7bc275;">)</span>
                   ,color <span style="color: #7bc275;">(</span>font-size . <span style="color: #7bc275;">"18pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>h1 nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"20px"</span><span style="color: #7bc275;">)</span>
                   <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span> ,color <span style="color: #7bc275;">(</span>font-size . <span style="color: #7bc275;">"24pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>p nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>text-decoration . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>margin-bottom . <span style="color: #7bc275;">"0px"</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span>margin-top . <span style="color: #7bc275;">"10px"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>line-height . <span style="color: #7bc275;">"11pt"</span><span style="color: #7bc275;">)</span> ,font-size
                  <span style="color: #7bc275;">(</span>max-width . <span style="color: #7bc275;">"100ch"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>b nil <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>font-weight . <span style="color: #7bc275;">"500"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span>color . ,theme-color<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>div nil <span style="color: #C57BDB;">(</span>,@font <span style="color: #7bc275;">(</span>line-height . <span style="color: #7bc275;">"12pt"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org-chef" class="outline-3">
<h3 id="org-chef"> <a class="anchor" aria-hidden="true" href="#org-chef">🔗</a> <a class="anchor" aria-hidden="true" href="#org-chef">🔗</a><span class="section-number-3">4.15</span> Org Chef</h3>
<div class="outline-text-3" id="text-4-15">
<p>
Loading after org seems a bit premature. Let&rsquo;s just load it when we try to use
it, either by command or in a capture template.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> org-chef
  <span style="color: #C57BDB;">:commands</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-chef-insert-recipe</span> org-chef-get-recipe-from-url<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-projectile" class="outline-3">
<h3 id="projectile"> <a class="anchor" aria-hidden="true" href="#projectile">🔗</a> <a class="anchor" aria-hidden="true" href="#projectile">🔗</a><span class="section-number-3">4.16</span> Projectile</h3>
<div class="outline-text-3" id="text-4-16">
<p>
Looking at documentation via <kbd>SPC h f</kbd> and <kbd>SPC h v</kbd> and looking at the source can
add package src directories to projectile. This isn&rsquo;t desirable in my opinion.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">projectile-ignored-projects</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"~/"</span> <span style="color: #7bc275;">"/tmp"</span> <span style="color: #7bc275;">"~/.emacs.d/.local/straight/repos/"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #DFDFDF;">projectile-ignored-project-function</span> <span style="color: #C57BDB;">(</span>filepath<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Return t if FILEPATH is within any of `</span><span style="color: #a991f1;">projectile-ignored-projects</span><span style="color: #7e7e87;">'"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>p<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">s-starts-with-p</span> p filepath<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #DFDFDF;">projectile-ignored-projects</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-smart-parentheses" class="outline-3">
<h3 id="smart-parentheses"> <a class="anchor" aria-hidden="true" href="#smart-parentheses">🔗</a> <a class="anchor" aria-hidden="true" href="#smart-parentheses">🔗</a><span class="section-number-3">4.17</span> Smart Parentheses</h3>
<div class="outline-text-3" id="text-4-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">sp-local-pair</span>
     <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>org-mode<span style="color: #C57BDB;">)</span>
     <span style="color: #7bc275;">"&lt;&lt;"</span> <span style="color: #7bc275;">"&gt;&gt;"</span>
     <span style="color: #C57BDB;">:actions</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>insert<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-spray" class="outline-3">
<h3 id="spray"> <a class="anchor" aria-hidden="true" href="#spray">🔗</a> <a class="anchor" aria-hidden="true" href="#spray">🔗</a><span class="section-number-3">4.18</span> Spray</h3>
<div class="outline-text-3" id="text-4-18">
<p>
Let&rsquo;s make this suit me slightly better.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> spray-wpm <span style="color: #e69055; font-weight: bold;">500</span>
      spray-height <span style="color: #e69055; font-weight: bold;">700</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-theme-magic" class="outline-3">
<h3 id="theme-magic"> <a class="anchor" aria-hidden="true" href="#theme-magic">🔗</a> <a class="anchor" aria-hidden="true" href="#theme-magic">🔗</a><span class="section-number-3">4.19</span> Theme magic</h3>
<div class="outline-text-3" id="text-4-19">
<p>
Let&rsquo;s automatically update terminals on theme change
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">doom-load-theme-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">theme-magic-from-emacs</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-tramp" class="outline-3">
<h3 id="tramp"> <a class="anchor" aria-hidden="true" href="#tramp">🔗</a> <a class="anchor" aria-hidden="true" href="#tramp">🔗</a><span class="section-number-3">4.20</span> Tramp</h3>
<div class="outline-text-3" id="text-4-20">
<p>
Let&rsquo;s try to make tramp handle prompts better
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> tramp
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">setenv</span> <span style="color: #7bc275;">"SHELL"</span> <span style="color: #7bc275;">"/bin/bash"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">tramp-shell-prompt-pattern</span> <span style="color: #7bc275;">"</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(?:</span><span style="color: #7bc275;">^</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">|</span><span style="color: #7bc275;"></span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">]#$%&gt;\n]*#?[]#$%&gt;&#57520;] *</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">&#27;\\[[0-9;]*[a-zA-Z] *</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">*"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">default + &#57520;</span>
</pre>
</div>
</div>
<div id="outline-container-troubleshooting" class="outline-5">
<h5 id="troubleshooting"> <a class="anchor" aria-hidden="true" href="#troubleshooting">🔗</a> <a class="anchor" aria-hidden="true" href="#troubleshooting">🔗</a> <a class="anchor" aria-hidden="true" href="#troubleshooting">🔗</a><span class="section-number-5">4.20.0.1</span> Troubleshooting</h5>
<div class="outline-text-5" id="text-4-20-0-1">
<p>
In case the remote shell is misbehaving, here are some things to try
</p>
</div>
<div id="outline-container-zsh" class="outline-6">
<h6 id="zsh"> <a class="anchor" aria-hidden="true" href="#zsh">🔗</a> <a class="anchor" aria-hidden="true" href="#zsh">🔗</a> <a class="anchor" aria-hidden="true" href="#zsh">🔗</a> <a class="anchor" aria-hidden="true" href="#zsh">🔗</a><span class="section-number-6">4.20.0.1.1</span> Zsh</h6>
<div class="outline-text-6" id="text-4-20-0-1-1">
<p>
There are some escape code you don&rsquo;t want, let&rsquo;s make it behave more considerately.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span><span style="color: #C57BDB;">[</span> <span style="color: #7bc275;">"</span><span style="color: #a991f1;">$</span><span style="color: #DFDFDF;">TERM</span><span style="color: #7bc275;">"</span> == <span style="color: #7bc275;">"dumb"</span> <span style="color: #C57BDB;">]</span><span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
        <span style="color: #C57BDB;">unset</span> zle_bracketed_paste
        <span style="color: #C57BDB;">unset</span> zle
        <span style="color: #DFDFDF;">PS1</span>=<span style="color: #7bc275;">'$ '</span>
        <span style="color: #51afef;">return</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-treemacs" class="outline-3">
<h3 id="treemacs"> <a class="anchor" aria-hidden="true" href="#treemacs">🔗</a> <a class="anchor" aria-hidden="true" href="#treemacs">🔗</a><span class="section-number-3">4.21</span> Treemacs</h3>
<div class="outline-text-3" id="text-4-21">
<p>
Quite often there are superfluous files I&rsquo;m not that interested in. There&rsquo;s no
good reason for them to take up space. Let&rsquo;s add a mechanism to ignore them.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> treemacs
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">treemacs-file-ignore-extensions</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"File extension which `</span><span style="color: #a991f1;">treemacs-ignore-filter</span><span style="color: #7e7e87;">' will ensure are ignored"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">treemacs-file-ignore-globs</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Globs which will are transformed to `</span><span style="color: #a991f1;">treemacs-file-ignore-regexps</span><span style="color: #7e7e87;">' which `</span><span style="color: #a991f1;">treemacs-ignore-filter</span><span style="color: #7e7e87;">' will ensure are ignored"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">treemacs-file-ignore-regexps</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"RegExps to be tested to ignore files, generated from `</span><span style="color: #a991f1;">treeemacs-file-ignore-globs</span><span style="color: #7e7e87;">'"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">treemacs-file-ignore-generate-regexps</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Generate `</span><span style="color: #a991f1;">treemacs-file-ignore-regexps</span><span style="color: #7e7e87;">' from `</span><span style="color: #a991f1;">treemacs-file-ignore-globs</span><span style="color: #7e7e87;">'"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> treemacs-file-ignore-regexps <span style="color: #51afef;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dired-glob-regexp</span> treemacs-file-ignore-globs<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> treemacs-file-ignore-globs <span style="color: #C57BDB;">'</span><span style="color: #51afef;">()</span><span style="color: #7bc275;">)</span> nil <span style="color: #7bc275;">(</span>treemacs-file-ignore-generate-regexps<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">treemacs-ignore-filter</span> <span style="color: #7bc275;">(</span>file full-path<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Ignore files specified by `</span><span style="color: #a991f1;">treemacs-file-ignore-extensions</span><span style="color: #7e7e87;">', and `</span><span style="color: #a991f1;">treemacs-file-ignore-regexps</span><span style="color: #7e7e87;">'"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">member</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">file-name-extension</span> file<span style="color: #C57BDB;">)</span> treemacs-file-ignore-extensions<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>ignore-file nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #7bc275;">(</span>regexp treemacs-file-ignore-regexps ignore-file<span style="color: #7bc275;">)</span>
            <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> ignore-file <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> ignore-file <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-match-p</span> regexp full-path<span style="color: #7bc275;">)</span> t nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">treemacs-ignored-file-predicates</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">treemacs-ignore-filter</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now, we just identify the files in question.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> treemacs-file-ignore-extensions <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #62686E;">;; </span><span style="color: #62686E;">LaTeX</span>
                                        <span style="color: #7bc275;">"aux"</span>
                                        <span style="color: #7bc275;">"ptc"</span>
                                        <span style="color: #7bc275;">"fdb_latexmk"</span>
                                        <span style="color: #7bc275;">"fls"</span>
                                        <span style="color: #7bc275;">"synctex.gz"</span>
                                        <span style="color: #7bc275;">"toc"</span>
                                        <span style="color: #62686E;">;; </span><span style="color: #62686E;">LaTeX - glossary</span>
                                        <span style="color: #7bc275;">"glg"</span>
                                        <span style="color: #7bc275;">"glo"</span>
                                        <span style="color: #7bc275;">"gls"</span>
                                        <span style="color: #7bc275;">"glsdefs"</span>
                                        <span style="color: #7bc275;">"ist"</span>
                                        <span style="color: #7bc275;">"acn"</span>
                                        <span style="color: #7bc275;">"acr"</span>
                                        <span style="color: #7bc275;">"alg"</span>
                                        <span style="color: #62686E;">;; </span><span style="color: #62686E;">LaTeX - pgfplots</span>
                                        <span style="color: #7bc275;">"mw"</span>
                                        <span style="color: #62686E;">;; </span><span style="color: #62686E;">LaTeX - pdfx</span>
                                        <span style="color: #7bc275;">"pdfa.xmpi"</span>
                                        <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> treemacs-file-ignore-globs <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #62686E;">;; </span><span style="color: #62686E;">LaTeX</span>
                                   <span style="color: #7bc275;">"*/_minted-*"</span>
                                   <span style="color: #62686E;">;; </span><span style="color: #62686E;">AucTeX</span>
                                   <span style="color: #7bc275;">"*/.auctex-auto"</span>
                                   <span style="color: #7bc275;">"*/_region_.log"</span>
                                   <span style="color: #7bc275;">"*/_region_.tex"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-vterm" class="outline-3">
<h3 id="vterm"> <a class="anchor" aria-hidden="true" href="#vterm">🔗</a> <a class="anchor" aria-hidden="true" href="#vterm">🔗</a><span class="section-number-3">4.22</span> VTerm</h3>
<div class="outline-text-3" id="text-4-22">
<p>
On my system, I want to use the <code>vterm</code> lib in <kbd>/usr/bin/libvterm.so</kbd>. This is not
default behaviour. Without this I see the following error message.
</p>
<pre class="example">
make[2]: *** No rule to make target 'libvterm-prefix/src/libvterm/.libs/libvterm.a', needed by '../vterm-module.so'.  Stop.
make[1]: *** [CMakeFiles/Makefile2:106: CMakeFiles/vterm-module.dir/all] Error 2
make: *** [Makefile:84: all] Error 2
</pre>
<p>
I asked about this in a <a href="https://github.com/akermu/emacs-libvterm/issues/238#issuecomment-586385773">GitHub Issue</a>, and the fix is to use the <code>cmake</code> flag
<code>-DUSE_SYSTEM_LIBVTERM=yes</code>. This can be set for when Doom recompiles <code>vterm</code> on
updating, which saves me manually compiling with the flag.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> vterm-module-cmake-args <span style="color: #7bc275;">"-DUSE_SYSTEM_LIBVTERM=yes"</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
I also use a &rsquo;fancy powerline setup&rsquo; with <a href="https://github.com/romkatv/powerlevel10k">Powerlevel10k</a>, so I need to use a
patched font for my terminal. Unfortunately I haven&rsquo;t quite figured out how to
do this yet.
</p>
</div>
</div>
<div id="outline-container-which-key" class="outline-3">
<h3 id="which-key"> <a class="anchor" aria-hidden="true" href="#which-key">🔗</a> <a class="anchor" aria-hidden="true" href="#which-key">🔗</a><span class="section-number-3">4.23</span> Which-key</h3>
<div class="outline-text-3" id="text-4-23">
<p>
Let&rsquo;s make this popup a bit faster
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">which-key-idle-delay</span> <span style="color: #e69055; font-weight: bold;">0.5</span><span style="color: #51afef;">)</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">I need the help, I really do</span>
</pre>
</div>
<p>
I also think that having <kbd>evil-</kbd> appear in so many popups is a bit too verbose, let&rsquo;s change that, and do a few other similar tweaks while we&rsquo;re at it.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">which-key-allow-multiple-replacements</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> which-key
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">pushnew!</span>
   <span style="color: #DFDFDF;">which-key-replacement-alist</span>
   <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">""</span> . <span style="color: #7bc275;">"\\`+?evil[-:]?</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(?:</span><span style="color: #7bc275;">a-</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">?</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">.*</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">"</span><span style="color: #51afef;">)</span> . <span style="color: #51afef;">(</span>nil . <span style="color: #7bc275;">"&#9666;\\1"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
   <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\`g s"</span> . <span style="color: #7bc275;">"\\`evilem--?motion-</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">.*</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">"</span><span style="color: #51afef;">)</span> . <span style="color: #51afef;">(</span>nil . <span style="color: #7bc275;">"&#9667;\\1"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
   <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-xkcd" class="outline-3">
<h3 id="xkcd"> <a class="anchor" aria-hidden="true" href="#xkcd">🔗</a> <a class="anchor" aria-hidden="true" href="#xkcd">🔗</a><span class="section-number-3">4.24</span> xkcd</h3>
<div class="outline-text-3" id="text-4-24">
<p>
We wan&rsquo;t to set this up so it loads nicely in <a href="#extra-links">Extra links</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> xkcd
  <span style="color: #C57BDB;">:commands</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">xkcd-get-json</span> xkcd-download xkcd-get
             <span style="color: #62686E;">;; </span><span style="color: #62686E;">now for funcs from my extension of this pkg</span>
             +xkcd-find-and-copy +xkcd-find-and-view
             +xkcd-fetch-info +xkcd-select<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:config</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">evil-snipe-disabled-modes</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">xkcd-mode</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:general</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:states</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">normal</span>
            <span style="color: #C57BDB;">:keymaps</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">xkcd-mode-map</span>
            <span style="color: #7bc275;">"&lt;right&gt;"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-next</span>
            <span style="color: #7bc275;">"n"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-next</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">evil-ish</span>
            <span style="color: #7bc275;">"&lt;left&gt;"</span>  <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-prev</span>
            <span style="color: #7bc275;">"N"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-prev</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">evil-ish</span>
            <span style="color: #7bc275;">"r"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-rand</span>
            <span style="color: #7bc275;">"a"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-rand</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">because image-rotate can interfere</span>
            <span style="color: #7bc275;">"t"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-alt-text</span>
            <span style="color: #7bc275;">"q"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-kill-buffer</span>
            <span style="color: #7bc275;">"o"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-open-browser</span>
            <span style="color: #7bc275;">"e"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-open-explanation-browser</span>
            <span style="color: #62686E;">;; </span><span style="color: #62686E;">extras</span>
            <span style="color: #7bc275;">"s"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+xkcd-find-and-view</span>
            <span style="color: #7bc275;">"/"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+xkcd-find-and-view</span>
            <span style="color: #7bc275;">"y"</span>       <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+xkcd-copy</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Let&rsquo;s also extend the functionality a whole bunch.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> xkcd
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">emacsql-sqlite</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-select</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Prompt the user for an xkcd using `</span><span style="color: #a991f1;">ivy-read</span><span style="color: #7e7e87;">' and `</span><span style="color: #a991f1;">+xkcd-select-format</span><span style="color: #7e7e87;">'. Return the xkcd number or nil"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span>prompt-lines
           <span style="color: #C57BDB;">(</span>-dummy <span style="color: #7bc275;">(</span><span style="color: #a991f1;">maphash</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>key xkcd-info<span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-select-format</span> xkcd-info<span style="color: #7bc275;">)</span> prompt-lines<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                            <span style="color: #DFDFDF;">+xkcd-stored-info</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>num <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">ivy-read</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"xkcd (%s): "</span> <span style="color: #DFDFDF;">xkcd-latest</span><span style="color: #51afef;">)</span> prompt-lines<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #7bc275;">""</span> num<span style="color: #C57BDB;">)</span> <span style="color: #DFDFDF;">xkcd-latest</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">string-to-number</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[0-9]+</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">.*"</span> <span style="color: #7bc275;">"\\1"</span> num<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-select-format</span> <span style="color: #7bc275;">(</span>xkcd-info<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Creates each ivy-read line from an xkcd info plist. Must start with the xkcd number"</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%-4s  %-30s %s"</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">number-to-string</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:num</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                        <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">counsel-key-binding</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:title</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:alt</span><span style="color: #C57BDB;">)</span>
                        <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>variable-pitch <span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-fetch-info</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> num<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Fetch the parsed json info for comic NUM. Fetches latest when omitted or 0"</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">xkcd</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">not</span> num<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">=</span> num <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-check-latest</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> num <span style="color: #DFDFDF;">xkcd-latest</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>res <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">gethash</span> num <span style="color: #DFDFDF;">+xkcd-stored-info</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">puthash</span> num <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+xkcd-db-read</span> num<span style="color: #C57BDB;">)</span> <span style="color: #DFDFDF;">+xkcd-stored-info</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> res
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+xkcd-db-write</span>
         <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>url <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"http://xkcd.com/%d/info.0.json"</span> num<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                <span style="color: #C57BDB;">(</span>json-assoc
                 <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> num <span style="color: #DFDFDF;">+xkcd-stored-info</span><span style="color: #51afef;">)</span>
                     <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> num <span style="color: #DFDFDF;">+xkcd-stored-info</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">json-read-from-string</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">xkcd-get-json</span> url num<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
           json-assoc<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> res <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-db-read</span> num<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      res<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">since we've done this, we may as well go one little step further</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-find-and-copy</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Prompt for an xkcd using `</span><span style="color: #a991f1;">+xkcd-select</span><span style="color: #7e7e87;">' and copy url to clipboard"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-copy</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-select</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-copy</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> num<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Copy a url to xkcd NUM to the clipboard"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #7bc275;">"i"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>num <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> num <span style="color: #DFDFDF;">xkcd-cur</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">gui-select-text</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"https://xkcd.com/%d"</span> num<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"xkcd.com/%d copied to clipboard"</span> num<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-find-and-view</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Prompt for an xkcd using `</span><span style="color: #a991f1;">+xkcd-select</span><span style="color: #7e7e87;">' and view it"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">xkcd-get</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-select</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">switch-to-buffer</span> <span style="color: #7bc275;">"*xkcd*"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">+xkcd-latest-max-age</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">*</span> <span style="color: #e69055; font-weight: bold;">60</span> <span style="color: #e69055; font-weight: bold;">60</span><span style="color: #7bc275;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">1 hour</span>
    <span style="color: #7e7e87;">"Time after which xkcd-latest should be refreshed, in seconds"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">initialise `</span><span style="color: #a991f1;">xkcd-latest</span><span style="color: #62686E;">' and `</span><span style="color: #a991f1;">+xkcd-stored-info</span><span style="color: #62686E;">' with latest xkcd</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">add-transient-hook!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">+xkcd-select</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">xkcd</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-fetch-info</span> <span style="color: #DFDFDF;">xkcd-latest</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">+xkcd-stored-info</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-db-read-all</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">add-transient-hook!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">+xkcd-fetch-info</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">xkcd-update-latest</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-check-latest</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Use value in `</span><span style="color: #a991f1;">xkcd-cache-latest</span><span style="color: #7e7e87;">' as long as it isn't older thabn `</span><span style="color: #a991f1;">+xkcd-latest-max-age</span><span style="color: #7e7e87;">'"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">file-exists-p</span> <span style="color: #DFDFDF;">xkcd-cache-latest</span><span style="color: #C57BDB;">)</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">&lt;</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">time-to-seconds</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">current-time</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #a991f1;">time-to-seconds</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">file-attribute-modification-time</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">file-attributes</span> <span style="color: #DFDFDF;">xkcd-cache-latest</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                    <span style="color: #DFDFDF;">+xkcd-latest-max-age</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>out <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">xkcd-get-json</span> <span style="color: #7bc275;">"http://xkcd.com/info.0.json"</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>json-assoc <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">json-read-from-string</span> out<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>latest <span style="color: #51afef;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">num</span> json-assoc<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">/=</span> <span style="color: #DFDFDF;">xkcd-latest</span> latest<span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-db-write</span> json-assoc<span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">find-file</span> <span style="color: #DFDFDF;">xkcd-cache-latest</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">xkcd-latest</span> latest<span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">erase-buffer</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">number-to-string</span> latest<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">save-buffer</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #a991f1;">kill-buffer</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">current-buffer</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">shell-command</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"touch %s"</span> <span style="color: #DFDFDF;">xkcd-cache-latest</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">+xkcd-stored-info</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">make-hash-table</span> <span style="color: #C57BDB;">:test</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">eql</span><span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Basic info on downloaded xkcds, in the form of a hashtable"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> xkcd-get-json--and-cache <span style="color: #7bc275;">(</span>url <span style="color: #FCCE7B;">&amp;optional</span> num<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Fetch the Json coming from URL.</span>
<span style="color: #7e7e87;">If the file NUM.json exists, use it instead.</span>
<span style="color: #7e7e87;">If NUM is 0, always download from URL.</span>
<span style="color: #7e7e87;">The return value is a string."</span>
    <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">xkcd-get-json</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>file <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s%d.json"</span> <span style="color: #DFDFDF;">xkcd-cache-dir</span> num<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>cached <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">file-exists-p</span> file<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> num <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>out <span style="color: #7bc275;">(</span><span style="color: #51afef;">with-current-buffer</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> cached
                                         <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">find-file</span> file<span style="color: #C57BDB;">)</span>
                                       <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">url-retrieve-synchronously</span> url<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> cached <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">re-search-forward</span> <span style="color: #7bc275;">"^$"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #51afef;">prog1</span>
                      <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">buffer-substring-no-properties</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">point</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                    <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">kill-buffer</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">current-buffer</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> cached <span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> num <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">xkcd-cache-json</span> num out<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      out<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> +xkcd-get <span style="color: #7bc275;">(</span>num<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Get the xkcd number NUM."</span>
    <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">xkcd-get</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #7bc275;">"nEnter comic number: "</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">xkcd-update-latest</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">get-buffer-create</span> <span style="color: #7bc275;">"*xkcd*"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">switch-to-buffer</span> <span style="color: #7bc275;">"*xkcd*"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">xkcd-mode</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">buffer-read-only</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">erase-buffer</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">xkcd-cur</span> num<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>xkcd-data <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-fetch-info</span> num<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>num <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-data <span style="color: #C57BDB;">:num</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>img <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-data <span style="color: #C57BDB;">:img</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>safe-title <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-data <span style="color: #C57BDB;">:safe-title</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>alt <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-data <span style="color: #C57BDB;">:alt</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             title file<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Getting comic..."</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> file <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">xkcd-download</span> img num<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> title <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%d: %s"</span> num safe-title<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> title
                            <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">center-line</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"\n"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">xkcd-insert-image</span> file num<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #DFDFDF;">xkcd-cur</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #7bc275;">)</span>
            <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">xkcd-cur</span> num<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">xkcd-alt</span> alt<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"%s"</span> title<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #DFDFDF;">+xkcd-db--sqlite-available-p</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">with-demoted-errors</span> <span style="color: #7bc275;">"+org-xkcd initialization: %S"</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">emacsql-sqlite-ensure-binary</span><span style="color: #51afef;">)</span>
      t<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">+xkcd-db--connection</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">make-hash-table</span> <span style="color: #C57BDB;">:test</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">equal</span><span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Database connection to +org-xkcd database."</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db--get</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Return the sqlite db file."</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">expand-file-name</span> <span style="color: #7bc275;">"xkcd.db"</span> <span style="color: #DFDFDF;">xkcd-cache-dir</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db--get-connection</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Return the database connection, if any."</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">gethash</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">file-truename</span> <span style="color: #DFDFDF;">xkcd-cache-dir</span><span style="color: #51afef;">)</span>
             <span style="color: #DFDFDF;">+xkcd-db--connection</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defconst</span> <span style="color: #DFDFDF;">+xkcd-db--table-schema</span>
    <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>xkcds
       <span style="color: #C57BDB;">[</span><span style="color: #7bc275;">(</span>num integer <span style="color: #C57BDB;">:unique</span> <span style="color: #C57BDB;">:primary-key</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>year        <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>month       <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>link        <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>news        <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>safe_title  <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>title       <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>transcript  <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>alt         <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>img         <span style="color: #C57BDB;">:not-null</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db--init</span> <span style="color: #7bc275;">(</span>db<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Initialize database DB with the correct schema and user version."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">emacsql-with-transaction</span> db
      <span style="color: #51afef;">(</span><span style="color: #51afef;">pcase-dolist</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>,table . ,schema<span style="color: #7bc275;">)</span> <span style="color: #DFDFDF;">+xkcd-db--table-schema</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">emacsql</span> db <span style="color: #7bc275;">[</span><span style="color: #C57BDB;">:create-table</span> $i1 $S2<span style="color: #7bc275;">]</span> table schema<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Entrypoint to the +org-xkcd sqlite database.</span>
<span style="color: #7e7e87;">Initializes and stores the database, and the database connection.</span>
<span style="color: #7e7e87;">Performs a database upgrade when required."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+xkcd-db--get-connection</span><span style="color: #C57BDB;">)</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">emacsql-live-p</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-db--get-connection</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>db-file <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-db--get</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span>init-db <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">file-exists-p</span> db-file<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">make-directory</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">file-name-directory</span> db-file<span style="color: #7bc275;">)</span> t<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>conn <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">emacsql-sqlite</span> db-file<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #a991f1;">set-process-query-on-exit-flag</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">emacsql-process</span> conn<span style="color: #51afef;">)</span> nil<span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #a991f1;">puthash</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">file-truename</span> <span style="color: #DFDFDF;">xkcd-cache-dir</span><span style="color: #51afef;">)</span>
                   conn
                   <span style="color: #DFDFDF;">+xkcd-db--connection</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> init-db
            <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-db--init</span> conn<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-db--get-connection</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db-query</span> <span style="color: #7bc275;">(</span>sql <span style="color: #FCCE7B;">&amp;rest</span> args<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Run SQL query on +org-xkcd database with ARGS.</span>
<span style="color: #7e7e87;">SQL can be either the emacsql vector representation, or a string."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span>  <span style="color: #51afef;">(</span><span style="color: #a991f1;">stringp</span> sql<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">emacsql</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+xkcd-db</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">apply</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">format</span> sql args<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">apply</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">emacsql</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+xkcd-db</span><span style="color: #C57BDB;">)</span> sql args<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db-read</span> <span style="color: #7bc275;">(</span>num<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when-let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>res
                <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-db-query</span> <span style="color: #C57BDB;">[</span><span style="color: #C57BDB;">:select</span> * <span style="color: #C57BDB;">:from</span> xkcds
                                      <span style="color: #C57BDB;">:where</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">=</span> num $s1<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">]</span>
                                     num
                                     <span style="color: #C57BDB;">:limit</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-db-list-to-plist</span> res<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db-read-all</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>xkcd-table <span style="color: #7bc275;">(</span><span style="color: #a991f1;">make-hash-table</span> <span style="color: #C57BDB;">:test</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">eql</span> <span style="color: #C57BDB;">:size</span> <span style="color: #e69055; font-weight: bold;">4000</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #7bc275;">(</span>xkcd-info-list<span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span><span style="color: #a991f1;">puthash</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> xkcd-info-list<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-db-list-to-plist</span> xkcd-info-list<span style="color: #51afef;">)</span> xkcd-table<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
              <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">+xkcd-db-query</span> <span style="color: #7bc275;">[</span><span style="color: #C57BDB;">:select</span> * <span style="color: #C57BDB;">:from</span> xkcds<span style="color: #7bc275;">]</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      xkcd-table<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db-list-to-plist</span> <span style="color: #7bc275;">(</span>xkcd-datalist<span style="color: #7bc275;">)</span>
    <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:num</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">0</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:year</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:month</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">2</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:link</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">3</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:news</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">4</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:safe-title</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">5</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:title</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">6</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:transcript</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">7</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:alt</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">8</span> xkcd-datalist<span style="color: #51afef;">)</span>
      <span style="color: #C57BDB;">:img</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">9</span> xkcd-datalist<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+xkcd-db-write</span> <span style="color: #7bc275;">(</span>data<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-db-query</span> <span style="color: #51afef;">[</span><span style="color: #C57BDB;">:insert-into</span> xkcds
                     <span style="color: #C57BDB;">:values</span> $v1<span style="color: #51afef;">]</span>
                    <span style="color: #51afef;">(</span><span style="color: #a991f1;">list</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">vector</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">num</span>        data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">year</span>       data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">month</span>      data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">link</span>       data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">news</span>       data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">safe_title</span> data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">title</span>      data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">transcript</span> data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">alt</span>        data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">img</span>        data<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-yasnippet" class="outline-3">
<h3 id="yasnippet"> <a class="anchor" aria-hidden="true" href="#yasnippet">🔗</a> <a class="anchor" aria-hidden="true" href="#yasnippet">🔗</a><span class="section-number-3">4.25</span> YASnippet</h3>
<div class="outline-text-3" id="text-4-25">
<p>
Nested snippets are good, enable that.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">yas-triggers-in-field</span> t<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-language-configuration" class="outline-2">
<h2 id="language-configuration"> <a class="anchor" aria-hidden="true" href="#language-configuration">🔗</a><span class="section-number-2">5</span> Language configuration</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-file-templates" class="outline-4">
<h4 id="file-templates"> <a class="anchor" aria-hidden="true" href="#file-templates">🔗</a> <a class="anchor" aria-hidden="true" href="#file-templates">🔗</a><span class="section-number-4">5.0.1</span> File Templates</h4>
<div class="outline-text-4" id="text-5-0-1">
<p>
For some file types, we overwrite defaults in the <a href="./snippets">snippets</a> directory, others
need to have a template assigned.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">set-file-template!</span> <span style="color: #7bc275;">"\\.tex$"</span> <span style="color: #C57BDB;">:trigger</span> <span style="color: #7bc275;">"__"</span> <span style="color: #C57BDB;">:mode</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-plaintext" class="outline-3">
<h3 id="plaintext"> <a class="anchor" aria-hidden="true" href="#plaintext">🔗</a> <a class="anchor" aria-hidden="true" href="#plaintext">🔗</a><span class="section-number-3">5.1</span> Plaintext</h3>
<div class="outline-text-3" id="text-5-1">
<p>
It&rsquo;s nice to see ansi colour codes displayed
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> text-mode
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">text-mode-hook</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Apply ANSI color codes</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">with-silent-modifications</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">ansi-color-apply-on-region</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org" class="outline-3">
<h3 id="org"> <a class="anchor" aria-hidden="true" href="#org">🔗</a> <a class="anchor" aria-hidden="true" href="#org">🔗</a><span class="section-number-3">5.2</span> Org Mode</h3>
<div class="outline-text-3" id="text-org">
<p>
I really like org mode, I&rsquo;ve given some thought to why, and below is the result.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-right">Fine-grained-control</th>
<th scope="col" class="org-right">Initial Effort</th>
<th scope="col" class="org-right">Syntax simplicity</th>
<th scope="col" class="org-right">Editor Support</th>
<th scope="col" class="org-right">Integrations</th>
<th scope="col" class="org-right">Ease-of-referencing</th>
<th scope="col" class="org-right">Versatility</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Word</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">LaTeX</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Org Mode</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">3.5</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">Markdown</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Markdown + Pandoc</td>
<td class="org-right">2.5</td>
<td class="org-right">2.5</td>
<td class="org-right">2.5</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>


<div class="figure">
<p><img src="https://media.githubusercontent.com/media/tecosaur/emacs-config/master/misc/document-format-comparison.png" alt="document-format-comparison.png" />
</p>
</div>
</div>

<div id="outline-container-system-config" class="outline-4">
<h4 id="system-config"> <a class="anchor" aria-hidden="true" href="#system-config">🔗</a> <a class="anchor" aria-hidden="true" href="#system-config">🔗</a> <a class="anchor" aria-hidden="true" href="#system-config">🔗</a><span class="section-number-4">5.2.1</span> System config</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
Org mode isn&rsquo;t recognised as it&rsquo;s own mime type by default, but that can easily
be changed with the following file. For system-wide changes try
<code>~/usr/share/mime/packages/org.xml</code>.
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #7bc275;">&lt;?</span><span style="color: #51afef;">xml</span><span style="color: #7bc275;"> </span><span style="color: #7e7e87;">version="1.0" encoding="utf-8"</span><span style="color: #7bc275;">?&gt;</span>
<span style="color: #7bc275;">&lt;?</span><span style="color: #51afef;">xml</span><span style="color: #7bc275;"> </span><span style="color: #7e7e87;">version="1.0" encoding="utf-8"</span><span style="color: #7bc275;">?&gt;</span>
&lt;<span style="color: #5cEfFF;">mime-info</span> <span style="color: #C57BDB;">xmlns</span>=<span style="color: #7bc275;">'http://www.freedesktop.org/standards/shared-mime-info'</span>&gt;
  &lt;<span style="color: #5cEfFF;">mime-type</span> <span style="color: #DFDFDF;">type</span>=<span style="color: #7bc275;">"text/org"</span>&gt;
    &lt;<span style="color: #5cEfFF;">comment</span>&gt;Emacs Org-mode File&lt;/<span style="color: #5cEfFF;">comment</span>&gt;
    &lt;<span style="color: #5cEfFF;">glob</span> <span style="color: #DFDFDF;">pattern</span>=<span style="color: #7bc275;">"*.org"</span>/&gt;
    &lt;<span style="color: #5cEfFF;">alias</span> <span style="color: #DFDFDF;">type</span>=<span style="color: #7bc275;">"text/org"</span>/&gt;
  &lt;/<span style="color: #5cEfFF;">mime-type</span>&gt;
&lt;/<span style="color: #5cEfFF;">mime-info</span>&gt;
</pre>
</div>
<p>
What&rsquo;s nice is that Papirus <a href="https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/commit/a10fb7f2423d5e30b9c4477416ccdc93c4f3849d">now</a> has an icon for <kbd>text/org</kbd>.
One simply needs to refresh their mime database
</p>
<div class="org-src-container">
<pre class="src src-shell">update-mime-database ~/.local/share/mime
</pre>
</div>
<p>
Then set Emacs as the default editor
</p>
<div class="org-src-container">
<pre class="src src-shell">xdg-mime default emacs.desktop text/org
</pre>
</div>
</div>
</div>
<div id="outline-container-behaviour" class="outline-4">
<h4 id="behaviour"> <a class="anchor" aria-hidden="true" href="#behaviour">🔗</a> <a class="anchor" aria-hidden="true" href="#behaviour">🔗</a> <a class="anchor" aria-hidden="true" href="#behaviour">🔗</a><span class="section-number-4">5.2.2</span> Behaviour</h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
<img src='https://imgs.xkcd.com/comics/automation.png' title="'Automating' comes from the roots 'auto-' meaning 'self-', and 'mating', meaning 'screwing'." alt='Automation'>
</p>
</div>
<div id="outline-container-tweaking-defaults" class="outline-5">
<h5 id="tweaking-defaults"> <a class="anchor" aria-hidden="true" href="#tweaking-defaults">🔗</a> <a class="anchor" aria-hidden="true" href="#tweaking-defaults">🔗</a> <a class="anchor" aria-hidden="true" href="#tweaking-defaults">🔗</a> <a class="anchor" aria-hidden="true" href="#tweaking-defaults">🔗</a><span class="section-number-5">5.2.2.1</span> Tweaking defaults</h5>
<div class="outline-text-5" id="text-5-2-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-directory</span> <span style="color: #7bc275;">"~/.org"</span>                      <span style="color: #62686E;">; </span><span style="color: #62686E;">let's put files here</span>
      <span style="color: #DFDFDF;">org-use-property-inheritance</span> t              <span style="color: #62686E;">; </span><span style="color: #62686E;">it's convenient to have properties inherited</span>
      <span style="color: #DFDFDF;">org-log-done</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">time</span>                          <span style="color: #62686E;">; </span><span style="color: #62686E;">having the time a item is done sounds convininet</span>
      <span style="color: #DFDFDF;">org-list-allow-alphabetical</span> t               <span style="color: #62686E;">; </span><span style="color: #62686E;">have a. A. a) A) list bullets</span>
      <span style="color: #DFDFDF;">org-export-in-background</span> t                  <span style="color: #62686E;">; </span><span style="color: #62686E;">run export processes in external emacs process</span>
      <span style="color: #DFDFDF;">org-catch-invisible-edits</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">smart</span><span style="color: #51afef;">)</span>           <span style="color: #62686E;">; </span><span style="color: #62686E;">try not to accidently do weird stuff in invisible regions</span>
</pre>
</div>
<p>
I also like the <code>:comments</code> header-argument, so let&rsquo;s make that a default.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-babel-default-header-args</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:session</span> . <span style="color: #7bc275;">"none"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:results</span> . <span style="color: #7bc275;">"replace"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:exports</span> . <span style="color: #7bc275;">"code"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:cache</span> . <span style="color: #7bc275;">"no"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:noweb</span> . <span style="color: #7bc275;">"no"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:hlines</span> . <span style="color: #7bc275;">"no"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:tangle</span> . <span style="color: #7bc275;">"no"</span><span style="color: #7bc275;">)</span>
                                      <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:comments</span> . <span style="color: #7bc275;">"link"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
By default, <code>visual-line-mode</code> is turned <kbd>on</kbd>, and <code>auto-fill-mode</code> <kbd>off</kbd> by a hook.
However this messes with tables in Org-mode, and other plaintext files (e.g.
markdown, \LaTeX) so I&rsquo;ll turn it off for this, and manually enable it for more
specific modes as desired.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">remove-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">text-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">visual-line-mode</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">text-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">auto-fill-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-behaviour-extra-functionality" class="outline-5">
<h5 id="behaviour-extra-functionality"> <a class="anchor" aria-hidden="true" href="#behaviour-extra-functionality">🔗</a> <a class="anchor" aria-hidden="true" href="#behaviour-extra-functionality">🔗</a> <a class="anchor" aria-hidden="true" href="#behaviour-extra-functionality">🔗</a> <a class="anchor" aria-hidden="true" href="#behaviour-extra-functionality">🔗</a><span class="section-number-5">5.2.2.2</span> Extra functionality</h5>
<div class="outline-text-5" id="text-5-2-2-2">
</div>
<div id="outline-container-org-buffer-creation" class="outline-6">
<h6 id="org-buffer-creation"> <a class="anchor" aria-hidden="true" href="#org-buffer-creation">🔗</a> <a class="anchor" aria-hidden="true" href="#org-buffer-creation">🔗</a> <a class="anchor" aria-hidden="true" href="#org-buffer-creation">🔗</a> <a class="anchor" aria-hidden="true" href="#org-buffer-creation">🔗</a> <a class="anchor" aria-hidden="true" href="#org-buffer-creation">🔗</a><span class="section-number-6">5.2.2.2.1</span> Org buffer creation</h6>
<div class="outline-text-6" id="text-5-2-2-2-1">
<p>
Let&rsquo;s also make creating an org buffer just that little bit easier.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">evil-define-command</span> <span style="color: #5cEfFF;">evil-buffer-org-new</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">count</span> file<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Creates a new ORG buffer replacing the current window, optionally</span>
<span style="color: #7e7e87;">   editing a certain FILE"</span>
  <span style="color: #C57BDB;">:repeat</span> nil
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #7bc275;">"P&lt;f&gt;"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> file
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">evil-edit</span> file<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>buffer <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">generate-new-buffer</span> <span style="color: #7bc275;">"*new org*"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">set-window-buffer</span> nil buffer<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">with-current-buffer</span> buffer
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-mode</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:leader</span>
  <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">:prefix</span> <span style="color: #7bc275;">"b"</span>
    <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">"New empty ORG buffer"</span> <span style="color: #7bc275;">"o"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">evil-buffer-org-new</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-list-bullet-sequence" class="outline-6">
<h6 id="list-bullet-sequence"> <a class="anchor" aria-hidden="true" href="#list-bullet-sequence">🔗</a> <a class="anchor" aria-hidden="true" href="#list-bullet-sequence">🔗</a> <a class="anchor" aria-hidden="true" href="#list-bullet-sequence">🔗</a> <a class="anchor" aria-hidden="true" href="#list-bullet-sequence">🔗</a> <a class="anchor" aria-hidden="true" href="#list-bullet-sequence">🔗</a><span class="section-number-6">5.2.2.2.2</span> List bullet sequence</h6>
<div class="outline-text-6" id="text-5-2-2-2-2">
<p>
I think it makes sense to have list bullets change with depth
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-list-demote-modify-bullet</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"+"</span> . <span style="color: #7bc275;">"-"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"-"</span> . <span style="color: #7bc275;">"+"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"*"</span> . <span style="color: #7bc275;">"+"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-citation" class="outline-6">
<h6 id="citation"> <a class="anchor" aria-hidden="true" href="#citation">🔗</a> <a class="anchor" aria-hidden="true" href="#citation">🔗</a> <a class="anchor" aria-hidden="true" href="#citation">🔗</a> <a class="anchor" aria-hidden="true" href="#citation">🔗</a> <a class="anchor" aria-hidden="true" href="#citation">🔗</a><span class="section-number-6">5.2.2.2.3</span> Citation</h6>
<div class="outline-text-6" id="text-5-2-2-2-3">
<p>
Occasionally I want to cite something.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> org-ref
   <span style="color: #C57BDB;">:after</span> org
   <span style="color: #C57BDB;">:config</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-ref-completion-library</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-ref-ivy-cite</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-cdlatex" class="outline-6">
<h6 id="cdlatex"> <a class="anchor" aria-hidden="true" href="#cdlatex">🔗</a> <a class="anchor" aria-hidden="true" href="#cdlatex">🔗</a> <a class="anchor" aria-hidden="true" href="#cdlatex">🔗</a> <a class="anchor" aria-hidden="true" href="#cdlatex">🔗</a> <a class="anchor" aria-hidden="true" href="#cdlatex">🔗</a><span class="section-number-6">5.2.2.2.4</span> cdlatex</h6>
<div class="outline-text-6" id="text-5-2-2-2-4">
<p>
It&rsquo;s also nice to be able to use <code>cdlatex</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-mode-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">turn-on-org-cdlatex</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
It&rsquo;s handy to be able to quickly insert environments with <kbd>C-c }</kbd>. I almost always
want to edit them afterwards though, so let&rsquo;s make that happen by default.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> org-edit-latex-emv-after-insert <span style="color: #7bc275;">()</span>
    <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-cdlatex-environment-indent</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-edit-latex-environment</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
At some point in the future it could be good to investigate <a href="https://scripter.co/splitting-an-org-block-into-two/">splitting org blocks</a>.
Likewise <a href="https://archive.casouri.cat/note/2020/insert-math-symbol-in-emacs/">this</a> looks good for symbols.
</p>
</div>
</div>
<div id="outline-container-spellcheck" class="outline-6">
<h6 id="spellcheck"> <a class="anchor" aria-hidden="true" href="#spellcheck">🔗</a> <a class="anchor" aria-hidden="true" href="#spellcheck">🔗</a> <a class="anchor" aria-hidden="true" href="#spellcheck">🔗</a> <a class="anchor" aria-hidden="true" href="#spellcheck">🔗</a> <a class="anchor" aria-hidden="true" href="#spellcheck">🔗</a><span class="section-number-6">5.2.2.2.5</span> Spellcheck</h6>
<div class="outline-text-6" id="text-5-2-2-2-5">
<p>
My spelling is atrocious, so let&rsquo;s get flycheck going.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-mode-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">turn-on-flyspell</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-lsp-support-src" class="outline-6">
<h6 id="lsp-support-src"> <a class="anchor" aria-hidden="true" href="#lsp-support-src">🔗</a> <a class="anchor" aria-hidden="true" href="#lsp-support-src">🔗</a> <a class="anchor" aria-hidden="true" href="#lsp-support-src">🔗</a> <a class="anchor" aria-hidden="true" href="#lsp-support-src">🔗</a> <a class="anchor" aria-hidden="true" href="#lsp-support-src">🔗</a><span class="section-number-6">5.2.2.2.6</span> LSP support in <code>src</code> blocks</h6>
<div class="outline-text-6" id="text-5-2-2-2-6">
<p>
Now, by default, LSPs don&rsquo;t really function at all in <code>src</code> blocks.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">cl-defmacro</span> <span style="color: #5cEfFF;">lsp-org-babel-enable</span> <span style="color: #C57BDB;">(</span>lang<span style="color: #C57BDB;">)</span>
    <span style="color: #7e7e87;">"Support LANG in org source code block."</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> centaur-lsp <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">lsp-mode</span><span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span><span style="color: #FCCE7B;">cl-check-type</span> lang stringp<span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let*</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>edit-pre <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"org-babel-edit-prep:%s"</span> lang<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span>intern-pre <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"lsp--%s"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">symbol-name</span> edit-pre<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">progn</span>
         <span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> ,intern-pre <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">info</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>file-name <span style="color: #C57BDB;">(</span><span style="color: #51afef;">-&gt;&gt;</span> info caddr <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">alist-get</span> <span style="color: #C57BDB;">:file</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> file-name
               <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> file-name <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">make-temp-file</span> <span style="color: #7bc275;">"babel-lsp-"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">buffer-file-name</span> file-name<span style="color: #7bc275;">)</span>
              <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">lsp-deferred</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span>,intern-pre <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">function-documentation</span>
              <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"Enable lsp-mode in the buffer of org source block (%s)."</span>
                      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">upcase</span> ,lang<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">fboundp</span> <span style="color: #C57BDB;">'</span>,edit-pre<span style="color: #C57BDB;">)</span>
             <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span>,edit-pre <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">'</span>,intern-pre<span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #51afef;">progn</span>
             <span style="color: #7bc275;">(</span><span style="color: #51afef;">defun</span> ,edit-pre <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">info</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span>,intern-pre info<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span>,edit-pre <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">function-documentation</span>
                  <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"Prepare local buffer environment for org source block (%s)."</span>
                          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">upcase</span> ,lang<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
  <span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">org-babel-lang-list</span>
    <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"go"</span> <span style="color: #7bc275;">"python"</span> <span style="color: #7bc275;">"ipython"</span> <span style="color: #7bc275;">"bash"</span> <span style="color: #7bc275;">"sh"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
  <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #C57BDB;">(</span>lang <span style="color: #DFDFDF;">org-babel-lang-list</span><span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eval</span> <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">lsp-org-babel-enable</span> ,lang<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-view-exported-file" class="outline-6">
<h6 id="view-exported-file"> <a class="anchor" aria-hidden="true" href="#view-exported-file">🔗</a> <a class="anchor" aria-hidden="true" href="#view-exported-file">🔗</a> <a class="anchor" aria-hidden="true" href="#view-exported-file">🔗</a> <a class="anchor" aria-hidden="true" href="#view-exported-file">🔗</a> <a class="anchor" aria-hidden="true" href="#view-exported-file">🔗</a><span class="section-number-6">5.2.2.2.7</span> View exported file</h6>
<div class="outline-text-6" id="text-5-2-2-2-7">
<p>
<kbd>'localeader v</kbd> has no pre-existing binding, so I may as well use it with the same
functionality as in LaTeX. Let&rsquo;s try viewing possible output files with this.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">org-mode-map</span>
        <span style="color: #C57BDB;">:localleader</span>
        <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">"View exported file"</span> <span style="color: #7bc275;">"v"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-view-output-file</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">org-view-output-file</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> org-file-path<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">"Visit buffer open on the first output file (if any) found, using `</span><span style="color: #a991f1;">org-view-output-file-extensions</span><span style="color: #7bc275;">'"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>org-file-path <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> org-file-path <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">buffer-file-name</span><span style="color: #51afef;">)</span> <span style="color: #7bc275;">""</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>dir <span style="color: #7bc275;">(</span><span style="color: #a991f1;">file-name-directory</span> org-file-path<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>basename <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">file-name-base</span> org-file-path<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>output-file nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #C57BDB;">(</span>ext <span style="color: #DFDFDF;">org-view-output-file-extensions</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unless</span> output-file
          <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">file-exists-p</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> dir basename <span style="color: #7bc275;">"."</span> ext<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> output-file <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> dir basename <span style="color: #7bc275;">"."</span> ext<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> output-file
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">pop-to-buffer</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">find-buffer-visiting</span> output-file<span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">find-file-noselect</span> output-file<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"No exported file found"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">org-view-output-file-extensions</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"pdf"</span> <span style="color: #7bc275;">"md"</span> <span style="color: #7bc275;">"rst"</span> <span style="color: #7bc275;">"txt"</span> <span style="color: #7bc275;">"tex"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Search for output files with these extensions, in order, viewing the first that matches"</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-super-agenda" class="outline-5">
<h5 id="super-agenda"> <a class="anchor" aria-hidden="true" href="#super-agenda">🔗</a> <a class="anchor" aria-hidden="true" href="#super-agenda">🔗</a> <a class="anchor" aria-hidden="true" href="#super-agenda">🔗</a> <a class="anchor" aria-hidden="true" href="#super-agenda">🔗</a><span class="section-number-5">5.2.2.3</span> Super agenda</h5>
<div class="outline-text-5" id="text-5-2-2-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> org-super-agenda
  <span style="color: #C57BDB;">:commands</span> <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">org-super-agenda-mode</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org-agenda
  <span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">org-super-agenda-mode</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-agenda-skip-scheduled-if-done</span> t
      <span style="color: #DFDFDF;">org-agenda-skip-deadline-if-done</span> t
      <span style="color: #DFDFDF;">org-agenda-include-deadlines</span> t
      <span style="color: #DFDFDF;">org-agenda-block-separator</span> nil
      <span style="color: #DFDFDF;">org-agenda-tags-column</span> <span style="color: #e69055; font-weight: bold;">100</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">from testing this seems to be a good value</span>
      <span style="color: #DFDFDF;">org-agenda-compact-blocks</span> t<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-agenda-custom-commands</span>
      <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"o"</span> <span style="color: #7bc275;">"Overview"</span>
         <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>agenda <span style="color: #7bc275;">""</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #DFDFDF;">org-agenda-span</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">day</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">org-super-agenda-groups</span>
                       <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Today"</span>
                                <span style="color: #C57BDB;">:time-grid</span> t
                                <span style="color: #C57BDB;">:date</span> today
                                <span style="color: #C57BDB;">:todo</span> <span style="color: #7bc275;">"TODAY"</span>
                                <span style="color: #C57BDB;">:scheduled</span> today
                                <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>alltodo <span style="color: #7bc275;">""</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #DFDFDF;">org-agenda-overriding-header</span> <span style="color: #7bc275;">""</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">org-super-agenda-groups</span>
                        <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Next to do"</span>
                                 <span style="color: #C57BDB;">:todo</span> <span style="color: #7bc275;">"NEXT"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Important"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Important"</span>
                                 <span style="color: #C57BDB;">:priority</span> <span style="color: #7bc275;">"A"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">6</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Due Today"</span>
                                 <span style="color: #C57BDB;">:deadline</span> today
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Due Soon"</span>
                                 <span style="color: #C57BDB;">:deadline</span> future
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">8</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Overdue"</span>
                                 <span style="color: #C57BDB;">:deadline</span> past
                                 <span style="color: #C57BDB;">:face</span> error
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">7</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Assignments"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Assignment"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">10</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Issues"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Issue"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">12</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Emacs"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Emacs"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">13</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Projects"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Project"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">14</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Research"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Research"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">15</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"To read"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"Read"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">30</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Waiting"</span>
                                 <span style="color: #C57BDB;">:todo</span> <span style="color: #7bc275;">"WAITING"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">20</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"University"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #7bc275;">"uni"</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">32</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"Trivial"</span>
                                 <span style="color: #C57BDB;">:priority&lt;=</span> <span style="color: #7bc275;">"E"</span>
                                 <span style="color: #C57BDB;">:tag</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"Trivial"</span> <span style="color: #7bc275;">"Unimportant"</span><span style="color: #51afef;">)</span>
                                 <span style="color: #C57BDB;">:todo</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"SOMEDAY"</span> <span style="color: #51afef;">)</span>
                                 <span style="color: #C57BDB;">:order</span> <span style="color: #e69055; font-weight: bold;">90</span><span style="color: #7bc275;">)</span>
                          <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:discard</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:tag</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Chore"</span> <span style="color: #7bc275;">"Routine"</span> <span style="color: #7bc275;">"Daily"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-capture" class="outline-5">
<h5 id="capture"> <a class="anchor" aria-hidden="true" href="#capture">🔗</a> <a class="anchor" aria-hidden="true" href="#capture">🔗</a> <a class="anchor" aria-hidden="true" href="#capture">🔗</a> <a class="anchor" aria-hidden="true" href="#capture">🔗</a><span class="section-number-5">5.2.2.4</span> Capture</h5>
<div class="outline-text-5" id="text-5-2-2-4">
<p>
Let&rsquo;s setup some org-capture templates
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> doct
  <span style="color: #C57BDB;">:commands</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">doct</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org-capture
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">org-capture-select-template-prettier</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> keys<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Select a capture template, in a prettier way than default</span>
<span style="color: #7e7e87;">  Lisp programs can force the template by setting KEYS to a string."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">org-capture-templates</span>
           <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-contextualize-keys</span>
                <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-capture-upgrade-templates</span> <span style="color: #DFDFDF;">org-capture-templates</span><span style="color: #C57BDB;">)</span>
                <span style="color: #DFDFDF;">org-capture-templates-contexts</span><span style="color: #51afef;">)</span>
               <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"t"</span> <span style="color: #7bc275;">"Task"</span> entry <span style="color: #7bc275;">(</span>file+headline <span style="color: #7bc275;">""</span> <span style="color: #7bc275;">"Tasks"</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> %?\n  %u\n  %a"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> keys
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> keys <span style="color: #DFDFDF;">org-capture-templates</span><span style="color: #7bc275;">)</span>
              <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">error</span> <span style="color: #7bc275;">"No capture template referred to by \"%s\" keys"</span> keys<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-mks</span> <span style="color: #DFDFDF;">org-capture-templates</span>
                 <span style="color: #7bc275;">"Select a capture template\n&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>
                 <span style="color: #7bc275;">"Template key: "</span>
                 <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"q"</span> ,<span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">all-the-icons-octicon</span> <span style="color: #7bc275;">"stop"</span> <span style="color: #C57BDB;">:face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-red</span> <span style="color: #C57BDB;">:v-adjust</span> <span style="color: #e69055; font-weight: bold;">0.01</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"\tAbort"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-capture-select-template</span> <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-capture-select-template-prettier</span><span style="color: #C57BDB;">)</span>
  
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">org-mks-pretty</span> <span style="color: #7bc275;">(</span>table title <span style="color: #FCCE7B;">&amp;optional</span> prompt specials<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Select a member of an alist with multiple keys. Prettified.</span>
<span style="color: #7e7e87;">  </span>
<span style="color: #7e7e87;">  TABLE is the alist which should contain entries where the car is a string.</span>
<span style="color: #7e7e87;">  There should be two types of entries.</span>
<span style="color: #7e7e87;">  </span>
<span style="color: #7e7e87;">  1. prefix descriptions like (\"a\" \"Description\")</span>
<span style="color: #7e7e87;">     This indicates that `a' is a prefix key for multi-letter selection, and</span>
<span style="color: #7e7e87;">     that there are entries following with keys like \"ab\", \"ax\"&#8230;</span>
<span style="color: #7e7e87;">  </span>
<span style="color: #7e7e87;">  2. Select-able members must have more than two elements, with the first</span>
<span style="color: #7e7e87;">     being the string of keys that lead to selecting it, and the second a</span>
<span style="color: #7e7e87;">     short description string of the item.</span>
<span style="color: #7e7e87;">  </span>
<span style="color: #7e7e87;">  The command will then make a temporary buffer listing all entries</span>
<span style="color: #7e7e87;">  that can be selected with a single key, and all the single key</span>
<span style="color: #7e7e87;">  prefixes.  When you press the key for a single-letter entry, it is selected.</span>
<span style="color: #7e7e87;">  When you press a prefix key, the commands (and maybe further prefixes)</span>
<span style="color: #7e7e87;">  under this key will be shown and offered for selection.</span>
<span style="color: #7e7e87;">  </span>
<span style="color: #7e7e87;">  TITLE will be placed over the selection in the temporary buffer,</span>
<span style="color: #7e7e87;">  PROMPT will be used when prompting for a key.  SPECIALS is an</span>
<span style="color: #7e7e87;">  alist with (\"key\" \"description\") entries.  When one of these</span>
<span style="color: #7e7e87;">  is selected, only the bare key is returned."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">save-window-excursion</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">inhibit-quit</span> t<span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span>buffer <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-switch-to-buffer-other-window</span> <span style="color: #7bc275;">"*Org Select*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span>prompt <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> prompt <span style="color: #7bc275;">"Select: "</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #DFDFDF;">case-fold-search</span>
      current<span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unwind-protect</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">catch</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">exit</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">while</span> t
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #DFDFDF;">evil-normal-state-cursor</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">list</span> nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">erase-buffer</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> title <span style="color: #7bc275;">"\n\n"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>des-keys nil<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>allowed-keys <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\C-g"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>tab-alternatives <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\s"</span> <span style="color: #7bc275;">"\t"</span> <span style="color: #7bc275;">"\r"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">cursor-type</span> nil<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">Populate allowed keys and descriptions keys</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">available with CURRENT selector.</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>re <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\`%s</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">.</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">\\'"</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> current <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">regexp-quote</span> current<span style="color: #C57BDB;">)</span> <span style="color: #7bc275;">""</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>prefix <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> current <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> current <span style="color: #7bc275;">" "</span><span style="color: #51afef;">)</span> <span style="color: #7bc275;">""</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #C57BDB;">(</span>entry table<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">pcase</span> entry
            <span style="color: #62686E;">;; </span><span style="color: #62686E;">Description.</span>
            <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #51afef;">(</span>,<span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> key <span style="color: #7bc275;">(</span>pred <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-match</span> re<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> ,desc<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>k <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> key<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> k des-keys<span style="color: #C57BDB;">)</span>
         <span style="color: #62686E;">;; </span><span style="color: #62686E;">Keys ending in tab, space or RET are equivalent.</span>
         <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">member</span> k tab-alternatives<span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span><span style="color: #51afef;">push</span> <span style="color: #7bc275;">"\t"</span> allowed-keys<span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span><span style="color: #51afef;">push</span> k allowed-keys<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> prefix <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> k <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bold</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#8250;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"  "</span> desc <span style="color: #7bc275;">"&#8230;"</span> <span style="color: #7bc275;">"\n"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
            <span style="color: #62686E;">;; </span><span style="color: #62686E;">Usable entry.</span>
            <span style="color: #7bc275;">(</span><span style="color: #C57BDB;">`</span><span style="color: #51afef;">(</span>,<span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> key <span style="color: #7bc275;">(</span>pred <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-match</span> re<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> ,desc . ,_<span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>k <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> key<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> prefix <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> k <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bold</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"   "</span> desc <span style="color: #7bc275;">"\n"</span><span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> k allowed-keys<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
            <span style="color: #7bc275;">(</span>_ nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">Insert special entries, if any.</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> specials
        <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">pcase-dolist</span> <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>,key ,description<span style="color: #7bc275;">)</span> specials<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s   %s\n"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> key <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>bold all-the-icons-red<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> description<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> key allowed-keys<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">Display UI and let user select an entry or</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">a sub-level prefix.</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">pos-visible-in-window-p</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-fit-window-to-buffer</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>pressed <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org--mks-read-key</span> allowed-keys prompt<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> current <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> current pressed<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
         <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> pressed <span style="color: #7bc275;">"\C-g"</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">user-error</span> <span style="color: #7bc275;">"Abort"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #62686E;">;; </span><span style="color: #62686E;">Selection is a prefix: open a new menu.</span>
         <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">member</span> pressed des-keys<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #62686E;">;; </span><span style="color: #62686E;">Selection matches an association: return it.</span>
         <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>entry <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> current table<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> entry <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">throw</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">exit</span> entry<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #62686E;">;; </span><span style="color: #62686E;">Selection matches a special entry: return the</span>
         <span style="color: #62686E;">;; </span><span style="color: #62686E;">selection prefix.</span>
         <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> current specials<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">throw</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">exit</span> current<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span>t <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">error</span> <span style="color: #7bc275;">"No entry available"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> buffer <span style="color: #51afef;">(</span><span style="color: #a991f1;">kill-buffer</span> buffer<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-mks</span> <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-mks-pretty</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> +org-capture-uni-units <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">split-string</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">f-read-text</span> <span style="color: #7bc275;">"~/.org/.uni-units"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> +org-capture-recipies  <span style="color: #7bc275;">"~/Desktop/TEC/Organisation/recipies.org"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+doct-icon-declaration-to-icon</span> <span style="color: #7bc275;">(</span>declaration<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Convert :icon declaration to icon"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>name <span style="color: #7bc275;">(</span><span style="color: #51afef;">pop</span> declaration<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">set</span>  <span style="color: #7bc275;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"all-the-icons-"</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> declaration <span style="color: #C57BDB;">:set</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>face <span style="color: #7bc275;">(</span><span style="color: #a991f1;">intern</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"all-the-icons-"</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> declaration <span style="color: #C57BDB;">:color</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>v-adjust <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> declaration <span style="color: #C57BDB;">:v-adjust</span><span style="color: #51afef;">)</span> <span style="color: #e69055; font-weight: bold;">0.01</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">apply</span> set <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>,name <span style="color: #C57BDB;">:face</span> ,face <span style="color: #C57BDB;">:v-adjust</span> ,v-adjust<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+doct-iconify-capture-templates</span> <span style="color: #7bc275;">(</span>groups<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Add declaration's :icon to each template group in GROUPS."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>templates <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doct-flatten-lists-in</span> groups<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> doct-templates <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>template<span style="color: #51afef;">)</span>
                                     <span style="color: #51afef;">(</span><span style="color: #51afef;">when-let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>props <span style="color: #51afef;">(</span><span style="color: #a991f1;">nthcdr</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> template<span style="color: #51afef;">)</span> <span style="color: #e69055; font-weight: bold;">4</span><span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #e69055; font-weight: bold;">5</span><span style="color: #C57BDB;">)</span> template<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                                                 <span style="color: #7bc275;">(</span>spec <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> props <span style="color: #C57BDB;">:doct</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">:icon</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                       <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setf</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> template<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+doct-icon-declaration-to-icon</span> spec<span style="color: #51afef;">)</span>
                                                                      <span style="color: #7bc275;">"\t"</span>
                                                                      <span style="color: #51afef;">(</span><span style="color: #a991f1;">nth</span> <span style="color: #e69055; font-weight: bold;">1</span> template<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                     template<span style="color: #7bc275;">)</span>
                                   templates<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> doct-after-conversion-functions <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>+doct-iconify-capture-templates<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">add-transient-hook!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-capture-select-template</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-capture-templates</span>
          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doct</span> <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Personal todo"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"t"</span>
                   <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"checklist"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"green"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #DFDFDF;">+org-capture-todo-file</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Inbox"</span>
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> %?"</span>
                              <span style="color: #7bc275;">"%i %a"</span><span style="color: #51afef;">)</span>
                   <span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Personal note"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"n"</span>
                   <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"sticky-note-o"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"green"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #DFDFDF;">+org-capture-todo-file</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Inbox"</span>
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* %?"</span>
                              <span style="color: #7bc275;">"%i %a"</span><span style="color: #51afef;">)</span>
                   <span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"University"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"u"</span>
                   <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"graduation-cap"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"purple"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #DFDFDF;">+org-capture-todo-file</span>
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"University"</span>
                   <span style="color: #C57BDB;">:unit-prompt</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%%^{Unit|%s}"</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-join</span> +org-capture-uni-units <span style="color: #7bc275;">"|"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:children</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Test"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"t"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"timer"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"material"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"red"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:template</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> [#C] %{unit-prompt} %? :uni:tests:"</span>
                                          <span style="color: #7bc275;">"SCHEDULED: %^{Test date:}T"</span>
                                          <span style="color: #7bc275;">"%i %a"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Assignment"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"a"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"library_books"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"material"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"orange"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:template</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> [#B] %{unit-prompt} %? :uni:assignments:"</span>
                                          <span style="color: #7bc275;">"DEADLINE: %^{Due date:}T"</span>
                                          <span style="color: #7bc275;">"%i %a"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Lecture"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"l"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"keynote"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"fileicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"orange"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:template</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> [#C] %{unit-prompt} %? :uni:lecture:"</span>
                                          <span style="color: #7bc275;">"%i %a"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Miscellaneous task"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"u"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"list"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"yellow"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:template</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> [#D] %{unit-prompt} %? :uni:"</span>
                                          <span style="color: #7bc275;">"%i %a"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Email"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"e"</span>
                   <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"envelope"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"blue"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #DFDFDF;">+org-capture-todo-file</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Inbox"</span>
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> %^{type|reply to|contact} %\\3 %? :email:"</span>
                              <span style="color: #7bc275;">"Send an email %^{urgancy|soon|ASAP|anon|at some point|eventually} to %^{recipiant}"</span>
                              <span style="color: #7bc275;">"about %^{topic}"</span>
                              <span style="color: #7bc275;">"%U %i %a"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Interesting"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"i"</span>
                   <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"eye"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"lcyan"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #DFDFDF;">+org-capture-todo-file</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Interesting"</span>
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* [ ] %{desc}%? :%{i-type}:"</span>
                              <span style="color: #7bc275;">"%i %a"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:children</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Webpage"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"w"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"globe"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"green"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">"%(org-cliplink-capture) "</span>
                               <span style="color: #C57BDB;">:i-type</span> <span style="color: #7bc275;">"read:web"</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Article"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"a"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"file-text"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"yellow"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">""</span>
                               <span style="color: #C57BDB;">:i-type</span> <span style="color: #7bc275;">"read:reaserch"</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\tRecipie"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"r"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"spoon"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"dorange"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-recipies
                               <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Unsorted"</span>
                               <span style="color: #C57BDB;">:template</span> <span style="color: #7bc275;">"%(org-chef-get-recipe-from-url)"</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Information"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"i"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"info-circle"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"blue"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">""</span>
                               <span style="color: #C57BDB;">:i-type</span> <span style="color: #7bc275;">"read:info"</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Idea"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"I"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"bubble_chart"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"material"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"silver"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">""</span>
                               <span style="color: #C57BDB;">:i-type</span> <span style="color: #7bc275;">"idea"</span>
                               <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Tasks"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"k"</span>
                   <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"inbox"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"yellow"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #DFDFDF;">+org-capture-todo-file</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Tasks"</span>
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> %? %^G%{extra}"</span>
                              <span style="color: #7bc275;">"%i %a"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:children</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"General Task"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"k"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"inbox"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"yellow"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:extra</span> <span style="color: #7bc275;">""</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Task with deadline"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"d"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"timer"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"material"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"orange"</span> <span style="color: #C57BDB;">:v-adjust</span> <span style="color: #e69055; font-weight: bold;">-0.1</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:extra</span> <span style="color: #7bc275;">"\nDEADLINE: %^{Deadline:}t"</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Scheduled Task"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"s"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"calendar"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"orange"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:extra</span> <span style="color: #7bc275;">"\nSCHEDULED: %^{Start time:}t"</span>
                               <span style="color: #C57BDB;">)</span>
                              <span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Project"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"p"</span>
                 <span style="color: #C57BDB;">:icon</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"repo"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"silver"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:headline</span> <span style="color: #7bc275;">"Inbox"</span>
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* %{time-or-todo} %?"</span>
                              <span style="color: #7bc275;">"%i"</span>
                              <span style="color: #7bc275;">"%a"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:file</span> <span style="color: #7bc275;">""</span>
                   <span style="color: #C57BDB;">:custom</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">""</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:children</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Project-local todo"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"t"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"checklist"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"octicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"green"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">"</span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;">"</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-project-todo-file<span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Project-local note"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"n"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"sticky-note"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"yellow"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">"%U"</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-project-notes-file<span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Project-local changelog"</span> <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"c"</span>
                               <span style="color: #C57BDB;">:icon</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"list"</span> <span style="color: #C57BDB;">:set</span> <span style="color: #7bc275;">"faicon"</span> <span style="color: #C57BDB;">:color</span> <span style="color: #7bc275;">"blue"</span><span style="color: #7bc275;">)</span>
                               <span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">"%U"</span>
                               <span style="color: #C57BDB;">:heading</span> <span style="color: #7bc275;">"Unreleased"</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-project-changelog-file<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                   <span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"\tCentralised project templates"</span>
                   <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"o"</span>
                   <span style="color: #C57BDB;">:type</span> entry
                   <span style="color: #C57BDB;">:prepend</span> t
                   <span style="color: #C57BDB;">:template</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"* %{time-or-todo} %?"</span>
                              <span style="color: #7bc275;">"%i"</span>
                              <span style="color: #7bc275;">"%a"</span><span style="color: #51afef;">)</span>
                   <span style="color: #C57BDB;">:children</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Project todo"</span>
                               <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"t"</span>
                               <span style="color: #C57BDB;">:prepend</span> nil
                               <span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">"</span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;">"</span>
                               <span style="color: #C57BDB;">:heading</span> <span style="color: #7bc275;">"Tasks"</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-central-project-todo-file<span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Project note"</span>
                               <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"n"</span>
                               <span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">"%U"</span>
                               <span style="color: #C57BDB;">:heading</span> <span style="color: #7bc275;">"Notes"</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-central-project-notes-file<span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"Project changelog"</span>
                               <span style="color: #C57BDB;">:keys</span> <span style="color: #7bc275;">"c"</span>
                               <span style="color: #C57BDB;">:time-or-todo</span> <span style="color: #7bc275;">"%U"</span>
                               <span style="color: #C57BDB;">:heading</span> <span style="color: #7bc275;">"Unreleased"</span>
                               <span style="color: #C57BDB;">:file</span> +org-capture-central-project-changelog-file<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                   <span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
It would also be nice to improve how the capture dialogue looks
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1b68b1a"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">org-capture-select-template-prettier</span> <span style="color: #C57BDB;">(</span><span style="color: #FCCE7B;">&amp;optional</span> keys<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Select a capture template, in a prettier way than default</span>
<span style="color: #7e7e87;">Lisp programs can force the template by setting KEYS to a string."</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #DFDFDF;">org-capture-templates</span>
         <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-contextualize-keys</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-capture-upgrade-templates</span> <span style="color: #DFDFDF;">org-capture-templates</span><span style="color: #51afef;">)</span>
              <span style="color: #DFDFDF;">org-capture-templates-contexts</span><span style="color: #7bc275;">)</span>
             <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"t"</span> <span style="color: #7bc275;">"Task"</span> entry <span style="color: #C57BDB;">(</span>file+headline <span style="color: #7bc275;">""</span> <span style="color: #7bc275;">"Tasks"</span><span style="color: #C57BDB;">)</span>
                <span style="color: #7bc275;">"* </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #7bc275;"> %?\n  %u\n  %a"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> keys
        <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assoc</span> keys <span style="color: #DFDFDF;">org-capture-templates</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">error</span> <span style="color: #7bc275;">"No capture template referred to by \"%s\" keys"</span> keys<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-mks</span> <span style="color: #DFDFDF;">org-capture-templates</span>
               <span style="color: #7bc275;">"Select a capture template\n&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>
               <span style="color: #7bc275;">"Template key: "</span>
               <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"q"</span> ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">all-the-icons-octicon</span> <span style="color: #7bc275;">"stop"</span> <span style="color: #C57BDB;">:face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-red</span> <span style="color: #C57BDB;">:v-adjust</span> <span style="color: #e69055; font-weight: bold;">0.01</span><span style="color: #C57BDB;">)</span> <span style="color: #7bc275;">"\tAbort"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-capture-select-template</span> <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-capture-select-template-prettier</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">org-mks-pretty</span> <span style="color: #C57BDB;">(</span>table title <span style="color: #FCCE7B;">&amp;optional</span> prompt specials<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Select a member of an alist with multiple keys. Prettified.</span>

<span style="color: #7e7e87;">TABLE is the alist which should contain entries where the car is a string.</span>
<span style="color: #7e7e87;">There should be two types of entries.</span>

<span style="color: #7e7e87;">1. prefix descriptions like (\"a\" \"Description\")</span>
<span style="color: #7e7e87;">   This indicates that `a' is a prefix key for multi-letter selection, and</span>
<span style="color: #7e7e87;">   that there are entries following with keys like \"ab\", \"ax\"&#8230;</span>

<span style="color: #7e7e87;">2. Select-able members must have more than two elements, with the first</span>
<span style="color: #7e7e87;">   being the string of keys that lead to selecting it, and the second a</span>
<span style="color: #7e7e87;">   short description string of the item.</span>

<span style="color: #7e7e87;">The command will then make a temporary buffer listing all entries</span>
<span style="color: #7e7e87;">that can be selected with a single key, and all the single key</span>
<span style="color: #7e7e87;">prefixes.  When you press the key for a single-letter entry, it is selected.</span>
<span style="color: #7e7e87;">When you press a prefix key, the commands (and maybe further prefixes)</span>
<span style="color: #7e7e87;">under this key will be shown and offered for selection.</span>

<span style="color: #7e7e87;">TITLE will be placed over the selection in the temporary buffer,</span>
<span style="color: #7e7e87;">PROMPT will be used when prompting for a key.  SPECIALS is an</span>
<span style="color: #7e7e87;">alist with (\"key\" \"description\") entries.  When one of these</span>
<span style="color: #7e7e87;">is selected, only the bare key is returned."</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">save-window-excursion</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">inhibit-quit</span> t<span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span>buffer <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-switch-to-buffer-other-window</span> <span style="color: #7bc275;">"*Org Select*"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span>prompt <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> prompt <span style="color: #7bc275;">"Select: "</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #DFDFDF;">case-fold-search</span>
    current<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">unwind-protect</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">catch</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">exit</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">while</span> t
        <span style="color: #51afef;">(</span><span style="color: #51afef;">setq-local</span> <span style="color: #DFDFDF;">evil-normal-state-cursor</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">list</span> nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a991f1;">erase-buffer</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> title <span style="color: #7bc275;">"\n\n"</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>des-keys nil<span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>allowed-keys <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"\C-g"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>tab-alternatives <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"\s"</span> <span style="color: #7bc275;">"\t"</span> <span style="color: #7bc275;">"\r"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">cursor-type</span> nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Populate allowed keys and descriptions keys</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">available with CURRENT selector.</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>re <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\`%s</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">.</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">\\'"</span>
          <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> current <span style="color: #51afef;">(</span><span style="color: #a991f1;">regexp-quote</span> current<span style="color: #51afef;">)</span> <span style="color: #7bc275;">""</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>prefix <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> current <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> current <span style="color: #7bc275;">" "</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">""</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #51afef;">(</span>entry table<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">pcase</span> entry
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">Description.</span>
          <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> key <span style="color: #C57BDB;">(</span>pred <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-match</span> re<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> ,desc<span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>k <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> key<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">push</span> k des-keys<span style="color: #51afef;">)</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">Keys ending in tab, space or RET are equivalent.</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">member</span> k tab-alternatives<span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> <span style="color: #7bc275;">"\t"</span> allowed-keys<span style="color: #C57BDB;">)</span>
         <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> k allowed-keys<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> prefix <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> k <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bold</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#8250;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #C57BDB;">)</span> <span style="color: #7bc275;">"  "</span> desc <span style="color: #7bc275;">"&#8230;"</span> <span style="color: #7bc275;">"\n"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">Usable entry.</span>
          <span style="color: #C57BDB;">(</span><span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> key <span style="color: #C57BDB;">(</span>pred <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-match</span> re<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> ,desc . ,_<span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>k <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> key<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> prefix <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-comment-face</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">propertize</span> k <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bold</span><span style="color: #C57BDB;">)</span> <span style="color: #7bc275;">"   "</span> desc <span style="color: #7bc275;">"\n"</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">push</span> k allowed-keys<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>_ nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Insert special entries, if any.</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> specials
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;\n"</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">pcase-dolist</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span>,key ,description<span style="color: #C57BDB;">)</span> specials<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s   %s\n"</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">propertize</span> key <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span>bold all-the-icons-red<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span> description<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">push</span> key allowed-keys<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Display UI and let user select an entry or</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">a sub-level prefix.</span>
    <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">unless</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">pos-visible-in-window-p</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point-max</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-fit-window-to-buffer</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>pressed <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org--mks-read-key</span> allowed-keys prompt<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> current <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> current pressed<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">cond</span>
       <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> pressed <span style="color: #7bc275;">"\C-g"</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">user-error</span> <span style="color: #7bc275;">"Abort"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">Selection is a prefix: open a new menu.</span>
       <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #a991f1;">member</span> pressed des-keys<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">Selection matches an association: return it.</span>
       <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>entry <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assoc</span> current table<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> entry <span style="color: #51afef;">(</span><span style="color: #a991f1;">throw</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">exit</span> entry<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">Selection matches a special entry: return the</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">selection prefix.</span>
       <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assoc</span> current specials<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">throw</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">exit</span> current<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span>t <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">error</span> <span style="color: #7bc275;">"No entry available"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> buffer <span style="color: #7bc275;">(</span><span style="color: #a991f1;">kill-buffer</span> buffer<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-mks</span> <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-mks-pretty</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
The <a href="file:///home/tec/.emacs.d/bin/org-capture">org-capture bin</a> is rather nice, but I&rsquo;d be nicer with a smaller frame, and
no modeline.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setf</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">alist-get</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">height</span> <span style="color: #DFDFDF;">+org-capture-frame-parameters</span><span style="color: #C57BDB;">)</span> <span style="color: #e69055; font-weight: bold;">15</span><span style="color: #51afef;">)</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">(alist-get 'name +org-capture-frame-parameters) "&#10070; Capture") ;; ATM hardcoded in other places, so changing breaks stuff</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">+org-capture-fn</span>
      <span style="color: #C57BDB;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #7bc275;">()</span>
        <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #a991f1;">set-window-parameter</span> nil <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">mode-line-format</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">none</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-capture</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-roam" class="outline-5">
<h5 id="roam"> <a class="anchor" aria-hidden="true" href="#roam">🔗</a> <a class="anchor" aria-hidden="true" href="#roam">🔗</a> <a class="anchor" aria-hidden="true" href="#roam">🔗</a> <a class="anchor" aria-hidden="true" href="#roam">🔗</a><span class="section-number-5">5.2.2.5</span> Roam</h5>
<div class="outline-text-5" id="text-5-2-2-5">
</div>
<div id="outline-container-basic-settings" class="outline-6">
<h6 id="basic-settings"> <a class="anchor" aria-hidden="true" href="#basic-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#basic-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#basic-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#basic-settings">🔗</a> <a class="anchor" aria-hidden="true" href="#basic-settings">🔗</a><span class="section-number-6">5.2.2.5.1</span> Basic settings</h6>
<div class="outline-text-6" id="text-5-2-2-5-1">
<p>
I&rsquo;ll just set this to be within <kbd>Organisation</kbd> folder for now, in the future it
could be worth seeing if I could hook this up to a <a href="https://nextcloud.com/">Nextcloud</a> instance.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-roam-directory</span> <span style="color: #7bc275;">"~/Desktop/TEC/Organisation/Roam/"</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-registering-roam-protocol" class="outline-6">
<h6 id="registering-roam-protocol"> <a class="anchor" aria-hidden="true" href="#registering-roam-protocol">🔗</a> <a class="anchor" aria-hidden="true" href="#registering-roam-protocol">🔗</a> <a class="anchor" aria-hidden="true" href="#registering-roam-protocol">🔗</a> <a class="anchor" aria-hidden="true" href="#registering-roam-protocol">🔗</a> <a class="anchor" aria-hidden="true" href="#registering-roam-protocol">🔗</a><span class="section-number-6">5.2.2.5.2</span> Registering roam protocol</h6>
<div class="outline-text-6" id="text-5-2-2-5-2">
<p>
The recommended method of registering a protocol is by registering a desktop
application, which seems reasonable.
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #FCCE7B;">Desktop Entry</span>]
<span style="color: #DFDFDF;">Name</span>=Org-Protocol
<span style="color: #DFDFDF;">Exec</span>=emacsclient %u
<span style="color: #DFDFDF;">Icon</span>=emacs-icon
<span style="color: #DFDFDF;">Type</span>=Application
<span style="color: #DFDFDF;">Terminal</span>=false
<span style="color: #DFDFDF;">MimeType</span>=x-scheme-handler/org-protocol
</pre>
</div>
<p>
To associate <code>org-protocol://</code> links with the desktop file,
</p>
<div class="org-src-container">
<pre class="src src-shell">xdg-mime default org-protocol.desktop x-scheme-handler/org-protocol
</pre>
</div>
</div>
</div>
<div id="outline-container-graph-behaviour" class="outline-6">
<h6 id="graph-behaviour"> <a class="anchor" aria-hidden="true" href="#graph-behaviour">🔗</a> <a class="anchor" aria-hidden="true" href="#graph-behaviour">🔗</a> <a class="anchor" aria-hidden="true" href="#graph-behaviour">🔗</a> <a class="anchor" aria-hidden="true" href="#graph-behaviour">🔗</a> <a class="anchor" aria-hidden="true" href="#graph-behaviour">🔗</a><span class="section-number-6">5.2.2.5.3</span> Graph Behaviour</h6>
<div class="outline-text-6" id="text-5-2-2-5-3">
<p>
By default, clicking on an <code>org-protocol://</code> link messes with the <kbd>svg</kbd> view. To fix
this we can use an <code>iframe</code>, however that requires shifting to an <kbd>html</kbd> file.
Hence, we need to do a bit of overriding.
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #7bc275;">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color: #5cEfFF;">html</span>&gt;
    &lt;<span style="color: #5cEfFF;">head</span>&gt;
        &lt;<span style="color: #5cEfFF;">meta</span> <span style="color: #DFDFDF;">charset</span>=<span style="color: #7bc275;">"utf-8"</span>&gt;
        &lt;<span style="color: #5cEfFF;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Roam Graph</span>&lt;/<span style="color: #5cEfFF;">title</span>&gt;
        &lt;<span style="color: #5cEfFF;">meta</span> <span style="color: #DFDFDF;">name</span>=<span style="color: #7bc275;">"viewport"</span> <span style="color: #DFDFDF;">content</span>=<span style="color: #7bc275;">"width=device-width"</span>&gt;
        &lt;<span style="color: #5cEfFF;">style</span> <span style="color: #DFDFDF;">type</span>=<span style="color: #7bc275;">"text/css"</span>&gt;
         svg {
             position: relative;
             top: 50vh;
             left: 50vw;
             transform: translate(-50%, -50%);
         }

         a &gt; polygon {
             transition-duration: 200ms;
             transition-property: fill;
         }

         a &gt; polyline {
             transition-duration: 400ms;
             transition-property: stroke;
         }

         a:hover &gt; polygon {
             fill: #d4d4d4;
         }
         a:hover &gt; polyline {
             stroke: #888;
         }
        &lt;/<span style="color: #5cEfFF;">style</span>&gt;
        &lt;<span style="color: #5cEfFF;">script</span> <span style="color: #DFDFDF;">type</span>=<span style="color: #7bc275;">"text/javascript"</span>&gt;
         function create_iframe (url) {
             i = document.createElement(<span style="color: #7bc275;">'iframe'</span>);
             i.setAttribute(<span style="color: #7bc275;">'src'</span>, url);
             i.style.setProperty(<span style="color: #7bc275;">'display'</span>, <span style="color: #7bc275;">'none'</span>);
             document.body.append(i);
         }
         function listen_on_all_a () {
             document.querySelectorAll(<span style="color: #7bc275;">"svg a"</span>).forEach(elem =&gt; {
                 elem.addEventListener(<span style="color: #7bc275;">'click'</span>, (e) =&gt; {
                     e.preventDefault();
                     create_iframe(elem.href.baseVal);
                 });
             });
         }
        &lt;/<span style="color: #5cEfFF;">script</span>&gt;
    &lt;/<span style="color: #5cEfFF;">head</span>&gt;
    &lt;<span style="color: #5cEfFF;">body</span> <span style="color: #DFDFDF;">onload</span>=<span style="color: #7bc275;">"listen_on_all_a()"</span>&gt;
<span style="color: #DFDFDF;">%s</span>
    &lt;/<span style="color: #5cEfFF;">body</span>&gt;
&lt;/<span style="color: #5cEfFF;">html</span>&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org-roam
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> +org-roam-graph--html-template <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"%</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">s]</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">"</span> <span style="color: #7bc275;">"%%\\1"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">f-read-text</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #DFDFDF;">doom-private-dir</span> <span style="color: #7bc275;">"misc/org-roam-template.html"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> +org-roam-graph--build-html <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> node-query<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Generate a graph showing the relations between nodes in NODE-QUERY. HTML style."</span>
    <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-roam-graph--build</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> <span style="color: #DFDFDF;">org-roam-graph-executable</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">user-error</span> <span style="color: #7bc275;">"Can't find %s executable.  Please check if it is in your path"</span>
                  <span style="color: #DFDFDF;">org-roam-graph-executable</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>node-query <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> node-query
                           <span style="color: #C57BDB;">`</span><span style="color: #51afef;">[</span><span style="color: #C57BDB;">:select</span> <span style="color: #C57BDB;">[</span>file titles<span style="color: #C57BDB;">]</span>
                                     <span style="color: #C57BDB;">:from</span> titles
                                     ,@<span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-roam-graph--expand-matcher</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">file</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">]</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>graph      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-roam-graph--dot</span> node-query<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>temp-dot   <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">make-temp-file</span> <span style="color: #7bc275;">"graph."</span> nil <span style="color: #7bc275;">".dot"</span> graph<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>temp-graph <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">make-temp-file</span> <span style="color: #7bc275;">"graph."</span> nil <span style="color: #7bc275;">".svg"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>temp-html  <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">make-temp-file</span> <span style="color: #7bc275;">"graph."</span> nil <span style="color: #7bc275;">".html"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">call-process</span> <span style="color: #DFDFDF;">org-roam-graph-executable</span> nil <span style="color: #e69055; font-weight: bold;">0</span> nil
                    temp-dot <span style="color: #7bc275;">"-Tsvg"</span> <span style="color: #7bc275;">"-o"</span> temp-graph<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">sleep-for</span> <span style="color: #e69055; font-weight: bold;">0.1</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">write-region</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> +org-roam-graph--html-template <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">f-read-text</span> temp-graph<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> nil temp-html<span style="color: #51afef;">)</span>
      temp-html<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-modeline-file-name" class="outline-6">
<h6 id="modeline-file-name"> <a class="anchor" aria-hidden="true" href="#modeline-file-name">🔗</a> <a class="anchor" aria-hidden="true" href="#modeline-file-name">🔗</a> <a class="anchor" aria-hidden="true" href="#modeline-file-name">🔗</a> <a class="anchor" aria-hidden="true" href="#modeline-file-name">🔗</a> <a class="anchor" aria-hidden="true" href="#modeline-file-name">🔗</a><span class="section-number-6">5.2.2.5.4</span> Modeline file name</h6>
<div class="outline-text-6" id="text-5-2-2-5-4">
<p>
All those numbers! It&rsquo;s messy. Let&rsquo;s adjust this in a similar way that I have in
the<a href="#window-title">Window title</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defadvice!</span> doom-modeline--reformat-roam <span style="color: #C57BDB;">(</span>orig-fun<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:around</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">doom-modeline-buffer-file-name</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Reformat?"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">buffer-file-name</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">s-contains-p</span> <span style="color: #DFDFDF;">org-roam-directory</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #DFDFDF;">buffer-file-name</span> <span style="color: #7bc275;">""</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span>
       <span style="color: #7bc275;">"</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(?:</span><span style="color: #7bc275;">^</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">|</span><span style="color: #7bc275;">.*/</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[0-9]\\{4\\}</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[0-9]\\{2\\}</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[0-9]\\{2\\}</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">[0-9]*-"</span>
       <span style="color: #7bc275;">"&#129172;(\\1-\\2-\\3) "</span>
       <span style="color: #51afef;">(</span><span style="color: #a991f1;">funcall</span> orig-fun<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">funcall</span> orig-fun<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-nicer-generated-heading" class="outline-5">
<h5 id="nicer-generated-heading"> <a class="anchor" aria-hidden="true" href="#nicer-generated-heading">🔗</a> <a class="anchor" aria-hidden="true" href="#nicer-generated-heading">🔗</a> <a class="anchor" aria-hidden="true" href="#nicer-generated-heading">🔗</a> <a class="anchor" aria-hidden="true" href="#nicer-generated-heading">🔗</a><span class="section-number-5">5.2.2.6</span> Nicer generated heading IDs</h5>
<div class="outline-text-5" id="text-5-2-2-6">
<p>
Thanks to alphapapa&rsquo;s <a href="https://github.com/alphapapa/unpackaged.el#export-to-html-with-useful-anchors">unpackaged.el</a>.
By default, <code>url-hexify-string</code> seemed to cause me some issues. Replacing that in
<code>a53899</code> resolved this for me. To go one step further, I create a function for
producing nice short links, like an inferior version of <code>reftex-label</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">org-heading-contraction-max-words</span> <span style="color: #e69055; font-weight: bold;">3</span>
  <span style="color: #7e7e87;">"Maximum number of words in a heading"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">org-heading-contraction-max-length</span> <span style="color: #e69055; font-weight: bold;">35</span>
  <span style="color: #7e7e87;">"Maximum length of resulting string"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">org-heading-contraction-stripped-words</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"the"</span> <span style="color: #7bc275;">"on"</span> <span style="color: #7bc275;">"in"</span> <span style="color: #7bc275;">"off"</span> <span style="color: #7bc275;">"a"</span> <span style="color: #7bc275;">"for"</span> <span style="color: #7bc275;">"by"</span> <span style="color: #7bc275;">"of"</span> <span style="color: #7bc275;">"and"</span> <span style="color: #7bc275;">"is"</span> <span style="color: #7bc275;">"to"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Unnecesary words to be removed from a heading"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">org-heading-contraction</span> <span style="color: #C57BDB;">(</span>heading-string<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Get a contracted form of HEADING-STRING that is onlu contains alphanumeric charachters.</span>
<span style="color: #7e7e87;">Strips 'joining' words in `</span><span style="color: #a991f1;">org-heading-contraction-stripped-words</span><span style="color: #7e7e87;">',</span>
<span style="color: #7e7e87;">and then limits the result to the first `</span><span style="color: #a991f1;">org-heading-contraction-max-words</span><span style="color: #7e7e87;">' words.</span>
<span style="color: #7e7e87;">If the total length is &gt; `</span><span style="color: #a991f1;">org-heading-contraction-max-length</span><span style="color: #7e7e87;">' then individual words are</span>
<span style="color: #7e7e87;">truncated to fit within the limit"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>heading-words
         <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">-filter</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>word<span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">member</span> word <span style="color: #DFDFDF;">org-heading-contraction-stripped-words</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">split-string</span>
                   <span style="color: #51afef;">(</span><span style="color: #51afef;">-&gt;&gt;</span> heading-string
                        s-downcase
                        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"\\[\\[[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">]]+\\]\\[</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">]]+</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">\\]\\]"</span> <span style="color: #7bc275;">"\\1"</span><span style="color: #C57BDB;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">get description from org-link</span>
                        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"[-/ ]+"</span> <span style="color: #7bc275;">" "</span><span style="color: #C57BDB;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">replace seperator-type chars with space</span>
                        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">a-z0-9 ]"</span> <span style="color: #7bc275;">""</span><span style="color: #C57BDB;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">strip chars which need %-encoding in a uri</span>
                        <span style="color: #51afef;">)</span> <span style="color: #7bc275;">" "</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">&gt;</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">length</span> heading-words<span style="color: #C57BDB;">)</span>
             <span style="color: #DFDFDF;">org-heading-contraction-max-words</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> heading-words
            <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">subseq</span> heading-words <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #DFDFDF;">org-heading-contraction-max-words</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>

    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">&gt;</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">+</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">-sum</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">length</span> heading-words<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                <span style="color: #7bc275;">(</span><span style="color: #a991f1;">1-</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> heading-words<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
             <span style="color: #DFDFDF;">org-heading-contraction-max-length</span><span style="color: #51afef;">)</span>
      <span style="color: #62686E;">;; </span><span style="color: #62686E;">trucate each word to a max word length determined by</span>
      <span style="color: #62686E;">;;   </span><span style="color: #62686E;">max length = \floor{ \frac{total length - chars for seperators - \sum_{word \leq average length} length(word) }{num(words) &gt; average length} }</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> heading-words <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let*</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>total-length-budget <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">-</span> <span style="color: #DFDFDF;">org-heading-contraction-max-length</span>  <span style="color: #62686E;">; </span><span style="color: #62686E;">how many non-separator chars we can use</span>
                                                         <span style="color: #7bc275;">(</span><span style="color: #a991f1;">1-</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> heading-words<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">(</span>word-length-budget <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">/</span> total-length-budget                  <span style="color: #62686E;">; </span><span style="color: #62686E;">max length of each word to keep within budget</span>
                                                        <span style="color: #DFDFDF;">org-heading-contraction-max-words</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">(</span>num-overlong <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">-count</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>word<span style="color: #51afef;">)</span>                             <span style="color: #62686E;">; </span><span style="color: #62686E;">how many words exceed that budget</span>
                                                         <span style="color: #51afef;">(</span><span style="color: #a991f1;">&gt;</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">length</span> word<span style="color: #C57BDB;">)</span> word-length-budget<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                                                       heading-words<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">(</span>total-short-length <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">-sum</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span>                 <span style="color: #62686E;">; </span><span style="color: #62686E;">total length of words under that budget</span>
                                                                     <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&lt;=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> word<span style="color: #51afef;">)</span> word-length-budget<span style="color: #7bc275;">)</span>
                                                                         <span style="color: #7bc275;">(</span><span style="color: #a991f1;">length</span> word<span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                                                   heading-words<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">(</span>max-length <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">/</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> total-length-budget total-short-length<span style="color: #7bc275;">)</span>   <span style="color: #62686E;">; </span><span style="color: #62686E;">max(max-length) that we can have to fit within the budget</span>
                                                num-overlong<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                            <span style="color: #7bc275;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span>
                                      <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&lt;=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">length</span> word<span style="color: #51afef;">)</span> max-length<span style="color: #7bc275;">)</span>
                                          word
                                        <span style="color: #7bc275;">(</span><span style="color: #a991f1;">substring</span> word <span style="color: #e69055; font-weight: bold;">0</span> max-length<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                    heading-words<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-join</span> heading-words <span style="color: #7bc275;">"-"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Now here&rsquo;s alphapapa&rsquo;s subtley tweaked mode.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">define-minor-mode</span> <span style="color: #DFDFDF;">unpackaged/org-export-html-with-useful-ids-mode</span>
  <span style="color: #7e7e87;">"Attempt to export Org as HTML with useful link IDs.</span>
<span style="color: #7e7e87;">Instead of random IDs like \"#orga1b2c3\", use heading titles,</span>
<span style="color: #7e7e87;">made unique when necessary."</span>
  <span style="color: #C57BDB;">:global</span> t
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">unpackaged/org-export-html-with-useful-ids-mode</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-export-get-reference</span> <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">unpackaged/org-export-get-reference</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">advice-remove</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-export-get-reference</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">unpackaged/org-export-get-reference</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">unpackaged/org-export-get-reference</span> <span style="color: #C57BDB;">(</span>datum info<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Like `</span><span style="color: #a991f1;">org-export-get-reference</span><span style="color: #7e7e87;">', except uses heading titles instead of random numbers."</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>cache <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> info <span style="color: #C57BDB;">:internal-references</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">rassq</span> datum cache<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>crossrefs <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-get</span> info <span style="color: #C57BDB;">:crossrefs</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
               <span style="color: #7bc275;">(</span>cells <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-export-search-cells</span> datum<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">Preserve any pre-existing association between</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">a search cell and a reference, i.e., when some</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">previously published document referenced a location</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">within current file (see</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">`</span><span style="color: #a991f1;">org-publish-resolve-external-link</span><span style="color: #62686E;">').</span>
               <span style="color: #62686E;">;;</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">However, there is no guarantee that search cells are</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">unique, e.g., there might be duplicate custom ID or</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">two headings with the same title in the file.</span>
               <span style="color: #62686E;">;;</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">As a consequence, before re-using any reference to</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">an element or object, we check that it doesn't refer</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">to a previous element or object.</span>
               <span style="color: #7bc275;">(</span>new <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">cl-some</span>
                         <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>cell<span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>stored <span style="color: #51afef;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assoc</span> cell crossrefs<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                             <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> stored
                               <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>old <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-export-format-reference</span> stored<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                 <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">not</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> old cache<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> stored<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                         cells<span style="color: #C57BDB;">)</span>
                        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:raw-value</span> datum<span style="color: #7bc275;">)</span>
                          <span style="color: #62686E;">;; </span><span style="color: #62686E;">Heading with a title</span>
                          <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">unpackaged/org-export-new-title-reference</span> datum cache<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                        <span style="color: #62686E;">;; </span><span style="color: #7bc275; font-weight: bold;">NOTE:</span><span style="color: #62686E;"> This probably breaks some Org Export</span>
                        <span style="color: #62686E;">;; </span><span style="color: #62686E;">feature, but if it does what I need, fine.</span>
                        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-export-format-reference</span>
                         <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-export-new-reference</span> cache<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
               <span style="color: #7bc275;">(</span>reference-string new<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">Cache contains both data already associated to</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">a reference and in-use internal references, so as to make</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">unique references.</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">dolist</span> <span style="color: #7bc275;">(</span>cell cells<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">push</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">cons</span> cell new<span style="color: #51afef;">)</span> cache<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">Retain a direct association between reference string and</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">DATUM since (1) not every object or element can be given</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">a search cell (2) it permits quick lookup.</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">push</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> reference-string datum<span style="color: #7bc275;">)</span> cache<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-put</span> info <span style="color: #C57BDB;">:internal-references</span> cache<span style="color: #C57BDB;">)</span>
          reference-string<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">unpackaged/org-export-new-title-reference</span> <span style="color: #C57BDB;">(</span>datum cache<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Return new reference for DATUM that is unique in CACHE."</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">cl-macrolet</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>inc-suffixf <span style="color: #C57BDB;">(</span>place<span style="color: #C57BDB;">)</span>
                             <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #51afef;">progn</span>
                                <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">rx</span> bos
                                                  <span style="color: #C57BDB;">(</span>minimal-match <span style="color: #7bc275;">(</span>group <span style="color: #51afef;">(</span><span style="color: #a991f1;">1+</span> anything<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                                  <span style="color: #C57BDB;">(</span>optional <span style="color: #7bc275;">"--"</span> <span style="color: #7bc275;">(</span>group <span style="color: #51afef;">(</span><span style="color: #a991f1;">1+</span> digit<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                                  eos<span style="color: #51afef;">)</span>
                                              ,place<span style="color: #7bc275;">)</span>
                                <span style="color: #62686E;">;; </span><span style="color: #a991f1; font-weight: bold;">HACK:</span><span style="color: #62686E;"> `</span><span style="color: #a991f1;">s1</span><span style="color: #62686E;">' instead of a gensym.</span>
                                <span style="color: #7bc275;">(</span><span style="color: #51afef;">-let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>s1 suffix<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">list</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> ,place<span style="color: #51afef;">)</span>
                                                           <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">2</span> ,place<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                                        <span style="color: #C57BDB;">(</span>suffix <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> suffix
                                                    <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-to-number</span> suffix<span style="color: #51afef;">)</span>
                                                  <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                  <span style="color: #51afef;">(</span><span style="color: #51afef;">setf</span> ,place <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"%s--%s"</span> s1 <span style="color: #7bc275;">(</span><span style="color: #51afef;">cl-incf</span> suffix<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>title <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:raw-value</span> datum<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #62686E;">;; </span><span style="color: #62686E;">get ascii-only form of title without needing percent-encoding</span>
           <span style="color: #C57BDB;">(</span>ref <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-heading-contraction</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">substring-no-properties</span> title<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>parent <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:parent</span> datum<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">while</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">--any</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> ref <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> it<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                    cache<span style="color: #C57BDB;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">Title not unique: make it so.</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> parent
            <span style="color: #62686E;">;; </span><span style="color: #62686E;">Append ancestor title.</span>
            <span style="color: #7bc275;">(</span><span style="color: #51afef;">setf</span> title <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:raw-value</span> parent<span style="color: #C57BDB;">)</span>
                                <span style="color: #7bc275;">"--"</span> title<span style="color: #51afef;">)</span>
                  <span style="color: #62686E;">;; </span><span style="color: #62686E;">get ascii-only form of title without needing percent-encoding</span>
                  ref <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-heading-contraction</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">substring-no-properties</span> title<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                  parent <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:parent</span> parent<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
          <span style="color: #62686E;">;; </span><span style="color: #62686E;">No more ancestors: add and increment a number.</span>
          <span style="color: #7bc275;">(</span>inc-suffixf ref<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      ref<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-load-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">unpackaged/org-export-html-with-useful-ids-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-nicer-org-return" class="outline-5">
<h5 id="nicer-org-return"> <a class="anchor" aria-hidden="true" href="#nicer-org-return">🔗</a> <a class="anchor" aria-hidden="true" href="#nicer-org-return">🔗</a> <a class="anchor" aria-hidden="true" href="#nicer-org-return">🔗</a> <a class="anchor" aria-hidden="true" href="#nicer-org-return">🔗</a><span class="section-number-5">5.2.2.7</span> Nicer <code>org-return</code></h5>
<div class="outline-text-5" id="text-5-2-2-7">
<p>
Once again, from <a href="https://github.com/alphapapa/unpackaged.el#org-return-dwim">unpackaged.el</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">unpackaged/org-element-descendant-of</span> <span style="color: #7bc275;">(</span>type element<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Return non-nil if ELEMENT is a descendant of TYPE.</span>
<span style="color: #7e7e87;">TYPE should be an element type, like `</span><span style="color: #a991f1;">item</span><span style="color: #7e7e87;">' or `</span><span style="color: #a991f1;">paragraph</span><span style="color: #7e7e87;">'.</span>
<span style="color: #7e7e87;">ELEMENT should be a list like that returned by `</span><span style="color: #a991f1;">org-element-context</span><span style="color: #7e7e87;">'."</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">MAYBE: Use `</span><span style="color: #a991f1;">org-element-lineage</span><span style="color: #62686E;">'.</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when-let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>parent <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:parent</span> element<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> type <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> parent<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">unpackaged/org-element-descendant-of</span> type parent<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

<span style="color: #62686E;">;;;</span><span style="color: #62686E;">###</span><span style="color: #FCCE7B;">autoload</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">unpackaged/org-return-dwim</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> default<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"A helpful replacement for `</span><span style="color: #a991f1;">org-return-indent</span><span style="color: #7e7e87;">'.  With prefix, call `</span><span style="color: #a991f1;">org-return-indent</span><span style="color: #7e7e87;">'.</span>

<span style="color: #7e7e87;">On headings, move point to position after entry content.  In</span>
<span style="color: #7e7e87;">lists, insert a new item or end the list, with checkbox if</span>
<span style="color: #7e7e87;">appropriate.  In tables, insert a new row or end the table."</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Inspired by John Kitchin: http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #7bc275;">"P"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> default
        <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-return</span> t<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">Act depending on context around point.</span>

       <span style="color: #62686E;">;; </span><span style="color: #7bc275; font-weight: bold;">NOTE:</span><span style="color: #62686E;"> I prefer RET to not follow links, but by uncommenting this block, links will be</span>
       <span style="color: #62686E;">;; </span><span style="color: #62686E;">followed.</span>

       <span style="color: #62686E;">;; </span><span style="color: #62686E;">((eq 'link (car (org-element-context)))</span>
       <span style="color: #62686E;">;;  </span><span style="color: #62686E;">;; Link: Open it.</span>
       <span style="color: #62686E;">;;  </span><span style="color: #62686E;">(org-open-at-point-global))</span>

       <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-at-heading-p</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">Heading: Move to position after entry content.</span>
        <span style="color: #62686E;">;; </span><span style="color: #7bc275; font-weight: bold;">NOTE:</span><span style="color: #62686E;"> This is probably the most interesting feature of this function.</span>
        <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>heading-start <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-entry-beginning-position</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-entry-end-position</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-at-heading-p</span><span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span><span style="color: #a991f1;">=</span> heading-start <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-entry-beginning-position</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                 <span style="color: #62686E;">;; </span><span style="color: #62686E;">Entry ends on its heading; add newline after</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">end-of-line</span><span style="color: #7bc275;">)</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"\n\n"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                <span style="color: #C57BDB;">(</span>t
                 <span style="color: #62686E;">;; </span><span style="color: #62686E;">Entry ends after its heading; back up</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">forward-line</span> <span style="color: #e69055; font-weight: bold;">-1</span><span style="color: #7bc275;">)</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">end-of-line</span><span style="color: #7bc275;">)</span>
                 <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-at-heading-p</span><span style="color: #51afef;">)</span>
                   <span style="color: #62686E;">;; </span><span style="color: #62686E;">At the same heading</span>
                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">forward-line</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"\n"</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">forward-line</span> <span style="color: #e69055; font-weight: bold;">-1</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                 <span style="color: #62686E;">;; </span><span style="color: #ff665c; font-weight: bold;">FIXME:</span><span style="color: #62686E;"> looking-back is supposed to be called with more arguments.</span>
                 <span style="color: #7bc275;">(</span><span style="color: #51afef;">while</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">looking-back</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">rx</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">repeat</span> <span style="color: #e69055; font-weight: bold;">3</span> <span style="color: #C57BDB;">(</span>seq <span style="color: #7bc275;">(</span>optional blank<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"\n"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"\n"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">forward-line</span> <span style="color: #e69055; font-weight: bold;">-1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

       <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-at-item-checkbox-p</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">Checkbox: Insert new item with checkbox.</span>
        <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-insert-todo-heading</span> nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

       <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-in-item-p</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">Plain list.  Yes, this gets a little complicated...</span>
        <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>context <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-context</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">plain-list</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> context<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>  <span style="color: #62686E;">; </span><span style="color: #62686E;">First item in list</span>
                  <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">item</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">car</span> context<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                       <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:contents-begin</span> context<span style="color: #7bc275;">)</span>
                                <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:contents-end</span> context<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">unpackaged/org-element-descendant-of</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">item</span> context<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>  <span style="color: #62686E;">; </span><span style="color: #62686E;">Element in list item, e.g. a link</span>
              <span style="color: #62686E;">;; </span><span style="color: #62686E;">Non-empty item: Add new item.</span>
              <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-insert-item</span><span style="color: #C57BDB;">)</span>
            <span style="color: #62686E;">;; </span><span style="color: #62686E;">Empty item: Close the list.</span>
            <span style="color: #62686E;">;; </span><span style="color: #FCCE7B; font-weight: bold;">TODO:</span><span style="color: #62686E;"> Do this with org functions rather than operating on the text. Can't seem to find the right function.</span>
            <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">delete-region</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">line-beginning-position</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">line-end-position</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"\n"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

       <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">fboundp</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-inlinetask-in-task-p</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>org-inlinetask-in-task-p<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">Inline task: Don't insert a new heading.</span>
        <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-return</span> t<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

       <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-at-table-p</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #51afef;">save-excursion</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">beginning-of-line</span><span style="color: #7bc275;">)</span>
                 <span style="color: #62686E;">;; </span><span style="color: #62686E;">See `</span><span style="color: #a991f1;">org-table-next-field</span><span style="color: #62686E;">'.</span>
                 <span style="color: #7bc275;">(</span><span style="color: #51afef;">cl-loop</span> with end = <span style="color: #51afef;">(</span><span style="color: #a991f1;">line-end-position</span><span style="color: #51afef;">)</span>
                          for cell = <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-element-table-cell-parser</span><span style="color: #51afef;">)</span>
                          always <span style="color: #51afef;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:contents-begin</span> cell<span style="color: #C57BDB;">)</span>
                                        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:contents-end</span> cell<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                          while <span style="color: #51afef;">(</span><span style="color: #a991f1;">re-search-forward</span> <span style="color: #7bc275;">"|"</span> end t<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">Empty row: end the table.</span>
               <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">delete-region</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">line-beginning-position</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">line-end-position</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-return</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span>t
               <span style="color: #62686E;">;; </span><span style="color: #62686E;">Non-empty row: call `</span><span style="color: #a991f1;">org-return-indent</span><span style="color: #62686E;">'.</span>
               <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-return</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
       <span style="color: #C57BDB;">(</span>t
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">All other cases: call `</span><span style="color: #a991f1;">org-return-indent</span><span style="color: #62686E;">'.</span>
        <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-return</span> t<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-return-indent</span> <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">unpackaged/org-return-dwim</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org-plot" class="outline-5">
<h5 id="org-plot"> <a class="anchor" aria-hidden="true" href="#org-plot">🔗</a> <a class="anchor" aria-hidden="true" href="#org-plot">🔗</a> <a class="anchor" aria-hidden="true" href="#org-plot">🔗</a> <a class="anchor" aria-hidden="true" href="#org-plot">🔗</a><span class="section-number-5">5.2.2.8</span> Org Plot</h5>
<div class="outline-text-5" id="text-5-2-2-8">
<p>
There are two main bits of extra functionality I wan to add
</p>
<ul class="org-ul">
<li>the ability to transpose tables (internally)</li>
<li>a radar type</li>
</ul>

<p>
To accomplish this, overriding the <code>org-plot/gnuplot</code> function seems to be the
clear way. I tried this, and overrode so much that it seemed to make sense
just to modify <kbd>org-plot.el</kbd> instead, as it was only ~350 lines and I functions
that encompassed most of that line count.
</p>

<p>
Given that my <a href="lisp/org-plot.el">org-plot.el</a> is now ~700 lines, this seems to have been a good call.
</p>

<p>
For transposition, I&rsquo;ve added the following (equivalent) keys
</p>
<ul class="org-ul">
<li><code>[transpose|t]</code></li>
<li><code>t</code></li>
</ul>
<p>
When set to <code>yes</code>, <code>y</code>, or <code>t</code> the table is internally transposed (i.e. the <kbd>elisp</kbd> data
form of the table only).
</p>

<p>
The radar chart is a lot more involved, and I&rsquo;ve added the following keys
</p>
<ul class="org-ul">
<li><code>type:radar</code>
This uses the radar template, the result of which can be seen in <a id="orgbaeffa9"></a></li>
<li><code>[min|ymin]:0..n</code>
This sets the start value of <i>every</i> axis.</li>
<li><code>[max|ymax]:0..n</code>
This sets the end value of <i>every</i> axis.
If both <code>ymin</code> and <code>ymax</code> are set, only the first axis gets tick labels.</li>
<li><code>ticks:0..n</code>
This sets the number of ticks. Only works for \(n>2\), or \(n=0\) in which
case no ticks are shown.</li>
</ul>
</div>
</div>
<div id="outline-container-extra-links" class="outline-5">
<h5 id="extra-links"> <a class="anchor" aria-hidden="true" href="#extra-links">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links">🔗</a><span class="section-number-5">5.2.2.9</span> Extra links</h5>
<div class="outline-text-5" id="text-5-2-2-9">
</div>
<div id="outline-container-extra-links-xkcd" class="outline-6">
<h6 id="extra-links-xkcd"> <a class="anchor" aria-hidden="true" href="#extra-links-xkcd">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links-xkcd">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links-xkcd">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links-xkcd">🔗</a> <a class="anchor" aria-hidden="true" href="#extra-links-xkcd">🔗</a><span class="section-number-6">5.2.2.9.1</span> xkcd</h6>
<div class="outline-text-6" id="text-5-2-2-9-1">
<p>
Because xkcd is cool, let&rsquo;s make it as easy and fun as possible to insert them.
Saving seconds adds up after all! (but only so much)
</p>

<p>
<img src='https://imgs.xkcd.com/comics/is_it_worth_the_time.png' title="Don't forget the time you spend finding the chart to look up what you save. And the time spent reading this reminder about the time spent. And the time trying to figure out if either of those actually make sense. Remember, every second counts toward your life total, including these right now." alt='Is It Worth the Time?'>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-link-set-parameters</span> <span style="color: #7bc275;">"xkcd"</span>
                           <span style="color: #C57BDB;">:image-data-fun</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+org-xkcd-image-fn</span>
                           <span style="color: #C57BDB;">:follow</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+org-xkcd-open-fn</span>
                           <span style="color: #C57BDB;">:export</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+org-xkcd-export</span>
                           <span style="color: #C57BDB;">:complete</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+org-xkcd-complete</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+org-xkcd-open-fn</span> <span style="color: #7bc275;">(</span>link<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+org-xkcd-image-fn</span> nil link nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+org-xkcd-image-fn</span> <span style="color: #7bc275;">(</span>protocol link description<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Get image data for xkcd num LINK"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>xkcd-info <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-fetch-info</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-to-number</span> link<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>img <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:img</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>alt <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:alt</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">message</span> alt<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+org-image-file-data-fn</span> protocol <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">xkcd-download</span> img <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-to-number</span> link<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span> description<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+org-xkcd-export</span> <span style="color: #7bc275;">(</span>path desc backend _com<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Convert xkcd to html/LaTeX form"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>xkcd-info <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">+xkcd-fetch-info</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-to-number</span> path<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>img <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:img</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>alt <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:alt</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>title <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> xkcd-info <span style="color: #C57BDB;">:title</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>file <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">xkcd-download</span> img <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-to-number</span> path<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">html</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"&lt;img src='%s' title=\"%s\" alt='%s'&gt;"</span> img <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">subst-char-in-string</span> ?\" ?&#8220; alt<span style="color: #51afef;">)</span> title<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex</span><span style="color: #7bc275;">)</span>
             <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\begin{figure}[!htb]</span>
<span style="color: #7bc275;">  \\centering</span>
<span style="color: #7bc275;">  \\includegraphics[scale=0.4]{%s}</span>
<span style="color: #7bc275;">  \\caption*{\\label{xkcd:%s} %s}</span>
<span style="color: #7bc275;">\\end{figure}"</span> file path <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> desc
                             <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\textbf{%s} %s"</span> title alt<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
            <span style="color: #C57BDB;">(</span>t <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"https://xkcd.com/%s"</span> path<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+org-xkcd-complete</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> arg<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Complete xkcd using `</span><span style="color: #a991f1;">+xkcd-stored-info</span><span style="color: #7e7e87;">'"</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"xkcd:%d"</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">+xkcd-select</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-youtube" class="outline-6">
<h6 id="youtube"> <a class="anchor" aria-hidden="true" href="#youtube">🔗</a> <a class="anchor" aria-hidden="true" href="#youtube">🔗</a> <a class="anchor" aria-hidden="true" href="#youtube">🔗</a> <a class="anchor" aria-hidden="true" href="#youtube">🔗</a> <a class="anchor" aria-hidden="true" href="#youtube">🔗</a><span class="section-number-6">5.2.2.9.2</span> YouTube</h6>
<div class="outline-text-6" id="text-5-2-2-9-2">
<p>
The <code>[[yt:...]]</code> links preview nicely, but don&rsquo;t export nicely. Thankfully, we can
fix that.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-link-set-parameters</span> <span style="color: #7bc275;">"yt"</span> <span style="color: #C57BDB;">:export</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">+org-export-yt</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+org-export-yt</span> <span style="color: #7bc275;">(</span>path desc backend _com<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">html</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"&lt;iframe width='440' \</span>
<span style="color: #7bc275;">height='335' \</span>
<span style="color: #7bc275;">src='https://www.youtube.com/embed/%s' \</span>
<span style="color: #7bc275;">frameborder='0' \</span>
<span style="color: #7bc275;">allowfullscreen&gt;%s&lt;/iframe&gt;"</span> path <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #7bc275;">""</span> desc<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\href{https://youtu.be/%s}{%s}"</span> path <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> desc <span style="color: #7bc275;">"youtube"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>t <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"https://youtu.be/%s"</span> path<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org-mode-visuals" class="outline-4">
<h4 id="org-mode-visuals"> <a class="anchor" aria-hidden="true" href="#org-mode-visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#org-mode-visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#org-mode-visuals">🔗</a><span class="section-number-4">5.2.3</span> Visuals</h4>
<div class="outline-text-4" id="text-5-2-3">
<p>
Here I try to do two things: improve the styling of the various documents, via
font changes etc, and also propagate colours from the current theme.
</p>

<p>
<img src='https://imgs.xkcd.com/comics/color_models.png' title="What if what *I* see as blue, *you* see as a slightly different blue because you're using Chrome instead of Firefox and despite a decade of messing with profiles we STILL can't get this right somehow." alt='Color Models'>
</p>
</div>

<div id="outline-container-editor" class="outline-5">
<h5 id="editor"> <a class="anchor" aria-hidden="true" href="#editor">🔗</a> <a class="anchor" aria-hidden="true" href="#editor">🔗</a> <a class="anchor" aria-hidden="true" href="#editor">🔗</a> <a class="anchor" aria-hidden="true" href="#editor">🔗</a><span class="section-number-5">5.2.3.1</span> In editor</h5>
<div class="outline-text-5" id="text-5-2-3-1">
</div>
<div id="outline-container-font-display" class="outline-6">
<h6 id="font-display"> <a class="anchor" aria-hidden="true" href="#font-display">🔗</a> <a class="anchor" aria-hidden="true" href="#font-display">🔗</a> <a class="anchor" aria-hidden="true" href="#font-display">🔗</a> <a class="anchor" aria-hidden="true" href="#font-display">🔗</a> <a class="anchor" aria-hidden="true" href="#font-display">🔗</a><span class="section-number-6">5.2.3.1.1</span> Font Display</h6>
<div class="outline-text-6" id="text-5-2-3-1-1">
<p>
Mixed pitch is great. As is <code>+org-pretty-mode</code>, let&rsquo;s use them.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">+org-pretty-mode</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">mixed-pitch-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Earlier I loaded the <code>org-pretty-table</code> package, let&rsquo;s enable it everywhere!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">global-org-pretty-table-mode</span> t<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Let&rsquo;s make headings a bit bigger
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">custom-set-faces!</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-1 <span style="color: #C57BDB;">:weight</span> extra-bold <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.25</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-2 <span style="color: #C57BDB;">:weight</span> bold <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.15</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-3 <span style="color: #C57BDB;">:weight</span> bold <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.12</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-4 <span style="color: #C57BDB;">:weight</span> semi-bold <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.09</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-5 <span style="color: #C57BDB;">:weight</span> semi-bold <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.06</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-6 <span style="color: #C57BDB;">:weight</span> semi-bold <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.03</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-8 <span style="color: #C57BDB;">:weight</span> semi-bold<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>outline-9 <span style="color: #C57BDB;">:weight</span> semi-bold<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-symbols" class="outline-6">
<h6 id="symbols"> <a class="anchor" aria-hidden="true" href="#symbols">🔗</a> <a class="anchor" aria-hidden="true" href="#symbols">🔗</a> <a class="anchor" aria-hidden="true" href="#symbols">🔗</a> <a class="anchor" aria-hidden="true" href="#symbols">🔗</a> <a class="anchor" aria-hidden="true" href="#symbols">🔗</a><span class="section-number-6">5.2.3.1.2</span> Symbols</h6>
<div class="outline-text-6" id="text-5-2-3-1-2">
<p>
It&rsquo;s also nice to change the character used for collapsed items (by default <code>…</code>),
I think <code>▾</code> is better for indicating &rsquo;collapsed section&rsquo;.
and add an extra <code>org-bullet</code> to the default list of four.
I&rsquo;ve also added some fun alternatives, just commented out.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">(after! org</span>
<span style="color: #62686E;">;;   </span><span style="color: #62686E;">(use-package org-pretty-tags</span>
<span style="color: #62686E;">;;   </span><span style="color: #62686E;">:config</span>
<span style="color: #62686E;">;;    </span><span style="color: #62686E;">(setq org-pretty-tags-surrogate-strings</span>
<span style="color: #62686E;">;;          </span><span style="color: #62686E;">`(("uni"        . ,(all-the-icons-faicon   "graduation-cap" :face 'all-the-icons-purple  :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("ucc"        . ,(all-the-icons-material "computer"       :face 'all-the-icons-silver  :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("assignment" . ,(all-the-icons-material "library_books"  :face 'all-the-icons-orange  :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("test"       . ,(all-the-icons-material "timer"          :face 'all-the-icons-red     :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("lecture"    . ,(all-the-icons-fileicon "keynote"        :face 'all-the-icons-orange  :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("email"      . ,(all-the-icons-faicon   "envelope"       :face 'all-the-icons-blue    :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("read"       . ,(all-the-icons-octicon  "book"           :face 'all-the-icons-lblue   :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("article"    . ,(all-the-icons-octicon  "file-text"      :face 'all-the-icons-yellow  :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("web"        . ,(all-the-icons-faicon   "globe"          :face 'all-the-icons-green   :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("info"       . ,(all-the-icons-faicon   "info-circle"    :face 'all-the-icons-blue    :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("issue"      . ,(all-the-icons-faicon   "bug"            :face 'all-the-icons-red     :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("someday"    . ,(all-the-icons-faicon   "calendar-o"     :face 'all-the-icons-cyan    :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("idea"       . ,(all-the-icons-octicon  "light-bulb"     :face 'all-the-icons-yellow  :v-adjust 0.01))</span>
<span style="color: #62686E;">;;            </span><span style="color: #62686E;">("emacs"      . ,(all-the-icons-fileicon "emacs"          :face 'all-the-icons-lpurple :v-adjust 0.01))))</span>
<span style="color: #62686E;">;;    </span><span style="color: #62686E;">(org-pretty-tags-global-mode)))</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org-superstar
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-superstar-headline-bullets-list</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#9673;"</span> <span style="color: #7bc275;">"&#9675;"</span> <span style="color: #7bc275;">"&#10040;"</span> <span style="color: #7bc275;">"&#10047;"</span> <span style="color: #7bc275;">"&#10020;"</span> <span style="color: #7bc275;">"&#10012;"</span> <span style="color: #7bc275;">"&#9670;"</span> <span style="color: #7bc275;">"&#9654;"</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">org-superstar-headline-bullets-list '("&#8544;" "&#8545;" "&#8546;" "&#8547;" "&#8548;" "&#8549;" "&#8550;" "&#8551;" "&#8552;" "&#8553;")</span>
        <span style="color: #DFDFDF;">org-superstar-prettify-item-bullets</span> t <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-ellipsis</span> <span style="color: #7bc275;">" &#9662; "</span>
        <span style="color: #DFDFDF;">org-priority-highest</span> ?A
        <span style="color: #DFDFDF;">org-priority-lowest</span> ?E
        <span style="color: #DFDFDF;">org-priority-faces</span>
        <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>?A . <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-red</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>?B . <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-orange</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>?C . <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-yellow</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>?D . <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-green</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span>?E . <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-blue</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
It&rsquo;s also nice to make use of the Unicode characters for check boxes, and other commands.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">appendq!</span> <span style="color: #DFDFDF;">+pretty-code-symbols</span>
            <span style="color: #C57BDB;">`</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:checkbox</span>      <span style="color: #7bc275;">"&#9744;"</span>
              <span style="color: #C57BDB;">:pending</span>       <span style="color: #7bc275;">"&#9724;"</span>
              <span style="color: #C57BDB;">:checkedbox</span>    <span style="color: #7bc275;">"&#9745;"</span>
              <span style="color: #C57BDB;">:list_property</span> <span style="color: #7bc275;">"&#8759;"</span>
              <span style="color: #C57BDB;">:results</span>       <span style="color: #7bc275;">"&#129078;"</span>
              <span style="color: #C57BDB;">:property</span>      <span style="color: #7bc275;">"&#9784;"</span>
              <span style="color: #C57BDB;">:properties</span>    <span style="color: #7bc275;">"&#9881;"</span>
              <span style="color: #C57BDB;">:end</span>           <span style="color: #7bc275;">"&#8718;"</span>
              <span style="color: #C57BDB;">:options</span>       <span style="color: #7bc275;">"&#8997;"</span>
              <span style="color: #C57BDB;">:title</span>         <span style="color: #7bc275;">"&#120399;"</span>
              <span style="color: #C57BDB;">:author</span>        <span style="color: #7bc275;">"&#120380;"</span>
              <span style="color: #C57BDB;">:date</span>          <span style="color: #7bc275;">"&#120383;"</span>
              <span style="color: #C57BDB;">:latex_header</span>  <span style="color: #7bc275;">"&#8677;"</span>
              <span style="color: #C57BDB;">:latex_class</span>   <span style="color: #7bc275;">"&#127282;"</span>
              <span style="color: #C57BDB;">:begin_quote</span>   <span style="color: #7bc275;">"&#10094;"</span>
              <span style="color: #C57BDB;">:end_quote</span>     <span style="color: #7bc275;">"&#10095;"</span>
              <span style="color: #C57BDB;">:begin_export</span>  <span style="color: #7bc275;">"&#11246;"</span>
              <span style="color: #C57BDB;">:end_export</span>    <span style="color: #7bc275;">"&#11244;"</span>
              <span style="color: #C57BDB;">:priority_a</span>   ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#9873;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-red</span><span style="color: #51afef;">)</span>
              <span style="color: #C57BDB;">:priority_b</span>   ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#11014;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-orange</span><span style="color: #51afef;">)</span>
              <span style="color: #C57BDB;">:priority_c</span>   ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#9632;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-yellow</span><span style="color: #51afef;">)</span>
              <span style="color: #C57BDB;">:priority_d</span>   ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#11015;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-green</span><span style="color: #51afef;">)</span>
              <span style="color: #C57BDB;">:priority_e</span>   ,<span style="color: #51afef;">(</span><span style="color: #a991f1;">propertize</span> <span style="color: #7bc275;">"&#10067;"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">face</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">all-the-icons-blue</span><span style="color: #51afef;">)</span>
              <span style="color: #C57BDB;">:em_dash</span>       <span style="color: #7bc275;">"&#8212;"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">set-pretty-symbols!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-mode</span>
    <span style="color: #C57BDB;">:merge</span> t
    <span style="color: #C57BDB;">:checkbox</span>      <span style="color: #7bc275;">"[ ]"</span>
    <span style="color: #C57BDB;">:pending</span>       <span style="color: #7bc275;">"[-]"</span>
    <span style="color: #C57BDB;">:checkedbox</span>    <span style="color: #7bc275;">"[X]"</span>
    <span style="color: #C57BDB;">:list_property</span> <span style="color: #7bc275;">"::"</span>
    <span style="color: #C57BDB;">:results</span>       <span style="color: #7bc275;">"#+RESULTS:"</span>
    <span style="color: #C57BDB;">:property</span>      <span style="color: #7bc275;">"#+PROPERTY:"</span>
    <span style="color: #C57BDB;">:property</span>      <span style="color: #7bc275;">":PROPERTIES:"</span>
    <span style="color: #C57BDB;">:end</span>           <span style="color: #7bc275;">":END:"</span>
    <span style="color: #C57BDB;">:options</span>       <span style="color: #7bc275;">"#+OPTIONS:"</span>
    <span style="color: #C57BDB;">:title</span>         <span style="color: #7bc275;">"#+TITLE:"</span>
    <span style="color: #C57BDB;">:author</span>        <span style="color: #7bc275;">"#+AUTHOR:"</span>
    <span style="color: #C57BDB;">:date</span>          <span style="color: #7bc275;">"#+DATE:"</span>
    <span style="color: #C57BDB;">:latex_class</span>   <span style="color: #7bc275;">"#+LATEX_CLASS:"</span>
    <span style="color: #C57BDB;">:latex_header</span>  <span style="color: #7bc275;">"#+LATEX_HEADER:"</span>
    <span style="color: #C57BDB;">:begin_quote</span>   <span style="color: #7bc275;">"#+BEGIN_QUOTE"</span>
    <span style="color: #C57BDB;">:end_quote</span>     <span style="color: #7bc275;">"#+END_QUOTE"</span>
    <span style="color: #C57BDB;">:begin_export</span>  <span style="color: #7bc275;">"#+BEGIN_EXPORT"</span>
    <span style="color: #C57BDB;">:end_export</span>    <span style="color: #7bc275;">"#+END_EXPORT"</span>
    <span style="color: #C57BDB;">:priority_a</span>    <span style="color: #7bc275;">"[#A]"</span>
    <span style="color: #C57BDB;">:priority_b</span>    <span style="color: #7bc275;">"[#B]"</span>
    <span style="color: #C57BDB;">:priority_c</span>    <span style="color: #7bc275;">"[#C]"</span>
    <span style="color: #C57BDB;">:priority_d</span>    <span style="color: #7bc275;">"[#D]"</span>
    <span style="color: #C57BDB;">:priority_e</span>    <span style="color: #7bc275;">"[#E]"</span>
    <span style="color: #C57BDB;">:em_dash</span>       <span style="color: #7bc275;">"---"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-put</span> <span style="color: #DFDFDF;">+pretty-code-symbols</span> <span style="color: #C57BDB;">:name</span> <span style="color: #7bc275;">"&#8269;"</span><span style="color: #51afef;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">or &#8250; could be good?</span>
</pre>
</div>
<p>
We also like <code>org-fragtog</code>, and that wants a hook.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-mode-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-fragtog-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-latex-fragments" class="outline-6">
<h6 id="latex-fragments"> <a class="anchor" aria-hidden="true" href="#latex-fragments">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-fragments">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-fragments">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-fragments">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-fragments">🔗</a><span class="section-number-6">5.2.3.1.3</span> LaTeX Fragments</h6>
<div class="outline-text-6" id="text-5-2-3-1-3">
<p>
First off, we want those fragments to look good.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-highlight-latex-and-related</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>native script entities<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
It&rsquo;s nice to customise the look of LaTeX fragments so they fit better in the
text &#x2014; like this \(\sqrt{\beta^2+3}-\sum_{\phi=1}^\infty \frac{x^\phi-1}{\Gamma(a)}\). Let&rsquo;s start by adding a sans font.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-format-latex-header</span> <span style="color: #7bc275;">"\\documentclass{article}</span>
<span style="color: #7bc275;">\\usepackage[usenames]{color}</span>

<span style="color: #7bc275;">\\usepackage[T1]{fontenc}</span>
<span style="color: #7bc275;">\\usepackage{mathtools}</span>
<span style="color: #7bc275;">\\usepackage{textcomp,amssymb}</span>
<span style="color: #7bc275;">\\usepackage[makeroom]{cancel}</span>

<span style="color: #7bc275;">\\usepackage{booktabs}</span>

<span style="color: #7bc275;">\\pagestyle{empty}             % do not remove</span>
<span style="color: #7bc275;">% The settings below are copied from fullpage.sty</span>
<span style="color: #7bc275;">\\setlength{\\textwidth}{\\paperwidth}</span>
<span style="color: #7bc275;">\\addtolength{\\textwidth}{-3cm}</span>
<span style="color: #7bc275;">\\setlength{\\oddsidemargin}{1.5cm}</span>
<span style="color: #7bc275;">\\addtolength{\\oddsidemargin}{-2.54cm}</span>
<span style="color: #7bc275;">\\setlength{\\evensidemargin}{\\oddsidemargin}</span>
<span style="color: #7bc275;">\\setlength{\\textheight}{\\paperheight}</span>
<span style="color: #7bc275;">\\addtolength{\\textheight}{-\\headheight}</span>
<span style="color: #7bc275;">\\addtolength{\\textheight}{-\\headsep}</span>
<span style="color: #7bc275;">\\addtolength{\\textheight}{-\\footskip}</span>
<span style="color: #7bc275;">\\addtolength{\\textheight}{-3cm}</span>
<span style="color: #7bc275;">\\setlength{\\topmargin}{1.5cm}</span>
<span style="color: #7bc275;">\\addtolength{\\topmargin}{-2.54cm}</span>
<span style="color: #7bc275;">% my custom stuff</span>
<span style="color: #7bc275;">\\usepackage{arev}</span>
<span style="color: #7bc275;">\\usepackage{arevmath}"</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
We can either render from a <code>dvi</code> or <code>pdf</code> file, so let&rsquo;s benchmark <code>latex</code> and
<code>pdflatex</code>.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>latex</code> time</th>
<th scope="col" class="org-left"><code>pdflatex</code> time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">135±2 ms</td>
<td class="org-left">215±3 ms</td>
</tr>
</tbody>
</table>

<p>
On the rendering side, there are two <code>.dvi</code>-to-image converters which I am
interested in: <code>dvipng</code> and <code>dvisvgm</code>. Then with the a <code>.pdf</code> we have <code>pdf2svg</code>.
For inline preview we care about speed, while for exporting we care about file
size and prefer a vector graphic.
</p>

<p>
Using the above latex expression and benchmarking lead to the following results:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>dvipng</code> time</th>
<th scope="col" class="org-left"><code>dvisvgm</code> time</th>
<th scope="col" class="org-left"><code>pdf2svg</code> time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">89±2 ms</td>
<td class="org-left">178±2 ms</td>
<td class="org-left">12±2 ms</td>
</tr>
</tbody>
</table>

<p>
Now let&rsquo;s combine this to see what&rsquo;s best
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Tool chain</th>
<th scope="col" class="org-left">Total time</th>
<th scope="col" class="org-left">Resultant file size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>latex</code> + <code>dvipng</code></td>
<td class="org-left">226±2 ms</td>
<td class="org-left">7 KiB</td>
</tr>

<tr>
<td class="org-left"><code>latex</code> + <code>dvisvgm</code></td>
<td class="org-left">392±4 ms</td>
<td class="org-left">8 KiB</td>
</tr>

<tr>
<td class="org-left"><code>pdflatex</code> + <code>pdf2svg</code></td>
<td class="org-left">230±2 ms</td>
<td class="org-left">16 KiB</td>
</tr>
</tbody>
</table>

<p>
So, let&rsquo;s use <code>dvipng</code> for previewing LaTeX fragments in-Emacs, but <code>dvisvgm</code> for <a href="#exporting-html">LaTeX Rendering</a>.
<i>Unfortunately: it seems that svg sizing is annoying ATM, so let&rsquo;s actually not do this right now.</i>
</p>

<p>
As well as having a sans font, there are a few other tweaks which can make them
look better. Namely making sure that the colours switch when the theme does.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
<span style="color: #62686E;">;; </span><span style="color: #62686E;">make background of fragments transparent</span>
<span style="color: #62686E;">;; </span><span style="color: #62686E;">(let ((dvipng--plist (alist-get 'dvipng org-preview-latex-process-alist)))</span>
<span style="color: #62686E;">;;   </span><span style="color: #62686E;">(plist-put dvipng--plist :use-xcolor t)</span>
<span style="color: #62686E;">;;   </span><span style="color: #62686E;">(plist-put dvipng--plist :image-converter '("dvipng -D %D -bg 'transparent' -T tight -o %O %f")))</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">doom-load-theme-hook</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">+org-refresh-latex-background</span> <span style="color: #51afef;">()</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">plist-put!</span> <span style="color: #DFDFDF;">org-format-latex-options</span>
                  <span style="color: #C57BDB;">:background</span>
                  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">cadr</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">assq</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">default</span> <span style="color: #DFDFDF;">face-remapping-alist</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                      <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">default</span><span style="color: #7bc275;">)</span>
                                  <span style="color: #C57BDB;">:background</span> nil t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
<span style="color: #51afef;">)</span>
</pre>
</div>
<p>
It&rsquo;d be nice to make <code>mhchem</code> equations able to be rendered.
NB: This doesn&rsquo;t work at the moment.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-latex-regexps</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"\\ce"</span> <span style="color: #7bc275;">"^\\\\ce{</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(?:</span><span style="color: #7bc275;">[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">\000{}]</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">|</span><span style="color: #7bc275;">{[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">\000}]+?}</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">}"</span> <span style="color: #e69055; font-weight: bold;">0</span> nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-stolen-from-scimax" class="outline-6">
<h6 id="stolen-from-scimax"> <a class="anchor" aria-hidden="true" href="#stolen-from-scimax">🔗</a> <a class="anchor" aria-hidden="true" href="#stolen-from-scimax">🔗</a> <a class="anchor" aria-hidden="true" href="#stolen-from-scimax">🔗</a> <a class="anchor" aria-hidden="true" href="#stolen-from-scimax">🔗</a> <a class="anchor" aria-hidden="true" href="#stolen-from-scimax">🔗</a><span class="section-number-6">5.2.3.1.4</span> Stolen from <a href="https://github.com/jkitchin/scimax">scimax</a> (semi-working right now)</h6>
<div class="outline-text-6" id="text-5-2-3-1-4">
<p>
I want fragment justification
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">scimax-org-latex-fragment-justify</span> <span style="color: #7bc275;">(</span>justification<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Justify the latex fragment at point with JUSTIFICATION.</span>
<span style="color: #7e7e87;">JUSTIFICATION is a symbol for 'left, 'center or 'right."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span>
     <span style="color: #51afef;">(</span><span style="color: #a991f1;">list</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">intern-soft</span>
            <span style="color: #7bc275;">(</span><span style="color: #a991f1;">completing-read</span> <span style="color: #7bc275;">"Justification (left): "</span> <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span>left center right<span style="color: #51afef;">)</span>
                             nil t nil nil <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">left</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let*</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>ov <span style="color: #7bc275;">(</span>ov-at<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>beg <span style="color: #7bc275;">(</span>ov-beg ov<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>end <span style="color: #7bc275;">(</span>ov-end ov<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>shift <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> beg <span style="color: #51afef;">(</span><span style="color: #a991f1;">line-beginning-position</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>img <span style="color: #7bc275;">(</span><span style="color: #a991f1;">overlay-get</span> ov <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">display</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           <span style="color: #C57BDB;">(</span>img <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> img <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">consp</span> img<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> img<span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">image</span><span style="color: #C57BDB;">)</span>
                          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">image-type-available-p</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">cdr</span> img<span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:type</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                     img<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
           space-left offset<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> img
                 <span style="color: #62686E;">;; </span><span style="color: #62686E;">This means the equation is at the start of the line</span>
                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">=</span> beg <span style="color: #51afef;">(</span><span style="color: #a991f1;">line-beginning-position</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                 <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span>
                  <span style="color: #51afef;">(</span><span style="color: #a991f1;">string=</span> <span style="color: #7bc275;">""</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">s-trim</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">buffer-substring</span> end <span style="color: #51afef;">(</span><span style="color: #a991f1;">line-end-position</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                  <span style="color: #51afef;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex-environment</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">car</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-context</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> space-left <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">window-max-chars-per-line</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">image-size</span> img<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
              offset <span style="color: #7bc275;">(</span><span style="color: #a991f1;">floor</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
                             <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> justification <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">center</span><span style="color: #7bc275;">)</span>
                              <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">/</span> space-left <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span> shift<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                             <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> justification <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">right</span><span style="color: #7bc275;">)</span>
                              <span style="color: #7bc275;">(</span><span style="color: #a991f1;">-</span> space-left shift<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                             <span style="color: #C57BDB;">(</span>t
                              <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">when</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&gt;=</span> offset <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #7bc275;">)</span>
          <span style="color: #7bc275;">(</span><span style="color: #a991f1;">overlay-put</span> ov <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">before-string</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">make-string</span> offset ?\ <span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">scimax-org-latex-fragment-justify-advice</span> <span style="color: #7bc275;">(</span>beg end image imagetype<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"After advice function to justify fragments."</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">scimax-org-latex-fragment-justify</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-get</span> <span style="color: #DFDFDF;">org-format-latex-options</span> <span style="color: #C57BDB;">:justify</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">left</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>


  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">scimax-toggle-latex-fragment-justification</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Toggle if LaTeX fragment justification options can be used."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">get</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-latex-fragment-justify-advice</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org--format-latex-make-overlay</span> <span style="color: #C57BDB;">:after</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-latex-fragment-justify-advice</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-latex-fragment-justify-advice</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span> t<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Latex fragment justification enabled"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">advice-remove</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org--format-latex-make-overlay</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-latex-fragment-justify-advice</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-latex-fragment-justify-advice</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span> nil<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Latex fragment justification disabled"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
There&rsquo;s also this lovely equation numbering stuff I&rsquo;ll nick
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">Numbered equations all have (1) as the number for fragments with vanilla</span>
<span style="color: #62686E;">;; </span><span style="color: #62686E;">org-mode. This code injects the correct numbers into the previews so they</span>
<span style="color: #62686E;">;; </span><span style="color: #62686E;">look good.</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">scimax-org-renumber-environment</span> <span style="color: #7bc275;">(</span>orig-func <span style="color: #FCCE7B;">&amp;rest</span> args<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"A function to inject numbers in LaTeX fragment previews."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>results <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">()</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>counter <span style="color: #e69055; font-weight: bold;">-1</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">numberp</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> results <span style="color: #C57BDB;">(</span><span style="color: #51afef;">loop</span> for <span style="color: #7bc275;">(</span>begin .  env<span style="color: #7bc275;">)</span> in
                          <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-map</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-element-parse-buffer</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex-environment</span>
                            <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>env<span style="color: #C57BDB;">)</span>
                              <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cons</span>
                               <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:begin</span> env<span style="color: #7bc275;">)</span>
                               <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:value</span> env<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                          collect
                          <span style="color: #7bc275;">(</span><span style="color: #51afef;">cond</span>
                           <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #7bc275;">"\\\\begin{equation}"</span> env<span style="color: #7bc275;">)</span>
                                 <span style="color: #7bc275;">(</span><span style="color: #a991f1;">not</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #7bc275;">"\\\\tag{"</span> env<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                            <span style="color: #C57BDB;">(</span><span style="color: #51afef;">incf</span> counter<span style="color: #C57BDB;">)</span>
                            <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cons</span> begin counter<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #7bc275;">"\\\\begin{align}"</span> env<span style="color: #C57BDB;">)</span>
                            <span style="color: #C57BDB;">(</span><span style="color: #51afef;">prog2</span>
                                <span style="color: #7bc275;">(</span><span style="color: #51afef;">incf</span> counter<span style="color: #7bc275;">)</span>
                                <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cons</span> begin counter<span style="color: #7bc275;">)</span>
                              <span style="color: #7bc275;">(</span><span style="color: #51afef;">with-temp-buffer</span>
                                <span style="color: #51afef;">(</span><span style="color: #a991f1;">insert</span> env<span style="color: #51afef;">)</span>
                                <span style="color: #51afef;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                <span style="color: #62686E;">;; </span><span style="color: #62686E;">\\ is used for a new line. Each one leads to a number</span>
                                <span style="color: #51afef;">(</span><span style="color: #51afef;">incf</span> counter <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">count-matches</span> <span style="color: #7bc275;">"\\\\$"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                <span style="color: #62686E;">;; </span><span style="color: #62686E;">unless there are nonumbers.</span>
                                <span style="color: #51afef;">(</span><span style="color: #a991f1;">goto-char</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point-min</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                                <span style="color: #51afef;">(</span><span style="color: #51afef;">decf</span> counter <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">count-matches</span> <span style="color: #7bc275;">"\\nonumber"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span>t
                            <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">cons</span> begin nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

      <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> numberp <span style="color: #7bc275;">(</span><span style="color: #a991f1;">cdr</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point</span><span style="color: #C57BDB;">)</span> results<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setf</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">car</span> args<span style="color: #7bc275;">)</span>
              <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span>
               <span style="color: #51afef;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\setcounter{equation}{%s}\n"</span> numberp<span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #a991f1;">car</span> args<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>

    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">apply</span> orig-func args<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>


  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">scimax-toggle-latex-equation-numbering</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Toggle whether LaTeX fragments are numbered."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">get</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-create-formula-image</span> <span style="color: #C57BDB;">:around</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span> t<span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Latex numbering enabled"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">advice-remove</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-create-formula-image</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span> nil<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">message</span> <span style="color: #7bc275;">"Latex numbering disabled."</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">advice-add</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-create-formula-image</span> <span style="color: #C57BDB;">:around</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">put</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">scimax-org-renumber-environment</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">enabled</span> t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-exporting-general" class="outline-5">
<h5 id="exporting-general"> <a class="anchor" aria-hidden="true" href="#exporting-general">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-general">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-general">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-general">🔗</a><span class="section-number-5">5.2.3.2</span> Exporting (general)</h5>
<div class="outline-text-5" id="text-5-2-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-export-headline-levels</span> <span style="color: #e69055; font-weight: bold;">5</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">I like nesting</span>
</pre>
</div>
<p>
I&rsquo;m also going to make use of an item in <kbd>ox-extra</kbd> so that I can add an <kbd>:ignore:</kbd>
tag to headings for the content to be kept, but the heading itself ignored
(unlike <kbd>:noexport:</kbd> which ignored both heading and content). This is useful when
I want to use headings to provide a structure for writing that doesn&rsquo;t appear in
the final documents.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">ox-extra</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">ox-extras-activate</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>ignore-headlines<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-exporting-html" class="outline-5">
<h5 id="exporting-html"> <a class="anchor" aria-hidden="true" href="#exporting-html">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-html">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-html">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-html">🔗</a><span class="section-number-5">5.2.3.3</span> Exporting to HTML</h5>
<div class="outline-text-5" id="text-5-2-3-3">
</div>
<div id="outline-container-custom-css-js" class="outline-6">
<h6 id="custom-css-js"> <a class="anchor" aria-hidden="true" href="#custom-css-js">🔗</a> <a class="anchor" aria-hidden="true" href="#custom-css-js">🔗</a> <a class="anchor" aria-hidden="true" href="#custom-css-js">🔗</a> <a class="anchor" aria-hidden="true" href="#custom-css-js">🔗</a> <a class="anchor" aria-hidden="true" href="#custom-css-js">🔗</a><span class="section-number-6">5.2.3.3.1</span> Custom CSS/JS</h6>
<div class="outline-text-6" id="text-5-2-3-3-1">
<p>
There is a fantastic exporter config (<a href="https://github.com/fniessen/org-html-themes">fniessen/org-html-themes</a>) which we can
setup to be used with all our org files. Since most of the syntax highlighting
colours from our <a href="#theme-modeline">Theme</a> gets used, we benefit from customising the code block style.
</p>
<p>
We also want to make the background and foreground colours of the <code>&lt;pre&gt;</code> blocks
match out theme (they don&rsquo;t by default), so I scraped some code from <code>emacs.stackexchange</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
<span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">my-org-inline-css-hook</span> <span style="color: #7bc275;">(</span>exporter<span style="color: #7bc275;">)</span>
  <span style="color: #7e7e87;">"Insert custom inline css to automatically set the</span>
<span style="color: #7e7e87;">   background of code to whatever theme I'm using's background"</span>
  <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">eq</span> exporter <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">html</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span>
     <span style="color: #DFDFDF;">org-html-head-extra</span>
     <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">s-contains-p</span> <span style="color: #7bc275;">"&lt;!&#8211;&#8211;tec/custom-head-start--&gt;"</span> <span style="color: #DFDFDF;">org-html-head-extra</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">s-replace-regexp</span> <span style="color: #7bc275;">"&lt;!&#8211;&#8211;tec\\/custom-head-start--&gt;[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">&#128604;]*&lt;!&#8211;&#8211;tec\\/custom-head-end--&gt;"</span> <span style="color: #7bc275;">""</span> <span style="color: #DFDFDF;">org-html-head-extra</span><span style="color: #51afef;">)</span>
        <span style="color: #DFDFDF;">org-html-head-extra</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">"&lt;!&#8211;&#8211;tec/custom-head-start--&gt;"</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"&lt;style type=\"text/css\"&gt;</span>
<span style="color: #7bc275;">   :root {</span>
<span style="color: #7bc275;">      --theme-bg: %s;</span>
<span style="color: #7bc275;">      --theme-bg-alt: %s;</span>
<span style="color: #7bc275;">      --theme-base0: %s;</span>
<span style="color: #7bc275;">      --theme-base1: %s;</span>
<span style="color: #7bc275;">      --theme-base2: %s;</span>
<span style="color: #7bc275;">      --theme-base3: %s;</span>
<span style="color: #7bc275;">      --theme-base4: %s;</span>
<span style="color: #7bc275;">      --theme-base5: %s;</span>
<span style="color: #7bc275;">      --theme-base6: %s;</span>
<span style="color: #7bc275;">      --theme-base7: %s;</span>
<span style="color: #7bc275;">      --theme-base8: %s;</span>
<span style="color: #7bc275;">      --theme-fg: %s;</span>
<span style="color: #7bc275;">      --theme-fg-alt: %s;</span>
<span style="color: #7bc275;">      --theme-grey: %s;</span>
<span style="color: #7bc275;">      --theme-red: %s;</span>
<span style="color: #7bc275;">      --theme-orange: %s;</span>
<span style="color: #7bc275;">      --theme-green: %s;</span>
<span style="color: #7bc275;">      --theme-teal: %s;</span>
<span style="color: #7bc275;">      --theme-yellow: %s;</span>
<span style="color: #7bc275;">      --theme-blue: %s;</span>
<span style="color: #7bc275;">      --theme-dark-blue: %s;</span>
<span style="color: #7bc275;">      --theme-magenta: %s;</span>
<span style="color: #7bc275;">      --theme-violet: %s;</span>
<span style="color: #7bc275;">      --theme-cyan: %s;</span>
<span style="color: #7bc275;">      --theme-dark-cyan: %s;</span>
<span style="color: #7bc275;">   }</span>
<span style="color: #7bc275;">&lt;/style&gt;"</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bg</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">bg-alt</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base0</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base1</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base2</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base3</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base4</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base5</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base6</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base7</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">base8</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">fg</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">fg-alt</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">grey</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">red</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">orange</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">green</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">teal</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">yellow</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">blue</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dark-blue</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">magenta</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">violet</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">cyan</span><span style="color: #51afef;">)</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dark-cyan</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">org-msg-currently-exporting</span> <span style="color: #7bc275;">""</span>
      <span style="color: #7bc275;">"</span>
<span style="color: #7bc275;">&lt;link rel='stylesheet' type='text/css' href='https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css'/&gt;</span>
<span style="color: #7bc275;">&lt;link rel='stylesheet' type='text/css' href='https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css'/&gt;</span>

<span style="color: #7bc275;">&lt;script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'&gt;&lt;/script&gt;</span>
<span style="color: #7bc275;">&lt;script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js'&gt;&lt;/script&gt;</span>
<span style="color: #7bc275;">&lt;script type='text/javascript' src='https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js'&gt;&lt;/script&gt;</span>
<span style="color: #7bc275;">&lt;script type='text/javascript' src='https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js'&gt;&lt;/script&gt;</span>

<span style="color: #7bc275;">&lt;style&gt;</span>
<span style="color: #7bc275;"> pre.src {</span>
<span style="color: #7bc275;">     background-color: var(--theme-bg);</span>
<span style="color: #7bc275;">     color: var(--theme-fg);</span>
<span style="color: #7bc275;">     scrollbar-color:#bbb6#9992;</span>
<span style="color: #7bc275;">     scrollbar-width: thin;</span>
<span style="color: #7bc275;">     margin: 0;</span>
<span style="color: #7bc275;">     border: none;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> div.org-src-container {</span>
<span style="color: #7bc275;">     border-radius: 12px;</span>
<span style="color: #7bc275;">     overflow: hidden;</span>
<span style="color: #7bc275;">     margin-bottom: 24px;</span>
<span style="color: #7bc275;">     margin-top: 1px;</span>
<span style="color: #7bc275;">     border: 1px solid#e1e4e5;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> pre.src::before {</span>
<span style="color: #7bc275;">     background-color:#6666;</span>
<span style="color: #7bc275;">     top: 8px;</span>
<span style="color: #7bc275;">     border: none;</span>
<span style="color: #7bc275;">     border-radius: 5px;</span>
<span style="color: #7bc275;">     line-height: 1;</span>
<span style="color: #7bc275;">     border: 2px solid var(--theme-bg);</span>
<span style="color: #7bc275;">     opacity: 0;</span>
<span style="color: #7bc275;">     transition: opacity 200ms;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> pre.src:hover::before { opacity: 1; }</span>
<span style="color: #7bc275;"> pre.src:active::before { opacity: 0; }</span>

<span style="color: #7bc275;"> pre.example {</span>
<span style="color: #7bc275;">     border-radius: 12px;</span>
<span style="color: #7bc275;">     background: var(--theme-bg-alt);</span>
<span style="color: #7bc275;">     color: var(--theme-fg);</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> code {</span>
<span style="color: #7bc275;">     border-radius: 5px;</span>
<span style="color: #7bc275;">     background:#e8e8e8;</span>
<span style="color: #7bc275;">     font-size: 80%;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> kbd {</span>
<span style="color: #7bc275;">     display: inline-block;</span>
<span style="color: #7bc275;">     padding: 3px 5px;</span>
<span style="color: #7bc275;">     font: 80% SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;</span>
<span style="color: #7bc275;">     line-height: normal;</span>
<span style="color: #7bc275;">     line-height: 10px;</span>
<span style="color: #7bc275;">     color:#444d56;</span>
<span style="color: #7bc275;">     vertical-align: middle;</span>
<span style="color: #7bc275;">     background-color:#fafbfc;</span>
<span style="color: #7bc275;">     border: 1px solid#d1d5da;</span>
<span style="color: #7bc275;">     border-radius: 3px;</span>
<span style="color: #7bc275;">     box-shadow: inset 0 -1px 0#d1d5da;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> table {</span>
<span style="color: #7bc275;">     max-width: 100%;</span>
<span style="color: #7bc275;">     overflow-x: auto;</span>
<span style="color: #7bc275;">     display: block;</span>
<span style="color: #7bc275;">     border-top: none;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> a:not([aria-hidden='true']) {</span>
<span style="color: #7bc275;">     text-decoration: none;</span>
<span style="color: #7bc275;">     background-image: linear-gradient(#d8dce9, #d8dce9);</span>
<span style="color: #7bc275;">     background-position: 0% 100%;</span>
<span style="color: #7bc275;">     background-repeat: no-repeat;</span>
<span style="color: #7bc275;">     background-size: 0% 2px;</span>
<span style="color: #7bc275;">     transition: background-size .3s;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> </span><span style="color: #FCCE7B;">\</span><span style="color: #7bc275;">#table-of-contents a {</span>
<span style="color: #7bc275;">     background-image: none;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> a:hover:not([aria-hidden='true']),</span>
<span style="color: #7bc275;"> a:focus:not([aria-hidden='true']) {</span>
<span style="color: #7bc275;">     background-size: 100% 2px;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> a[href^='#'] { font-variant-numeric: oldstyle-nums; }</span>
<span style="color: #7bc275;"> a[href^='#']:visited { color:#3091d1; }</span>

<span style="color: #7bc275;"> li .checkbox {</span>
<span style="color: #7bc275;">     display: inline-block;</span>
<span style="color: #7bc275;">     width: 0.9em;</span>
<span style="color: #7bc275;">     height: 0.9em;</span>
<span style="color: #7bc275;">     border-radius: 3px;</span>
<span style="color: #7bc275;">     margin: 3px;</span>
<span style="color: #7bc275;">     top: 4px;</span>
<span style="color: #7bc275;">     position: relative;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> li.on &gt; .checkbox { background: var(--theme-green); box-shadow: 0 0 2px var(--theme-green); }</span>
<span style="color: #7bc275;"> li.trans &gt; .checkbox { background: var(--theme-orange); box-shadow: 0 0 2px var(--theme-orange); }</span>
<span style="color: #7bc275;"> li.off &gt; .checkbox { background: var(--theme-red); box-shadow: 0 0 2px var(--theme-red); }</span>
<span style="color: #7bc275;"> li.on &gt; .checkbox::after {</span>
<span style="color: #7bc275;">     content: '';</span>
<span style="color: #7bc275;">     height: 0.45em;</span>
<span style="color: #7bc275;">     width: 0.225em;</span>
<span style="color: #7bc275;">     -webkit-transform-origin: left top;</span>
<span style="color: #7bc275;">     transform-origin: left top;</span>
<span style="color: #7bc275;">     transform: scaleX(-1) rotate(135deg);</span>
<span style="color: #7bc275;">     border-right: 2.8px solid#fff;</span>
<span style="color: #7bc275;">     border-top: 2.8px solid#fff;</span>
<span style="color: #7bc275;">     opacity: 0.9;</span>
<span style="color: #7bc275;">     left: 0.10em;</span>
<span style="color: #7bc275;">     top: 0.45em;</span>
<span style="color: #7bc275;">     position: absolute;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> li.trans &gt; .checkbox::after {</span>
<span style="color: #7bc275;">     content: '';</span>
<span style="color: #7bc275;">     font-weight: bold;</span>
<span style="color: #7bc275;">     font-size: 1.6em;</span>
<span style="color: #7bc275;">     position: absolute;</span>
<span style="color: #7bc275;">     top: 0.23em;</span>
<span style="color: #7bc275;">     left: 0.09em;</span>
<span style="color: #7bc275;">     width: 0.35em;</span>
<span style="color: #7bc275;">     height: 0.12em;</span>
<span style="color: #7bc275;">     background:#fff;</span>
<span style="color: #7bc275;">     opacity: 0.9;</span>
<span style="color: #7bc275;">     border-radius: 0.1em;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;"> li.off &gt; .checkbox::after {</span>
<span style="color: #7bc275;">     content: '&#10006;';</span>
<span style="color: #7bc275;">     color:#fff;</span>
<span style="color: #7bc275;">     opacity: 0.9;</span>
<span style="color: #7bc275;">     position: relative;</span>
<span style="color: #7bc275;">     top: -0.40rem;</span>
<span style="color: #7bc275;">     left: 0.17em;</span>
<span style="color: #7bc275;">     font-size: 0.75em;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> span.timestamp {</span>
<span style="color: #7bc275;">     color: #003280;</span>
<span style="color: #7bc275;">     background: #647CFF44;</span>
<span style="color: #7bc275;">     border-radius: 3px;</span>
<span style="color: #7bc275;">     line-height: 1.25;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> </span><span style="color: #FCCE7B;">\</span><span style="color: #7bc275;">#content img {</span>
<span style="color: #7bc275;">     border-radius: 3px;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> </span><span style="color: #FCCE7B;">\</span><span style="color: #7bc275;">#table-of-contents { overflow-y: auto; }</span>
<span style="color: #7bc275;"> blockquote p { margin: 8px 0px 16px 0px; }</span>
<span style="color: #7bc275;"> </span><span style="color: #FCCE7B;">\</span><span style="color: #7bc275;">#postamble .date { color: var(--theme-green); }</span>

<span style="color: #7bc275;"> ::-webkit-scrollbar { width: 10px; height: 8px; }</span>
<span style="color: #7bc275;"> ::-webkit-scrollbar-track { background:#9992; }</span>
<span style="color: #7bc275;"> ::-webkit-scrollbar-thumb { background:#ccc; border-radius: 10px; }</span>
<span style="color: #7bc275;"> ::-webkit-scrollbar-thumb:hover { background:#888; }</span>

<span style="color: #7bc275;"> /* sometimes this all-important space seems to go missing</span>
<span style="color: #7bc275;"> /so let's protect against that. If it's exteranious it's</span>
<span style="color: #7bc275;"> /just gobbled anyway. */</span>
<span style="color: #7bc275;"> span.section-number-1:after,</span>
<span style="color: #7bc275;"> span.section-number-2:after,</span>
<span style="color: #7bc275;"> span.section-number-3:after,</span>
<span style="color: #7bc275;"> span.section-number-4:after,</span>
<span style="color: #7bc275;"> span.section-number-5:after,</span>
<span style="color: #7bc275;"> span.section-number-6:after {</span>
<span style="color: #7bc275;">     content: ' '</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> /* so the bounding box coveres the &lt;a&gt; */</span>
<span style="color: #7bc275;"> h1,h2,h3,h4,h5,h6 {</span>
<span style="color: #7bc275;">     padding-left: 30px;</span>
<span style="color: #7bc275;">     margin-left: -30px;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> h1 &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h2 &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h3 &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h4 &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h5 &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h6 &gt; a[aria-hidden='true'] {</span>
<span style="color: #7bc275;">     color: #6a737d;</span>
<span style="color: #7bc275;">     float: left;</span>
<span style="color: #7bc275;">     padding-right: 4px;</span>
<span style="color: #7bc275;">     margin-left: -25px;</span>
<span style="color: #7bc275;">     position: relative;</span>
<span style="color: #7bc275;">     top: 7px;</span>
<span style="color: #7bc275;">     line-height: 1;</span>
<span style="color: #7bc275;">     font-size: 70%;</span>
<span style="color: #7bc275;">     visibility: hidden;</span>
<span style="color: #7bc275;"> }</span>

<span style="color: #7bc275;"> h1:hover &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h2:hover &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h3:hover &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h4:hover &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h5:hover &gt; a[aria-hidden='true'],</span>
<span style="color: #7bc275;"> h6:hover &gt; a[aria-hidden='true'] {</span>
<span style="color: #7bc275;">     visibility: visible;</span>
<span style="color: #7bc275;"> }</span>
<span style="color: #7bc275;">&lt;/style&gt;</span>
<span style="color: #7bc275;">"</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">"&lt;!&#8211;&#8211;tec/custom-head-end--&gt;"</span>
      <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

<span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-export-before-processing-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">my-org-inline-css-hook</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-make-verbatim-different" class="outline-6">
<h6 id="make-verbatim-different"> <a class="anchor" aria-hidden="true" href="#make-verbatim-different">🔗</a> <a class="anchor" aria-hidden="true" href="#make-verbatim-different">🔗</a> <a class="anchor" aria-hidden="true" href="#make-verbatim-different">🔗</a> <a class="anchor" aria-hidden="true" href="#make-verbatim-different">🔗</a> <a class="anchor" aria-hidden="true" href="#make-verbatim-different">🔗</a><span class="section-number-6">5.2.3.3.2</span> Make verbatim different to code</h6>
<div class="outline-text-6" id="text-5-2-3-3-2">
<p>
Since we have <kbd>verbatim</kbd> and <code>code</code>, let&rsquo;s use <kbd>verbatim</kbd> for key strokes.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-html-text-markup-alist</span>
      <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">bold</span> . <span style="color: #7bc275;">"&lt;b&gt;%s&lt;/b&gt;"</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>code . <span style="color: #7bc275;">"&lt;code&gt;%s&lt;/code&gt;"</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>italic . <span style="color: #7bc275;">"&lt;i&gt;%s&lt;/i&gt;"</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>strike-through . <span style="color: #7bc275;">"&lt;del&gt;%s&lt;/del&gt;"</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>underline . <span style="color: #7bc275;">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>verbatim . <span style="color: #7bc275;">"&lt;kbd&gt;%s&lt;/kbd&gt;"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-change-checkbox-type" class="outline-6">
<h6 id="change-checkbox-type"> <a class="anchor" aria-hidden="true" href="#change-checkbox-type">🔗</a> <a class="anchor" aria-hidden="true" href="#change-checkbox-type">🔗</a> <a class="anchor" aria-hidden="true" href="#change-checkbox-type">🔗</a> <a class="anchor" aria-hidden="true" href="#change-checkbox-type">🔗</a> <a class="anchor" aria-hidden="true" href="#change-checkbox-type">🔗</a><span class="section-number-6">5.2.3.3.3</span> Change checkbox type</h6>
<div class="outline-text-6" id="text-5-2-3-3-3">
<p>
We also want to use HTML checkboxes, however we want to get a bit fancier than default
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
<span style="color: #C57BDB;">(</span><span style="color: #51afef;">appendq!</span> <span style="color: #DFDFDF;">org-html-checkbox-types</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>html-span .
    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>on . <span style="color: #7bc275;">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span>off . <span style="color: #7bc275;">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span>trans . <span style="color: #7bc275;">"&lt;span class='checkbox'&gt;&lt;/span&gt;"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
<span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-html-checkbox-type</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">html-span</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<ul class="org-ul">
<li class="off"><span class='checkbox'></span> I&rsquo;m yet to do this</li>
<li class="trans"><span class='checkbox'></span> Work in progress</li>
<li class="on"><span class='checkbox'></span> This is done</li>
</ul>
</div>
</div>
<div id="outline-container-header-anchors" class="outline-6">
<h6 id="header-anchors"> <a class="anchor" aria-hidden="true" href="#header-anchors">🔗</a> <a class="anchor" aria-hidden="true" href="#header-anchors">🔗</a> <a class="anchor" aria-hidden="true" href="#header-anchors">🔗</a> <a class="anchor" aria-hidden="true" href="#header-anchors">🔗</a> <a class="anchor" aria-hidden="true" href="#header-anchors">🔗</a><span class="section-number-6">5.2.3.3.4</span> Header anchors</h6>
<div class="outline-text-6" id="text-5-2-3-3-4">
<p>
I want to add github-style links on hover for headings.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/org-export-html-headline-anchor</span> <span style="color: #7bc275;">(</span>text backend info<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">html</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #DFDFDF;">org-msg-currently-exporting</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span>
         <span style="color: #7bc275;">"&lt;h</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[0-9]</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;"> id=\"</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[a-z0-9-]+</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">\"&gt;"</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">this is quite restrictive, but due to `</span><span style="color: #a991f1;">org-heading-contraction</span><span style="color: #62686E;">' I can do this</span>
         <span style="color: #7bc275;">"&lt;h\\1 id=\"\\2\"&gt;\</span>
<span style="color: #7bc275;"> &lt;a class=\"anchor\" aria-hidden=\"true\" href=\"#\\2\"&gt;&#128279;&lt;/a&gt;"</span>
         text<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-export-filter-headline-functions</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">tec/org-export-html-headline-anchor</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
It&rsquo;s worth noting that <code>org-msg-currently-exporting</code> is defined in <a href="#org-msg">Org Msg</a>.
</p>
</div>
</div>
<div id="outline-container-latex-rendering" class="outline-6">
<h6 id="latex-rendering"> <a class="anchor" aria-hidden="true" href="#latex-rendering">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-rendering">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-rendering">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-rendering">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-rendering">🔗</a><span class="section-number-6">5.2.3.3.5</span> LaTeX Rendering</h6>
<div class="outline-text-6" id="text-5-2-3-3-5">
<p>
When displaying images, we want to resize by the reciprocal of <code>preview-scale</code>.
Unfortunately that doesn&rsquo;t happen by default, but not to worry! Advice exists.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
<span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> org-html-latex-fragment-scaled <span style="color: #7bc275;">(</span>latex-fragment _contents info<span style="color: #7bc275;">)</span>
  <span style="color: #7e7e87;">"Transcode a LATEX-FRAGMENT object from Org to HTML.</span>
<span style="color: #7e7e87;">CONTENTS is nil.  INFO is a plist holding contextual information."</span>
  <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-html-latex-fragment</span>
  <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>latex-frag <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:value</span> latex-fragment<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>processing-type <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> info <span style="color: #C57BDB;">:with-latex</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>attrs <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:class</span> <span style="color: #7bc275;">"latex-fragment"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> processing-type <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dvipng</span><span style="color: #C57BDB;">)</span>
      <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-put</span> attrs <span style="color: #C57BDB;">:style</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"transform: scale(%.3f)"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">/</span> <span style="color: #e69055; font-weight: bold;">1.0</span> <span style="color: #DFDFDF;">preview-scale</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
     <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">memq</span> processing-type <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span>t mathjax<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html-format-latex</span> latex-frag <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mathjax</span> info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
     <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">memq</span> processing-type <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span>t html<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html-format-latex</span> latex-frag <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">html</span> info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
     <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">assq</span> processing-type <span style="color: #DFDFDF;">org-preview-latex-process-alist</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>formula-link
             <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html-format-latex</span> latex-frag processing-type info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> formula-link <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #7bc275;">"file:</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">]]*</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">"</span> formula-link<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>source <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-export-file-uri</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> formula-link<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
            <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html--format-image</span> source attrs info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
     <span style="color: #C57BDB;">(</span>t latex-frag<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

<span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> org-html-latex-environment-scaled <span style="color: #7bc275;">(</span>latex-environment _contents info<span style="color: #7bc275;">)</span>
  <span style="color: #7e7e87;">"Transcode a LATEX-ENVIRONMENT element from Org to HTML.</span>
<span style="color: #7e7e87;">CONTENTS is nil.  INFO is a plist holding contextual information."</span>
  <span style="color: #C57BDB;">:override</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-html-latex-environment</span>
  <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>processing-type <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> info <span style="color: #C57BDB;">:with-latex</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>latex-frag <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-remove-indentation</span>
                     <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:value</span> latex-environment<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>attributes <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-export-read-attribute</span> <span style="color: #C57BDB;">:attr_html</span> latex-environment<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>label <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-element-property</span> <span style="color: #C57BDB;">:name</span> latex-environment<span style="color: #51afef;">)</span>
                    <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-export-get-reference</span> latex-environment info<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>caption <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-html--latex-environment-numbered-p</span> latex-environment<span style="color: #51afef;">)</span>
                      <span style="color: #51afef;">(</span><span style="color: #a991f1;">number-to-string</span>
                       <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-export-get-ordinal</span>
                        latex-environment info nil
                        <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>l _<span style="color: #51afef;">)</span>
                          <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-html--math-environment-p</span> l<span style="color: #C57BDB;">)</span>
                               <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-html--latex-environment-numbered-p</span> l<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span><span style="color: #a991f1;">plist-put</span> attributes <span style="color: #C57BDB;">:class</span> <span style="color: #7bc275;">"latex-environment"</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">eq</span> processing-type <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dvipng</span><span style="color: #C57BDB;">)</span>
      <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-put</span> attributes <span style="color: #C57BDB;">:style</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"transform: scale(%.3f)"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">/</span> <span style="color: #e69055; font-weight: bold;">1.0</span> <span style="color: #DFDFDF;">preview-scale</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span>
     <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">memq</span> processing-type <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span>t mathjax<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html-format-latex</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-string-nw-p</span> label<span style="color: #C57BDB;">)</span>
     <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span> <span style="color: #7bc275;">"\\`.*"</span>
             <span style="color: #7bc275;">(</span><span style="color: #a991f1;">format</span> <span style="color: #7bc275;">"\\&amp;\n\\\\label{%s}"</span> label<span style="color: #7bc275;">)</span>
             latex-frag<span style="color: #C57BDB;">)</span>
   latex-frag<span style="color: #51afef;">)</span>
       <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mathjax</span> info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
     <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">assq</span> processing-type <span style="color: #DFDFDF;">org-preview-latex-process-alist</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span>formula-link
             <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html-format-latex</span>
              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-html--unlabel-latex-environment</span> latex-frag<span style="color: #51afef;">)</span>
              processing-type info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> formula-link <span style="color: #7bc275;">(</span><span style="color: #a991f1;">string-match</span> <span style="color: #7bc275;">"file:</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">[</span><span style="color: #C57BDB; font-weight: bold;">^</span><span style="color: #7bc275;">]]*</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">"</span> formula-link<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span><span style="color: #51afef;">let</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span>source <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">org-export-file-uri</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">match-string</span> <span style="color: #e69055; font-weight: bold;">1</span> formula-link<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html--wrap-latex-environment</span>
       <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-html--format-image</span> source attributes info<span style="color: #51afef;">)</span>
       info caption label<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
     <span style="color: #C57BDB;">(</span>t <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">org-html--wrap-latex-environment</span> latex-frag info caption label<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
On the maths side of things, I consider <code>dvisvgm</code> to be a rather compelling
option. However this isn&rsquo;t sized very well at the moment.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">(setq-default org-html-with-latex `dvisvgm)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-exporting-latex" class="outline-5">
<h5 id="exporting-latex"> <a class="anchor" aria-hidden="true" href="#exporting-latex">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex">🔗</a><span class="section-number-5">5.2.3.4</span> Exporting to LaTeX</h5>
<div class="outline-text-5" id="text-5-2-3-4">
<p>
I like automatically using spaced small caps for acronyms. For strings I want to
be unaffected lest&rsquo;s use <code>;</code> as a prefix to prevent the transformation &#x2014; i.e.
<code>;JFK</code> (as one would want for two-letter geographic locations and names).
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #62686E;"> make this /only/ apply to text (i.e. not URL)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/org-export-latex-filter-acronym</span> <span style="color: #7bc275;">(</span>text backend info<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">let</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #DFDFDF;">case-fold-search</span> nil<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span>
         <span style="color: #7bc275;">"[;\\\\]?\\b[A-Z][A-Z]+s?"</span>
         <span style="color: #7bc275;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>all-caps-str<span style="color: #51afef;">)</span>
           <span style="color: #62686E;">; </span><span style="color: #62686E;">only \acr if str doesn't start with ";" or "\" (for LaTeX commands)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">aref</span> all-caps-str <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span> ?\;<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">substring</span> all-caps-str <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">aref</span> all-caps-str <span style="color: #e69055; font-weight: bold;">0</span><span style="color: #51afef;">)</span> ?\\<span style="color: #7bc275;">)</span> all-caps-str<span style="color: #C57BDB;">)</span>
                 <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">aref</span> all-caps-str <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">-</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">length</span> all-caps-str<span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> ?s<span style="color: #7bc275;">)</span>
                  <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"\\textls*[70]{\\textsc{"</span>
                            <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">s-downcase</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">substring</span> all-caps-str <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #e69055; font-weight: bold;">-1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
                            <span style="color: #7bc275;">"}\\protect\\scalebox{.91}[.84]{s}}"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
                 <span style="color: #C57BDB;">(</span>t <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"\\textls*[70]{\\textsc{"</span>
                              <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">s-downcase</span> all-caps-str<span style="color: #51afef;">)</span> <span style="color: #7bc275;">"}}"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
         text t t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-export-filter-plain-text-functions</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">tec/org-export-latex-filter-acronym</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-export-filter-headline-functions</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">tec/org-export-latex-filter-acronym</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> org
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/org-export-latex-fancy-item-checkboxes</span> <span style="color: #7bc275;">(</span>text backend info<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">org-export-derived-backend-p</span> backend <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">replace-regexp-in-string</span>
       <span style="color: #7bc275;">"\\\\item\\[{$\\\\</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">\\w+</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">)</span><span style="color: #7bc275;">$}\\]"</span>
       <span style="color: #C57BDB;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #7bc275;">(</span>fullmatch<span style="color: #7bc275;">)</span>
         <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"\\\\item["</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">pcase</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">substring</span> fullmatch <span style="color: #e69055; font-weight: bold;">9</span> <span style="color: #e69055; font-weight: bold;">-3</span><span style="color: #C57BDB;">)</span> <span style="color: #62686E;">; </span><span style="color: #62686E;">content of capture group</span>
                               <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"square"</span>   <span style="color: #7bc275;">"\\\\ifdefined\\\\checkboxUnchecked\\\\checkboxUnchecked\\\\else$\\\\square$\\\\fi"</span>    <span style="color: #C57BDB;">)</span>
                               <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"boxminus"</span> <span style="color: #7bc275;">"\\\\ifdefined\\\\checkboxTransitive\\\\checkboxTransitive\\\\else$\\\\boxminus$\\\\fi"</span><span style="color: #C57BDB;">)</span>
                               <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"boxtimes"</span> <span style="color: #7bc275;">"\\\\ifdefined\\\\checkboxChecked\\\\checkboxChecked\\\\else$\\\\boxtimes$\\\\fi"</span>      <span style="color: #C57BDB;">)</span>
                               <span style="color: #C57BDB;">(</span>_ <span style="color: #7bc275;">(</span><span style="color: #a991f1;">substring</span> fullmatch <span style="color: #e69055; font-weight: bold;">9</span> <span style="color: #e69055; font-weight: bold;">-3</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #7bc275;">"]"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
       text<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-export-filter-item-functions</span>
               <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">tec/org-export-latex-fancy-item-checkboxes</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Now for a few more adjustments.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> ox-latex
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-latex-classes</span>
               <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"fancy-article"</span>
                 <span style="color: #7bc275;">"\\documentclass{scrartcl}\n\</span>
<span style="color: #7bc275;">\\usepackage[T1]{fontenc}\n\</span>
<span style="color: #7bc275;">\\usepackage[osf,largesc,helvratio=0.9]{newpxtext}\n\</span>
<span style="color: #7bc275;">\\usepackage[scale=0.92]{sourcecodepro}\n\</span>
<span style="color: #7bc275;">\\usepackage[varbb]{newpxmath}\n\</span>

<span style="color: #7bc275;">\\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000]{microtype}\n\</span>
<span style="color: #7bc275;">\\usepackage{xcolor}\n\</span>
<span style="color: #7bc275;">\\usepackage{booktabs}</span>

<span style="color: #7bc275;">\\usepackage{subcaption}</span>
<span style="color: #7bc275;">\\usepackage[hypcap=true]{caption}</span>
<span style="color: #7bc275;">\\setkomafont{caption}{\\sffamily\\small}</span>
<span style="color: #7bc275;">\\setkomafont{captionlabel}{\\upshape\\bfseries}</span>
<span style="color: #7bc275;">\\captionsetup{justification=raggedright,singlelinecheck=true}</span>
<span style="color: #7bc275;">\\setcapindent{0pt}</span>

<span style="color: #7bc275;">\\setlength{\\parskip}{\\baselineskip}\n\</span>
<span style="color: #7bc275;">\\setlength{\\parindent}{0pt}\n\</span>

<span style="color: #7bc275;">\\usepackage{pifont}</span>
<span style="color: #7bc275;">\\newcommand{\\checkboxUnchecked}{$\\square$}</span>
<span style="color: #7bc275;">\\newcommand{\\checkboxTransitive}{\\rlap{\\raisebox{0.0ex}{\\hspace{0.35ex}\\Large\\textbf -}}$\\square$}</span>
<span style="color: #7bc275;">\\newcommand{\\checkboxChecked}{\\rlap{\\raisebox{0.2ex}{\\hspace{0.35ex}\\scriptsize \\ding{56}}}$\\square$}</span>

<span style="color: #7bc275;">\\newenvironment{warning}</span>
<span style="color: #7bc275;">    {\\begin{center}</span>
<span style="color: #7bc275;">    \\begin{tabular}{rp{0.9\\textwidth}}</span>
<span style="color: #7bc275;">    \\ding{82} &amp; \\textbf{Warning} \\\\ &amp;</span>
<span style="color: #7bc275;">    }</span>
<span style="color: #7bc275;">    {</span>
<span style="color: #7bc275;">    \\end{tabular}</span>
<span style="color: #7bc275;">    \\end{center}</span>
<span style="color: #7bc275;">    }</span>
<span style="color: #7bc275;">"</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\section{%s}"</span> . <span style="color: #7bc275;">"\\section*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsection{%s}"</span> . <span style="color: #7bc275;">"\\subsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsubsection{%s}"</span> . <span style="color: #7bc275;">"\\subsubsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\paragraph{%s}"</span> . <span style="color: #7bc275;">"\\paragraph*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subparagraph{%s}"</span> . <span style="color: #7bc275;">"\\subparagraph*{%s}"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-latex-classes</span>
               <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"blank"</span>
               <span style="color: #7bc275;">"[NO-DEFAULT-PACKAGES]</span>
<span style="color: #7bc275;">               [NO-PACKAGES]</span>
<span style="color: #7bc275;">               [EXTRA]"</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\section{%s}"</span> . <span style="color: #7bc275;">"\\section*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsection{%s}"</span> . <span style="color: #7bc275;">"\\subsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsubsection{%s}"</span> . <span style="color: #7bc275;">"\\subsubsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\paragraph{%s}"</span> . <span style="color: #7bc275;">"\\paragraph*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subparagraph{%s}"</span> . <span style="color: #7bc275;">"\\subparagraph*{%s}"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-latex-classes</span>
               <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"bmc-article"</span>
               <span style="color: #7bc275;">"\\documentclass[article,code,maths]{bmc}</span>
<span style="color: #7bc275;">               [NO-DEFAULT-PACKAGES]</span>
<span style="color: #7bc275;">               [NO-PACKAGES]</span>
<span style="color: #7bc275;">               [EXTRA]"</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\section{%s}"</span> . <span style="color: #7bc275;">"\\section*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsection{%s}"</span> . <span style="color: #7bc275;">"\\subsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsubsection{%s}"</span> . <span style="color: #7bc275;">"\\subsubsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\paragraph{%s}"</span> . <span style="color: #7bc275;">"\\paragraph*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subparagraph{%s}"</span> . <span style="color: #7bc275;">"\\subparagraph*{%s}"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-latex-classes</span>
               <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"bmc"</span>
               <span style="color: #7bc275;">"\\documentclass[code,maths]{bmc}</span>
<span style="color: #7bc275;">               [NO-DEFAULT-PACKAGES]</span>
<span style="color: #7bc275;">               [NO-PACKAGES]</span>
<span style="color: #7bc275;">               [EXTRA]"</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\chapter{%s}"</span> . <span style="color: #7bc275;">"\\chapter*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\section{%s}"</span> . <span style="color: #7bc275;">"\\section*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsection{%s}"</span> . <span style="color: #7bc275;">"\\subsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subsubsection{%s}"</span> . <span style="color: #7bc275;">"\\subsubsection*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\paragraph{%s}"</span> . <span style="color: #7bc275;">"\\paragraph*{%s}"</span><span style="color: #51afef;">)</span>
               <span style="color: #51afef;">(</span><span style="color: #7bc275;">"\\subparagraph{%s}"</span> . <span style="color: #7bc275;">"\\subparagraph*{%s}"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-latex-default-class</span> <span style="color: #7bc275;">"fancy-article"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-latex-packages-alist</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">""</span> <span style="color: #7bc275;">"minted"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-latex-listings</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">minted</span>
        <span style="color: #DFDFDF;">org-latex-minted-options</span>
        <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"frame"</span> <span style="color: #7bc275;">"lines"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"fontsize"</span> <span style="color: #7bc275;">"\\scriptsize"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"linenos"</span> <span style="color: #7bc275;">""</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakanywhere"</span> <span style="color: #7bc275;">"true"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakautoindent"</span> <span style="color: #7bc275;">"true"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breaklines"</span> <span style="color: #7bc275;">"true"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"autogobble"</span> <span style="color: #7bc275;">"true"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"obeytabs"</span> <span style="color: #7bc275;">"true"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"python3"</span> <span style="color: #7bc275;">"true"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakbefore"</span> <span style="color: #7bc275;">"\\\\\\.+"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakafter"</span> <span style="color: #7bc275;">"\\,"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"style"</span> <span style="color: #7bc275;">"autumn"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breaksymbol"</span> <span style="color: #7bc275;">"\\tiny\\ensuremath{\\hookrightarrow}"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakanywheresymbolpre"</span> <span style="color: #7bc275;">"\\,\\footnotesize\\ensuremath{{}_{\\rfloor}}"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakbeforesymbolpre"</span> <span style="color: #7bc275;">"\\,\\footnotesize\\ensuremath{{}_{\\rfloor}}"</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #7bc275;">"breakaftersymbolpre"</span> <span style="color: #7bc275;">"\\,\\footnotesize\\ensuremath{{}_{\\rfloor}}"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-latex-tables-booktabs</span> t<span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-latex-hyperref-template</span> <span style="color: #7bc275;">"</span>
<span style="color: #7bc275;">\\colorlet{greenyblue}{blue!70!green}</span>
<span style="color: #7bc275;">\\colorlet{blueygreen}{blue!40!green}</span>
<span style="color: #7bc275;">\\providecolor{link}{named}{greenyblue}</span>
<span style="color: #7bc275;">\\providecolor{cite}{named}{blueygreen}</span>
<span style="color: #7bc275;">\\hypersetup{</span>
<span style="color: #7bc275;">  pdfauthor={%a},</span>
<span style="color: #7bc275;">  pdftitle={%t},</span>
<span style="color: #7bc275;">  pdfkeywords={%k},</span>
<span style="color: #7bc275;">  pdfsubject={%d},</span>
<span style="color: #7bc275;">  pdfcreator={%c},</span>
<span style="color: #7bc275;">  pdflang={%L},</span>
<span style="color: #7bc275;">  breaklinks=true,</span>
<span style="color: #7bc275;">  colorlinks=true,</span>
<span style="color: #7bc275;">  linkcolor=,</span>
<span style="color: #7bc275;">  urlcolor=link,</span>
<span style="color: #7bc275;">  citecolor=cite\n}</span>
<span style="color: #7bc275;">\\urlstyle{same}\n"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-latex-pdf-process</span>
        <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"latexmk -shell-escape -interaction=nonstopmode -f -pdf -output-directory=%o %f"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
<div id="outline-container-chameleon-aka-match" class="outline-6">
<h6 id="chameleon-aka-match"> <a class="anchor" aria-hidden="true" href="#chameleon-aka-match">🔗</a> <a class="anchor" aria-hidden="true" href="#chameleon-aka-match">🔗</a> <a class="anchor" aria-hidden="true" href="#chameleon-aka-match">🔗</a> <a class="anchor" aria-hidden="true" href="#chameleon-aka-match">🔗</a> <a class="anchor" aria-hidden="true" href="#chameleon-aka-match">🔗</a><span class="section-number-6">5.2.3.4.1</span> Chameleon &#x2014; aka. match theme</h6>
<div class="outline-text-6" id="text-5-2-3-4-1">
<p>
Once the idea of having the look of the LaTeX document produced match the
current Emacs theme, I was enraptured. The result is the pseudo-class <code>chameleon</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> ox
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">ox-chameleon-base-class</span> <span style="color: #7bc275;">"fancy-article"</span>
    <span style="color: #7e7e87;">"The base class that chameleon builds on"</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">ox-chameleon--p</span> nil
    <span style="color: #7e7e87;">"Used to indicate whether the current export is trying to blend in. Set just before being accessed."</span><span style="color: #C57BDB;">)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">(setf (alist-get :filter-latex-class</span>
  <span style="color: #62686E;">;;                  </span><span style="color: #62686E;">(org-export-backend-filters</span>
  <span style="color: #62686E;">;;                   </span><span style="color: #62686E;">(org-export-get-backend 'latex)))</span>
  <span style="color: #62686E;">;;       </span><span style="color: #62686E;">'ox-chameleon-latex-class-detector-filter)</span>

  <span style="color: #62686E;">;; </span><span style="color: #62686E;">(defun ox-chameleon-latex-class-detector-filter (info backend)</span>
  <span style="color: #62686E;">;;   </span><span style="color: #62686E;">""</span>
  <span style="color: #62686E;">;;   </span><span style="color: #62686E;">(setq ox-chameleon--p (when (equal (plist-get info :latex-class)</span>
  <span style="color: #62686E;">;;                                      </span><span style="color: #62686E;">"chameleon")</span>
  <span style="color: #62686E;">;;                           </span><span style="color: #62686E;">(plist-put info :latex-class ox-chameleon-base-class)</span>
  <span style="color: #62686E;">;;                           </span><span style="color: #62686E;">t)))</span>

  <span style="color: #62686E;">;; </span><span style="color: #FCCE7B; font-weight: bold;">TODO</span><span style="color: #62686E;"> make this less hacky. One ideas was as follows</span>
  <span style="color: #62686E;">;; </span><span style="color: #62686E;">(map-put (org-export-backend-filters (org-export-get-backend 'latex))</span>
  <span style="color: #62686E;">;;           </span><span style="color: #62686E;">:filter-latex-class 'ox-chameleon-latex-class-detector-filter))</span>
  <span style="color: #62686E;">;; </span><span style="color: #62686E;">Never seemed to execute though</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> ox-chameleon-org-latex-detect <span style="color: #7bc275;">(</span>orig-fun info<span style="color: #7bc275;">)</span>
    <span style="color: #C57BDB;">:around</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-export-install-filters</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">ox-chameleon--p</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">equal</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">plist-get</span> info <span style="color: #C57BDB;">:latex-class</span><span style="color: #7bc275;">)</span>
                                       <span style="color: #7bc275;">"chameleon"</span><span style="color: #C57BDB;">)</span>
                            <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">plist-put</span> info <span style="color: #C57BDB;">:latex-class</span> <span style="color: #DFDFDF;">ox-chameleon-base-class</span><span style="color: #C57BDB;">)</span>
                            t<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">funcall</span> orig-fun info<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defadvice!</span> ox-chameleon-org-latex-export <span style="color: #7bc275;">(</span>orig-fn info <span style="color: #FCCE7B;">&amp;optional</span> template snippet?<span style="color: #7bc275;">)</span>
    <span style="color: #C57BDB;">:around</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">org-latex-make-preamble</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">funcall</span> orig-fn info<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">not</span> <span style="color: #DFDFDF;">ox-chameleon--p</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #a991f1;">funcall</span> orig-fn info template snippet?<span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">funcall</span> orig-fn info template snippet?<span style="color: #C57BDB;">)</span>
              <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">ox-chameleon-generate-colourings</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>

  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">ox-chameleon-generate-colourings</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">apply</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">format</span>
           <span style="color: #7bc275;">"%% make document follow Emacs theme</span>
<span style="color: #7bc275;">\\definecolor{bg}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{fg}{HTML}{%s}</span>

<span style="color: #7bc275;">\\definecolor{red}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{orange}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{green}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{teal}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{yellow}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{blue}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{dark-blue}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{magenta}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{violet}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{cyan}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{dark-cyan}{HTML}{%s}</span>

<span style="color: #7bc275;">\\definecolor{level1}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level2}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level3}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level4}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level5}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level6}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level7}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{level8}{HTML}{%s}</span>

<span style="color: #7bc275;">\\definecolor{link}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{cite}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{itemlabel}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{code}{HTML}{%s}</span>
<span style="color: #7bc275;">\\definecolor{verbatim}{HTML}{%s}</span>

<span style="color: #7bc275;">\\pagecolor{bg}</span>
<span style="color: #7bc275;">\\color{fg}</span>

<span style="color: #7bc275;">\\addtokomafont{section}{\\color{level1}}</span>
<span style="color: #7bc275;">\\newkomafont{sectionprefix}{\\color{level1}}</span>
<span style="color: #7bc275;">\\addtokomafont{subsection}{\\color{level2}}</span>
<span style="color: #7bc275;">\\newkomafont{subsectionprefix}{\\color{level2}}</span>
<span style="color: #7bc275;">\\addtokomafont{subsubsection}{\\color{level3}}</span>
<span style="color: #7bc275;">\\newkomafont{subsubsectionprefix}{\\color{level3}}</span>
<span style="color: #7bc275;">\\addtokomafont{paragraph}{\\color{level4}}</span>
<span style="color: #7bc275;">\\newkomafont{paragraphprefix}{\\color{level4}}</span>
<span style="color: #7bc275;">\\addtokomafont{subparagraph}{\\color{level5}}</span>
<span style="color: #7bc275;">\\newkomafont{subparagraphprefix}{\\color{level5}}</span>

<span style="color: #7bc275;">\\renewcommand{\\labelitemi}{\\textcolor{itemlabel}{\\textbullet}}</span>
<span style="color: #7bc275;">\\renewcommand{\\labelitemii}{\\textcolor{itemlabel}{\\normalfont\\bfseries \\textendash}}</span>
<span style="color: #7bc275;">\\renewcommand{\\labelitemiii}{\\textcolor{itemlabel}{\\textasteriskcentered}}</span>
<span style="color: #7bc275;">\\renewcommand{\\labelitemiv}{\\textcolor{itemlabel}{\\textperiodcentered}}</span>

<span style="color: #7bc275;">\\renewcommand{\\labelenumi}{\\textcolor{itemlabel}{\\theenumi.}}</span>
<span style="color: #7bc275;">\\renewcommand{\\labelenumii}{\\textcolor{itemlabel}{(\\theenumii)}}</span>
<span style="color: #7bc275;">\\renewcommand{\\labelenumiii}{\\textcolor{itemlabel}{\\theenumiii.}}</span>
<span style="color: #7bc275;">\\renewcommand{\\labelenumiv}{\\textcolor{itemlabel}{\\theenumiv.}}</span>

<span style="color: #7bc275;">\\DeclareTextFontCommand{\\texttt}{\\color{code}\\ttfamily}</span>
<span style="color: #7bc275;">\\makeatletter</span>
<span style="color: #7bc275;">\\def\\verbatim@font{\\color{verbatim}\\normalfont\\ttfamily}</span>
<span style="color: #7bc275;">\\makeatother</span>
<span style="color: #7bc275;">%% end customisations</span>
<span style="color: #7bc275;">"</span>
           <span style="color: #51afef;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">doom-rpartial</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">substring</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span>
                   <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">list</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">solaire-default-face</span> <span style="color: #C57BDB;">:background</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">default</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #62686E;">;;</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">red</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">orange</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">green</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">teal</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">yellow</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">blue</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dark-blue</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">magenta</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">violet</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">cyan</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">dark-cyan</span><span style="color: #7bc275;">)</span>
                    <span style="color: #62686E;">;;</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-1</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-2</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-3</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-4</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-5</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-6</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-7</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">outline-8</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #62686E;">;;</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">link</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-ref-cite-face</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">doom-color</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">yellow</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-list-dt</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-code</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">face-attribute</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">org-verbatim</span> <span style="color: #C57BDB;">:foreground</span><span style="color: #7bc275;">)</span>
                    <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-exporting-latex-make" class="outline-6">
<h6 id="exporting-latex-make"> <a class="anchor" aria-hidden="true" href="#exporting-latex-make">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex-make">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex-make">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex-make">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-latex-make">🔗</a><span class="section-number-6">5.2.3.4.2</span> Make verbatim different to code</h6>
<div class="outline-text-6" id="text-5-2-3-4-2">
<p>
Since have just gone to so much effort above let&rsquo;s make the most of it by making
<kbd>verbatim</kbd> use <code>verb</code> instead of <code>protectedtexttt</code> (default).
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-latex-text-markup-alist</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">bold</span> . <span style="color: #7bc275;">"\\textbf{%s}"</span><span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span>code . protectedtexttt<span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span>italic . <span style="color: #7bc275;">"\\emph{%s}"</span><span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span>strike-through . <span style="color: #7bc275;">"\\sout{%s}"</span><span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span>underline . <span style="color: #7bc275;">"\\uline{%s}"</span><span style="color: #7bc275;">)</span>
           <span style="color: #7bc275;">(</span>verbatim . verb<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-exporting-beamer" class="outline-5">
<h5 id="exporting-beamer"> <a class="anchor" aria-hidden="true" href="#exporting-beamer">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-beamer">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-beamer">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-beamer">🔗</a><span class="section-number-5">5.2.3.5</span> Exporting to Beamer</h5>
<div class="outline-text-5" id="text-5-2-3-5">
<p>
It&rsquo;s nice to use a different theme
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-beamer-theme</span> <span style="color: #7bc275;">"[progressbar=foot]metropolis"</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Then customise it a bit
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">
</pre>
</div>
<p>
And I think that it&rsquo;s natural to divide a presentation into sections, e.g.
Introduction, Overview&#x2026; so let&rsquo;s set bump up the headline level that becomes a
frame from <code>1</code> to <code>2</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-beamer-frame-level</span> <span style="color: #e69055; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-exporting-gfm" class="outline-5">
<h5 id="exporting-gfm"> <a class="anchor" aria-hidden="true" href="#exporting-gfm">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-gfm">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-gfm">🔗</a> <a class="anchor" aria-hidden="true" href="#exporting-gfm">🔗</a><span class="section-number-5">5.2.3.6</span> Exporting to GFM</h5>
<div class="outline-text-5" id="text-5-2-3-6">
<p>
We just need to load <code>ox-gfm</code> for org-mode documents
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">eval-after-load</span> <span style="color: #7bc275;">"org"</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #51afef;">require</span> <span style="color: #C57BDB;">'</span><span style="color: #a991f1;">ox-gfm</span> nil t<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-babel" class="outline-4">
<h4 id="babel"> <a class="anchor" aria-hidden="true" href="#babel">🔗</a> <a class="anchor" aria-hidden="true" href="#babel">🔗</a> <a class="anchor" aria-hidden="true" href="#babel">🔗</a><span class="section-number-4">5.2.4</span> Babel</h4>
<div class="outline-text-4" id="text-5-2-4">
<p>
Doom lazy-loads babel languages, with is lovely.
</p>

<p>
We need to tell babel to use python3. Who uses python2 anymore anyway? And why
doesn&rsquo;t <code>python</code> refer to the latest version!?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">org-babel-python-command</span> <span style="color: #7bc275;">"python3"</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
We also like auto-completion here
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec-org-python</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #DFDFDF;">major-mode</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">python-mode</span><span style="color: #7bc275;">)</span>
   <span style="color: #7bc275;">(</span><span style="color: #51afef;">progn</span> <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">anaconda-mode</span> t<span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #DFDFDF;">company-mode</span> t<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">org-src-mode-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">tec-org-python</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org-mode-ess" class="outline-4">
<h4 id="org-mode-ess"> <a class="anchor" aria-hidden="true" href="#org-mode-ess">🔗</a> <a class="anchor" aria-hidden="true" href="#org-mode-ess">🔗</a> <a class="anchor" aria-hidden="true" href="#org-mode-ess">🔗</a><span class="section-number-4">5.2.5</span> ESS</h4>
<div class="outline-text-4" id="text-5-2-5">
<p>
We don&rsquo;t want <code>R</code> evaluation to hang the editor, hence
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> ess-eval-visibly <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">nowait</span><span style="color: #51afef;">)</span>
</pre>
</div>
<p>
Syntax highlighting is nice, so let&rsquo;s turn all of that on
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> ess-R-font-lock-keywords <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>ess-R-fl-keyword:keywords . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-R-fl-keyword:constants . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-R-fl-keyword:modifiers . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-R-fl-keyword:fun-defs . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-R-fl-keyword:assign-ops . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-R-fl-keyword:%op% . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-fl-keyword:fun-calls . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-fl-keyword:numbers . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-fl-keyword:operators . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-fl-keyword:delimiters . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-fl-keyword:= . t<span style="color: #7bc275;">)</span>
 <span style="color: #7bc275;">(</span>ess-R-fl-keyword:F&amp;T . t<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-language-configuration-latex" class="outline-3">
<h3 id="language-configuration-latex"> <a class="anchor" aria-hidden="true" href="#language-configuration-latex">🔗</a> <a class="anchor" aria-hidden="true" href="#language-configuration-latex">🔗</a><span class="section-number-3">5.3</span> LaTeX</h3>
<div class="outline-text-3" id="text-5-3">
<p>
<img src='https://imgs.xkcd.com/comics/file_extensions.png' title="I have never been lied to by data in a .txt file which has been hand-aligned." alt='File Extensions'>
</p>
</div>
<div id="outline-container-be-implemented-ideas" class="outline-4">
<h4 id="be-implemented-ideas"> <a class="anchor" aria-hidden="true" href="#be-implemented-ideas">🔗</a> <a class="anchor" aria-hidden="true" href="#be-implemented-ideas">🔗</a> <a class="anchor" aria-hidden="true" href="#be-implemented-ideas">🔗</a><span class="section-number-4">5.3.1</span> To-be-implemented ideas</h4>
<div class="outline-text-4" id="text-5-3-1">
<ul class="org-ul">
<li>Paste image from clipboard
<ul class="org-ul">
<li>Determine first folder in <code>graphicspath</code> if applicable</li>
<li>Ask for file name</li>
<li><p>
Use <code>xclip</code> to save file to graphics folder, or current directory (whichever applies)
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #C57BDB;">command</span> -v xclip &gt;/dev/null <span style="color: #e69055; font-weight: bold;">2</span>&gt;&amp;<span style="color: #e69055; font-weight: bold;">1</span> || <span style="color: #51afef;">{</span> <span style="color: #FCCE7B;">echo</span> &gt;&amp;<span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #7bc275;">"no xclip"</span>; <span style="color: #51afef;">exit</span> <span style="color: #e69055; font-weight: bold;">1</span>; <span style="color: #51afef;">}</span>

<span style="color: #51afef;">if</span>
xclip -selection clipboard -target image/png -o &gt;/dev/null <span style="color: #e69055; font-weight: bold;">2</span>&gt;&amp;<span style="color: #e69055; font-weight: bold;">1</span>
<span style="color: #51afef;">then</span>
xclip -selection clipboard -target image/png -o &gt;$<span style="color: #e69055; font-weight: bold;">1</span> <span style="color: #e69055; font-weight: bold;">2</span>&gt;/dev/null
<span style="color: #FCCE7B;">echo</span> $<span style="color: #e69055; font-weight: bold;">1</span>
<span style="color: #51afef;">else</span>
<span style="color: #FCCE7B;">echo</span> <span style="color: #7bc275;">"no image"</span>
<span style="color: #51afef;">fi</span>
</pre>
</div></li>
<li>Insert figure, with filled in details as a result (activate <kbd>yasnippet</kbd> with
filename as variable maybe?)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-compilation" class="outline-4">
<h4 id="compilation"> <a class="anchor" aria-hidden="true" href="#compilation">🔗</a> <a class="anchor" aria-hidden="true" href="#compilation">🔗</a> <a class="anchor" aria-hidden="true" href="#compilation">🔗</a><span class="section-number-4">5.3.2</span> Compilation</h4>
<div class="outline-text-4" id="text-5-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">TeX-save-query</span> nil
      <span style="color: #DFDFDF;">TeX-show-compilation</span> t
      <span style="color: #DFDFDF;">TeX-command-extra-options</span> <span style="color: #7bc275;">"-shell-escape"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> latex
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">TeX-command-list</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"XeLaTeX"</span> <span style="color: #7bc275;">"%`xelatex%(mode)%' %t"</span> TeX-run-TeX nil t<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
For viewing the PDF, I rather like the pdf-tools viewer. While auctex is trying
to be nice in recognising that I have some PDF viewing apps installed, I&rsquo;d
rather not have it default to using them, so let&rsquo;s re-order the preferences.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">+latex-viewers</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>pdf-tools evince zathura okular skim sumatrapdf<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-snippet-helpers" class="outline-4">
<h4 id="snippet-helpers"> <a class="anchor" aria-hidden="true" href="#snippet-helpers">🔗</a> <a class="anchor" aria-hidden="true" href="#snippet-helpers">🔗</a> <a class="anchor" aria-hidden="true" href="#snippet-helpers">🔗</a><span class="section-number-4">5.3.3</span> Snippet helpers</h4>
<div class="outline-text-4" id="text-5-3-3">
</div>
<div id="outline-container-template" class="outline-5">
<h5 id="template"> <a class="anchor" aria-hidden="true" href="#template">🔗</a> <a class="anchor" aria-hidden="true" href="#template">🔗</a> <a class="anchor" aria-hidden="true" href="#template">🔗</a> <a class="anchor" aria-hidden="true" href="#template">🔗</a><span class="section-number-5">5.3.3.1</span> Template</h5>
<div class="outline-text-5" id="text-5-3-3-1">
<p>
For use in the new-file template, let&rsquo;s set out a nice preamble we may want to use.
Then let&rsquo;s bind the content to a function, and define some nice helpers.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> tec/yas-latex-template-preamble <span style="color: #7bc275;">"</span>
<span style="color: #7bc275;">\\usepackage[pdfa,unicode=true,hidelinks]{hyperref}</span>

<span style="color: #7bc275;">\\usepackage[dvipsnames,svgnames,table,hyperref]{xcolor}</span>
<span style="color: #7bc275;">\\renewcommand{\\UrlFont}{\\ttfamily\\small}</span>

<span style="color: #7bc275;">\\usepackage[a-2b]{pdfx} % why not be archival</span>

<span style="color: #7bc275;">\\usepackage[T1]{fontenc}</span>
<span style="color: #7bc275;">\\usepackage[osf,helvratio=0.9]{newpxtext} % pallatino</span>
<span style="color: #7bc275;">\\usepackage[scale=0.92]{sourcecodepro}</span>

<span style="color: #7bc275;">\\usepackage[varbb]{newpxmath}</span>
<span style="color: #7bc275;">\\usepackage{mathtools}</span>
<span style="color: #7bc275;">\\usepackage{amssymb}</span>

<span style="color: #7bc275;">\\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=2000]{microtype}</span>
<span style="color: #7bc275;">% microtype makes text look nicer</span>

<span style="color: #7bc275;">\\usepackage{graphicx} % include graphics</span>
<span style="color: #7bc275;">\\usepackage{grffile} % fix allowed graphicx filenames</span>

<span style="color: #7bc275;">\\usepackage{booktabs} % nice table rules</span>
<span style="color: #7bc275;">"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/yas-latex-get-class-choice</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #7e7e87;">"Prompt user for LaTeX class choice"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> tec/yas-latex-class-choice <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">ivy-read</span> <span style="color: #7bc275;">"Select document class: "</span> <span style="color: #C57BDB;">'</span><span style="color: #51afef;">(</span><span style="color: #7bc275;">"article"</span> <span style="color: #7bc275;">"scrartcl"</span> <span style="color: #7bc275;">"bmc"</span><span style="color: #51afef;">)</span> <span style="color: #C57BDB;">:def</span> <span style="color: #7bc275;">"bmc"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/yas-latex-preamble-if</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #7e7e87;">"Based on class choice prompt for insertion of default preamble"</span>
    <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">equal</span> tec/yas-latex-class-choice <span style="color: #7bc275;">"bmc"</span><span style="color: #7bc275;">)</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">nil</span>
             <span style="color: #7bc275;">(</span><span style="color: #a991f1;">eq</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">read-char-choice</span> <span style="color: #7bc275;">"Include default preamble? [Type y/n]"</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>?y ?n<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> ?y<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-deliminators" class="outline-5">
<h5 id="deliminators"> <a class="anchor" aria-hidden="true" href="#deliminators">🔗</a> <a class="anchor" aria-hidden="true" href="#deliminators">🔗</a> <a class="anchor" aria-hidden="true" href="#deliminators">🔗</a> <a class="anchor" aria-hidden="true" href="#deliminators">🔗</a><span class="section-number-5">5.3.3.2</span> Deliminators</h5>
<div class="outline-text-5" id="text-5-3-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> tex
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">tec/tex-last-delim-char</span> nil
    <span style="color: #7e7e87;">"Last open delim expanded in a tex document"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span> t
    <span style="color: #7e7e87;">"When the `</span><span style="color: #a991f1;">tec/tex-last-delim-char</span><span style="color: #7e7e87;">' is . a second charachter (this) is prompted for"</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/get-open-delim-char</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Exclusivly read next char to tec/tex-last-delim-char"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span> nil<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">tec/tex-last-delim-char</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">read-char-exclusive</span> <span style="color: #7bc275;">"Opening deliminator, recognises: 9 ( [ { &lt; | ."</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">when</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">eql</span> ?. <span style="color: #DFDFDF;">tec/tex-last-delim-char</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">read-char-exclusive</span> <span style="color: #7bc275;">"Other deliminator, recognises: 0 9 (  ) [ ] { } &lt; &gt; |"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/tex-open-delim-from-char</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> open-char<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Find the associated opening delim as string"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">unless</span> open-char <span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> open-char <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">eql</span> ?. <span style="color: #DFDFDF;">tec/tex-last-delim-char</span><span style="color: #7bc275;">)</span>
                                          <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span>
                                        <span style="color: #DFDFDF;">tec/tex-last-delim-char</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">case</span> open-char
      <span style="color: #51afef;">(</span>?\( <span style="color: #7bc275;">"("</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>?9  <span style="color: #7bc275;">"("</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>?\[ <span style="color: #7bc275;">"["</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>?\{ <span style="color: #7bc275;">"\\{"</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>?&lt;  <span style="color: #7bc275;">"&lt;"</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>?|  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span> <span style="color: #7bc275;">"."</span> <span style="color: #7bc275;">"|"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>t   <span style="color: #7bc275;">"."</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/tex-close-delim-from-char</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> open-char<span style="color: #7bc275;">)</span>
    <span style="color: #7e7e87;">"Find the associated closing delim as string"</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">case</span> <span style="color: #DFDFDF;">tec/tex-delim-dot-second</span>
          <span style="color: #C57BDB;">(</span>?\) <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>?0  <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>?\] <span style="color: #7bc275;">"]"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>?\} <span style="color: #7bc275;">"\\}"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>?\&gt; <span style="color: #7bc275;">"&gt;"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>?|  <span style="color: #7bc275;">"|"</span><span style="color: #C57BDB;">)</span>
          <span style="color: #C57BDB;">(</span>t   <span style="color: #7bc275;">"."</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span><span style="color: #51afef;">case</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">or</span> open-char <span style="color: #DFDFDF;">tec/tex-last-delim-char</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\( <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?9  <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\[ <span style="color: #7bc275;">"]"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\{ <span style="color: #7bc275;">"\\}"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?&lt;  <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\) <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?0  <span style="color: #7bc275;">")"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\] <span style="color: #7bc275;">"]"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\} <span style="color: #7bc275;">"\\}"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?\&gt; <span style="color: #7bc275;">"&gt;"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>?|  <span style="color: #7bc275;">"|"</span><span style="color: #C57BDB;">)</span>
        <span style="color: #C57BDB;">(</span>t   <span style="color: #7bc275;">"."</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/tex-next-char-smart-close-delim</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> open-char<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">bound-and-true-p</span> <span style="color: #DFDFDF;">smartparens-mode</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #a991f1;">eql</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">char-after</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">case</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">or</span> open-char <span style="color: #DFDFDF;">tec/tex-last-delim-char</span><span style="color: #7bc275;">)</span>
                             <span style="color: #7bc275;">(</span>?\( ?\)<span style="color: #7bc275;">)</span>
                             <span style="color: #7bc275;">(</span>?\[ ?\]<span style="color: #7bc275;">)</span>
                             <span style="color: #7bc275;">(</span>?{ ?}<span style="color: #7bc275;">)</span>
                             <span style="color: #7bc275;">(</span>?&lt; ?&gt;<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">tec/tex-delim-yas-expand</span> <span style="color: #7bc275;">(</span><span style="color: #FCCE7B;">&amp;optional</span> open-char<span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">yas-expand-snippet</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">yas-lookup-snippet</span> <span style="color: #7bc275;">"_deliminators"</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex-mode</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">point</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">+</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">point</span><span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">tec/tex-next-char-smart-close-delim</span> open-char<span style="color: #7bc275;">)</span> <span style="color: #e69055; font-weight: bold;">2</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-editor-visuals" class="outline-4">
<h4 id="editor-visuals"> <a class="anchor" aria-hidden="true" href="#editor-visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#editor-visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#editor-visuals">🔗</a><span class="section-number-4">5.3.4</span> Editor visuals</h4>
<div class="outline-text-4" id="text-5-3-4">
<p>
Once again, <i>all hail mixed pitch mode!</i>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #5cEfFF;">add-hook</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">LaTeX-mode-hook</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">mixed-pitch-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Let&rsquo;s enhance <code>TeX-fold-math</code> a bit
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> latex
  <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">setcar</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">assoc</span> <span style="color: #7bc275;">"&#8902;"</span> <span style="color: #DFDFDF;">LaTeX-fold-math-spec-list</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"&#9733;"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">make \star bigger</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">TeX-fold-math-spec-list</span>
      <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #62686E;">;; </span><span style="color: #62686E;">missing/better symbols</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8804;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"le"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8805;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"ge"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8800;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"ne"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">conviniance shorts -- these don't work nicely ATM</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">("&#8249;" ("left"))</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">("&#8250;" ("right"))</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">private macros</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8477;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"RR"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8469;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"NN"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8484;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"ZZ"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8474;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"QQ"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8450;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"CC"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8473;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"PP"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8461;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"HH"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#120124;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"EE"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#119889;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"dd"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">known commands</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">""</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"phantom"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>num den<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">TeX-string-single-token-p</span> num<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">TeX-string-single-token-p</span> den<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
                           <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> num <span style="color: #7bc275;">"&#65295;"</span> den<span style="color: #7bc275;">)</span>
                         <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"&#10090;"</span> num <span style="color: #7bc275;">"&#65295;"</span> den <span style="color: #7bc275;">"&#10091;"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"frac"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>arg<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"&#8730;"</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">TeX-fold-parenthesize-as-neccesary</span> arg<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"sqrt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>arg<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #7bc275;">"&#11105;"</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">TeX-fold-parenthesize-as-neccesary</span> arg<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"vec"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8216;</span><span style="color: #a991f1;">{1}</span><span style="color: #7bc275;">&#8217;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"text"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">private commands</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"|{1}|"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"abs"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8214;{1}&#8214;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"norm"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8970;{1}&#8971;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"floor"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8968;{1}&#8969;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"ceil"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8970;{1}&#8969;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"round"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#119889;{1}/&#119889;{2}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"dv"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8706;{1}/&#8706;{2}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"pdv"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">fancification</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathrm"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #e69055; font-weight: bold;">119743</span> word<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathbf"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #e69055; font-weight: bold;">119951</span> word<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathcal"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #e69055; font-weight: bold;">120003</span> word<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathfrak"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #e69055; font-weight: bold;">120055</span> word<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathbb"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #e69055; font-weight: bold;">120159</span> word<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathsf"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>word<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #e69055; font-weight: bold;">120367</span> word<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"mathtt"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #C57BDB;">)</span>
      <span style="color: #DFDFDF;">TeX-fold-macro-spec-list</span>
      <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">as the defaults</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"[f]"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"footnote"</span> <span style="color: #7bc275;">"marginpar"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"[c]"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"cite"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"[l]"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"label"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"[r]"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"ref"</span> <span style="color: #7bc275;">"pageref"</span> <span style="color: #7bc275;">"eqref"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"[i]"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"index"</span> <span style="color: #7bc275;">"glossary"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"..."</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"dots"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"emph"</span> <span style="color: #7bc275;">"textit"</span> <span style="color: #7bc275;">"textsl"</span> <span style="color: #7bc275;">"textmd"</span> <span style="color: #7bc275;">"textrm"</span> <span style="color: #7bc275;">"textsf"</span> <span style="color: #7bc275;">"texttt"</span>
            <span style="color: #7bc275;">"textbf"</span> <span style="color: #7bc275;">"textsc"</span> <span style="color: #7bc275;">"textup"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">tweaked defaults</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#169;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"copyright"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#174;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"textregistered"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#8482;"</span>  <span style="color: #51afef;">(</span><span style="color: #7bc275;">"texttrademark"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"[1]:||&#9658;"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"item"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#10081;&#10081;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"part"</span> <span style="color: #7bc275;">"part*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#10081;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"chapter"</span> <span style="color: #7bc275;">"chapter*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#167;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"section"</span> <span style="color: #7bc275;">"section*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#167;&#167;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"subsection"</span> <span style="color: #7bc275;">"subsection*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#167;&#167;&#167;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"subsubsection"</span> <span style="color: #7bc275;">"subsubsection*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#182;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"paragraph"</span> <span style="color: #7bc275;">"paragraph*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#182;&#182;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"subparagraph"</span> <span style="color: #7bc275;">"subparagraph*"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #62686E;">;; </span><span style="color: #62686E;">extra</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#11030;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"begin"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #7bc275;">(</span><span style="color: #7bc275;">"&#11031;&#8198;{1}"</span> <span style="color: #51afef;">(</span><span style="color: #7bc275;">"end"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
        <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">string-offset-roman-chars</span> <span style="color: #C57BDB;">(</span>offset word<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Shift the codepoint of each charachter in WORD by OFFSET with an extra -6 shift if the letter is lowercase"</span>
    <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">apply</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">string</span>
       <span style="color: #7bc275;">(</span><span style="color: #a991f1;">mapcar</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #C57BDB;">(</span>c<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">+</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">&gt;=</span> c <span style="color: #e69055; font-weight: bold;">97</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">-</span> c <span style="color: #e69055; font-weight: bold;">6</span><span style="color: #51afef;">)</span> c<span style="color: #7bc275;">)</span> offset<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> word<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">TeX-fold-parenthesize-as-neccesary</span> <span style="color: #C57BDB;">(</span>tokens <span style="color: #FCCE7B;">&amp;optional</span> suppress-left suppress-right<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Add &#10090; &#10091; parenthesis as if multiple LaTeX tokens appear to be present"</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">TeX-string-single-token-p</span> tokens<span style="color: #7bc275;">)</span> tokens
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">concat</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> suppress-left <span style="color: #7bc275;">""</span> <span style="color: #7bc275;">"&#10090;"</span><span style="color: #51afef;">)</span>
            tokens
            <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> suppress-right <span style="color: #7bc275;">""</span> <span style="color: #7bc275;">"&#10091;"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">TeX-string-single-token-p</span> <span style="color: #C57BDB;">(</span>teststring<span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Return t if TESTSTRING appears to be a single token, nil otherwise"</span>
 <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #5cEfFF;">string-match-p</span> <span style="color: #7bc275;">"^\\\\?\\w+$"</span> teststring<span style="color: #7bc275;">)</span> t nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Some local keybindings to make life a bit easier
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> tex
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">map!</span>
   <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">LaTeX-mode-map</span>
   <span style="color: #C57BDB;">:ei</span> <span style="color: #7bc275;">[</span>C-return<span style="color: #7bc275;">]</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">LaTeX-insert-item</span>

   <span style="color: #62686E;">;; </span><span style="color: #62686E;">normal stuff here</span>
   <span style="color: #C57BDB;">:localleader</span>
   <span style="color: #C57BDB;">:desc</span> <span style="color: #7bc275;">"View"</span> <span style="color: #7bc275;">"v"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">TeX-view</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">TeX-electric-math</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"</span><span style="color: #C57BDB; font-weight: bold;">\\</span><span style="color: #C57BDB; font-weight: bold;">(</span><span style="color: #7bc275;">"</span> . <span style="color: #7bc275;">""</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Maths deliminators can be de-emphasised a bit
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #62686E;">;; </span><span style="color: #62686E;">Making \( \) less visible</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defface</span> <span style="color: #DFDFDF;">unimportant-latex-face</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>t
     <span style="color: #C57BDB;">:inherit</span> <span style="color: #DFDFDF;">font-lock-comment-face</span> <span style="color: #C57BDB;">:family</span> <span style="color: #7bc275;">"Overpass"</span> <span style="color: #C57BDB;">:weight</span> light<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #7e7e87;">"Face used to make \\(\\), \\[</span><span style="color: #a991f1;">\\</span><span style="color: #7e7e87;">] less visible."</span>
  <span style="color: #C57BDB;">:group</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">LaTeX-math</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">font-lock-add-keywords</span>
 <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex-mode</span>
 <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>,<span style="color: #51afef;">(</span><span style="color: #51afef;">rx</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> <span style="color: #7bc275;">"\\"</span> <span style="color: #7bc275;">(</span>any <span style="color: #7bc275;">"()[]"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span> <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">unimportant-latex-face</span> prepend<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
 <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">end</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #5cEfFF;">font-lock-add-keywords</span>
 <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">latex-mode</span>
 <span style="color: #C57BDB;">`</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">(</span>,<span style="color: #7bc275;">"\\\\[[:word:]]+"</span> <span style="color: #e69055; font-weight: bold;">0</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">font-lock-keyword-face</span> prepend<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
 <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">end</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
And enable shell escape for the preview
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #DFDFDF;">preview-LaTeX-command</span> <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"%`%l \"\\nonstopmode\\nofiles\</span>
<span style="color: #7bc275;">\\PassOptionsToPackage{"</span> <span style="color: #7bc275;">(</span><span style="color: #7bc275;">","</span> . <span style="color: #DFDFDF;">preview-required-option-list</span><span style="color: #7bc275;">)</span> <span style="color: #7bc275;">"}{preview}\</span>
<span style="color: #7bc275;">\\AtBeginDocument{\\ifx\\ifPreview\\undefined"</span>
<span style="color: #DFDFDF;">preview-default-preamble</span> <span style="color: #7bc275;">"\\fi}\"%' \"\\detokenize{\" %t \"}\""</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-latex-cdlatex" class="outline-4">
<h4 id="latex-cdlatex"> <a class="anchor" aria-hidden="true" href="#latex-cdlatex">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-cdlatex">🔗</a> <a class="anchor" aria-hidden="true" href="#latex-cdlatex">🔗</a><span class="section-number-4">5.3.5</span> CDLaTeX</h4>
<div class="outline-text-4" id="text-5-3-5">
<p>
The symbols and modifies are very nice by default, but could do with a bit of
fleshing out. Let&rsquo;s change the prefix to a key which is similarly rarely used,
but more convenient, like <kbd>;</kbd>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> cdlatex
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">cdlatex-math-symbol-prefix ?\; ;; doesn't work at the moment :(</span>
   <span style="color: #DFDFDF;">cdlatex-math-symbol-alist</span>
   <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">adding missing functions to 3rd level symbols</span>
     <span style="color: #51afef;">(</span>?_    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\downarrow"</span>  <span style="color: #7bc275;">""</span>           <span style="color: #7bc275;">"\\inf"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?2    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"^2"</span>           <span style="color: #7bc275;">"\\sqrt{?}"</span>     <span style="color: #7bc275;">""</span>     <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?3    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"^3"</span>           <span style="color: #7bc275;">"\\sqrt[3]{?}"</span>  <span style="color: #7bc275;">""</span>     <span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?^    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\uparrow"</span>    <span style="color: #7bc275;">""</span>           <span style="color: #7bc275;">"\\sup"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?k    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\kappa"</span>      <span style="color: #7bc275;">""</span>           <span style="color: #7bc275;">"\\ker"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?m    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\mu"</span>         <span style="color: #7bc275;">""</span>           <span style="color: #7bc275;">"\\lim"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?c    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">""</span>             <span style="color: #7bc275;">"\\circ"</span>     <span style="color: #7bc275;">"\\cos"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?d    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\delta"</span>      <span style="color: #7bc275;">"\\partial"</span>  <span style="color: #7bc275;">"\\dim"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?D    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\Delta"</span>      <span style="color: #7bc275;">"\\nabla"</span>    <span style="color: #7bc275;">"\\deg"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #62686E;">;; </span><span style="color: #62686E;">no idea why \Phi isnt on 'F' in first place, \phi is on 'f'.</span>
     <span style="color: #51afef;">(</span>?F    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\Phi"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #62686E;">;; </span><span style="color: #62686E;">now just conveniance</span>
     <span style="color: #51afef;">(</span>?.    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\cdot"</span> <span style="color: #7bc275;">"\\dots"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?:    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\vdots"</span> <span style="color: #7bc275;">"\\ddots"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?*    <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\times"</span> <span style="color: #7bc275;">"\\star"</span> <span style="color: #7bc275;">"\\ast"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
   <span style="color: #DFDFDF;">cdlatex-math-modify-alist</span>
   <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span> <span style="color: #62686E;">;; </span><span style="color: #62686E;">my own stuff</span>
     <span style="color: #51afef;">(</span>?B    <span style="color: #7bc275;">"\\mathbb"</span>        nil          t    nil  nil<span style="color: #51afef;">)</span>
     <span style="color: #51afef;">(</span>?a    <span style="color: #7bc275;">"\\abs"</span>           nil          t    nil  nil<span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
In a smilar vein to this, really whenever I have a number after a symbol (letter
or command) I want it as a subscript. <b>@yoavm448</b> did some lovely legwork to
provide this:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">prvt/auto-number-subscript</span> <span style="color: #C57BDB;">()</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">interactive</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">if</span> <span style="color: #7bc275;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">or</span> <span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&gt;=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">char-before</span><span style="color: #51afef;">)</span> ?a<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&lt;=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">char-before</span><span style="color: #51afef;">)</span> ?z<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
               <span style="color: #C57BDB;">(</span><span style="color: #51afef;">and</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&gt;=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">char-before</span><span style="color: #51afef;">)</span> ?A<span style="color: #7bc275;">)</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">&lt;=</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">char-before</span><span style="color: #51afef;">)</span> ?Z<span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">cl-digit-char-p</span> <span style="color: #C57BDB;">(</span><span style="color: #a991f1;">string-to-char</span> <span style="color: #7bc275;">(</span><span style="color: #a991f1;">this-command-keys</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #5cEfFF;">texmathp</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
      <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #7bc275;">"_"</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">this-command-keys</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #a991f1;">insert</span> <span style="color: #51afef;">(</span><span style="color: #a991f1;">this-command-keys</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">map!</span>
 <span style="color: #C57BDB;">:after</span> tex <span style="color: #C57BDB;">:map</span> <span style="color: #DFDFDF;">LaTeX-mode-map</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"0"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"1"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"2"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"3"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"4"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"5"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"6"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"7"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"8"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span>
 <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"9"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">prvt/auto-number-subscript</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-synctex" class="outline-4">
<h4 id="synctex"> <a class="anchor" aria-hidden="true" href="#synctex">🔗</a> <a class="anchor" aria-hidden="true" href="#synctex">🔗</a> <a class="anchor" aria-hidden="true" href="#synctex">🔗</a><span class="section-number-4">5.3.6</span> SyncTeX</h4>
<div class="outline-text-4" id="text-5-3-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> tex
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">TeX-view-program-list</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #7bc275;">"Evince"</span> <span style="color: #7bc275;">"evince %o"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">add-to-list</span> <span style="color: #C57BDB;">'</span><span style="color: #DFDFDF;">TeX-view-program-selection</span> <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span>output-pdf <span style="color: #7bc275;">"Evince"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-evilification" class="outline-4">
<h4 id="evilification"> <a class="anchor" aria-hidden="true" href="#evilification">🔗</a> <a class="anchor" aria-hidden="true" href="#evilification">🔗</a> <a class="anchor" aria-hidden="true" href="#evilification">🔗</a><span class="section-number-4">5.3.7</span> Evilification</h4>
<div class="outline-text-4" id="text-5-3-7">
<p>
Let&rsquo;s face it. Being evil is fun, let&rsquo;s take it as far as we can.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> evil-tex
  <span style="color: #C57BDB;">:hook</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">LaTeX-mode</span> . <span style="color: #DFDFDF;">evil-tex-mode</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-python" class="outline-3">
<h3 id="python"> <a class="anchor" aria-hidden="true" href="#python">🔗</a> <a class="anchor" aria-hidden="true" href="#python">🔗</a><span class="section-number-3">5.4</span> Python</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Since I&rsquo;m using <kbd>mypyls</kbd>, as suggested in <a href="file:///home/tec/.emacs.d/modules/lang/python/README.html#MissingReference">:lang python LSP support</a> I&rsquo;ll tweak the
priority of <kbd>mypyls</kbd>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> lsp-python-ms
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">set-lsp-priority!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">mspyls</span> <span style="color: #e69055; font-weight: bold;">1</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-r" class="outline-3">
<h3 id="r"> <a class="anchor" aria-hidden="true" href="#r">🔗</a> <a class="anchor" aria-hidden="true" href="#r">🔗</a><span class="section-number-3">5.5</span> R</h3>
<div class="outline-text-3" id="text-5-5">
</div>
<div id="outline-container-r-editor-visuals" class="outline-4">
<h4 id="r-editor-visuals"> <a class="anchor" aria-hidden="true" href="#r-editor-visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#r-editor-visuals">🔗</a> <a class="anchor" aria-hidden="true" href="#r-editor-visuals">🔗</a><span class="section-number-4">5.5.1</span> Editor Visuals</h4>
<div class="outline-text-4" id="text-5-5-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> ess-r-mode
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">appendq!</span> <span style="color: #DFDFDF;">+pretty-code-symbols</span>
            <span style="color: #C57BDB;">'</span><span style="color: #7bc275;">(</span><span style="color: #C57BDB;">:assign</span> <span style="color: #7bc275;">"&#10229;"</span>
              <span style="color: #C57BDB;">:multiply</span> <span style="color: #7bc275;">"&#215;"</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">set-pretty-symbols!</span> <span style="color: #C57BDB;">'</span><span style="color: #FCCE7B;">ess-r-mode</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Functional</span>
    <span style="color: #C57BDB;">:def</span> <span style="color: #7bc275;">"function"</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Types</span>
    <span style="color: #C57BDB;">:null</span> <span style="color: #7bc275;">"NULL"</span>
    <span style="color: #C57BDB;">:true</span> <span style="color: #7bc275;">"TRUE"</span>
    <span style="color: #C57BDB;">:false</span> <span style="color: #7bc275;">"FALSE"</span>
    <span style="color: #C57BDB;">:int</span> <span style="color: #7bc275;">"int"</span>
    <span style="color: #C57BDB;">:floar</span> <span style="color: #7bc275;">"float"</span>
    <span style="color: #C57BDB;">:bool</span> <span style="color: #7bc275;">"bool"</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Flow</span>
    <span style="color: #C57BDB;">:not</span> <span style="color: #7bc275;">"!"</span>
    <span style="color: #C57BDB;">:and</span> <span style="color: #7bc275;">"&amp;&amp;"</span> <span style="color: #C57BDB;">:or</span> <span style="color: #7bc275;">"||"</span>
    <span style="color: #C57BDB;">:for</span> <span style="color: #7bc275;">"for"</span>
    <span style="color: #C57BDB;">:in</span> <span style="color: #7bc275;">"%in%"</span>
    <span style="color: #C57BDB;">:return</span> <span style="color: #7bc275;">"return"</span>
    <span style="color: #62686E;">;; </span><span style="color: #62686E;">Other</span>
    <span style="color: #C57BDB;">:assign</span> <span style="color: #7bc275;">"&lt;-"</span>
    <span style="color: #C57BDB;">:multiply</span> <span style="color: #7bc275;">"%*%"</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-hledger" class="outline-3">
<h3 id="hledger"> <a class="anchor" aria-hidden="true" href="#hledger">🔗</a> <a class="anchor" aria-hidden="true" href="#hledger">🔗</a><span class="section-number-3">5.6</span> hledger</h3>
<div class="outline-text-3" id="text-5-6">
<p>
<code>ledger-mode</code> is great and all, but <code>hledger</code> seems to be more actively maintained.
For example, from 2018&#x2013;2020, the most prolific contributor to <code>ledger</code> produced
31 commits. For <code>hledger</code> this statistic is 1800 commits. In addition, over the
last decade, <code>ledger</code> seems to have lost steam, while <code>hledger</code> seems as actively
developed as ever. From this basic comparison <code>hledger</code> looks to have a more
promising outlook. It also has a few extra niceties that <code>ledger</code> doesn&rsquo;t, but is
a little slower (<code>haskell</code> vs. <code>c++</code>).
Since this uses the same format, and <code>ledger-mode</code> is well integrated into emacs,
and produced by John Wiegley &#x2014; author of <code>ledger</code> and current Emacs maintainer
&#x2014; using this seems like a good idea. Thankfully we can, with a little modification.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> ledger-mode-should-check-version nil
      ledger-report-links-in-register nil
      ledger-binary-path <span style="color: #7bc275;">"hledger"</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-markdown" class="outline-3">
<h3 id="markdown"> <a class="anchor" aria-hidden="true" href="#markdown">🔗</a> <a class="anchor" aria-hidden="true" href="#markdown">🔗</a><span class="section-number-3">5.7</span> Markdown</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Let&rsquo;s use mixed pitch, because it&rsquo;s great
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">gfm-mode</span> markdown-mode<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">mixed-pitch-mode</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Most of the time when I write markdown, it&rsquo;s going into some app/website which
will do it&rsquo;s own line wrapping, hence we <i>only</i> want to use visual line wrapping. No hard stuff.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">gfm-mode</span> markdown-mode<span style="color: #C57BDB;">)</span> <span style="color: #C57BDB;">#'</span><span style="color: #DFDFDF;">visual-line-mode</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">turn-off-auto-fill</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Since markdown is often seen as rendered HTML, let&rsquo;s try to somewhat mirror the
style or markdown renderes.
</p>

<p>
Most markdown renders seem to make the first three headings levels larger than
normal text, the first two much so. Then the fourth level tends to be the same
as body text, while the fifth and sixth are (increasingly) smaller, with the
sixth greyed out. Since the sixth level is so small, I&rsquo;ll turn up the boldness a notch.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">custom-set-faces!</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>markdown-header-face-1 <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.25</span> <span style="color: #C57BDB;">:weight</span> extra-bold <span style="color: #C57BDB;">:inherit</span> markdown-header-face<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>markdown-header-face-2 <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.15</span> <span style="color: #C57BDB;">:weight</span> bold       <span style="color: #C57BDB;">:inherit</span> markdown-header-face<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>markdown-header-face-3 <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.08</span> <span style="color: #C57BDB;">:weight</span> bold       <span style="color: #C57BDB;">:inherit</span> markdown-header-face<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>markdown-header-face-4 <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">1.00</span> <span style="color: #C57BDB;">:weight</span> bold       <span style="color: #C57BDB;">:inherit</span> markdown-header-face<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>markdown-header-face-5 <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0.90</span> <span style="color: #C57BDB;">:weight</span> bold       <span style="color: #C57BDB;">:inherit</span> markdown-header-face<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">'</span><span style="color: #C57BDB;">(</span>markdown-header-face-6 <span style="color: #C57BDB;">:height</span> <span style="color: #e69055; font-weight: bold;">0.75</span> <span style="color: #C57BDB;">:weight</span> extra-bold <span style="color: #C57BDB;">:inherit</span> markdown-header-face<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-beancount" class="outline-3">
<h3 id="beancount"> <a class="anchor" aria-hidden="true" href="#beancount">🔗</a> <a class="anchor" aria-hidden="true" href="#beancount">🔗</a><span class="section-number-3">5.8</span> Beancount</h3>
<div class="outline-text-3" id="text-5-8">
<p>
The <a href="https://bitbucket.org/blais/beancount/src/tip/editors/emacs/beancount.el">beancount package</a> online has been put into <code>./lisp</code>, we just need to load and
enable it for <code>.beancount</code> files.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> beancount
  <span style="color: #C57BDB;">:load-path</span> <span style="color: #7bc275;">"~/.config/doom/lisp"</span>
  <span style="color: #C57BDB;">:mode</span> <span style="color: #C57BDB;">(</span><span style="color: #7bc275;">"\\.beancount\\'"</span> . beancount-mode<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">:config</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">setq</span> beancount-electric-currency t<span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">defun</span> <span style="color: #5cEfFF;">beancount-bal</span> <span style="color: #7bc275;">()</span>
    <span style="color: #7e7e87;">"Run bean-report bal."</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">interactive</span><span style="color: #7bc275;">)</span>
    <span style="color: #7bc275;">(</span><span style="color: #51afef;">let</span> <span style="color: #51afef;">(</span><span style="color: #C57BDB;">(</span><span style="color: #DFDFDF;">compilation-read-command</span> nil<span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
      <span style="color: #51afef;">(</span>beancount--run <span style="color: #7bc275;">"bean-report"</span>
                      <span style="color: #C57BDB;">(</span><span style="color: #5cEfFF;">file-relative-name</span> <span style="color: #DFDFDF;">buffer-file-name</span><span style="color: #C57BDB;">)</span> <span style="color: #7bc275;">"bal"</span><span style="color: #51afef;">)</span><span style="color: #7bc275;">)</span><span style="color: #C57BDB;">)</span>
  <span style="color: #C57BDB;">(</span><span style="color: #51afef;">map!</span> <span style="color: #C57BDB;">:map</span> beancount-mode-map
        <span style="color: #C57BDB;">:n</span> <span style="color: #7bc275;">"TAB"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">beancount-align-to-previous-number</span>
        <span style="color: #C57BDB;">:i</span> <span style="color: #7bc275;">"TAB"</span> <span style="color: #C57BDB;">#'</span><span style="color: #FCCE7B;">beancount-tab-dwim</span><span style="color: #C57BDB;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: tecosaur</p>
<p class="date">Created: 2020-06-02 Tue 13:05</p>
</div>
</body>
</html>
